{"version":3,"sources":["webpack://frag/./src/Animations/Animation.js","webpack://frag/./src/Animations/KeyframeAnimationAction.js","webpack://frag/./src/Animations/ModelAnimation.js","webpack://frag/./src/Animations/ObjectAnimationState.js","webpack://frag/./src/Animations/ParallelAnimationAction.js","webpack://frag/./src/Animations/PositionAnimationAction.js","webpack://frag/./src/Animations/RepeatAnimationAction.js","webpack://frag/./src/Animations/SceneObjectAnimation.js","webpack://frag/./src/Animations/ValueAnimationAction.js","webpack://frag/./src/Cameras/OrthographicCamera.js","webpack://frag/./src/Cameras/PerspectiveCamera.js","webpack://frag/./src/Cameras/UiCamera.js","webpack://frag/./src/Framework/Framework.js","webpack://frag/./src/Framework/Init.js","webpack://frag/./src/Framework/Location.js","webpack://frag/./src/Framework/Observable.js","webpack://frag/./src/Framework/Transform.js","webpack://frag/./src/Framework/Transform2D.js","webpack://frag/./src/Input/AnalogAction.js","webpack://frag/./src/Input/AnalogInput.js","webpack://frag/./src/Input/AnalogState.js","webpack://frag/./src/Input/DigitalAction.js","webpack://frag/./src/Input/DigitalInput.js","webpack://frag/./src/Input/DigitalState.js","webpack://frag/./src/Input/HitTest.js","webpack://frag/./src/Input/InputMethod.js","webpack://frag/./src/Loaders/AssetCatalog.js","webpack://frag/./src/Loaders/MaterialLoader.js","webpack://frag/./src/Loaders/PackageLoader.js","webpack://frag/./src/Materials/Font.js","webpack://frag/./src/Materials/Material.js","webpack://frag/./src/Materials/Texture.js","webpack://frag/./src/Math/Matrix.js","webpack://frag/./src/Math/Triangle.js","webpack://frag/./src/Math/Vector.js","webpack://frag/./src/SceneGraph/MeshData.js","webpack://frag/./src/SceneGraph/MeshOptimizer.js","webpack://frag/./src/SceneGraph/Model.js","webpack://frag/./src/SceneGraph/Scene.js","webpack://frag/./src/SceneGraph/SceneObject.js","webpack://frag/./src/SceneGraph/ScenePosition.js","webpack://frag/./src/SceneGraph/VertexData.js","webpack://frag/./src/Shaders/CustomShader.js","webpack://frag/./src/Shaders/FontShader.js","webpack://frag/./src/Shaders/Shader.js","webpack://frag/./src/Shaders/UiShader.js","webpack://frag/./src/Shapes/Cube.js","webpack://frag/./src/Shapes/Cylinder.js","webpack://frag/./src/Shapes/Disc.js","webpack://frag/./src/Shapes/Plane.js","webpack://frag/webpack/bootstrap","webpack://frag/./src/index.js"],"names":["window","frag","Animation","obj","isChild","private","stopAfter","isRunning","public","__private","DEFAULT_STEP_DURATION","getIsRunning","setDuration","gameTicks","duration","setInterval","interval","action","parent","gameTick","frameTick","undefined","stopAt","sequence","step","sequenceIndex","stop","deactivateAnimation","disposeOnStop","dispose","nextStepTick","length","autoRestart","start","nextGameTick","frameRepeat","nextFrameTick","tickRepeat","actions","loop","Array","isArray","i","perform","activateAnimation","repeatTicks","actionToRepeat","repeatFrames","frameCount","addAnimation","removeAnimation","KeyframeAnimationAction","startTick","currentFrame","keyframes","frames","animation","Math","floor","keyframe","data","keyframeIndex","push","ModelAnimation","channelGraphs","name","value","expandKeyframes","values","currentValue","priorKeyframe","frame","transition","startValue","slope","addChannel","channel","pattern","frameValues","ObjectAnimationState","location","Location","getMatrix","channelName","translateX","isModified","translateY","translateZ","scaleX","scaleY","scaleZ","rotateX","rotateY","rotateZ","console","warn","ParallelAnimationAction","forEach","a","PositionAnimationAction","scenePosition","invLinearVelocity","invAngularVelocity","Vector","startLocation","startRotate","moveBy","rotateBy","moveTo","rotateTo","vector","distance","eulerAngles","x","y","z","onStart","onStop","getLocation","getRotate","rotateDelta","b","delta","sub","PI","angularDelta","moveDelta","endTick","r","add","mult","rotate","RepeatAnimationAction","count","SceneObjectAnimation","animationMap","modelAnimation","childAnimations","updateFunctions","childAnimation","modelName","model","getName","animationState","graph","update","getUpdateFunction","frameAction","setFrames","getInterval","getFrames","getLoop","ValueAnimationAction","onStep","OrthographicCamera","fov","zNear","zFar","xScale","aspectRatio","worldToClipTransform","Transform","computeTransformMatrix","yScale","zScale","zOffset","identity","scaleXYZ","translateXY","moveToXY","moveToXYZ","moveToX","moveToY","moveToZ","frustrum","fieldOfView","setViewport","gl","viewport","canvas","clientWidth","clientHeight","width","height","adjustToViewport","drawingBufferWidth","drawingBufferHeight","matrix","setMatrix","PerspectiveCamera","locationTransform","worldTransform","perspectiveTransform","xRot","yRot","zRot","transformChanged","computeCameraTransforms","translateXYZ","rotateXYZ","computePerspectiveTransform","zt","computeTransform","transformMatrix","Matrix","m4Xm4","UiCamera","Transform2D","horizontalScale","scenes","activeAnimations","inactiveAnimations","startTime","performance","now","mainScene","nextAnimationId","frameTimes","frameTimesSum","correctClock","serverTick","difference","gameTickMs","scene","getMainScene","addScene","removeScene","splice","id","render","t0","playAnimations","bindFramebuffer","FRAMEBUFFER","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","drawContext","draw","elapsed","shift","fps","setTimeout","renderInterval","startFunctions","init","document","getElementById","error","getContext","alert","addEventListener","event","preventDefault","clearColor","enable","CULL_FACE","DEPTH_TEST","debugPackageLoader","debugShaderBuilder","debugAnimations","debugMeshes","debugInputs","maxTextureUnits","getParameter","MAX_COMBINED_TEXTURE_IMAGE_UNITS","nextTextureUnit","allocateTextureUnit","result","config","is3d","clone","other","transform","scaleXY","Observable","notify","observers","observer","fn","ObservableValue","observable","v","subscribe","unsubscribe","observableMatrix","o","scale","s","d","rad","c","cos","sin","apply","uniform","uniformMatrix4fv","m3Xm3","uniformMatrix3fv","AnalogAction","actionName","context","splits","split","mode","axis","test","analogState","getCamera","sceneObject","AnalogInput","inputName","downPosition","downValue","buttons","vertical","inverted","wheel","moveHandler","evt","fraction","clientY","clientX","maxValue","minValue","log","setValue","downHandler","wheelHandler","deltaY","decrement","increment","disable","removeEventListener","leftKey","rightKey","handler","key","clientLength","span","additionalTouches","index","touchStartHandler","touches","touch","item","touch1","touch2","spanX","spanY","sqrt","angle","dirX","dirY","atan2","controllerIndex","stickIndex","axisIndex","gamepad","poll","axes","setVelocity","maxVelocity","connectedHandler","e","disconnectedHandler","clearInterval","AnalogState","analogAction","acceleration","deceleration","abs","velocity","change","calcVelocity","DigitalAction","digitalState","isOn","DigitalInput","toggle","setOn","setOff","setIsOn","ctrl","alt","meta","isDown","altKey","ctrlKey","shiftKey","metaKey","keyDownHandler","keyUpHandler","DigitalState","digitalAction","shader","hitTest","attributes","uniforms","vSource","fSource","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","program","createProgram","position","getAttribLocation","clipMatrix","getUniformLocation","color","bind","useProgram","unbind","texture","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","frameBuffer","createFramebuffer","framebufferTexture2D","COLOR_ATTACHMENT0","depthBuffer","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","DEPTH_COMPONENT16","framebufferRenderbuffer","DEPTH_ATTACHMENT","isHitTest","sceneObjects","models","pixel","Uint8Array","readPixels","red","green","blue","modelId","sceneObjectId","InputMethod","inputs","enabled","input","AssetCatalog","defaultTextures","defaultTexturePixels","diffuse","Texture","dataFormat","fromArrayBuffer","buffer","surface","emmissive","RGB","normal","Shader","verticiesXYZ","matrix3D","diffuseTexture","directionalLightGrey","compile","fonts","materials","font","Font","material","Material","disposeTextures","setTexture","Model","MaterialLoader","uInt32","Uint32Array","littleEndian","loadMipV1","header","headerOffset","dataOffset","mipLevel","flags","getUint8","colorDataOffset","getUint32","debugMaterialLoader","colorTexture","surfaceDataOffset","surfaceTexture","normalMapDataOffset","normalMap","pbrDataOffset","pbrTexture","loadMaterialV1","assetCatalog","nameLength","String","fromCharCode","getMaterial","mip","nextMip","loadMaterialsFromBuffer","bytes","DataView","version","headerLength","getUint16","textureSize","loadMaterialsFromUrl","url","onload","xhttp","XMLHttpRequest","responseType","onreadystatechange","this","readyState","status","response","open","send","PackageLoader","round4","n","round","loadFontV1","objectIndex","getFont","faceLength","fontFace","lineHeight","charCount","charIndex","charLength","char","originX","getInt16","originY","advance","addChar","modeLength","LUMINANCE","imageWidth","imageHeight","dataArray","loadMeshV1","mesh","MeshData","fragmentCount","fragmentIndex","vertexFormat","dataFlags","normalFormat","tangentFormat","bitangentFormat","uvFormat","colorFormat","meshVertexCount","indexVertexCount","isIndexed","is3D","triangleCount","msg","indexArray","Int16Array","verticies","normals","tangents","bitangents","uvs","colors","Float32Array","vertexOffset","indexOffset","triangleOffset","trunc","sectionDataIndex","vertexDataIndex","vertexData","VertexData","setTriangles","setTriangles2D","setTriangleStrip","setTriangleFan","addVertexData","loadAnimationV1","channelCount","reverse","patternLength","channelNameLength","keyframeCount","j","transitionEnum","getFloat32","RegExp","loadModelV1","modelFlags","materialIndex","meshIndex","childCount","animationCount","isRoot","hasMaterial","hasMesh","getModel","meshes","modelIndex","addChild","animationIndex","animations","channels","getChannelGraphs","channelIndex","loadFromBuffer","objectSize","expectedObjectIndex","objectType","objectOffset","loadFromUrl","glTexture","generated","internalFormat","format","dataType","valuesPerPixel","chars","textureUnit","deleteTexture","disposed","LUMINANCE_ALPHA","formaat","ALPHA","setup","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","offset","bufferView","fromImage","image","load","activeTexture","TEXTURE0","generateMipmap","LINEAR_MIPMAP_NEAREST","TEXTURE_MAG_FILTER","uniform1i","buildTextMesh","text","drawChar","ch","dimensions","left","right","top","bottom","pushVerticies","texLeft","texTop","pushTexture","addTriangles","shadeFlat","textureFlat","buildTextModel","fontShader","updateTextModel","oldMesh","getMesh","textures","textureType","shouldDispose","currentTexture","level","fromUrl","crossOrigin","Image","src","fromScene","m3Identity","m3Invert","m3Transpose","a00","a01","a02","a10","a11","a12","a20","a21","a22","b00","b01","b02","b10","b11","b12","b20","b21","b22","m3Xv3","b0","b1","b2","m4Identity","m4Invert","m4Transpose","a03","a13","a23","a30","a31","a32","a33","b03","b13","b23","b30","b31","b32","b33","m4Xv4","c0r0","c0r1","c0r2","c0r3","c1r0","c1r1","c1r2","c1r3","c2r0","c2r1","c2r2","c2r3","c3r0","c3r1","c3r2","c3r3","b3","Triangle","makeTriangleFromVectors","makeTriangleFromArray2D","array","offsetA","offsetB","offsetC","makeTriangleFromArray3D","triangle","v1","v2","normalize","cross","extract2D","extract3D","zero","div","sum","average","dot","append","directionVector","upVector","dir","up","pitch","asin","yaw","wingDir","glBuffer","createBuffer","meshFragments","debugFragments","finalized","fromBuffer","smoothShading","smoothTexture","wireframe","normalLength","normalColor","calcNormals","calcTangents","calcBitangents","deleteBuffer","drawWireframe","Fragment","renderData","vertexDataOffset","uvDataOffset","normalDataOffset","tangentDataOffset","bitangentDataOffset","addFragment","addTriangles2D","addTriangleStrip","addTriangleFan","size","primitiveType","vertexDimensions","vertexCount","extractTriangles","fragment","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","addFragmentDebugInfo","newFragment","addVertex","vertex","getVertexVector","getColor","uv","getUvVector","getNormalVector","t","addNormal","setLines2D","setLines","finalize","optimizer","MeshOptimizer","setFragments","initialize","calcTangentsFromUvs","calcBitangentsFromUvs","calcNormalsFromCross","calcNormalsFromGeometry","calcBitangentsFromCross","f","countFragmentLength","copy","arr","BYTES_PER_ELEMENT","copyFragmentData","drawFragmentPosition","enableVertexAttribArray","vertexAttribPointer","FLOAT","disableVertexAttribArray","drawFragmentColor","colorDimensions","drawFragmentTexture","uvDimensions","drawFragmentNormals","normalDimensions","drawFragmentTangents","tangent","drawFragmentBitangents","bitangent","drawFragment","drawArrays","fragmentTriangles","groups","groupIndecies","ensureTriangles","triangles","vertexTriangleIndecies","vectorA","vectorB","vectorC","fragmentTriangle","uvA","uvB","uvC","deltaPos1","deltaPos2","deltaUv1","deltaUv2","ri","ensureGroups","equal","vertexIndex","found","groupIndex","group","fragmentIndecies","calcGroupNormals","vertexNormal","calcGroupUvs","fragmentIndicies","calcSmoothShading","calcSmoothTexture","tangentIndex","triangleIndex","setTangentVector","bitangentIndex","setBitangentVector","normalIndex","getTangentVector","getBitangentVector","setNormalVector","children","meshData","flattenedChildren","predicate","child","addFlattenedChildren","ScenePosition","m","getShader","depth","shadeSmooth","textureSmooth","drawNormals","graphs","childName","modelToWorldMatrix","modelToClipMatrix","localMatrix","alpha","uniform4f","modelMatrix","Scene","activeCamera","cameraUpdated","camera","SceneObject","animationLocation","childModelName","objectAnimation","getAnimationLocation","getPosition","getAnimationPosition","clearAnimationPosition","animationName","worldToClipMatrix","setLocation","getScaleX","getScaleY","getScaleZ","scaleBy","scales","scaleByXYZ","getRotateX","getRotateY","getRotateZ","euler","rotateByXYZ","getLocationX","getLocationY","getLocationZ","locationXYZ","locationX","locationY","locationZ","direction","moveByXYZ","TRIANGLES","from","coord","getVector","setVector","setVertexVector","colorIndex","setColor","uvIndex","setUvVector","addTriangle","TRIANGLE_STRIP","TRIANGLE_FAN","LINES","setLineStrip","LINE_STRIP","type","source","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","deleteShader","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","CustomShader","bindList","unbindList","vertexShaderSource","fragmentShaderSource","attribute","glType","initialValue","newValue","none","textureCoords","emmissiveTexture","displacementTexture","roughnessTexture","shininessTexture","metalinessTexture","directionalLight","ambientLight","addAttributeDeclarations","addUniformDeclarations","addVaryingDeclarations","statement","addLogic","displacementScale","uniform1f","_displacementScale","_ambientLight","lightDirection","uniform3fv","_lightDirection","lightColor","_lightColor","balanceAmbient","uiShader","verticiesXY","matrix2D","Cube","facets","options","drawFront","drawBack","drawTop","drawBottom","drawLeft","drawRight","u1","u2","corners","addUv","u","addFacetVerticies","bottomRight","topRight","bottomLeft","topLeft","addFacetUvs","uLeft","vBottom","uRight","vTop","addFace","vFacet","vFracLow","vFracHigh","vFacetBottom","vFacetTop","hFacet","hFracLow","hFracHigh","facetBottomLeft","facetBottomRight","facetTopLeft","facetTopRight","duplicateTexture","Cylinder","topUvs","topNormals","topColors","bottomUvs","bottomNormals","bottomColors","side","sideColors","sideUvs","sideNormals","Disc","Plane","row","y0","y1","column","x0","x1","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__"],"mappings":"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","file":"frag.min.js","sourcesContent":["// The framework maintains a list of these animations and runs the animations\r\n// efficiently within the rendering cycle. All animation mechanisms use this\r\n// implementation as a base. Note that an object can be passed into the constructor\r\n// and it will be embelished with proprties and methods to make it into an animation.\r\n// This allows you to store custom fields relating to your animation and access them\r\n// within the animation steps.\r\nwindow.frag.Animation = function (obj, isChild) {\r\n    const private = {\r\n        stopAfter: 0,\r\n        isRunning: false\r\n    }\r\n\r\n    const public = obj || {};\r\n    public.__private = private;\r\n\r\n    const DEFAULT_STEP_DURATION = 100;\r\n    const DEFAULT_STEP_INTERVAL = 5;\r\n    const DEFAULT_REPEAT_TICKS = 20;\r\n    const DEFAULT_REPEAT_FRAMES = 1;\r\n\r\n    public.getIsRunning = function() {\r\n        return private.isRunning;\r\n    }\r\n\r\n    // If you set the duration it should be done before passing this\r\n    // animation to the sequence() method of another animation\r\n    public.setDuration = function (gameTicks) {\r\n        public.duration = gameTicks;\r\n        return public;\r\n    }\r\n\r\n    // If you set the interval it should be done before passing this\r\n    // animation to the sequence() method of another animation\r\n    public.setInterval = function (gameTicks) {\r\n        public.interval = gameTicks;\r\n        return public;\r\n    }\r\n\r\n    // This is called internally by the framework. You should not call this\r\n    // from your application code.\r\n    public.action = function (parent, gameTick, frameTick) {\r\n        if (private.stopAfter !== undefined) {\r\n            private.stopAt = gameTick + private.stopAfter;\r\n            delete private.stopAfter;\r\n        }\r\n\r\n        if (private.stopAt !== undefined && gameTick >= private.stopAt) {\r\n            if (private.sequence) {\r\n                let step = private.sequence[private.sequenceIndex];\r\n                if (step.stop) step.stop(public, gameTick);\r\n            }\r\n            window.frag.deactivateAnimation(public);\r\n            if (private.disposeOnStop) public.dispose();\r\n            private.isRunning = false;\r\n            return;\r\n        }\r\n\r\n        if (private.sequence) {\r\n            let step = private.sequence[private.sequenceIndex];\r\n            if (private.nextStepTick) {\r\n                if (gameTick >= private.nextStepTick) {\r\n                    if (step.stop) step.stop(public, gameTick);\r\n                    private.sequenceIndex++;\r\n                    if (private.sequenceIndex === private.sequence.length) {\r\n                        if (private.autoRestart) {\r\n                            private.sequenceIndex = 0;\r\n                            step = private.sequence[private.sequenceIndex];\r\n                            if (step.start) step.start(public, gameTick);\r\n                            private.nextStepTick = gameTick + (step.duration || DEFAULT_STEP_DURATION);\r\n                        } else {\r\n                            private.stopAt = gameTick;\r\n                        }\r\n                    } else {\r\n                        step = private.sequence[private.sequenceIndex];\r\n                        if (step.start) step.start(public, gameTick);\r\n                        public.interval = step.interval;\r\n                        private.nextStepTick = gameTick + (step.duration || DEFAULT_STEP_DURATION);\r\n                    }\r\n                }\r\n            } else {\r\n                private.nextStepTick = gameTick + (step.duration || DEFAULT_STEP_DURATION);\r\n                if (step.start) step.start(public, gameTick);\r\n            }\r\n            private.action = step.action;\r\n            public.nextGameTick = gameTick + (step.interval || DEFAULT_STEP_INTERVAL);\r\n        } else if (private.frameRepeat !== undefined) {\r\n            public.nextFrameTick = frameTick + private.frameRepeat;\r\n        } else if (private.tickRepeat !== undefined) {\r\n            public.nextGameTick = gameTick + private.tickRepeat;\r\n        }\r\n\r\n        if (private.action) private.action(public, gameTick, frameTick);\r\n    }\r\n\r\n    // Defines a sequence of timed actions to perform when the animation runs\r\n    // Each action can :\r\n    // - optionally implement start() and stop() functions that are passed the animation object and the current game tick\r\n    // - optionally have a duration field that defines the number of game ticks that this action should run for\r\n    // - optionally have an interval field that defines the number of game ticks between executions of this action\r\n    // - optionally have an action() function that will be called to perform tge animation function\r\n    public.sequence = function (actions, loop) {\r\n        if (Array.isArray(actions)) \r\n            private.sequence = actions;\r\n        else\r\n            private.sequence = [actions];\r\n        private.sequenceIndex = 0;\r\n        private.autoRestart = loop;\r\n\r\n        let duration = 0;\r\n        for (let i = 0; i < private.sequence.length; i++) {\r\n            const action = private.sequence[i];\r\n            if (action.duration !== undefined)\r\n                duration = duration + action.duration;\r\n            else\r\n                duration = duration + DEFAULT_STEP_DURATION;\r\n        }\r\n        public.duration = duration;\r\n        return public;\r\n    }\r\n\r\n    // Syntactic sugar for a sequence of one action\r\n    public.perform = function(action, loop) {\r\n        return public.sequence(action, loop);\r\n    }\r\n\r\n    // Starts the animation running\r\n    public.start = function () {\r\n        delete private.nextStepTick;\r\n        delete private.stopAfter;\r\n        delete private.stopAt;\r\n        window.frag.activateAnimation(public);\r\n        private.isRunning = true;\r\n        return public;\r\n    }\r\n\r\n    // Stops the animation\r\n    public.stop = function () {\r\n        private.stopAfter = 0;\r\n        return public;\r\n    }\r\n\r\n    // Executes an action function at a regular interval in game ticks\r\n    public.repeatTicks = function (actionToRepeat, gameTicks) {\r\n        delete private.autoRestart;\r\n        delete private.frameRepeat;\r\n        delete private.sequence;\r\n\r\n        private.tickRepeat = gameTicks || actionToRepeat.interval || DEFAULT_REPEAT_TICKS;\r\n        private.action = actionToRepeat;\r\n\r\n        return public;\r\n    }\r\n\r\n    // Executes an action function at a regular number of frame refreshes\r\n    public.repeatFrames = function (actionToRepeat, frameCount) {\r\n        delete private.autoRestart;\r\n        delete private.tickRepeat;\r\n        delete private.sequence;\r\n\r\n        private.frameRepeat = frameCount || DEFAULT_REPEAT_FRAMES;\r\n        private.action = actionToRepeat;\r\n\r\n        return public;\r\n    }\r\n\r\n    // Automatically stops the animation after the specified number of game ticks\r\n    public.stopAfter = function (gameTicks) {\r\n        private.stopAfter = gameTicks;\r\n        delete private.stopAt;\r\n        return public;\r\n    }\r\n\r\n    public.disposeOnStop = function(dispose){\r\n        private.disposeOnStop = dispose;\r\n    }\r\n\r\n    if (!isChild) window.frag.addAnimation(public);\r\n\r\n    public.dispose = function () {\r\n        window.frag.removeAnimation(public);\r\n    }\r\n\r\n    return public;\r\n}\r\n\r\n","// Provides a mechanism to execute animation actions at specific keyframes\r\n// KeyframeAnimationAction objects can be passed to an Animation object as the action\r\n// to take in one of the steps in an animation sequence\r\nwindow.frag.KeyframeAnimationAction = function () {\r\n    const private = {\r\n        startTick: undefined,\r\n        currentFrame: undefined,\r\n        keyframes: {}\r\n    };\r\n\r\n    const public = {\r\n        __private: private,\r\n        interval: 10,\r\n        frames: 100,\r\n    };\r\n\r\n    // This function is used internally\r\n    public.start = function (animation, gameTick) {\r\n        private.startTick = gameTick;\r\n        private.currentFrame = -1;\r\n        return public;\r\n    }\r\n\r\n    // This function is used internally\r\n    public.action = function (animation, gameTick) {\r\n        let currentFrame = Math.floor((gameTick - private.startTick) / public.interval);\r\n        while (private.currentFrame < currentFrame) {\r\n            private.currentFrame++;\r\n            const keyframe = private.keyframes[private.currentFrame];\r\n            if (keyframe) {\r\n                for (let i = 0; i < keyframe.length; i++)\r\n                    keyframe[i].action(private.currentFrame, keyframe[i].data, gameTick);\r\n            }\r\n        }\r\n        return public;\r\n    }\r\n\r\n    public.setFrames = function(interval, frames){\r\n        public.interval = interval;\r\n        public.frames = frames || public.frames;\r\n        public.duration = public.interval * public.frames;\r\n        return public;\r\n    }\r\n\r\n    // Adds an action to perform at a specific keyframe. The data object will\r\n    // be passed to the action function when the keyframe is actioned\r\n    public.add = function(keyframeIndex, action, data){\r\n        let keyframe = private.keyframes[keyframeIndex];\r\n        if (!keyframe) {\r\n            keyframe = [];\r\n            private.keyframes[keyframeIndex] = keyframe;\r\n        }\r\n        keyframe.push({ action, data });\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n}\r\n","// Defines an animation that can be applied to scene objects based on a particular model\r\nwindow.frag.ModelAnimation = function () {\r\n    const private = {\r\n        loop: false,\r\n        interval: 10,\r\n        frames: 50,\r\n        channelGraphs: [],\r\n        name: \"\",\r\n    };\r\n\r\n    const public = {\r\n        __private: private,\r\n    };\r\n\r\n    public.getChannelGraphs = function () {\r\n        return private.channelGraphs;\r\n    }\r\n\r\n    public.name = function (value) {\r\n        private.name = value;\r\n        return public;\r\n    }\r\n\r\n    public.getName = function () {\r\n        return private.name;\r\n    }\r\n\r\n    public.loop = function (value) {\r\n        private.loop = value;\r\n        return public;\r\n    }\r\n\r\n    public.getLoop = function () {\r\n        return private.loop;\r\n    }\r\n\r\n    public.interval = function (value) {\r\n        private.interval = value;\r\n        return public;\r\n    }\r\n\r\n    public.getInterval = function () {\r\n        return private.interval;\r\n    }\r\n\r\n    public.frames = function (value) {\r\n        private.frames = value;\r\n        return public;\r\n    }\r\n\r\n    public.getFrames = function () {\r\n        return private.frames;\r\n    }\r\n\r\n    const expandKeyframes = function (keyframes) {\r\n        const values = [];\r\n        values.length = private.frames;\r\n        let currentValue = undefined;\r\n        let priorKeyframe = 0;\r\n        for (let frame = 0; frame < private.frames; frame++) {\r\n            const keyframe = keyframes[frame];\r\n            if (keyframe !== undefined) {\r\n                currentValue = keyframe.value;\r\n                if (keyframe.transition === \"linear\") {\r\n                    const startValue = values[priorKeyframe];\r\n                    const steps = frame - priorKeyframe;\r\n                    const range = currentValue - startValue;\r\n                    const slope = range / steps;\r\n                    for (let i = priorKeyframe + 1; i < frame; i++) {\r\n                        values[i] = startValue + (i - priorKeyframe) * slope;\r\n                    }\r\n                }\r\n                priorKeyframe = frame;\r\n            }\r\n            values[frame] = currentValue;\r\n        }\r\n        return values;\r\n    };\r\n\r\n    // Build a graph of channel values at each frame based on keyframe changes\r\n\r\n    public.addChannel = function (channel) {\r\n        private.channelGraphs.push({\r\n            pattern: channel.pattern,\r\n            channel: channel.channel,\r\n            frameValues: expandKeyframes(channel.keyframes)\r\n        });\r\n    };\r\n\r\n    return public;\r\n};\r\n","// Represents the current state of an object being animated\r\nwindow.frag.ObjectAnimationState = function () {\r\n    const private = {\r\n    };\r\n\r\n    const public = {\r\n        __private: private,\r\n        location: window.frag.Location(),\r\n    };\r\n\r\n    public.getMatrix = function () {\r\n        return public.location.getMatrix();\r\n    }\r\n\r\n    public.getUpdateFunction = function(channelName) {\r\n        switch (channelName) {\r\n            case \"translate-x\":\r\n                return function (value) {\r\n                    public.location.translateX = value;\r\n                    public.location.isModified = true;\r\n                };\r\n            case \"translate-y\":\r\n                return function (value) {\r\n                    public.location.translateY = value;\r\n                    public.location.isModified = true;\r\n                };\r\n            case \"translate-z\":\r\n                return function (value) {\r\n                    public.location.translateZ = value;\r\n                    public.location.isModified = true;\r\n                }\r\n\r\n            case \"scale-x\":\r\n                return function (value) {\r\n                    public.location.scaleX = value;\r\n                    public.location.isModified = true;\r\n                };\r\n            case \"scale-y\":\r\n                return function (value) {\r\n                    public.location.scaleY = value;\r\n                    public.location.isModified = true;\r\n                };\r\n            case \"scale-z\":\r\n                return function (value) {\r\n                    public.location.scaleZ = value;\r\n                    public.location.isModified = true;\r\n                }\r\n\r\n            case \"rotate-x\":\r\n                return function (value) {\r\n                    public.location.rotateX = value;\r\n                    public.location.isModified = true;\r\n                }\r\n            case \"rotate-y\":\r\n                return function (value) {\r\n                    public.location.rotateY = value;\r\n                    public.location.isModified = true;\r\n                }\r\n            case \"rotate-z\":\r\n                return function (value) {\r\n                    public.location.rotateZ = value;\r\n                    public.location.isModified = true;\r\n                };\r\n        }\r\n        console.warn(\"Unsupported animation channel \" + channelName);\r\n        return function () { };\r\n    };\r\n\r\n    return public;\r\n}\r\n","window.frag.ParallelAnimationAction = function ([actions]) {\r\n    const private = {\r\n        actions\r\n    };\r\n\r\n    const public = {\r\n        __private: private,\r\n        duration: 30,\r\n        interval: 5,\r\n    };\r\n\r\n    public.setDuration = function (gameTicks) {\r\n        public.duration = gameTicks;\r\n        return public;\r\n    }\r\n\r\n    public.setInterval = function (gameTicks) {\r\n        public.interval = gameTicks;\r\n        return public;\r\n    }\r\n\r\n    public.start = function (animation, gameTick) {\r\n        private.actions.forEach(a => {\r\n            if (a.start) a.start(animation, gameTick);\r\n        });\r\n        return public;\r\n    }\r\n\r\n    public.action = function (animation, gameTick) {\r\n        private.actions.forEach(a => {\r\n            if (a.action) a.action(animation, gameTick);\r\n        });\r\n        return public;\r\n    }\r\n\r\n    public.stop = function (animation, gameTick) {\r\n        private.actions.forEach(a => {\r\n            if (a.stop) a.stop(animation, gameTick);\r\n        });\r\n    }\r\n\r\n    return public;\r\n}\r\n","// Provides a mechanism to move an object in the scene at a specific speed\r\nwindow.frag.PositionAnimationAction = function (scenePosition, invLinearVelocity, invAngularVelocity) {\r\n    const frag = window.frag;\r\n    const Vector = frag.Vector;\r\n\r\n    const private = {\r\n        scenePosition,\r\n        invLinearVelocity,\r\n        invAngularVelocity,\r\n        startLocation: undefined,\r\n        startRotate: undefined,\r\n        moveBy: undefined,\r\n        rotateBy: undefined,\r\n        moveTo: undefined,\r\n        rotateTo: undefined,\r\n    };\r\n\r\n    const public = {\r\n        __private: private,\r\n    };\r\n\r\n    public.setInterval = function (gameTicks) {\r\n        public.interval = gameTicks;\r\n        return public;\r\n    }\r\n\r\n    public.moveBy = function (vector, invLinearVelocity) {\r\n        invLinearVelocity = invLinearVelocity || private.invLinearVelocity || 1;\r\n        let distance = Vector.length(vector);\r\n        public.duration = Math.floor(invLinearVelocity * distance + 1);\r\n        private.moveBy = vector;\r\n        return public;\r\n    }\r\n\r\n    public.moveTo = function (location, invLinearVelocity) {\r\n        if (invLinearVelocity) private.invAngularVelocity = undefined;\r\n        private.invLinearVelocity = invLinearVelocity || private.invLinearVelocity || 1;\r\n        private.moveTo = location;\r\n        return public;\r\n    }\r\n\r\n    public.rotateBy = function (vector, invAngularVelocity) {\r\n        invAngularVelocity = invAngularVelocity || private.invAngularVelocity || 10;\r\n        let distance = Vector.length(vector);\r\n        public.duration = Math.floor(invAngularVelocity * distance + 1);\r\n        private.rotateBy = vector;\r\n        return public;\r\n    }\r\n\r\n    public.rotateTo = function (eulerAngles, invAngularVelocity) {\r\n        if (invAngularVelocity) private.invLinearVelocity = undefined;\r\n        private.invAngularVelocity = invAngularVelocity || private.invAngularVelocity || 10;\r\n        private.rotateTo = eulerAngles;\r\n        return public;\r\n    }\r\n\r\n\r\n    public.moveByXYZ = function (x, y, z, invLinearVelocity) {\r\n        return public.moveBy([x, y, z], invLinearVelocity);\r\n    }\r\n\r\n    public.moveByXY = function (x, y, invLinearVelocity) {\r\n        return public.moveBy([x, y, 0], invLinearVelocity);\r\n    }\r\n\r\n    public.moveToXYZ = function (x, y, z, invLinearVelocity) {\r\n        return public.moveTo([x, y, z], invLinearVelocity);\r\n    }\r\n\r\n    public.moveToXY = function (x, y, invLinearVelocity) {\r\n        return public.moveTo([x, y, 0], invLinearVelocity);\r\n    }\r\n\r\n\r\n    public.rotateByXYZ = function (x, y, z, invAngularVelocity) {\r\n        return public.rotateBy([x, y, z], invAngularVelocity);\r\n    }\r\n\r\n    public.rotateByXY = function (x, y, invAngularVelocity) {\r\n        return public.rotateBy([x, y, 0], invAngularVelocity);\r\n    }\r\n\r\n    public.rotateToXYZ = function (x, y, z, invAngularVelocity) {\r\n        return public.rotateTo([x, y, z], invAngularVelocity);\r\n    }\r\n\r\n    public.rotateToXY = function (x, y, invAngularVelocity) {\r\n        return public.rotateTo([x, y, 0], invAngularVelocity);\r\n    }\r\n\r\n\r\n    public.onStart = function (onStart) {\r\n        private.onStart = onStart;\r\n        return public;\r\n    }\r\n\r\n    public.onStop = function (onStop) {\r\n        private.onStop = onStop;\r\n        return public;\r\n    }\r\n\r\n    const angularDelta = function(a, b) {\r\n        const delta = Vector.sub(a, b);\r\n        for (let i = 0; i < delta.length; i++) {\r\n            while (delta[i] < -Math.PI) delta[i] += Math.PI * 2;\r\n            while (delta[i] > Math.PI) delta[i] -= Math.PI * 2;\r\n        }\r\n        return delta;\r\n    }\r\n\r\n    const linearDelta = function(a, b) {\r\n        const delta = Vector.sub(a, b);\r\n        return delta;\r\n    }\r\n\r\n    public.start = function (animation, gameTick) {\r\n        private.startLocation = private.scenePosition.getLocation();\r\n        private.startRotate = private.scenePosition.getRotate();\r\n\r\n        if (private.rotateTo && private.invAngularVelocity) {\r\n            private.rotateDelta = angularDelta(private.rotateTo, private.startRotate);\r\n            const distance = Vector.length(private.rotateDelta);\r\n            public.duration = Math.floor(private.invAngularVelocity * distance + 1);\r\n        }\r\n\r\n        if (private.moveTo && private.invLinearVelocity) {\r\n            private.moveDelta = linearDelta(private.moveTo, private.startLocation);\r\n            const distance = Vector.length(private.moveDelta);\r\n            public.duration = Math.floor(private.invLinearVelocity * distance + 1);\r\n        }\r\n\r\n        private.startTick = gameTick;\r\n        private.endTick = gameTick + public.duration;\r\n        if (private.onStart) private.onStart(animation, public, gameTick);\r\n        return public;\r\n    }\r\n\r\n    public.action = function (animation, gameTick) {\r\n        const r = (gameTick - private.startTick) / public.duration;\r\n        let moveBy = private.moveBy;\r\n        let rotateBy = private.rotateBy;\r\n\r\n        if (private.moveDelta) \r\n            moveBy = private.moveDelta;\r\n\r\n        if (private.rotateDelta)\r\n            rotateBy = private.rotateDelta;\r\n\r\n        if (moveBy) \r\n            private.scenePosition.location(Vector.add(private.startLocation, Vector.mult(moveBy, r)));\r\n\r\n        if (rotateBy) \r\n            private.scenePosition.rotate(Vector.add(private.startRotate, Vector.mult(rotateBy, r)));\r\n\r\n        return public;\r\n    }\r\n\r\n    public.stop = function (animation, gameTick) {\r\n        if (private.onStop) private.onStop(animation, public, gameTick);\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n}\r\n","// Provides a mechanism to execute another animation action a specific\r\n// number of times\r\nwindow.frag.RepeatAnimationAction = function (action, count) {\r\n    return {\r\n        duration: action.duration * count,\r\n        interval: action.interval,\r\n        start: action.start,\r\n        stop: action.stop,\r\n        action: action.action\r\n    };\r\n}\r\n","// Constructs a model animation in the context of a scene object\r\n// For example this could be the \"moving\" animation for a model. Constructing this\r\n// object enables you to start and stop this animation on a specific scene object\r\nwindow.frag.SceneObjectAnimation = function (animation, animationMap) {\r\n    const modelAnimation = animation.modelAnimation;\r\n    const childAnimations = animation.childAnimations;\r\n\r\n    const updateFunctions = [];\r\n\r\n    for (let i = 0; i < childAnimations.length; i++) {\r\n        const childAnimation = childAnimations[i];\r\n        const modelName = childAnimation.model.getName();\r\n        animationState = animationMap[modelName];\r\n        if (animationState) {\r\n            const graph = childAnimation.graph;\r\n            const update = animationState.getUpdateFunction(graph.channel);\r\n            updateFunctions.push(function (frame) {\r\n                update(graph.frameValues[frame]);\r\n            });\r\n        }\r\n    }\r\n\r\n    const frameAction = function (frame) {\r\n        for (let i = 0; i < updateFunctions.length; i++) {\r\n            updateFunctions[i](frame);\r\n        }\r\n    }\r\n\r\n    const action = window.frag.KeyframeAnimationAction()\r\n        .setFrames(modelAnimation.getInterval(), modelAnimation.getFrames());\r\n\r\n    for (let frame = 0; frame < modelAnimation.getFrames(); frame++) {\r\n        action.add(frame, frameAction);\r\n    }\r\n\r\n    return window.frag.Animation()\r\n        .perform(action, modelAnimation.getLoop());\r\n}\r\n","// Provides a mechanism to change a value over time. For example smoothly change\r\n// one color into another or smoothly move an object within the scene.\r\n// ValueAnimationAction objects can be passed to an Animation object as the action\r\n// to take in one of the steps in an animation sequence\r\nwindow.frag.ValueAnimationAction = function () {\r\n    const private = {};\r\n\r\n    const public = {\r\n        __private: private,\r\n        duration: 30,\r\n        interval: 5,\r\n    };\r\n\r\n    public.setDuration = function (gameTicks) {\r\n        public.duration = gameTicks;\r\n        return public;\r\n    }\r\n\r\n    public.setInterval = function (gameTicks) {\r\n        public.interval = gameTicks;\r\n        return public;\r\n    }\r\n\r\n    public.onStart = function (onStart) {\r\n        private.onStart = onStart;\r\n        return public;\r\n    }\r\n\r\n    public.onStop = function (onStop) {\r\n        private.onStop = onStop;\r\n        return public;\r\n    }\r\n\r\n    public.onStep = function (onStep) {\r\n        private.onStep = onStep;\r\n        return public;\r\n    }\r\n\r\n    public.start = function (animation, gameTick) {\r\n        private.startTick = gameTick;\r\n        private.endTick = gameTick + public.duration;\r\n        if (private.onStart) private.onStart(animation, public, gameTick);\r\n        return public;\r\n    }\r\n\r\n    public.action = function (animation, gameTick) {\r\n        if (private.onStep) {\r\n            const r = (gameTick - private.startTick) / public.duration;\r\n            private.onStep(animation, r, public, gameTick);\r\n        }\r\n        return public;\r\n    }\r\n\r\n    public.stop = function (animation, gameTick) {\r\n        if (private.onStop) private.onStop(animation, public, gameTick);\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n}\r\n","// This camera draws objects in their actual size regardless of how far from the camera they are.\r\n// The frustrum affects z clip space and XY scaling to the viewport but does not scale objects in the scene\r\n\r\nwindow.frag.OrthographicCamera = function () {\r\n    const private = {\r\n        x: 0,\r\n        y: 0,\r\n        z: -200,\r\n        fov: 35 * Math.PI / 180,\r\n        zNear: -100,\r\n        zFar: 100,\r\n        xScale: 100,\r\n        aspectRatio: 1,\r\n    };\r\n\r\n    const public = {\r\n        __private: private,\r\n        worldToClipTransform: window.frag.Transform()\r\n    };\r\n\r\n    const computeTransformMatrix = function () {\r\n        const xScale = 1 / private.xScale;\r\n        const yScale = private.aspectRatio / private.xScale;\r\n\r\n        const zScale = 2 / (private.zFar - private.zNear);\r\n        const zOffset = 1 - (private.zFar * zScale);\r\n\r\n        public.worldToClipTransform\r\n            .identity()\r\n            .translateZ(zOffset)\r\n            .scaleXYZ(xScale, yScale, zScale)\r\n            .translateXY(-private.x, -private.y);\r\n    }\r\n\r\n    public.moveToXY = function (x, y) {\r\n        private.x = x;\r\n        private.y = y;\r\n\r\n        computeTransformMatrix();\r\n\r\n        return public;\r\n    }\r\n\r\n    public.moveToXYZ = function (x, y, z) {\r\n        private.x = x;\r\n        private.y = y;\r\n        private.z = z;\r\n\r\n        computeTransformMatrix();\r\n\r\n        return public;\r\n    }\r\n\r\n    public.moveToX = function (x) {\r\n        private.x = x;\r\n\r\n        computeTransformMatrix();\r\n\r\n        return public;\r\n    }\r\n\r\n    public.moveToY = function (y) {\r\n        private.y = y;\r\n\r\n        computeTransformMatrix();\r\n\r\n        return public;\r\n    }\r\n\r\n    public.moveToZ = function (z) {\r\n        private.z = z;\r\n\r\n        computeTransformMatrix();\r\n\r\n        return public;\r\n    }\r\n\r\n    public.frustrum = function (fieldOfView, zNear, zFar) {\r\n        private.fov = fieldOfView;\r\n        private.zNear = zNear;\r\n        private.zFar = zFar;\r\n\r\n        computeTransformMatrix();\r\n\r\n        return public;\r\n    }\r\n\r\n    public.scaleX = function (x) {\r\n        private.xScale = x;\r\n\r\n        computeTransformMatrix();\r\n\r\n        return public;\r\n    }\r\n\r\n    public.setViewport = function (gl) {\r\n        gl.viewport(0, 0, gl.canvas.clientWidth, gl.canvas.clientHeight);\r\n        gl.canvas.width = gl.canvas.clientWidth;\r\n        gl.canvas.height = gl.canvas.clientHeight;\r\n\r\n        return public.adjustToViewport(gl);\r\n    };\r\n\r\n    public.adjustToViewport = function (gl) {\r\n        const aspectRatio = gl.drawingBufferWidth / gl.drawingBufferHeight;\r\n\r\n        if (aspectRatio != private.aspectRatio) {\r\n            private.aspectRatio = aspectRatio;\r\n            const matrix = public.worldToClipTransform.getMatrix();\r\n            matrix[5] = matrix[0] * aspectRatio;\r\n            public.worldToClipTransform.setMatrix(matrix);\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n};\r\n","// This public makes objects closer to the public appear larger. The frustrum\r\n// defines clipping and scaling of the scene\r\n\r\nwindow.frag.PerspectiveCamera = function () {\r\n    const frag = window.frag;\r\n\r\n    const private = {\r\n        locationTransform: window.frag.Transform(),\r\n        worldTransform: window.frag.Transform(),\r\n        perspectiveTransform: window.frag.Transform(),\r\n        x: 0,\r\n        y: 0,\r\n        z: -200,\r\n        xRot: 0,\r\n        yRot: 0,\r\n        zRot: 0,\r\n        fov: 45 * Math.PI / 180,\r\n        zNear: -100,\r\n        zFar: 100,\r\n        xScale: 100,\r\n        aspectRatio: 1,\r\n        transformChanged: true\r\n    }\r\n\r\n    const public = {\r\n        __private: private,\r\n        worldToClipTransform: window.frag.Transform()\r\n    };\r\n\r\n    private.computeCameraTransforms = function () {\r\n        // Position of the camera within the world\r\n        private.locationTransform\r\n            .identity()\r\n            .translateXYZ(private.x, private.y, private.z)\r\n            .rotateXYZ(private.xRot, private.yRot, private.zRot);\r\n\r\n        // Position the world with the camera at the origin\r\n        private.worldTransform\r\n            .identity()\r\n            .rotateXYZ(-private.xRot, -private.yRot, -private.zRot)\r\n            .scaleXYZ(1 / private.xScale, private.aspectRatio / private.xScale, 2 / (private.zFar - private.zNear))\r\n            .translateXYZ(-private.x, -private.y, -private.z);\r\n\r\n        private.transformChanged = true;\r\n    }\r\n\r\n    private.computePerspectiveTransform = function () {\r\n        // TODO: calculate based on private.fov\r\n        const ps = 0.5;\r\n        const pt = 0.7;\r\n\r\n        // Note that the world transform already transforms the frustrum into a 2x2x2 cube at zNear\r\n        const xs = 1;\r\n        const ys = 1;\r\n        const zs = 1;\r\n\r\n        const xt = 0;\r\n        const yt = 0;\r\n        const zt = -2 * (private.zNear - private.z) / (private.zFar - private.zNear) - 1;\r\n\r\n        const __ = 0;\r\n\r\n        private.perspectiveTransform.setMatrix([\r\n            xs, __, __, __,\r\n            __, ys, __, __,\r\n            __, __, zs, ps,\r\n            xt, yt, zt, pt,\r\n        ]);\r\n\r\n        private.transformChanged = true;\r\n    }\r\n\r\n    private.computeTransform = function () {\r\n        const transformMatrix = frag.Matrix.m4Xm4(\r\n            private.perspectiveTransform.getMatrix(),\r\n            private.worldTransform.getMatrix());\r\n        public.worldToClipTransform.setMatrix(transformMatrix);\r\n\r\n        /*\r\n        // Opposite corners of frustrum should be [-1, -1, -1] and [1, 1, 1] in clip space\r\n        const t = function (matrix, x, y, z) {\r\n            const v = frag.Matrix.m4Xv4(matrix, [x, y, z, 1]);\r\n            v[0] = v[0] / v[3];\r\n            v[1] = v[1] / v[3];\r\n            v[2] = v[2] / v[3];\r\n            return v;\r\n        }\r\n\r\n        const gradient = 1 / Math.tan((Math.PI - private.fov) * 0.5);\r\n        const nearWidth = private.xScale * gradient;\r\n        const farWidth = nearWidth + (private.zFar - private.zNear) * gradient;\r\n        const t1 = t(private.worldTransform, -nearWidth, -nearWidth, private.zNear);\r\n        const t2 = t(private.worldTransform, farWidth, farWidth, private.zFar);\r\n\r\n        const t3 = t(public.worldToClipTransform, -nearWidth, -nearWidth, private.zNear);\r\n        const t4 = t(public.worldToClipTransform, farWidth, farWidth, private.zFar);\r\n        */\r\n    }\r\n\r\n    private.computeCameraTransforms();\r\n    private.computePerspectiveTransform();\r\n\r\n    public.moveToXY = function (x, y) {\r\n        private.x = x;\r\n        private.y = y;\r\n\r\n        private.computeCameraTransforms();\r\n        return public;\r\n    }\r\n\r\n    public.moveToX = function (x) {\r\n        private.x = x;\r\n\r\n        private.computeCameraTransforms();\r\n        return public;\r\n    }\r\n\r\n    public.moveToY = function (y) {\r\n        private.y = y;\r\n\r\n        private.computeCameraTransforms();\r\n        return public;\r\n    }\r\n\r\n    public.moveToZ = function (z) {\r\n        private.z = z;\r\n\r\n        private.computeCameraTransforms();\r\n        private.computePerspectiveTransform();\r\n        return public;\r\n    }\r\n\r\n    public.moveToXYZ = function (x, y, z) {\r\n        private.x = x;\r\n        private.y = y;\r\n        private.z = z;\r\n\r\n        private.computeCameraTransforms();\r\n        private.computePerspectiveTransform();\r\n        return public;\r\n    }\r\n\r\n    public.frustrum = function (fieldOfView, zNear, zFar) {\r\n        private.fov = fieldOfView;\r\n        private.zNear = zNear;\r\n        private.zFar = zFar;\r\n\r\n        private.computePerspectiveTransform();\r\n        return public;\r\n    }\r\n\r\n    public.scaleX = function (x) {\r\n        private.xScale = x;\r\n        private.computeCameraTransforms();\r\n        return public;\r\n    }\r\n\r\n    public.setViewport = function (gl) {\r\n        gl.viewport(0, 0, gl.canvas.clientWidth, gl.canvas.clientHeight);\r\n        gl.canvas.width = gl.canvas.clientWidth;\r\n        gl.canvas.height = gl.canvas.clientHeight;\r\n\r\n        return public.adjustToViewport(gl);\r\n    };\r\n\r\n    public.adjustToViewport = function (gl) {\r\n        const aspectRatio = gl.drawingBufferWidth / gl.drawingBufferHeight;\r\n\r\n        if (aspectRatio != private.aspectRatio) {\r\n            private.aspectRatio = aspectRatio;\r\n            private.computeCameraTransforms();\r\n        }\r\n\r\n        if (private.transformChanged) {\r\n            private.computeTransform();\r\n            private.transformChanged = false;\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n};\r\n","// This public draws 2D shapes scaled to the width of the viewport.\r\n// It is designed to be used in conjunction with the UiShader which will project onto the front of the viewport.\r\n\r\nwindow.frag.UiCamera = function () {\r\n\r\n    const private = {\r\n        aspectRatio: 1};\r\n\r\n    const public = {\r\n        worldToClipTransform: window.frag.Transform2D().identity()\r\n    };\r\n\r\n    public.scaleX = function (horizontalScale) {\r\n        var matrix = public.worldToClipTransform.getMatrix();\r\n        matrix[0] = 1 / horizontalScale;\r\n        public.worldToClipTransform.setMatrix(matrix);\r\n        private.aspectRatio = -1;\r\n        return public;\r\n    }\r\n\r\n    public.setViewport = function (gl) {\r\n        gl.viewport(0, 0, gl.canvas.clientWidth, gl.canvas.clientHeight);\r\n        gl.canvas.width = gl.canvas.clientWidth;\r\n        gl.canvas.height = gl.canvas.clientHeight;\r\n\r\n        return public.adjustToViewport(gl);\r\n    };\r\n\r\n    public.adjustToViewport = function (gl) {\r\n        const aspectRatio = gl.drawingBufferWidth / gl.drawingBufferHeight;\r\n\r\n        if (private.aspectRatio != aspectRatio) {\r\n            const matrix = public.worldToClipTransform.getMatrix();\r\n            matrix[4] = matrix[0] * aspectRatio;\r\n            public.worldToClipTransform.setMatrix(matrix);\r\n\r\n            private.aspectRatio = aspectRatio;\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n};\r\n","(function() {\r\n    const frag = window.frag;\r\n    const scenes = [];\r\n    const activeAnimations = {};\r\n    const inactiveAnimations = {};\r\n    let startTime = performance.now();\r\n    let gameTick = 0;\r\n    let frameTick = 0;\r\n    let mainScene = null;\r\n    let nextAnimationId = 0;\r\n    let frameTimes = [];\r\n    let frameTimesSum = 0;\r\n\r\n    frag.correctClock = function(serverTick) {\r\n        let difference = serverTick - gameTick;\r\n        if (difference > 0) {\r\n            startTime += frag.gameTickMs;\r\n        } else if (difference < 0) {\r\n            startTime -= frag.gameTickMs;\r\n        }\r\n    }\r\n\r\n    frag.mainScene = function (scene) {\r\n        if (mainScene) mainScene.dispose();\r\n        mainScene = scene;\r\n        return frag;\r\n    }\r\n\r\n    frag.getMainScene = function () {\r\n        return mainScene;\r\n    }\r\n\r\n    frag.addScene = function (scene) {\r\n        scenes.push(scene);\r\n        return frag;\r\n    };\r\n\r\n    frag.removeScene = function (scene) {\r\n        for (let i = 0; i < scenes.length; i++) {\r\n            if (scenes[i] === scene) {\r\n                scenes.splice(i, 1);\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    frag.activateAnimation = function(animation) {\r\n        activeAnimations[animation.id] = animation;\r\n        delete inactiveAnimations[animation.id];\r\n    }\r\n\r\n    frag.deactivateAnimation = function(animation) {\r\n        inactiveAnimations[animation.id] = animation;\r\n        delete activeAnimations[animation.id];\r\n    }\r\n\r\n    frag.addAnimation = function (animation) {\r\n        animation.id = nextAnimationId++;\r\n        inactiveAnimations[animation.id] = animation;\r\n        return frag;\r\n    };\r\n\r\n    frag.removeAnimation = function (animation) {\r\n        delete inactiveAnimations[animation.id];\r\n        delete activeAnimations[animation.id];\r\n        return frag;\r\n    };\r\n\r\n    const playAnimations = function (gameTick, frameTick) {\r\n        for (let id in activeAnimations) {\r\n            let animation = activeAnimations[id];\r\n            if (animation.nextFrameTick !== undefined) {\r\n                if (frameTick >= animation.nextFrameTick) {\r\n                    animation.nextFrameTick = frameTick + 10;\r\n                    animation.action(null, gameTick, frameTick);\r\n                }\r\n            } else if (animation.nextGameTick != undefined) {\r\n                if (gameTick >= animation.nextGameTick) {\r\n                    animation.nextGameTick = gameTick + 5;\r\n                    animation.action(null, gameTick, frameTick);\r\n                }\r\n            } else {\r\n                animation.nextGameTick = gameTick + 5;\r\n            }\r\n        }\r\n    };\r\n\r\n    const render = function () {\r\n        if (mainScene) {\r\n            const gl = frag.gl;\r\n\r\n            const t0 = performance.now();\r\n            gameTick = Math.floor((t0 - startTime) / window.frag.gameTickMs);\r\n            frameTick++;\r\n\r\n            playAnimations(gameTick, frameTick);\r\n\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n            mainScene.setViewport(gl);\r\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n            const drawContext = { gl };\r\n            mainScene.draw(drawContext);\r\n\r\n            for (let i = 0; i < scenes.length; i++) {\r\n                scenes[i].adjustToViewport(gl);\r\n                scenes[i].draw(drawContext);\r\n            }\r\n\r\n            const elapsed = performance.now() - startTime;\r\n            frameTimes.push(elapsed);\r\n            frameTimesSum += elapsed;\r\n            if (frameTimes.length > 100) frameTimesSum -= frameTimes.shift();\r\n            frag.fps = 1000 * frameTimes.length / frameTimesSum;\r\n        }\r\n        setTimeout(render, frag.renderInterval);\r\n    }\r\n    window.frag.startFunctions.push(render);\r\n})();\r\n","/* To customize Frag for your application, set properties of the\r\n   frag object before calling `window.frag.init()` as illustrated \r\n   by the following example:\r\n\r\nwindow.frag.canvas = document.getElementById(\"my-canvas\");\r\nwindow.frag.config = function(frag) {\r\n    frag.gl.clearColor(0, 0, 0, 1);\r\n    frag.debugShaderBuilder = true;\r\n    frag.renderInterval = 10;\r\n    frag.gameTickMs = 50;\r\n}\r\nwindow.frag.init();\r\n*/\r\n\r\nwindow.frag = window.frag || {};\r\n\r\nwindow.frag.startFunctions = [];\r\n\r\nwindow.frag.init = function () {\r\n    const frag = window.frag;\r\n    frag.canvas = frag.canvas || document.getElementById(\"scene\");\r\n    if (!frag.canvas){\r\n        console.error('No canvas with id of \"scene\" in the page');\r\n        return null;\r\n    }\r\n\r\n    const gl = frag.canvas.getContext(\"webgl\");\r\n    if (!gl) {\r\n        alert(\"WebGL is not available\");\r\n        return null;\r\n    }\r\n    frag.gl = gl;\r\n\r\n    frag.canvas.addEventListener('contextmenu', event => event.preventDefault());\r\n\r\n    gl.clearColor(1, 1, 1, 1);\r\n    gl.enable(gl.CULL_FACE);\r\n    gl.enable(gl.DEPTH_TEST);\r\n\r\n    frag.renderInterval = 15;\r\n    frag.gameTickMs = 10;\r\n\r\n    frag.debugPackageLoader = false;\r\n    frag.debugShaderBuilder = false;\r\n    frag.debugAnimations = false;\r\n    frag.debugMeshes = false;\r\n    frag.debugInputs = false;\r\n\r\n    frag.maxTextureUnits = frag.gl.getParameter(frag.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS);\r\n    frag.nextTextureUnit = 0;\r\n    frag.allocateTextureUnit = function () {\r\n        const result = frag.nextTextureUnit;\r\n        frag.nextTextureUnit = (frag.nextTextureUnit + 1) % frag.maxTextureUnits;\r\n        return result;\r\n    };\r\n\r\n    if (frag.config) frag.config(frag);\r\n\r\n    for (var i = 0; i < frag.startFunctions.length; i++)\r\n        frag.startFunctions[i](frag);\r\n\r\n    return frag;\r\n};\r\n","// Represents a location, scale and orientation\r\nwindow.frag.Location = function (is3d) {\r\n    const public = {\r\n        is3d,\r\n        isModified: false,\r\n        matrix: null,\r\n        translateX: 0,\r\n        translateY: 0,\r\n        translateZ: 0,\r\n        scaleX: 1,\r\n        scaleY: 1,\r\n        scaleZ: 1,\r\n        rotateX: 0,\r\n        rotateY: 0,\r\n        rotateZ: 0\r\n    };\r\n\r\n    public.clone = function() {\r\n        const clone = window.frag.Location(public.is3d);\r\n        clone.isModified = public.isModified;\r\n        clone.matrix = public.matrix;\r\n        clone.translateX = public.translateX;\r\n        clone.translateY = public.translateY;\r\n        clone.translateZ = public.translateZ;\r\n        clone.scaleX = public.scaleX;\r\n        clone.scaleY = public.scaleY;\r\n        clone.scaleZ = public.scaleZ;\r\n        clone.rotateX = public.rotateX;\r\n        clone.rotateY = public.rotateY;\r\n        clone.rotateZ = public.rotateZ;\r\n        return clone;\r\n    }\r\n\r\n    public.add = function(other) {\r\n        public.translateX += other.translateX;\r\n        public.translateY += other.translateY;\r\n        public.translateZ += other.translateZ;\r\n        public.scaleX *= other.scaleX;\r\n        public.scaleY *= other.scaleY;\r\n        public.scaleZ *= other.scaleZ;\r\n        public.rotateX += other.rotateX;\r\n        public.rotateY += other.rotateY;\r\n        public.rotateZ += other.rotateZ;\r\n        public.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.getMatrix = function () {\r\n        if (public.matrix && !public.isModified)\r\n            return public.matrix;\r\n\r\n        let transform;\r\n        if (public.is3d) {\r\n            transform = window.frag.Transform()\r\n                .translateXYZ(public.translateX, public.translateY, public.translateZ)\r\n                .rotateXYZ(public.rotateX, public.rotateY, public.rotateZ)\r\n                .scaleXYZ(public.scaleX, public.scaleY, public.scaleZ);\r\n        } else {\r\n            transform = window.frag.Transform2D()\r\n                .translateXY(public.translateX, public.translateY)\r\n                .rotate(public.rotateZ)\r\n                .scaleXY(public.scaleX, public.scaleY);\r\n        }\r\n\r\n        public.matrix = transform.getMatrix();\r\n        public.isModified = false;\r\n\r\n        return public.matrix;\r\n    }\r\n\r\n    return public;\r\n}","window.frag.Observable = function (notify) {\r\n    const private = {\r\n        notify,\r\n        observers: []\r\n    }\r\n\r\n    const public = {\r\n        __private: private\r\n    };\r\n\r\n    public.subscribe = function (observer) {\r\n        private.observers.push(observer);\r\n        private.notify(observer);\r\n    };\r\n\r\n    public.unsubscribe = function (observer) {\r\n        for (let i = 0; i < private.observers.length; i++) {\r\n            if (private.observers[i] === observer) {\r\n                private.observers.splice(i, 1);\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    public.notify = function (fn) {\r\n        fn = fn || private.notify || (function (observer) { observer(); });\r\n        for (let i = 0; i < private.observers.length; i++) {\r\n            fn(private.observers[i]);\r\n        }\r\n    }\r\n\r\n    return public;\r\n};\r\n\r\nwindow.frag.ObservableValue = function () {\r\n    let value = null;\r\n    const observable = frag.Observable((fn) => { fn(value); });\r\n\r\n    const public = {};\r\n\r\n    public.get = function () {\r\n        return value;\r\n    }\r\n\r\n    public.set = function (v) {\r\n        value = v;\r\n        observable.notify();\r\n    }\r\n\r\n    public.subscribe = function (fn) {\r\n        return observable.subscribe(fn);\r\n    }\r\n\r\n    public.unsubscribe = function (fn) {\r\n        return observable.unsubscribe(fn);\r\n    }\r\n\r\n    return public;\r\n};\r\n\r\n/*\r\nconst observedValue = window.frag.ObservableValue();\r\nobservedValue.set(42);\r\n\r\nlet observer1 = function (v) { console.log(\"Observer 1 received \" + v); }\r\nobservedValue.subscribe(observer1);\r\n\r\nobservedValue.set(43);\r\n\r\nlet observer2 = function (v) { console.log(\"Observer 2 received \" + v); }\r\nobservedValue.subscribe(observer2);\r\n\r\nobservedValue.unsubscribe(observer1);\r\n\r\nobservedValue.set(44);\r\n*/","// This is a wrapper around a 4x4 matrix. It provides methods to operate on the matrix\r\n// and can appply the matrix to a shader for rendering. It also provides an observable\r\n// that you can subscribe to changes in the matrix\r\nwindow.frag.Transform = function (matrix) {\r\n    const frag = window.frag;\r\n    const _ = 0;\r\n\r\n    const private = {\r\n        matrix,\r\n    };\r\n\r\n    const public = {\r\n        __private: private,\r\n        observableMatrix: window.frag.Observable((o) => { o(private.matrix) }),\r\n        is3d: true,\r\n    };\r\n\r\n    public.clone = function (matrix) {\r\n        return window.frag.Transform(matrix || private.matrix);\r\n    }\r\n\r\n    public.getMatrix = function () {\r\n        return private.matrix;\r\n    }\r\n\r\n    public.setMatrix = function (matrix) {\r\n        private.matrix = matrix;\r\n        public.observableMatrix.notify();\r\n        return public;\r\n    }\r\n\r\n    private.transform = function (matrix) {\r\n        if (private.matrix)\r\n            return public.setMatrix(frag.Matrix.m4Xm4(private.matrix, matrix));\r\n        return public.setMatrix(matrix);\r\n    }\r\n\r\n    public.identity = function () {\r\n        return public.setMatrix([\r\n            1, _, _, _,\r\n            _, 1, _, _,\r\n            _, _, 1, _,\r\n            _, _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.scale = function (s) {\r\n        return private.transform([\r\n            s, _, _, _,\r\n            _, s, _, _,\r\n            _, _, s, _,\r\n            _, _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.scaleX = function (s) {\r\n        return private.transform([\r\n            s, _, _, _,\r\n            _, 1, _, _,\r\n            _, _, 1, _,\r\n            _, _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.scaleY = function (s) {\r\n        return private.transform([\r\n            1, _, _, _,\r\n            _, s, _, _,\r\n            _, _, s, _,\r\n            _, _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.scaleZ = function (s) {\r\n        return private.transform([\r\n            1, _, _, _,\r\n            _, 1, _, _,\r\n            _, _, s, _,\r\n            _, _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.scaleXY = function (x, y) {\r\n        return private.transform([\r\n            x, _, _, _,\r\n            _, y, _, _,\r\n            _, _, 1, _,\r\n            _, _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.scaleXYZ = function (x, y, z) {\r\n        return private.transform([\r\n            x, _, _, _,\r\n            _, y, _, _,\r\n            _, _, z, _,\r\n            _, _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.translateX = function (d) {\r\n        return private.transform([\r\n            1, _, _, _,\r\n            _, 1, _, _,\r\n            _, _, 1, _,\r\n            d, _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.translateY = function (d) {\r\n        return private.transform([\r\n            1, _, _, _,\r\n            _, 1, _, _,\r\n            _, _, 1, _,\r\n            _, d, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.translateZ = function (d) {\r\n        return private.transform([\r\n            1, _, _, _,\r\n            _, 1, _, _,\r\n            _, _, 1, _,\r\n            _, _, d, 1,\r\n        ]);\r\n    }\r\n\r\n    public.translateXY = function (x, y) {\r\n        return private.transform([\r\n            1, _, _, _,\r\n            _, 1, _, _,\r\n            _, _, 1, _,\r\n            x, y, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.translateXYZ = function (x, y, z) {\r\n        return private.transform([\r\n            1, _, _, _,\r\n            _, 1, _, _,\r\n            _, _, 1, _,\r\n            x, y, z, 1,\r\n        ]);\r\n    }\r\n\r\n    public.rotateX = function (rad) {\r\n        var c = Math.cos(rad);\r\n        var s = Math.sin(rad);\r\n        return private.transform([\r\n            1, _, _, _,\r\n            _, c, s, _,\r\n            _,-s, c, _,\r\n            _, _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.rotateY = function (rad) {\r\n        var c = Math.cos(rad);\r\n        var s = Math.sin(rad);\r\n        return private.transform([\r\n            c, _,-s, _,\r\n            _, 1, _, _,\r\n            s, _, c, _,\r\n            _, _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.rotateZ = function (rad) {\r\n        var c = Math.cos(rad);\r\n        var s = Math.sin(rad);\r\n        return private.transform([\r\n            c, s, _, _,\r\n           -s, c, _, _,\r\n            _, _, 1, _,\r\n            _, _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.rotateXYZ = function (x, y, z) {\r\n        if (x) public.rotateX(x);\r\n        if (y) public.rotateY(y);\r\n        if (z) public.rotateZ(z);\r\n        return public;\r\n    }\r\n\r\n    public.apply = function (gl, uniform) {\r\n        if (uniform !== undefined) {\r\n            gl.uniformMatrix4fv(uniform, false, public.getMatrix());\r\n        }\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n};\r\n\r\n// Unit tests for Transform\r\n/*\r\nwindow.tests = window.tests || {};\r\n\r\nwindow.tests.transform = {\r\n    check: function (name, transform, vector, expected) {\r\n        const result = window.frag.Matrix.m4Xv4(transform.getMatrix(), vector);\r\n        window.tests.expectArray(name, expected, result);\r\n    },\r\n    t1: window.frag.Transform().identity(),\r\n    t2: window.frag.Transform().scaleXYZ(2, 3, 4).translateXYZ(1, 2, 3),\r\n    t3: window.frag.Transform().translateXYZ(1, 2, 3).scaleXYZ(2, 3, 4),\r\n\r\n    run: function (test) {\r\n        test.check(\"Identity matrix\", test.t1, [9, 13, 56, 1], [9, 13, 56, 1]);\r\n        test.check(\"Scale+translate matrix\", test.t2, [1, 1, 1, 1], [4, 9, 16, 1]);\r\n        test.check(\"Translate+scale matrix\", test.t3, [1, 1, 1, 1], [3, 5, 7, 1]);\r\n    }\r\n};\r\n\r\nwindow.tests.transform.run(window.tests.transform);\r\n*/","// This is a wrapper around a 3x3 matrix. It provides methods to operate on the matrix\r\n// and can appply the matrix to a shader for rendering. It also provides an observable\r\n// that you can subscribe to changes in the matrix\r\nwindow.frag.Transform2D = function (matrix) {\r\n    const frag = window.frag;\r\n    const _ = 0;\r\n\r\n    const private = {\r\n        matrix\r\n    }\r\n\r\n    const public = {\r\n        __private: private,\r\n        observableMatrix: window.frag.Observable((o) => { o(private.matrix) }),\r\n        is3d: false,\r\n    };\r\n\r\n    public.clone = function (matrix) {\r\n        return window.frag.Transform2D(matrix || private.matrix);\r\n    }\r\n\r\n    public.getMatrix = function () {\r\n        return private.matrix;\r\n    }\r\n\r\n    public.setMatrix = function (matrix) {\r\n        private.matrix = matrix;\r\n        public.observableMatrix.notify();\r\n        return public;\r\n    }\r\n\r\n    private.transform = function (matrix) {\r\n        if (private.matrix)\r\n            return public.setMatrix(frag.Matrix.m3Xm3(private.matrix, matrix));\r\n        return public.setMatrix(matrix);\r\n    }\r\n\r\n    public.identity = function () {\r\n        return public.setMatrix([\r\n            1, _, _,\r\n            _, 1, _,\r\n            _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.scale = function (s) {\r\n        return private.transform([\r\n            s, _, _,\r\n            _, s, _,\r\n            _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.scaleXY = function (x, y) {\r\n        return private.transform([\r\n            x, _, _,\r\n            _, y, _,\r\n            _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.translateX = function (d) {\r\n        return private.transform([\r\n            1, _, _,\r\n            _, 1, _,\r\n            d, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.translateY = function (d) {\r\n        return private.transform([\r\n            1, _, _,\r\n            _, 1, _,\r\n            _, d, 1,\r\n        ]);\r\n    }\r\n\r\n    public.translateXY = function (x, y) {\r\n        return private.transform([\r\n            1, _, _,\r\n            _, 1, _,\r\n            x, y, 1,\r\n        ]);\r\n    }\r\n\r\n    public.rotate = function (rad) {\r\n        var c = Math.cos(rad);\r\n        var s = Math.sin(rad);\r\n        return private.transform([\r\n            c,-s, _,\r\n            s, c, _,\r\n            _, _, 1,\r\n        ]);\r\n    }\r\n\r\n    public.apply = function (gl, uniform) {\r\n        if (uniform !== undefined) {\r\n            gl.uniformMatrix3fv(uniform, false, public.getMatrix());\r\n        }\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n};\r\n","// Returne functions that can be bound to analog inputs\r\nwindow.frag.AnalogAction = function(actionName, context) {\r\n\r\n    const splits = actionName.split(\"-\");\r\n\r\n    let mode = \"move\";\r\n    let axis = \"z\";\r\n\r\n    for (let i = 0; i < splits.length; i++) {\r\n        if ((/^move$/i).test(splits[i])) mode = \"move\";\r\n        if ((/^rotate$/i).test(splits[i])) mode = \"rotate\";\r\n        if ((/^scale$/i).test(splits[i])) mode = \"scale\";\r\n        if ((/^x$/i).test(splits[i])) axis = \"x\";\r\n        if ((/^y$/i).test(splits[i])) axis = \"y\";\r\n        if ((/^z$/i).test(splits[i])) axis = \"z\";\r\n        if ((/^right$/i).test(splits[i])) axis = \"right\";\r\n        if ((/^up$/i).test(splits[i])) axis = \"up\";\r\n        if ((/^forward$/i).test(splits[i])) axis = \"forward\";\r\n    }\r\n\r\n    if (/camera/i.test(actionName)) {\r\n        if (mode === \"move\") {\r\n            if (axis === \"x\") \r\n                return function(analogState) { frag.getMainScene().getCamera().moveToX(analogState.value); }\r\n            if (axis === \"y\") \r\n                return function(analogState) { frag.getMainScene().getCamera().moveToY(analogState.value); }\r\n            if (axis === \"z\") \r\n                return function(analogState) { frag.getMainScene().getCamera().moveToZ(analogState.value); }\r\n        }        \r\n    }\r\n\r\n    if (context && context.sceneObject) {\r\n        if (/sceneobject/i.test(actionName)) {\r\n            return function(analogState) {\r\n            }\r\n        }\r\n    }\r\n\r\n    return null;    \r\n}","// Represents an input that can be moved up and down in value. For example\r\n// the scroll wheel on the mouse or a joystick axis\r\nwindow.frag.AnalogInput = function(inputName, analogState) {\r\n    const frag = window.frag;\r\n\r\n    const private = {\r\n        inputName,\r\n        analogState,\r\n    }\r\n\r\n    const public = {\r\n        __private: private,\r\n    }\r\n\r\n    const splits = inputName.split(\"-\");\r\n\r\n    if ((/mouse/i).test(inputName)) {\r\n        let buttons = 0;\r\n        let vertical = false;\r\n        let inverted = false;\r\n        let wheel = false;\r\n        let downPosition;\r\n        let downValue;\r\n\r\n        for (let i = 0; i < splits.length; i++) {\r\n            if ((/^horizontal$/).test(splits[i])) vertical = false;\r\n            if ((/^vertical$/).test(splits[i])) vertical = true;\r\n            if ((/^inverted$/).test(splits[i])) inverted = true;\r\n            if ((/^wheel$/).test(splits[i])) wheel = true;\r\n            if ((/^left$/).test(splits[i])) buttons = 1;\r\n            if ((/^right$/).test(splits[i])) buttons = 2;\r\n            if ((/^middle$/).test(splits[i])) buttons = 4;\r\n            if ((/^back$/).test(splits[i])) buttons = 8;\r\n            if ((/^forward$/).test(splits[i])) buttons = 16;\r\n            if ((/^any$/).test(splits[i])) buttons = 255;\r\n        }\r\n\r\n        const moveHandler = function (evt) {\r\n            if (buttons === 0) {\r\n                let fraction = vertical ? (frag.canvas.clientHeight - evt.clientY) / frag.canvas.clientHeight : evt.clientX / frag.canvas.clientWidth;\r\n                if (inverted) fraction = 1 - fraction;\r\n                const value = ((private.analogState.maxValue - private.analogState.minValue) * fraction) + private.analogState.minValue;\r\n                if (frag.debugInputs) console.log(\"Analog input\", private.inputName, \"=\", value);\r\n                private.analogState.setValue(evt, value, true);\r\n            } else if ((evt.buttons & buttons) !== 0) {\r\n                let fraction = vertical \r\n                    ? (inverted ? (evt.clientY - downPosition) : (downPosition - evt.clientY)) / frag.canvas.clientHeight\r\n                    : (inverted ? (downPosition - evt.clientX) : (evt.clientX - downPosition)) / frag.canvas.clientWidth;\r\n                const value = downValue + ((private.analogState.maxValue - private.analogState.minValue) * fraction);\r\n                if (frag.debugInputs) console.log(\"Analog input\", private.inputName, \"=\", value);\r\n                private.analogState.setValue(evt, value, true);\r\n            }\r\n            return true;\r\n        }\r\n\r\n        const downHandler = function(evt) {\r\n            if ((evt.buttons & buttons) !== 0) {\r\n                downPosition = vertical ? evt.clientY : evt.clientX;\r\n                downValue = private.analogState.value;\r\n            }\r\n        }\r\n\r\n        const wheelHandler = function(evt) {\r\n            if (frag.debugInputs) console.log(\"Analog input\", private.inputName, \"delta\", evt.deltaY);\r\n            if (inverted) {\r\n                if (evt.deltaY > 0) private.analogState.decrement(evt); else private.analogState.increment(evt);\r\n            } else {\r\n                if (evt.deltaY < 0) private.analogState.decrement(evt); else private.analogState.increment(evt);\r\n            }\r\n            evt.preventDefault();\r\n            return true;\r\n        }\r\n\r\n        public.enable = function () {\r\n            if (wheel) {\r\n                frag.canvas.addEventListener(\"wheel\", wheelHandler, false);\r\n            } else {\r\n                frag.canvas.addEventListener(\"mousemove\", moveHandler, false);\r\n                if (buttons !== 0) frag.canvas.addEventListener(\"mousedown\", downHandler, false);\r\n            }\r\n        }\r\n\r\n        public.disable = function () {\r\n            if (wheel) {\r\n                frag.canvas.removeEventListener(\"wheel\", wheelHandler, false);\r\n            } else {\r\n                frag.canvas.removeEventListener(\"mousemove\", moveHandler, false);\r\n                if (buttons !== 0) frag.canvas.removeEventListener(\"mousedown\", downHandler, false);\r\n            }\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    if ((/keys/i).test(splits[0])) {\r\n        let leftKey = \"ArrowLeft\";\r\n        let rightKey = \"ArrowRight\";\r\n        if (splits.length > 1) leftKey = splits[1];\r\n        if (splits.length > 2) rightKey = splits[2];\r\n\r\n        const handler = function (evt) {\r\n            if (evt.key === leftKey) {\r\n                if (frag.debugInputs) console.log(\"Analog input\", private.inputName, \"decrement\");\r\n                private.analogState.decrement(evt);\r\n                evt.preventDefault();\r\n            } else if (evt.key === rightKey) {\r\n                if (frag.debugInputs) console.log(\"Analog input\", private.inputName, \"increment\");\r\n                private.analogState.increment(evt);\r\n                evt.preventDefault();\r\n            }\r\n            return true;\r\n        }\r\n\r\n        public.enable = function () {\r\n            document.addEventListener(\"keydown\", handler, false);\r\n        }\r\n\r\n        public.disable = function () {\r\n            document.removeEventListener(\"keydown\", handler, false);\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    if ((/touch/i.test(inputName))) {\r\n        let mode = \"horizontal\";\r\n        let inverted = false;\r\n        let additionalTouches = false;\r\n        let downPosition;\r\n        let downValue;\r\n        let clientLength;\r\n        let span;\r\n        let index = 0;\r\n\r\n        for (let i = 0; i < splits.length; i++) {\r\n            if ((/^horizontal$/).test(splits[i])) mode = \"horizontal\";\r\n            if ((/^vertical$/).test(splits[i])) mode = \"vertical\";\r\n            if ((/^pinch$/).test(splits[i])) mode = \"pinch\";\r\n            if ((/^rotate$/).test(splits[i])) mode = \"rotate\";\r\n            if ((/^inverted$/).test(splits[i])) inverted = true;\r\n            if ((/^plus$/).test(splits[i])) additionalTouches = true;\r\n            if ((/^1$/).test(splits[i])) index = 0;\r\n            if ((/^2$/).test(splits[i])) index = 1;\r\n            if ((/^3$/).test(splits[i])) index = 2;\r\n        }\r\n\r\n        let moveHandler = null;\r\n        let touchStartHandler = null;\r\n\r\n        if (mode === \"horizontal\") {\r\n            moveHandler = function (evt) {\r\n                if ((additionalTouches && evt.touches.length > index) || evt.touches.length === index + 1) {\r\n                    const touch = evt.touches.item(index);\r\n                    let fraction = (inverted ? (downPosition - touch.clientX) : (touch.clientX - downPosition)) / clientLength;\r\n                    const value = downValue + (span * fraction);\r\n                    if (frag.debugInputs) console.log(\"Analog input\", private.inputName, \"=\", value);\r\n                    private.analogState.setValue(evt, value, true);\r\n                }\r\n                return true;\r\n            }\r\n            touchStartHandler = function(evt) {\r\n                if (evt.touches.length === index + 1) {\r\n                    const touch = evt.touches.item(index);\r\n                    downPosition = touch.clientX;\r\n                    downValue = private.analogState.value;\r\n                    span = private.analogState.maxValue - private.analogState.minValue;\r\n                    clientLength = frag.canvas.clientWidth;\r\n                }\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (mode === \"vertical\") {\r\n            moveHandler = function (evt) {\r\n                if ((additionalTouches && evt.touches.length > index) || evt.touches.length === index + 1) {\r\n                    const touch = evt.touches.item(index);\r\n                    let fraction =  (inverted ? (touch.clientY - downPosition) : (downPosition - touch.clientY)) / clientLength;\r\n                    const value = downValue + (span * fraction);\r\n                    if (frag.debugInputs) console.log(\"Analog input\", private.inputName, \"=\", value);\r\n                    private.analogState.setValue(evt, value, true);\r\n                }\r\n                return true;\r\n            }\r\n            touchStartHandler = function(evt) {\r\n                if (evt.touches.length === index + 1) {\r\n                    const touch = evt.touches.item(index);\r\n                    downPosition = touch.clientY;\r\n                    downValue = private.analogState.value;\r\n                    span = private.analogState.maxValue - private.analogState.minValue;\r\n                    clientLength = frag.canvas.clientHeight;\r\n                }\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (mode === \"pinch\") {\r\n            const distance = function(evt) {\r\n                const touch1 = evt.touches.item(0);\r\n                const touch2 = evt.touches.item(1);\r\n                const spanX = touch2.clientX - touch1.clientX;\r\n                const spanY = touch2.clientY - touch1.clientY;\r\n                return Math.sqrt(spanX * spanX + spanY * spanY);\r\n            }\r\n\r\n            moveHandler = function (evt) {\r\n                if ((additionalTouches && evt.touches.length > 1) || evt.touches.length === 2) {\r\n                    const position = distance(evt);\r\n                    let fraction = (position - downPosition) / clientLength;\r\n                    if (inverted) fraction = -fraction;\r\n                    const value = downValue + span * fraction;\r\n                    if (frag.debugInputs) console.log(\"Analog input\", private.inputName, \"=\", value);\r\n                    private.analogState.setValue(evt, value, true);\r\n                }\r\n                return true;\r\n            }\r\n            touchStartHandler = function(evt) {\r\n                if (evt.touches.length === 2) {\r\n                    downPosition = distance(evt);\r\n                    downValue = private.analogState.value;\r\n                    span = private.analogState.maxValue - private.analogState.minValue;\r\n                    clientLength = Math.sqrt(frag.canvas.clientHeight * frag.canvas.clientHeight + frag.canvas.clientWidth * frag.canvas.clientWidth) * 0.5;\r\n                }\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (mode === \"rotate\") {\r\n            const angle = function(evt) {\r\n                const touch1 = evt.touches.item(0);\r\n                const touch2 = evt.touches.item(1);\r\n                const dirX = touch2.clientX - touch1.clientX;\r\n                const dirY = touch2.clientY - touch1.clientY;\r\n                return Math.atan2(dirY, dirX);\r\n            }\r\n\r\n            moveHandler = function (evt) {\r\n                if ((additionalTouches && evt.touches.length > 1) || evt.touches.length === 2) {\r\n                    const position = angle(evt);\r\n                    let fraction = (position - downPosition) / clientLength;\r\n                    if (inverted) fraction = -fraction;\r\n                    const value = downValue + span * fraction;\r\n                    if (frag.debugInputs) console.log(\"Analog input\", private.inputName, \"=\", value);\r\n                    private.analogState.setValue(evt, value, true);\r\n                }\r\n                return true;\r\n            }\r\n            touchStartHandler = function(evt) {\r\n                if (evt.touches.length === 2) {\r\n                    downPosition = angle(evt);\r\n                    downValue = private.analogState.value;\r\n                    span = private.analogState.maxValue - private.analogState.minValue;\r\n                    clientLength = Math.PI * 0.5;\r\n                }\r\n                return true;\r\n            }\r\n        }\r\n\r\n        public.enable = function () {\r\n            if (moveHandler) frag.canvas.addEventListener(\"touchmove\", moveHandler, false);\r\n            if (touchStartHandler) frag.canvas.addEventListener(\"touchstart\", touchStartHandler, false);\r\n        }\r\n\r\n        public.disable = function () {\r\n            if (moveHandler) frag.canvas.removeEventListener(\"touchmove\", moveHandler, false);\r\n            if (touchStartHandler) frag.canvas.removeEventListener(\"touchstart\", touchStartHandler, false);\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    if ((/pointer/i).test(inputName)) {\r\n        let buttons = 0;\r\n        let vertical = false;\r\n        let inverted = false;\r\n        let downPosition;\r\n        let downValue;\r\n\r\n        for (let i = 0; i < splits.length; i++) {\r\n            if ((/^horizontal$/).test(splits[i])) vertical = false;\r\n            if ((/^vertical$/).test(splits[i])) vertical = true;\r\n            if ((/^inverted$/).test(splits[i])) inverted = true;\r\n            if ((/^left$/).test(splits[i])) buttons = 1;\r\n            if ((/^right$/).test(splits[i])) buttons = 2;\r\n            if ((/^middle$/).test(splits[i])) buttons = 4;\r\n            if ((/^back$/).test(splits[i])) buttons = 8;\r\n            if ((/^forward$/).test(splits[i])) buttons = 16;\r\n            if ((/^eraser$/).test(splits[i])) buttons = 32;\r\n            if ((/^any$/).test(splits[i])) buttons = 255;\r\n        }\r\n\r\n        const moveHandler = function (evt) {\r\n            if (buttons === 0) {\r\n                let fraction = vertical ? evt.clientY / frag.canvas.clientHeight : evt.clientX / frag.canvas.clientWidth;\r\n                if (inverted) fraction = 1 - fraction;\r\n                const value = ((private.analogState.maxValue - private.analogState.minValue) * fraction) + private.analogState.minValue;\r\n                if (frag.debugInputs) console.log(\"Analog input\", private.inputName, \"=\", value);\r\n                private.analogState.setValue(evt, value, true);\r\n            } else if ((evt.buttons & buttons) !== 0) {\r\n                let fraction = vertical \r\n                    ? (inverted ? (downPosition - evt.clientY) : (evt.clientY - downPosition)) / frag.canvas.clientHeight\r\n                    : (inverted ? (downPosition - evt.clientX) : (evt.clientX - downPosition)) / frag.canvas.clientWidth;\r\n                const value = downValue + ((private.analogState.maxValue - private.analogState.minValue) * fraction);\r\n                if (frag.debugInputs) console.log(\"Analog input\", private.inputName, \"=\", value);\r\n                private.analogState.setValue(evt, value, true);\r\n            }\r\n            return true;\r\n        }\r\n\r\n        const downHandler = function(evt) {\r\n            if ((evt.buttons & buttons) !== 0) {\r\n                downPosition = vertical ? evt.clientY : evt.clientX;\r\n                downValue = private.analogState.value;\r\n            }\r\n        }\r\n\r\n        public.enable = function () {\r\n            frag.canvas.addEventListener(\"pointermove\", moveHandler, false);\r\n            if (buttons !== 0) frag.canvas.addEventListener(\"pointerdown\", downHandler, false);\r\n        }\r\n\r\n        public.disable = function () {\r\n            frag.canvas.removeEventListener(\"pointermove\", moveHandler, false);\r\n            if (buttons !== 0) frag.canvas.removeEventListener(\"pointerdown\", downHandler, false);\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    if ((/gamepad/i.test(inputName))) {\r\n        let controllerIndex = 0;\r\n        let stickIndex = 0;\r\n        let axisIndex = 0;\r\n        let gamepad = null;\r\n        let inverted = false;\r\n        let interval;\r\n\r\n        for (let i = 0; i < splits.length; i++) {\r\n            if ((/^horizontal$/).test(splits[i])) axisIndex = 0;\r\n            if ((/^vertical$/).test(splits[i])) axisIndex = 1;\r\n            if ((/^inverted$/).test(splits[i])) inverted = true;\r\n            if ((/^player1$/).test(splits[i])) controllerIndex = 0;\r\n            if ((/^player2$/).test(splits[i])) controllerIndex = 1;\r\n            if ((/^player3$/).test(splits[i])) controllerIndex = 2;\r\n            if ((/^player4$/).test(splits[i])) controllerIndex = 3;\r\n            if ((/^stick1$/).test(splits[i])) stickIndex = 0;\r\n            if ((/^stick2$/).test(splits[i])) stickIndex = 1;\r\n            if ((/^stick3$/).test(splits[i])) stickIndex = 2;\r\n            if ((/^stick4$/).test(splits[i])) stickIndex = 3;\r\n        }\r\n\r\n        const index = stickIndex * 2 + axisIndex;\r\n\r\n        const poll = function (evt) {\r\n            if (gamepad) {\r\n                const value = gamepad.axes[index];\r\n                if (inverted) value = -value;\r\n                private.analogState.setVelocity(evt, value * private.analogState.maxVelocity);\r\n            }\r\n        }\r\n\r\n        const connectedHandler = function(evt) {\r\n            if (frag.debugInputs) console.log(\"Gamepad\", evt.gamepad.index, \"connected\", \"id:\" + evt.gamepad.id, \"with\", e.gamepad.axes.length, \"axes\");\r\n            if (evt.gamepad.index === controllerIndex && gamepad.axes.length > index) {\r\n                gamepad = evt.gamepad;\r\n                interval = setInterval(poll, 50);\r\n            }\r\n        }\r\n\r\n        const disconnectedHandler = function(evt) {\r\n            if (frag.debugInputs) console.log(\"Gamepad\", evt.gamepad.index, \"disconnected\", \"id:\" + evt.gamepad.id);\r\n            if (evt.gamepad.id === gamepad.id) {\r\n                clearInterval(interval);\r\n                gamepad = null;\r\n            }\r\n        }\r\n\r\n        public.enable = function () {\r\n            window.addEventListener(\"gamepadconnected\", connectedHandler, false);\r\n            window.addEventListener(\"gamepaddisconnected\", disconnectedHandler, false);\r\n        }\r\n\r\n        public.disable = function () {\r\n            window.removeEventListener(\"gamepadconnected\", connectedHandler, false);\r\n            window.removeEventListener(\"gamepaddisconnected\", disconnectedHandler, false);\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    if ((/orientation/i.test(inputName))) {\r\n        // https://developer.mozilla.org/en-US/docs/Web/Events/Detecting_device_orientation\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n}","// Represents an analog value that can be changed by the player using analog inputs\r\nwindow.frag.AnalogState = function(analogAction, config, name) {\r\n    const frag = window.frag;\r\n\r\n    if (!config) config = {};\r\n    config.value = config.value || 0;\r\n    config.minValue = config.minValue === undefined ? -100 : config.minValue;\r\n    config.maxValue = config.maxValue === undefined ? 100 : config.maxValue;\r\n    config.maxVelocity = config.maxVelocity || 5;\r\n    config.acceleration = config.acceleration === undefined ? 0.25 : config.acceleration;\r\n    config.deceleration = config.deceleration === undefined ? 1 : config.deceleration;\r\n\r\n    const private = {\r\n        analogAction,\r\n        config,\r\n        name,\r\n        inverted: false,\r\n    }\r\n\r\n    const public = {\r\n        __private: private,\r\n        value: config.value,\r\n        minValue: config.minValue,\r\n        maxValue: config.maxValue,\r\n        maxVelocity: Math.abs(config.maxVelocity),\r\n        velocity: 0,\r\n    }\r\n\r\n    if (config.maxValue < config.minValue) {\r\n        private.inverted = true;\r\n        public.minValue = config.maxValue;\r\n        public.maxValue = config.minValue;\r\n    }\r\n\r\n    private.change = function(evt) {\r\n        if (private.analogAction) {\r\n            if (Array.isArray(private.analogAction)) {\r\n                for (let i = 0; i < private.analogAction.length; i++)\r\n                    private.analogAction[i](public, evt);\r\n            } else {\r\n                private.analogAction(public, evt);\r\n            }\r\n        }\r\n    }\r\n\r\n    private.setValue = function(evt, value) {\r\n        if (value < public.minValue) {\r\n            value = public.minValue;\r\n            public.velocity = 0;\r\n        }\r\n        if (value > public.maxValue) {\r\n            value = public.maxValue;\r\n            public.velocity = 0;\r\n        }\r\n        if (Math.abs(public.value - value) > 1e-5) {\r\n            public.value = value;\r\n            if (frag.debugInputs) console.log(\"Analog state\", private.name, \"set to\", value);\r\n            private.change(evt);\r\n        }\r\n    }\r\n\r\n    private.increment = function(evt) {\r\n        public.velocity += public.velocity >= 0 ? private.config.acceleration : private.config.deceleration;\r\n        if (public.velocity > private.config.maxVelocity) public.velocity = private.config.maxVelocity;\r\n        private.setValue(evt, public.value + public.velocity, false);\r\n    }\r\n\r\n    private.decrement = function(evt) {\r\n        public.velocity -= public.velocity <= 0 ? private.config.acceleration : private.config.deceleration;\r\n        if (public.velocity < -private.config.maxVelocity) public.velocity = -private.config.maxVelocity;\r\n        private.setValue(evt, public.value + public.velocity, false);\r\n    }\r\n\r\n    public.setValue = function(evt, value, calcVelocity) {\r\n        if (private.inverted)\r\n            value = public.minValue + public.maxValue - value;\r\n\r\n        if (calcVelocity) public.velocity = value - public.value;\r\n\r\n        private.setValue(evt, value);\r\n    }\r\n\r\n    public.increment = function(evt) {\r\n        if (private.inverted) private.decrement(evt);\r\n        else private.increment(evt);\r\n    }\r\n\r\n    public.decrement = function(evt) {\r\n        if (private.inverted) private.increment(evt);\r\n        else private.decrement(evt);\r\n    }\r\n\r\n    public.setVelocity = function(evt, velocity) {\r\n        if (inverted) public.velocity = -velocity;\r\n        else public.velocity = velocity;\r\n        if (public.velocity > private.config.maxVelocity) public.velocity = private.config.maxVelocity;\r\n        if (public.velocity < -private.config.maxVelocity) public.velocity = -private.config.maxVelocity;\r\n        private.setValue(evt, public.value + public.velocity);\r\n    }\r\n\r\n    return public;\r\n}","// Returne functions that can be bound to digital inputs\r\nwindow.frag.DigitalAction = function(actionName, context) {\r\n    const frag = window.frag;\r\n\r\n    if (context && context.animation) {\r\n        if (/^animation$/i.test(actionName)) {\r\n            return function(digitalState) {\r\n                if (frag.debugInputs) console.log(\"Turning animation\", digitalState.isOn ? \"on\" : \"off\");\r\n                if (digitalState.isOn) context.animation.start();\r\n                else context.animation.stop();\r\n            }\r\n        }\r\n\r\n        if (/^animation-start$/i.test(actionName)) {\r\n            return function(digitalState) {\r\n                if (!digitalState.isOn) {\r\n                    if (frag.debugInputs) console.log(\"Starting animation\");\r\n                    context.animation.start();\r\n                }\r\n            }\r\n        }\r\n\r\n        if (/^animation-stop$/i.test(actionName)) {\r\n            return function(digitalState) {\r\n                if (!digitalState.isOn) {\r\n                    if (frag.debugInputs) console.log(\"Stopping animation\");\r\n                    context.animation.stop();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if (context && context.sceneObject) {\r\n        if (/^sceneobject$/i.test(actionName)) {\r\n            return function(digitalState) {\r\n                if (frag.debugInputs) console.log(\"Turning scene object\", digitalState.isOn ? \"on\" : \"off\");\r\n                if (digitalState.isOn) context.sceneObject.enable();\r\n                else context.sceneObject.disable();\r\n            }\r\n        }\r\n    }\r\n\r\n    if (context && context.model) {\r\n        if (/^model$/i.test(actionName)) {\r\n            return function(digitalState) {\r\n                if (frag.debugInputs) console.log(\"Turning\", context.model.getName(), \"model\", digitalState.isOn ? \"on\" : \"off\");\r\n                if (digitalState.isOn) context.model.enable();\r\n                else context.model.disable();\r\n            }\r\n        }\r\n    }\r\n\r\n    return null;\r\n}","// Represents an input that can only be on or off. For example keyboard keys or mouse buttons\r\nwindow.frag.DigitalInput = function (inputName, digitalState) {\r\n    const frag = window.frag;\r\n\r\n    const private = {\r\n        inputName,\r\n        digitalState,\r\n        toggle: false,\r\n        inverted: false,\r\n        setOn: false,\r\n        setOff: false,\r\n    }\r\n\r\n    const public = {\r\n        __private: private,\r\n    }\r\n\r\n    const splits = inputName.split(\"-\");\r\n\r\n    const setIsOn = function (evt, isOn) {\r\n        if (private.inverted) isOn = !isOn;\r\n        if (frag.debugInputs) console.log(\"Digital input\", private.inputName, \"is\", isOn ? \"on\" : \"off\");\r\n        if (private.toggle) {\r\n            if (isOn) private.digitalState.toggle(evt);\r\n        } else {\r\n            if (private.setOn || private.setOff) {\r\n                if (isOn) {\r\n                    // Note that it is deliberate that you can set both on and off.\r\n                    // In this case each time you press the key down the digital\r\n                    // state will go on and off again very quickly\r\n                    if (private.setOn) private.digitalState.setIsOn(evt, true);\r\n                    if (private.setOff) private.digitalState.setIsOn(evt, false);\r\n                }\r\n            } else {\r\n                private.digitalState.setIsOn(evt, isOn);\r\n            }\r\n        }\r\n    }\r\n\r\n    if ((/mouse/i).test(inputName)) {\r\n        let buttons = 1;\r\n\r\n        for (let i = 0; i < splits.length; i++) {\r\n            if ((/^toggle$/i).test(splits[i])) private.toggle = true;\r\n            if ((/^inverted$/i).test(splits[i])) private.inverted = true;\r\n            if ((/^on$/i).test(splits[i])) private.setOn = true;\r\n            if ((/^off$/i).test(splits[i])) private.setOff = true;\r\n            if ((/^left$/i).test(splits[i])) buttons = 1;\r\n            if ((/^right$/i).test(splits[i])) buttons = 2;\r\n            if ((/^middle$/i).test(splits[i])) buttons = 4;\r\n            if ((/^back$/i).test(splits[i])) buttons = 8;\r\n            if ((/^forward$/i).test(splits[i])) buttons = 16;\r\n            if ((/^eraser$/i).test(splits[i])) buttons = 32;\r\n            if ((/^any$/i).test(splits[i])) buttons = 255;\r\n        }\r\n\r\n        const handler = function (evt) {\r\n            setIsOn(evt, (evt.buttons & buttons) !== 0);\r\n            return true;\r\n        }\r\n\r\n        public.enable = function () {\r\n            frag.canvas.addEventListener(\"mousedown\", handler, false);\r\n            frag.canvas.addEventListener(\"mouseup\", handler, false);\r\n        }\r\n\r\n        public.disable = function () {\r\n            frag.canvas.removeEventListener(\"mousedown\", handler, false);\r\n            frag.canvas.removeEventListener(\"mouseup\", handler, false);\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    if ((/pointer/i).test(inputName)) {\r\n        let buttons = 1;\r\n\r\n        for (let i = 0; i < splits.length; i++) {\r\n            if ((/^toggle$/i).test(splits[i])) private.toggle = true;\r\n            if ((/^inverted$/i).test(splits[i])) private.inverted = true;\r\n            if ((/^on$/i).test(splits[i])) private.setOn = true;\r\n            if ((/^off$/i).test(splits[i])) private.setOff = true;\r\n            if ((/^left$/i).test(splits[i])) buttons = 1;\r\n            if ((/^right$/i).test(splits[i])) buttons = 2;\r\n            if ((/^middle$/i).test(splits[i])) buttons = 4;\r\n            if ((/^back$/i).test(splits[i])) buttons = 8;\r\n            if ((/^forward$/i).test(splits[i])) buttons = 16;\r\n            if ((/^eraser$/i).test(splits[i])) buttons = 32;\r\n            if ((/^any$/i).test(splits[i])) buttons = 255;\r\n        }\r\n\r\n        const handler = function (evt) {\r\n            setIsOn(evt, (evt.buttons & buttons) !== 0);\r\n            return true;\r\n        }\r\n\r\n        public.enable = function () {\r\n            frag.canvas.addEventListener(\"pointerdown\", handler, false);\r\n            frag.canvas.addEventListener(\"pointerup\", handler, false);\r\n        }\r\n\r\n        public.disable = function () {\r\n            frag.canvas.removeEventListener(\"pointerdown\", handler, false);\r\n            frag.canvas.removeEventListener(\"pointerup\", handler, false);\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    if ((/key/i).test(inputName)) {\r\n        let key;\r\n        let ctrl = false;\r\n        let shift = false;\r\n        let alt = false;\r\n        let meta = false;\r\n\r\n        for (let i = 0; i < splits.length; i++) {\r\n            if ((/^toggle$/i).test(splits[i])) private.toggle = true;\r\n            else if ((/^inverted$/i).test(splits[i])) private.inverted = true;\r\n            else if ((/^on$/i).test(splits[i])) private.setOn = true;\r\n            else if ((/^off$/i).test(splits[i])) private.setOff = true;\r\n            else if (/^ctrl$/i.test(splits[i])) ctrl = true;\r\n            else if (/^shift$/i.test(splits[i])) shift = true;\r\n            else if (/^alt$/i.test(splits[i])) alt = true;\r\n            else if (/^meta$/i.test(splits[i])) meta = true;\r\n            else if (/^key$/i.test(splits[i]));\r\n            else key = splits[i];\r\n        }\r\n\r\n        const handler = function (evt, isDown) {\r\n            if (evt.key !== key ||\r\n                evt.altKey !== alt ||\r\n                evt.ctrlKey !== ctrl ||\r\n                evt.shiftKey !== shift ||\r\n                evt.metaKey !== meta)\r\n                return true;\r\n\r\n            evt.preventDefault();\r\n            setIsOn(evt, isDown);\r\n\r\n            return true;\r\n        }\r\n\r\n        const keyDownHandler = function (evt) {\r\n            return handler(evt, true);\r\n        }\r\n\r\n        const keyUpHandler = function (evt) {\r\n            return handler(evt, false);\r\n        }\r\n\r\n        public.enable = function () {\r\n            document.addEventListener(\"keydown\", keyDownHandler, false);\r\n            document.addEventListener(\"keyup\", keyUpHandler, false);\r\n        }\r\n\r\n        public.disable = function () {\r\n            document.removeEventListener(\"keydown\", keyDownHandler, false);\r\n            document.removeEventListener(\"keyup\", keyUpHandler, false);\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n}","// Represents an on/off state that can be controlled by the player using digital inputs\r\nwindow.frag.DigitalState = function (digitalAction, config, name) {\r\n    const frag = window.frag;\r\n\r\n    if (!config) config = {};\r\n    config.isOn = !!config.isOn;\r\n\r\n    const private = {\r\n        digitalAction,\r\n        config,\r\n        name,\r\n    }\r\n\r\n    const public = {\r\n        __private: private,\r\n        isOn: config.isOn,\r\n    }\r\n\r\n    private.change = function(evt) {\r\n        if (private.digitalAction) {\r\n            if (Array.isArray(private.digitalAction)) {\r\n                for (let i = 0; i < private.digitalAction.length; i++)\r\n                    private.digitalAction[i](public, evt);\r\n            } else {\r\n                private.digitalAction(public, evt);\r\n            }\r\n        }\r\n    }\r\n\r\n    public.setIsOn = function (evt, isOn) {\r\n        if (isOn !== public.isOn) {\r\n            public.isOn = isOn;\r\n            if (frag.debugInputs) console.log(\"Digital state\", private.name, \"turned\", public.isOn ? \"on\" : \"off\");\r\n            private.change(evt);\r\n        }\r\n        else if (frag.debugInputs) console.log(\"Digital state\", private.name, \"is already\", public.isOn ? \"on\" : \"off\");\r\n    }\r\n\r\n    public.toggle = function (evt) {\r\n        public.isOn = !public.isOn;\r\n        if (frag.debugInputs) console.log(\"Digital state\", private.name, \"toggled to\", public.isOn ? \"on\" : \"off\");\r\n        private.change(evt);\r\n    }\r\n\r\n    return public;\r\n}","(function() {\r\n    let shader;\r\n\r\n    window.frag.hitTest = function(x, y, width, height, scene) {\r\n        const frag = window.frag;\r\n        const gl = frag.gl;\r\n\r\n        width = width || frag.canvas.clientWidth;\r\n        height = height || frag.canvas.clientHeight;\r\n        scene = scene || frag.getMainScene();\r\n\r\n        if (!shader) {\r\n            shader = {\r\n                name: \"HitTest\",\r\n                attributes: {},\r\n                uniforms: {},\r\n                is3d: true,\r\n            };\r\n\r\n            const vSource =\r\n                'attribute vec4 a_position;\\n' +\r\n                'uniform mat4 u_clipMatrix;\\n' +\r\n                'void main() {;\\n' +\r\n                '  gl_Position = u_clipMatrix * a_position;\\n' +\r\n                '}';\r\n\r\n            const fSource =\r\n                'precision mediump float;\\n' +\r\n                'uniform vec4 u_color;\\n' +\r\n                'void main() {;\\n' +\r\n                '  gl_FragColor = u_color;\\n' +\r\n                '}';\r\n\r\n            const vertexShader = frag.createShader(shader.name, gl.VERTEX_SHADER, vSource);\r\n            const fragmentShader = frag.createShader(shader.name, gl.FRAGMENT_SHADER, fSource);\r\n            shader.program = frag.createProgram(shader.name, vertexShader, fragmentShader);\r\n\r\n            shader.attributes.position = gl.getAttribLocation(shader.program, \"a_position\");\r\n\r\n            shader.uniforms.clipMatrix = gl.getUniformLocation(shader.program, \"u_clipMatrix\");\r\n            shader.uniforms.color = gl.getUniformLocation(shader.program, \"u_color\");\r\n\r\n            shader.bind = function (gl) {\r\n                gl.useProgram(shader.program);\r\n            }\r\n\r\n            shader.unbind = function() {}\r\n        }\r\n\r\n        const texture = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n\r\n        const frameBuffer = gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, frameBuffer);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n\r\n        const depthBuffer = gl.createRenderbuffer();\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, depthBuffer);\r\n        gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, width, height);\r\n        gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, depthBuffer);\r\n\r\n        gl.viewport(0, 0, width, height);\r\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n        const drawContext = {\r\n            gl,\r\n            shader,\r\n            isHitTest: true,\r\n            sceneObjects: [],\r\n            models: [],\r\n        };\r\n\r\n        if (Array.isArray(scene)) {\r\n            for (let i = 0; i < scene.length; i++) {\r\n                scene[i].adjustToViewport(gl);\r\n                scene[i].draw(drawContext);\r\n            }\r\n        } else {\r\n            scene.adjustToViewport(gl);\r\n            scene.draw(drawContext);\r\n        }\r\n\r\n        const pixel = new Uint8Array(4);\r\n        gl.readPixels(x, height - y, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n        const red = pixel[0];\r\n        const green = pixel[1];\r\n        const blue = pixel[2];\r\n        const alpha = pixel[3];\r\n\r\n        const modelId = alpha | (blue << 8) | ((green & 0x0f) << 16);\r\n        const sceneObjectId = ((green & 0xf0) >> 4) | (red << 4);\r\n\r\n        if ((modelId < drawContext.models.length) && (sceneObjectId < drawContext.sceneObjects.length))\r\n            return { \r\n                sceneObject: drawContext.sceneObjects[sceneObjectId],\r\n                model: drawContext.models[modelId]\r\n            };\r\n\r\n        return null;\r\n    };\r\n})();","// A collection of inputs that can be turned on and off.\r\nwindow.frag.InputMethod = function() {\r\n    const private = {\r\n        inputs: [],\r\n        enabled: false\r\n    }\r\n\r\n    const public = {\r\n        __private: private\r\n    }\r\n\r\n    // Enables all of the inputs for this input method\r\n    public.enable = function() {\r\n        if (!private.enabled) {\r\n            for (var i = 0; i< private.inputs.length; i++)\r\n                private.inputs[i].enable();\r\n            private.enabled = true;\r\n        }\r\n        return public;\r\n    }\r\n\r\n    // Disables all of the inputs for this input method\r\n    public.disable = function() {\r\n        if (private.enabled) {\r\n            private.enabled = false;\r\n            for (var i = 0; i< private.inputs.length; i++)\r\n                private.inputs[i].disable();\r\n        }\r\n        return public;\r\n    }\r\n\r\n    // Adds a new input method\r\n    public.add = function(input) {\r\n        private.inputs.push(input);\r\n        if (private.enabled) input.enable();\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n}","window.frag.AssetCatalog = function (shader, defaultTextures) {\r\n    const frag = window.frag;\r\n\r\n    const defaultTexturePixels = new Uint8Array([\r\n        0x7F, 0x7F, 0x7F, 0xFF, // Opaque medium grey\r\n        0x00, 0x00, 0xFF, 0x00, // Very shinny\r\n        0x00, 0x00, 0x00,       // No light emmission\r\n        0x7F, 0x7F, 0xFF]);     // Normal (0, 0, 1)\r\n    \r\n    if (!defaultTextures) defaultTextures = {};\r\n    if (!defaultTextures.diffuse) defaultTextures.diffuse = frag.Texture()\r\n        .name(\"default-diffuse-texture\")\r\n        .dataFormat(frag.gl.RGBA)\r\n        .fromArrayBuffer(0, defaultTexturePixels.buffer, 0, 1, 1);\r\n    if (!defaultTextures.surface) defaultTextures.surface = frag.Texture()\r\n        .name(\"default-surface-texture\")\r\n        .dataFormat(frag.gl.RGBA)\r\n        .fromArrayBuffer(0, defaultTexturePixels.buffer, 4, 1, 1);\r\n    if (!defaultTextures.emmissive) defaultTextures.emmissive = frag.Texture()\r\n        .name(\"default-emmissive-texture\")\r\n        .dataFormat(frag.gl.RGB)\r\n        .fromArrayBuffer(0, defaultTexturePixels.buffer, 8, 1, 1);\r\n    if (!defaultTextures.normal) defaultTextures.normal = frag.Texture()\r\n        .name(\"default-normal-map-texture\")\r\n        .dataFormat(frag.gl.RGB)\r\n        .fromArrayBuffer(0, defaultTexturePixels.buffer, 11, 1, 1);\r\n\r\n    if (!shader) {\r\n        shader = frag.Shader()\r\n            .name(\"Model\")\r\n            .verticiesXYZ()\r\n            .matrix3D()\r\n            .diffuseTexture()\r\n            .directionalLightGrey()\r\n            .compile();\r\n    };\r\n\r\n    const private = {\r\n        defaultTextures,\r\n        fonts: {},\r\n        materials: {},\r\n        models: {},\r\n    };\r\n\r\n    const public = {\r\n        __private: private,\r\n        shader\r\n    };\r\n\r\n    public.getFont = function(name) {\r\n        var font = private.fonts[name];\r\n        if (!font) {\r\n            font = frag.Font()\r\n                .name(name)\r\n            private.fonts[name] = font;\r\n        }\r\n        return font;\r\n    }\r\n\r\n    public.getMaterial = function(name) {\r\n        var material = private.materials[name];\r\n        if (!material) {\r\n            material = frag.Material()\r\n                .name(name)\r\n                .disposeTextures(false)\r\n                .setTexture(\"diffuse\", private.defaultTextures.diffuse)\r\n                .setTexture(\"emmissive\", private.defaultTextures.emmissive)\r\n                .setTexture(\"surface\", private.defaultTextures.surface)\r\n                .setTexture(\"normalMap\", private.defaultTextures.normal);\r\n            private.materials[name] = material;\r\n        }\r\n        return material;\r\n    }\r\n\r\n    public.getModel = function (name, isChild) {\r\n        var model = isChild ? undefined : private.models[name];\r\n        if (!model) {\r\n            model = frag.Model(public.shader.is3d)\r\n                .name(name)\r\n                .shader(public.shader);\r\n            if (!isChild) private.models[name] = model;\r\n        }\r\n        return model;\r\n    }\r\n\r\n    return public;\r\n}\r\n","window.frag.MaterialLoader = (function () {\r\n    const frag = window.frag;\r\n\r\n    const uInt32 = new Uint32Array([0x11223344]);\r\n    const uInt8 = new Uint8Array(uInt32.buffer);\r\n    const littleEndian = uInt8[0] === 0x44;\r\n\r\n    const private = {\r\n    }\r\n\r\n    const public = {\r\n        __private: private,\r\n        littleEndian\r\n    };\r\n\r\n    private.loadMipV1 = function (header, headerOffset, data, dataOffset, material, mipLevel, width, height) {\r\n        const flags = header.getUint8(headerOffset++);\r\n\r\n        const colorDataOffset = header.getUint32(headerOffset, littleEndian);\r\n        if (frag.debugMaterialLoader)\r\n            console.log(\"Color data at \" + colorDataOffset);\r\n        headerOffset += 4;\r\n\r\n        const colorTexture = frag.Texture()\r\n            .dataFormat((flags & 1) === 1 ? frag.gl.RGBA : frag.gl.RGB)\r\n            .fromArrayBuffer(mipLevel, data, dataOffset + colorDataOffset, width, height);\r\n        material.setTexture(\"diffuse\", colorTexture);\r\n\r\n        if ((flags & 2) === 2) {\r\n            const surfaceDataOffset = header.getUint32(headerOffset, littleEndian);\r\n            if (frag.debugMaterialLoader)\r\n                console.log(\"Surface data at \" + surfaceDataOffset);\r\n            headerOffset += 4;\r\n\r\n            const surfaceTexture = frag.Texture()\r\n                .dataFormat(frag.gl.RGBA)\r\n                .fromArrayBuffer(mipLevel, data, dataOffset + surfaceDataOffset, width, height);\r\n            material.setTexture(\"surface\", surfaceTexture);\r\n        }\r\n\r\n        if ((flags & 4) === 4) {\r\n            const normalMapDataOffset = header.getUint32(headerOffset, littleEndian);\r\n            if (frag.debugMaterialLoader)\r\n                console.log(\"Normal map at \" + normalMapDataOffset);\r\n            headerOffset += 4;\r\n\r\n            const normalMap = frag.Texture()\r\n                .dataFormat(frag.gl.RGB)\r\n                .fromArrayBuffer(mipLevel, data, dataOffset + normalMapDataOffset, width, height);\r\n            material.setTexture(\"normalMap\", normalMap);\r\n        }\r\n\r\n        if ((flags & 8) === 8) {\r\n            const pbrDataOffset = header.getUint32(headerOffset, littleEndian);\r\n            if (frag.debugMaterialLoader)\r\n                console.log(\"PBR data at \" + pbrDataOffset);\r\n            headerOffset += 4;\r\n            const pbrTexture = frag.Texture()\r\n                .dataFormat(frag.gl.RGBA)\r\n                .fromArrayBuffer(mipLevel, data, dataOffset + pbrDataOffset, width, height);\r\n            material.setTexture(\"pbr\", pbrTexture);\r\n        }\r\n\r\n        return headerOffset;\r\n    }\r\n\r\n    private.loadMaterialV1 = function (assetCatalog, header, headerOffset, data, dataOffset) {\r\n        const nameLength = header.getUint8(headerOffset++);\r\n        var name = \"\";\r\n        for (let i = 0; i < nameLength; i++) {\r\n            name += String.fromCharCode(header.getUint8(headerOffset++));\r\n        }\r\n        const material = assetCatalog.getMaterial(name);\r\n        if (frag.debugMaterialLoader) {\r\n            console.log(\"\");\r\n            console.log(\"Loading \" + name + \" material textures\");\r\n        }\r\n\r\n        const maxMip = header.getUint8(headerOffset++);\r\n\r\n        var width = 1 << maxMip;\r\n        var height = width;\r\n        var nextMip = 0;\r\n        var mip;\r\n\r\n        do {\r\n            mip = header.getUint8(headerOffset++);\r\n            if (frag.debugMaterialLoader)\r\n                console.log(\"Loading MIP level \" + mip + \" at \" + width + \" x \" + height + \" pixels\");\r\n\r\n            if (mip !== nextMip)\r\n                console.error(\"Mip levels are wrong for \" + name + \" texture\");\r\n\r\n            headerOffset = private.loadMipV1(header, headerOffset, data, dataOffset, material, mip, width, height);\r\n\r\n            nextMip++;\r\n            width >>>= 1;\r\n            height >>>= 1;\r\n        }\r\n        while (mip !== 0)\r\n    }\r\n\r\n\r\n    public.loadMaterialsFromBuffer = function(buffer, assetCatalog){\r\n        if (!assetCatalog) assetCatalog = frag.AssetCatalog();\r\n\r\n        const bytes = new Uint8Array(buffer);\r\n        const header = new DataView(buffer, 0, bytes.length);\r\n\r\n        const version = bytes[0];\r\n        const headerLength = header.getUint16(2, littleEndian);\r\n        var headerOffset = 4;\r\n        const dataOffset = headerOffset + headerLength;\r\n\r\n        if (frag.debugMaterialLoader)\r\n            console.log(\"Material pack V\" + version + \" is \" + bytes.length + \" bytes with \" + headerLength + \" header bytes\");\r\n\r\n        if (version === 1) {\r\n            var textureSize = header.getUint16(headerOffset, littleEndian);\r\n            while (textureSize !== 0) {\r\n                private.loadMaterialV1(assetCatalog, header, headerOffset + 2, buffer, dataOffset);\r\n                headerOffset += textureSize;\r\n                textureSize = header.getUint16(headerOffset, littleEndian);\r\n            }\r\n        } else {\r\n            console.error(\"Version \" + version + \" texture packs are not supported\");\r\n        }\r\n        return assetCatalog;\r\n    };\r\n\r\n    public.loadMaterialsFromUrl = function (url, assetCatalog, onload) {\r\n        var xhttp = new XMLHttpRequest();\r\n        xhttp.responseType = \"arraybuffer\";\r\n        xhttp.onreadystatechange = function () {\r\n            if (this.readyState == 4 && this.status == 200) {\r\n                assetCatalog = public.loadMaterialsFromBuffer(this.response, assetCatalog);\r\n                if (onload) onload(assetCatalog);\r\n            }\r\n        };\r\n        xhttp.open(\"GET\", url, true);\r\n        xhttp.send();\r\n    };\r\n\r\n    return public;\r\n})();\r\n","window.frag.PackageLoader = (function () {\r\n    const frag = window.frag;\r\n\r\n    const uInt32 = new Uint32Array([0x11223344]);\r\n    const uInt8 = new Uint8Array(uInt32.buffer);\r\n    const littleEndian = uInt8[0] === 0x44;\r\n\r\n    const round4 = function(n) { return Math.round(n * 10000) / 10000; }\r\n\r\n    const private = {\r\n    }\r\n\r\n    const public = {\r\n        __private: private,\r\n        littleEndian\r\n    };\r\n\r\n    private.loadFontV1 = function (context, objectIndex, headerOffset) {\r\n        const nameLength = context.header.getUint8(headerOffset++);\r\n        var name = \"\";\r\n        for (let i = 0; i < nameLength; i++) {\r\n            name += String.fromCharCode(context.header.getUint8(headerOffset++));\r\n        }\r\n\r\n        const font = context.assetCatalog.getFont(name);\r\n        if (frag.debugPackageLoader)\r\n            console.log(\"Object[\" + objectIndex + \"] is font \" + name);\r\n\r\n        const faceLength = context.header.getUint8(headerOffset++);\r\n        var fontFace = \"\";\r\n        for (let i = 0; i < faceLength; i++) {\r\n            fontFace += String.fromCharCode(context.header.getUint8(headerOffset++));\r\n        }\r\n\r\n        const lineHeight = context.header.getUint16(headerOffset, littleEndian);\r\n        const width = context.header.getUint16(headerOffset + 2, littleEndian);\r\n        const height = context.header.getUint16(headerOffset + 4, littleEndian);\r\n        const charCount = context.header.getUint16(headerOffset + 6, littleEndian);\r\n        headerOffset += 8;\r\n\r\n        if (frag.debugPackageLoader)\r\n            console.log(\"  \" + width + \"x\" + height + \" pixel texture contains \" + charCount + \" characters from \" + lineHeight + \"px \" + fontFace);\r\n\r\n        font.lineHeight(lineHeight);\r\n\r\n        for (let charIndex = 0; charIndex < charCount; charIndex++) {\r\n            const charLength = context.header.getUint8(headerOffset++);\r\n            var char = \"\";\r\n            for (let i = 0; i < charLength; i++) {\r\n                char += String.fromCharCode(context.header.getUint8(headerOffset++));\r\n            }\r\n            const x = context.header.getUint16(headerOffset + 0, littleEndian);\r\n            const y = context.header.getUint16(headerOffset + 2, littleEndian);\r\n            const width = context.header.getUint16(headerOffset + 4, littleEndian);\r\n            const height = context.header.getUint16(headerOffset + 6, littleEndian);\r\n            const originX = context.header.getInt16(headerOffset + 8, littleEndian);\r\n            const originY = context.header.getInt16(headerOffset + 10, littleEndian);\r\n            const advance = context.header.getInt16(headerOffset + 12, littleEndian);\r\n            headerOffset += 14;\r\n\r\n            font.addChar(char, x, y, width, height, originX, originY, advance);\r\n        }\r\n\r\n        const modeLength = context.header.getUint8(headerOffset++);\r\n        var mode = \"\";\r\n        for (let i = 0; i < modeLength; i++) {\r\n            mode += String.fromCharCode(context.header.getUint8(headerOffset++));\r\n        }\r\n\r\n        if (mode === \"RGB\") font.dataFormat(frag.gl.RGB);\r\n        else if (mode === \"RGBA\") font.dataFormat(frag.gl.RGBA);\r\n        else if (mode === \"L\") font.dataFormat(frag.gl.LUMINANCE);\r\n        else console.error(\"Font \" + name + \" unsupported mode \" + mode);\r\n\r\n        const imageWidth = context.header.getUint16(headerOffset + 0, littleEndian);\r\n        const imageHeight = context.header.getUint16(headerOffset + 2, littleEndian);\r\n        let dataOffset = context.header.getUint32(headerOffset + 4, littleEndian) + context.dataOffset;\r\n        headerOffset += 8;\r\n\r\n        if (imageWidth !== width)             \r\n            console.error(\"Font \" + name + \" width does not match image width\");\r\n        if (imageHeight !== height)             \r\n            console.error(\"Font \" + name + \" height does not match image height\");\r\n\r\n        const dataArray = new Uint8Array(context.data, dataOffset);\r\n        font.fromArrayBuffer(dataArray, 0, width, height);\r\n        return font;\r\n    }\r\n\r\n    private.loadMaterialV1 = function (context, objectIndex, headerOffset) {\r\n        const nameLength = context.header.getUint8(headerOffset++);\r\n        var name = \"\";\r\n        for (let i = 0; i < nameLength; i++) {\r\n            name += String.fromCharCode(context.header.getUint8(headerOffset++));\r\n        }\r\n        const material = context.assetCatalog.getMaterial(name);\r\n        if (frag.debugPackageLoader)\r\n            console.log(\"Object[\" + objectIndex + \"] is material \" + name);\r\n        return material;\r\n    }\r\n\r\n    private.loadMeshV1 = function (context, objectIndex, headerOffset) {\r\n        const mesh = frag.MeshData();\r\n        const fragmentCount = context.header.getUint16(headerOffset, littleEndian);\r\n        headerOffset += 2;\r\n        if (frag.debugPackageLoader)\r\n            console.log(\"Object[\" + objectIndex + \"] is a mesh with \" + fragmentCount + \" fragments\");\r\n\r\n        for (let fragmentIndex = 0; fragmentIndex < fragmentCount; fragmentIndex++) {\r\n            const vertexFormat = context.header.getUint8(headerOffset);\r\n            const dataFlags = context.header.getUint8(headerOffset + 1);\r\n            const normalFormat = context.header.getUint8(headerOffset + 2);\r\n            const tangentFormat = context.header.getUint8(headerOffset + 3);\r\n            const bitangentFormat = context.header.getUint8(headerOffset + 4);\r\n            const uvFormat = context.header.getUint8(headerOffset + 5);\r\n            const colorFormat = context.header.getUint8(headerOffset + 6);\r\n            const meshVertexCount = context.header.getUint32(headerOffset + 7, littleEndian);\r\n            const indexVertexCount = context.header.getUint32(headerOffset + 11, littleEndian);\r\n            let dataOffset = context.header.getUint32(headerOffset + 15, littleEndian) + context.dataOffset;\r\n            headerOffset += 19;\r\n\r\n            const isIndexed = (dataFlags & 0x01) === 0x01;\r\n            const is3D = (dataFlags & 0x02) === 0x02;\r\n\r\n            let triangleCount = 0;\r\n            if (vertexFormat === 1) {\r\n                triangleCount = meshVertexCount / 3;\r\n            }\r\n            else if (vertexFormat === 2) {\r\n                triangleCount = meshVertexCount / 2;\r\n            }\r\n            else if (vertexFormat === 3) {\r\n                triangleCount = meshVertexCount - 2;\r\n            }\r\n            else if (vertexFormat === 4) {\r\n                triangleCount = meshVertexCount - 2;\r\n            };\r\n\r\n            if (frag.debugPackageLoader) {\r\n                let msg = \"  fragment[\" + fragmentIndex + \"] has \" + meshVertexCount + \" verticies forming \";\r\n                if (vertexFormat === 1) {\r\n                    msg += triangleCount + \" triangles\"\r\n                }\r\n                else if (vertexFormat === 2) {\r\n                    msg += (triangleCount / 2) + \" rectangles\"\r\n                }\r\n                else if (vertexFormat === 3) {\r\n                    msg += \"a strip of \" + triangleCount + \"triangles\"\r\n                }\r\n                else if (vertexFormat === 4) {\r\n                    msg += \"a fan of \" + triangleCount + \" triangles\"\r\n                };\r\n\r\n                if (isIndexed) msg += \" indexed\";\r\n                if (!is3D) msg += \" in 2D\";\r\n\r\n                switch (normalFormat) {\r\n                    case 1:\r\n                        msg += \" with custom normals\";\r\n                        break;\r\n                    case 2:\r\n                        msg += \" with indexed normals\";\r\n                        break;\r\n                    case 3:\r\n                        msg += \" with triangle normals\";\r\n                        break;\r\n                }\r\n\r\n                switch (tangentFormat) {\r\n                    case 1:\r\n                        msg += \" with custom tangents\";\r\n                        break;\r\n                    case 2:\r\n                        msg += \" with indexed tangents\";\r\n                        break;\r\n                    case 3:\r\n                        msg += \" with triangle tangents\";\r\n                        break;\r\n                    case 4:\r\n                        msg += \" with single tangent\";\r\n                        break;\r\n                }\r\n\r\n                switch (bitangentFormat) {\r\n                    case 1:\r\n                        msg += \" with bitangents\";\r\n                        break;\r\n                }\r\n\r\n                switch (uvFormat) {\r\n                    case 1:\r\n                        msg += \" with custom uvs\";\r\n                        break;\r\n                    case 2:\r\n                        msg += \" with indexed uvs\";\r\n                        break;\r\n                    case 3:\r\n                        msg += \" with triangle uvs\";\r\n                        break;\r\n                }\r\n\r\n                switch (colorFormat) {\r\n                    case 1:\r\n                        msg += \" with custom colors\";\r\n                        break;\r\n                    case 2:\r\n                        msg += \" with custom colors and transparency\";\r\n                        break;\r\n                    case 3:\r\n                        msg += \" with indexed colors\";\r\n                        break;\r\n                    case 4:\r\n                        msg += \" with indexed colors and transparency\";\r\n                        break;\r\n                }\r\n\r\n                console.log(msg);\r\n            }\r\n\r\n            const index = isIndexed ? [] : undefined;\r\n            if (isIndexed) {\r\n                indexArray = new Int16Array(context.data, dataOffset);\r\n                for (let i = 0; i < meshVertexCount; i++) {\r\n                    index.push(indexArray[i]);\r\n                }\r\n                dataOffset += 2 * meshVertexCount;\r\n                if ((meshVertexCount & 1) == 1) dataOffset += 2;\r\n            }\r\n\r\n            const verticies = [];\r\n            const normals = normalFormat === 0 ? undefined : [];\r\n            const tangents = tangentFormat === 0 ? undefined : [];\r\n            const bitangents = bitangentFormat === 0 ? undefined : [];\r\n            const uvs = uvFormat === 0 ? undefined : [];\r\n            const colors = undefined;\r\n\r\n            const dataArray = new Float32Array(context.data, dataOffset);\r\n\r\n            for (let vertexOffset = 0; vertexOffset < meshVertexCount; vertexOffset++) {\r\n                let indexOffset = isIndexed ? index[vertexOffset] : vertexOffset;\r\n\r\n                let triangleOffset = Math.trunc(vertexOffset / 3);\r\n                if (vertexFormat === 2) {\r\n                    triangleOffset = Math.trunc(vertexOffset / 4);\r\n                }\r\n                else if (vertexFormat === 3 || vertexFormat === 4) {\r\n                    if (vertexOffset < 3) triangleOffset = 0;\r\n                    else triangleOffset = vertexOffset - 2;\r\n                }\r\n\r\n                let sectionDataIndex = 0;\r\n                let vertexDataIndex = is3D ? indexOffset * 3 : indexOffset * 2;\r\n\r\n                verticies.push(dataArray[vertexDataIndex]); // X\r\n                verticies.push(dataArray[vertexDataIndex + 1]); // Y\r\n                if (is3D) {\r\n                    verticies.push(dataArray[vertexDataIndex + 2]); // Z\r\n                    sectionDataIndex += indexVertexCount * 3;\r\n                } else {\r\n                    sectionDataIndex += indexVertexCount * 2;\r\n                }\r\n\r\n                switch (normalFormat) {\r\n                    case 1:\r\n                        vertexDataIndex = sectionDataIndex + vertexOffset * 3;\r\n                        sectionDataIndex += meshVertexCount * 3;\r\n                        break;\r\n                    case 2:\r\n                        vertexDataIndex = sectionDataIndex + indexOffset * 3;\r\n                        sectionDataIndex += indexVertexCount * 3;\r\n                        break;\r\n                    case 3:\r\n                        vertexDataIndex = sectionDataIndex + triangleOffset * 3;\r\n                        sectionDataIndex += triangleCount * 3;\r\n                        break;\r\n                }\r\n                if (normalFormat !== 0) {\r\n                    normals.push(dataArray[vertexDataIndex]); // X\r\n                    normals.push(dataArray[vertexDataIndex + 1]); // Y\r\n                    normals.push(dataArray[vertexDataIndex + 2]); // Z\r\n                }\r\n\r\n                //if (hasTangents) {\r\n                //    tangents.push(dataArray[vertexDataIndex]); // X\r\n                //    tangents.push(dataArray[vertexDataIndex + 1]); // Y\r\n                //    tangents.push(dataArray[vertexDataIndex + 2]); // Z\r\n                //    vertexDataIndex += indexVertexCount * 3;\r\n                //}\r\n\r\n                //if (hasBitangents) {\r\n                //    bitangents.push(dataArray[vertexDataIndex]); // X\r\n                //    bitangents.push(dataArray[vertexDataIndex + 1]); // Y\r\n                //    bitangents.push(dataArray[vertexDataIndex + 2]); // Z\r\n                //    vertexDataIndex += indexVertexCount * 3;\r\n                //}\r\n\r\n                //if (hasUvs) {\r\n                //    uvs.push(dataArray[vertexDataIndex]); // U\r\n                //    uvs.push(dataArray[vertexDataIndex + 1]); // V\r\n                //    vertexDataIndex += indexVertexCount * 2;\r\n                //}\r\n            }\r\n\r\n            if (frag.debugPackageLoader && frag.debugMeshes) {\r\n                let msg = \"  vertices[\";\r\n                for (var i = 0; i < verticies.length; i++) {\r\n                    if (i > 0) msg += ', ';\r\n                    msg += round4(verticies[i]);\r\n                }\r\n                msg += \"]\";\r\n                console.log(msg);\r\n            }\r\n\r\n            const vertexData = frag.VertexData();\r\n            if (vertexFormat === 1 || vertexFormat === 2) {\r\n                if (is3D)\r\n                    vertexData.setTriangles(verticies, colors, uvs, normals, tangents, bitangents)\r\n                else\r\n                    vertexData.setTriangles2D(verticies, colors, uvs, normals, tangents, bitangents);\r\n            }\r\n            else if (vertexFormat === 3) vertexData.setTriangleStrip(verticies, colors, uvs, normals, tangents, bitangents);\r\n            else if (vertexFormat === 4) vertexData.setTriangleFan(verticies, colors, uvs, normals, tangents, bitangents);\r\n\r\n            mesh.addVertexData(vertexData);\r\n        }\r\n\r\n        return mesh;\r\n    }\r\n\r\n    private.loadAnimationV1 = function (context, objectIndex, headerOffset) {\r\n        const nameLength = context.header.getUint8(headerOffset++);\r\n        var name = \"\";\r\n        for (let i = 0; i < nameLength; i++) {\r\n            name += String.fromCharCode(context.header.getUint8(headerOffset++));\r\n        }\r\n\r\n        const flags = context.header.getUint8(headerOffset);\r\n        const frames = context.header.getUint16(headerOffset + 1, littleEndian);\r\n        const interval = context.header.getUint16(headerOffset + 3, littleEndian);\r\n        const channelCount = context.header.getUint8(headerOffset + 5);\r\n        headerOffset += 6;\r\n\r\n        const loop = (flags & 0x1) === 0x1;\r\n        const reverse = (flags & 0x2) === 0x2;\r\n\r\n        if (frag.debugPackageLoader) {\r\n            let msg = \"Object[\" + objectIndex + \"] is '\" + name + \"' animation which runs for \" + frames + \"x\" + interval + \" ms\";\r\n            if (loop) msg += \". Repeats until stopped\";\r\n            if (reverse) msg += \". Plays in reverse after playing forwards\";\r\n            console.log(msg);\r\n        }\r\n\r\n        const modelAnimation = frag.ModelAnimation()\r\n            .name(name)\r\n            .loop(loop)\r\n            .frames(frames)\r\n            .interval(interval / window.frag.gameTickMs);\r\n\r\n        for (let i = 0; i < channelCount; i++) {\r\n            const patternLength = context.header.getUint8(headerOffset++);\r\n            var pattern = \"\";\r\n            for (let i = 0; i < patternLength; i++) {\r\n                pattern += String.fromCharCode(context.header.getUint8(headerOffset++));\r\n            }\r\n\r\n            const channelNameLength = context.header.getUint8(headerOffset++);\r\n            var channelName = \"\";\r\n            for (let i = 0; i < channelNameLength; i++) {\r\n                channelName += String.fromCharCode(context.header.getUint8(headerOffset++));\r\n            }\r\n\r\n            if (frag.debugPackageLoader && frag.debugAnimations) {\r\n                msg = \"  Channel \" + channelName + \" applies to \" + pattern + \" children\"\r\n                console.log(msg);\r\n            }\r\n\r\n            const keyframes = {};\r\n            const keyframeCount = context.header.getUint16(headerOffset, littleEndian);\r\n            headerOffset += 2;\r\n\r\n            for (let j = 0; j < keyframeCount; j++) {\r\n                const frame = context.header.getUint16(headerOffset, littleEndian);\r\n                const transitionEnum = context.header.getUint8(headerOffset + 2);\r\n                const value = context.header.getFloat32(headerOffset + 3, littleEndian);\r\n                headerOffset += 7;\r\n\r\n                var transition = \"step\";\r\n                if (transitionEnum === 1) transition = \"linear\";\r\n                else if (transitionEnum === 2) transition = \"spline\";\r\n                keyframes[frame] = { value, transition };\r\n\r\n                if (frag.debugPackageLoader && frag.debugAnimations) {\r\n                    msg = \"    Keyframe[\" + frame + \"] = \" + round4(value) + \" \" + transition;\r\n                    console.log(msg);\r\n                }\r\n            }\r\n\r\n            modelAnimation.addChannel({\r\n                channel: channelName,\r\n                pattern: new RegExp(pattern, \"i\"),\r\n                keyframes: keyframes\r\n            });\r\n        }\r\n\r\n        return modelAnimation;\r\n    }\r\n\r\n    private.loadModelV1 = function (context, objectIndex, headerOffset) {\r\n        const nameLength = context.header.getUint8(headerOffset++);\r\n        var name = \"\";\r\n        for (let i = 0; i < nameLength; i++) {\r\n            name += String.fromCharCode(context.header.getUint8(headerOffset++));\r\n        }\r\n\r\n        const modelFlags = context.header.getUint8(headerOffset);\r\n        const materialIndex = context.header.getUint16(headerOffset + 1, littleEndian);\r\n        const meshIndex = context.header.getUint16(headerOffset + 3, littleEndian);\r\n        headerOffset += 5;\r\n\r\n        const location = frag.Location(true); // Loaded models are always 3D\r\n        location.translateX = context.header.getFloat32(headerOffset + 0, littleEndian);\r\n        location.translateY = context.header.getFloat32(headerOffset + 4, littleEndian);\r\n        location.translateZ = context.header.getFloat32(headerOffset + 8, littleEndian);\r\n        location.rotateX = context.header.getFloat32(headerOffset + 12, littleEndian);\r\n        location.rotateY = context.header.getFloat32(headerOffset + 16, littleEndian);\r\n        location.rotateZ = context.header.getFloat32(headerOffset + 20, littleEndian);\r\n        location.scaleX = context.header.getFloat32(headerOffset + 24, littleEndian);\r\n        location.scaleY = context.header.getFloat32(headerOffset + 28, littleEndian);\r\n        location.scaleZ = context.header.getFloat32(headerOffset + 32, littleEndian);\r\n        location.isModified = true;\r\n        headerOffset += 36;\r\n\r\n        const childCount = context.header.getUint16(headerOffset, littleEndian);\r\n        const animationCount = context.header.getUint16(headerOffset + 2, littleEndian);\r\n        headerOffset += 4;\r\n\r\n        const isRoot = (modelFlags & 1) === 1;\r\n        const hasMaterial = (modelFlags & 2) === 2;\r\n        const hasMesh = (modelFlags & 4) === 4;\r\n\r\n        if (frag.debugPackageLoader) {\r\n            console.log(\"Object[\" + objectIndex + \"] is \" + \r\n                (isRoot ? \"root \" : \"\") + \"model \" + name + \" with \" + childCount + \" children and \" + animationCount + \" animations.\" + \r\n                (hasMesh ? \" Paint mesh \" + meshIndex : \" No mesh\") + (hasMaterial ? \" with material \" + materialIndex : \". No material\"));\r\n            console.log(\"Object[\" + objectIndex + \"] at (\" + \r\n                round4(location.translateX) + \",\" + round4(location.translateY) + \",\" + round4(location.translateZ) +\").[\"+ \r\n                round4(location.rotateX) + \",\" + round4(location.rotateY) + \",\" + round4(location.rotateZ) + \"]x(\" + \r\n                round4(location.scaleX) + \",\" + round4(location.scaleY) + \",\" + round4(location.scaleZ) + \")\");\r\n        }\r\n\r\n        const model = context.assetCatalog.getModel(name, !isRoot);\r\n        model.location = location;\r\n\r\n        if (hasMaterial) model.material(context.materials[materialIndex]);\r\n        if (hasMesh) model.mesh(context.meshes[meshIndex]);\r\n\r\n        for (let i = 0; i < childCount; i++) {\r\n            const modelIndex = context.header.getUint16(headerOffset, littleEndian);\r\n            headerOffset += 2;\r\n            model.addChild(context.models[modelIndex]);\r\n        }\r\n\r\n        if (isRoot) {\r\n            if (frag.debugAnimations && animationCount > 0)\r\n                console.log(\"Model #\" + objectIndex + \" '\" + name + \"' has \" + animationCount + \" animations\");\r\n            for (let i = 0; i < animationCount; i++) {\r\n                const animationIndex = context.header.getUint16(headerOffset, littleEndian);\r\n                headerOffset += 2;\r\n\r\n                const animation = context.animations[animationIndex];\r\n                if (frag.debugAnimations) {\r\n                    const channels = animation.getChannelGraphs();\r\n                    console.log(\"  Animation '\" + animation.getName() + \"' has \" + channels.length + \" channels.\" + (animation.__private.loop ? \" Loop \" : \"\") + animation.__private.frames + \"x\" + animation.__private.interval + \" frames\");\r\n                    for (let channelIndex = 0; channelIndex < channels.length; channelIndex++) {\r\n                        console.log(\"    Animates \" + channels[channelIndex].channel + \" for children matching \" + channels[channelIndex].pattern);\r\n                    }\r\n                }\r\n                model.addAnimation(animation);\r\n            }\r\n        } else {\r\n            if (animationCount > 0) console.warn(\"Model #\" + objectIndex + \" '\" + name + \"' has \" + animationCount + \" animations but is not a root\");\r\n        }\r\n\r\n        return model;\r\n    };\r\n\r\n    public.loadFromBuffer = function(buffer, assetCatalog){\r\n        if (!assetCatalog) assetCatalog = frag.AssetCatalog();\r\n\r\n        const bytes = new Uint8Array(buffer);\r\n        const header = new DataView(buffer, 0, bytes.length);\r\n\r\n        const version = bytes[0];\r\n        const headerLength = header.getUint32(4, littleEndian);\r\n        var headerOffset = 8;\r\n        const dataOffset = headerOffset + headerLength;\r\n\r\n        if (frag.debugPackageLoader)\r\n            console.log(\"Asset pack V\" + version + \" is \" + bytes.length + \" bytes with \" + headerLength + \" header bytes\");\r\n\r\n        const context = {\r\n            assetCatalog,\r\n            header,\r\n            data: buffer,\r\n            dataOffset,\r\n            materials: {},\r\n            meshes: {},\r\n            animations: {},\r\n            models: {},\r\n            fonts: {}\r\n        };\r\n\r\n        if (version === 1) {\r\n            var objectSize = header.getUint16(headerOffset, littleEndian);\r\n            var expectedObjectIndex = 0;\r\n            while (objectSize !== 0) {\r\n                const objectIndex = header.getUint16(headerOffset + 2, littleEndian);\r\n                const objectType = header.getUint8(headerOffset + 4);\r\n                const objectOffset = headerOffset + 5;\r\n\r\n                if (objectIndex !== expectedObjectIndex++) {\r\n                    console.error(\"Object indexes are not consecutive\");\r\n                    return;\r\n                }\r\n\r\n                if (objectType === 0) break;\r\n\r\n                if (objectType === 1) {\r\n                    context.materials[objectIndex] = private.loadMaterialV1(context, objectIndex, objectOffset);\r\n                }\r\n                else if (objectType === 2) {\r\n                    context.meshes[objectIndex] = private.loadMeshV1(context, objectIndex, objectOffset);\r\n                }\r\n                else if (objectType === 3) {\r\n                    context.animations[objectIndex] = private.loadAnimationV1(context, objectIndex, objectOffset);\r\n                }\r\n                else if (objectType === 4) {\r\n                    context.models[objectIndex] = private.loadModelV1(context, objectIndex, objectOffset);\r\n                }\r\n                else if (objectType === 5) {\r\n                    context.fonts[objectIndex] = private.loadFontV1(context, objectIndex, objectOffset);\r\n                }\r\n                else console.error(\"Unknown object type \" + objectType);\r\n\r\n                headerOffset += objectSize;\r\n                objectSize = header.getUint16(headerOffset, littleEndian);\r\n            }\r\n        } else {\r\n            console.error(\"Version \" + version + \" asset packs are not supported\");\r\n        }\r\n        return assetCatalog\r\n    };\r\n\r\n    public.loadFromUrl = function (url, assetCatalog, onload) {\r\n        var xhttp = new XMLHttpRequest();\r\n        xhttp.responseType = \"arraybuffer\";\r\n        xhttp.onreadystatechange = function () {\r\n            if (this.readyState == 4 && this.status == 200) {\r\n                assetCatalog = public.loadFromBuffer(this.response, assetCatalog);\r\n                if (onload) onload(assetCatalog)\r\n            }\r\n        };\r\n        xhttp.open(\"GET\", url, true);\r\n        xhttp.send();\r\n    };\r\n\r\n    return public;\r\n})();\r\n","window.frag.Font = function () {\r\n    const frag = window.frag;\r\n    const gl = frag.gl;\r\n\r\n    const private = {\r\n        glTexture: null,\r\n        generated: false,\r\n        internalFormat: gl.RGBA,\r\n        format: gl.RGBA,\r\n        dataType: gl.UNSIGNED_BYTE,\r\n        valuesPerPixel: 4,\r\n        chars: {},\r\n        lineHeight: 24,\r\n        color: [0, 0, 0, 1]\r\n    }\r\n\r\n    const public = {\r\n        __private: private,\r\n        textureUnit: window.frag.allocateTextureUnit()\r\n    };\r\n\r\n    public.dispose = function () {\r\n        if (private.glTexture) {\r\n            gl.deleteTexture(private.glTexture);\r\n            private.glTexture = null;\r\n            private.disposed = true;\r\n        }\r\n    }\r\n\r\n    public.name = function (value) {\r\n        private.name = value;\r\n        return public;\r\n    }\r\n\r\n    public.color = function(color) {\r\n        private.color = color;\r\n    }\r\n\r\n    public.dataFormat = function (format) {\r\n        private.internalFormat = format;\r\n        private.format = format;\r\n\r\n        if (format === gl.RGBA) {\r\n            private.dataType = gl.UNSIGNED_BYTE;\r\n            private.valuesPerPixel = 4;\r\n        }\r\n        else if (format === gl.RGB) {\r\n            private.dataType = gl.UNSIGNED_BYTE;\r\n            private.valuesPerPixel = 3;\r\n        }\r\n        else if (format === gl.LUMINANCE_ALPHA) {\r\n            private.dataType = gl.UNSIGNED_BYTE;\r\n            private.valuesPerPixel = 2;\r\n        }\r\n        else if (format === gl.LUMINANCE || formaat === gl.ALPHA) {\r\n            private.dataType = gl.UNSIGNED_BYTE;\r\n            private.valuesPerPixel = 1;\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    private.setup = function (width, height) {\r\n        private.width = width;\r\n        private.height = height;\r\n\r\n        if (!private.glTexture)\r\n            private.glTexture = gl.createTexture();\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, private.glTexture);\r\n\r\n        if ((width & (width - 1)) !== 0 || (height & (height - 1)) !== 0) {\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n            private.generated = true;\r\n        }\r\n    }\r\n\r\n    public.lineHeight = function (height) {\r\n        private.lineHeight = height;\r\n    }\r\n\r\n    public.addChar = function(char, x, y, width, height, originX, originY, advance) {\r\n        private.chars[char] = { x, y, width, height, originX, originY, advance };\r\n    }\r\n\r\n    public.fromArrayBuffer = function (buffer, offset, width, height) {\r\n        let bufferView;\r\n        if (private.dataType === gl.UNSIGNED_BYTE)\r\n            bufferView = new Uint8Array(buffer, offset, width * height * private.valuesPerPixel);\r\n\r\n        private.setup(width, height);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, private.internalFormat, width, height, 0, private.format, private.dataType, bufferView);\r\n\r\n        return public;\r\n    }\r\n\r\n    public.fromImage = function (image) {\r\n        const load = function() {\r\n            private.setup(image.width, image.height);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, private.internalFormat, private.format, private.dataType, image);\r\n        }\r\n        if (image.onload)\r\n            load();\r\n        else\r\n            image.onload = load;\r\n        return public;\r\n    }\r\n\r\n    public.apply = function (gl, shader) {\r\n        if (shader.uniforms[\"color\"] !== undefined) {\r\n            gl[\"uniform\" + private.color.length + \"fv\"](shader.uniforms[\"color\"], private.color);\r\n        }\r\n\r\n        const uniform = shader.uniforms[\"diffuse\"];\r\n        if (!uniform || !private.glTexture)\r\n            return public;\r\n        \r\n        gl.activeTexture(gl.TEXTURE0 + public.textureUnit);\r\n        gl.bindTexture(gl.TEXTURE_2D, private.glTexture);\r\n\r\n        if (!private.generated) {\r\n            gl.generateMipmap(gl.TEXTURE_2D);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n            private.generated = true;\r\n        }\r\n\r\n        gl.uniform1i(uniform, public.textureUnit);\r\n        return public;\r\n    }\r\n    public.buildTextMesh = function (text) {\r\n        const verticies = [];\r\n        const uvs = [];\r\n        const normals = [];\r\n\r\n        const pushVerticies = function (left, right, top, bottom) {\r\n            verticies.push(left);\r\n            verticies.push(bottom);\r\n            verticies.push(0);\r\n\r\n            verticies.push(right);\r\n            verticies.push(top);\r\n            verticies.push(0);\r\n\r\n            verticies.push(left);\r\n            verticies.push(top);\r\n            verticies.push(0);\r\n\r\n            verticies.push(left);\r\n            verticies.push(bottom);\r\n            verticies.push(0);\r\n\r\n            verticies.push(right);\r\n            verticies.push(bottom);\r\n            verticies.push(0);\r\n\r\n            verticies.push(right);\r\n            verticies.push(top);\r\n            verticies.push(0);\r\n\r\n            for (let i = 0; i < 6; i++) {\r\n                normals.push(0);\r\n                normals.push(0);\r\n                normals.push(-1);\r\n            }\r\n        }\r\n\r\n        const pushTexture = function(left, right, top, bottom) {\r\n            left = left  / private.width;\r\n            right = right  / private.width;\r\n            top = top / private.height;\r\n            bottom = bottom / private.height;\r\n\r\n            uvs.push(left);\r\n            uvs.push(bottom);\r\n\r\n            uvs.push(right);\r\n            uvs.push(top);\r\n\r\n            uvs.push(left);\r\n            uvs.push(top);\r\n\r\n            uvs.push(left);\r\n            uvs.push(bottom);\r\n\r\n            uvs.push(right);\r\n            uvs.push(bottom);\r\n\r\n            uvs.push(right);\r\n            uvs.push(top);\r\n        }\r\n\r\n        const drawChar = function (ch, x) {\r\n            dimensions = private.chars[ch];\r\n            if (!dimensions) return x;\r\n\r\n            const left = x - dimensions.originX;\r\n            const right = left + dimensions.width;\r\n            const top = dimensions.originY;\r\n            const bottom = top - dimensions.height;\r\n\r\n            pushVerticies(left, right, top, bottom);\r\n    \r\n            const texLeft = dimensions.x;\r\n            const texTop = private.height - dimensions.y;\r\n            const texRight = texLeft + dimensions.width;\r\n            const texBottom = texTop - dimensions.height;\r\n\r\n            pushTexture(texLeft, texRight, texTop, texBottom);\r\n\r\n            return x + dimensions.advance;\r\n        }\r\n\r\n        let x = 0;\r\n        for (let i = 0; i < text.length; i++) {\r\n            x = drawChar(text[i], x);\r\n        }\r\n\r\n        return frag.MeshData()\r\n            .addTriangles(verticies, undefined, uvs, normals)\r\n            .shadeFlat()\r\n            .textureFlat();\r\n    }\r\n\r\n    public.buildTextModel = function(text) {\r\n        const mesh = public.buildTextMesh(text);\r\n\r\n        const model = frag.Model(true)\r\n            .shader(frag.fontShader)\r\n            .mesh(mesh)\r\n            .material(public);\r\n        return model;\r\n    }\r\n\r\n    public.updateTextModel = function(model, text) {\r\n        const oldMesh = model.getMesh();\r\n        model.mesh(public.buildTextMesh(text));\r\n        oldMesh.dispose();\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n};\r\n","window.frag.Material = function () {\r\n    const private = {\r\n        textures: {},\r\n        disposeTextures: false\r\n    }\r\n\r\n    const public = {\r\n        __private: private\r\n    };\r\n\r\n    public.dispose = function () {\r\n        if (private.disposeTextures) {\r\n            for (let textureType in private.textures) {\r\n                const texture = private.textures[textureType];\r\n                if (texture) texture.dispose();\r\n            }\r\n        }\r\n        private.textures = {};\r\n    };\r\n\r\n    public.disposeTextures = function (shouldDispose) {\r\n        private.disposeTextures = shouldDispose;\r\n        return public;\r\n    }\r\n\r\n    public.name = function (value) {\r\n        private.name = value;\r\n        return public;\r\n    };\r\n\r\n    // The name of the texture type must match the name of a uniform on the shader\r\n    public.setTexture = function (textureType, texture) {\r\n        if (private.disposeTextures) {\r\n            const currentTexture = private.textures[textureType];\r\n            if (currentTexture) currentTexture.dispose();\r\n        }\r\n        private.textures[textureType] = texture;\r\n        return public;\r\n    }\r\n\r\n    public.apply = function (gl, shader) {\r\n        for (let textureType in private.textures) {\r\n            const texture = private.textures[textureType];\r\n            if (texture) texture.apply(textureType, gl, shader);\r\n        }\r\n        return public;\r\n    };\r\n\r\n    return public;\r\n};\r\n","window.frag.Texture = function () {\r\n    const frag = window.frag;\r\n    const gl = frag.gl;\r\n\r\n    const private = {\r\n        glTexture: null,\r\n        generated: false,\r\n        internalFormat: gl.RGBA,\r\n        format: gl.RGBA,\r\n        dataType: gl.UNSIGNED_BYTE,\r\n        valuesPerPixel: 4\r\n    }\r\n\r\n    const public = {\r\n        __private: private,\r\n        textureUnit: window.frag.allocateTextureUnit()\r\n    };\r\n\r\n    public.dispose = function () {\r\n        if (private.glTexture) {\r\n            gl.deleteTexture(private.glTexture);\r\n            private.glTexture = null;\r\n            private.disposed = true;\r\n        }\r\n    }\r\n\r\n    public.name = function (value) {\r\n        private.name = value;\r\n        return public;\r\n    }\r\n\r\n    public.dataFormat = function (format) {\r\n        private.internalFormat = format;\r\n        private.format = format;\r\n\r\n        if (format === gl.RGBA) {\r\n            private.dataType = gl.UNSIGNED_BYTE;\r\n            private.valuesPerPixel = 4;\r\n        }\r\n        else if (format === gl.RGB) {\r\n            private.dataType = gl.UNSIGNED_BYTE;\r\n            private.valuesPerPixel = 3;\r\n        }\r\n        else if (format === gl.LUMINANCE_ALPHA) {\r\n            private.dataType = gl.UNSIGNED_BYTE;\r\n            private.valuesPerPixel = 2;\r\n        }\r\n        else if (format === gl.LUMINANCE || formaat === gl.ALPHA) {\r\n            private.dataType = gl.UNSIGNED_BYTE;\r\n            private.valuesPerPixel = 1;\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    private.setup = function (width, height) {\r\n        private.width = width;\r\n        private.height = height;\r\n\r\n        if (!private.glTexture)\r\n            private.glTexture = gl.createTexture();\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, private.glTexture);\r\n\r\n        if ((width & (width - 1)) !== 0 || (height & (height - 1)) !== 0) {\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n            private.generated = true;\r\n        }\r\n    }\r\n\r\n    public.fromArrayBuffer = function (level, buffer, offset, width, height) {\r\n        let bufferView;\r\n        if (private.dataType === gl.UNSIGNED_BYTE)\r\n            bufferView = new Uint8Array(buffer, offset, width * height * private.valuesPerPixel);\r\n\r\n        private.setup(width, height);\r\n        gl.texImage2D(gl.TEXTURE_2D, level, private.internalFormat, width, height, 0, private.format, private.dataType, bufferView);\r\n\r\n        return public;\r\n    }\r\n\r\n    public.fromImage = function (level, image) {\r\n        const load = function() {\r\n            private.setup(image.width, image.height);\r\n            gl.texImage2D(gl.TEXTURE_2D, level, private.internalFormat, private.format, private.dataType, image);\r\n        }\r\n        if (image.onload)\r\n            load();\r\n        else\r\n            image.onload = load;\r\n        return public;\r\n    }\r\n\r\n    public.fromUrl = function (level, url, crossOrigin) {\r\n        const image = new Image();\r\n        public.fromImage(level, image);\r\n        if (crossOrigin !== undefined)\r\n            image.crossOrigin = crossOrigin;\r\n        image.src = url;\r\n        return public;\r\n    }\r\n\r\n    public.update = function (width, height) {\r\n        const frag = window.frag;\r\n        const gl = frag.gl;\r\n\r\n        if (private.scene) {\r\n            if (width !== undefined && height !== undefined) {\r\n                if (width !== private.width || height !== private.height) {\r\n                    public.fromScene(private.scene, width, height);\r\n                }\r\n            }\r\n\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, private.frameBuffer);\r\n            gl.viewport(0, 0, private.width, private.height);\r\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n            private.scene.adjustToViewport(gl);\r\n            private.scene.draw({ gl });\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    public.fromScene = function (scene, width, height) {\r\n        const frag = window.frag;\r\n        const gl = frag.gl;\r\n        const level = 0;\r\n\r\n        private.setup(width, height);\r\n        gl.texImage2D(gl.TEXTURE_2D, level, private.internalFormat, width, height, 0, private.format, private.dataType, null);\r\n\r\n        private.scene = scene;\r\n        private.frameBuffer = gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, private.frameBuffer);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, private.glTexture, level);\r\n\r\n        private.depthBuffer = gl.createRenderbuffer();\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, private.depthBuffer);\r\n        gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, width, height);\r\n        gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, private.depthBuffer);\r\n\r\n        return public.update(width, height);\r\n    }\r\n\r\n    public.apply = function (textureType, gl, shader) {\r\n        const uniform = shader.uniforms[textureType];\r\n        if (!uniform || !private.glTexture)\r\n            return public;\r\n        \r\n        gl.activeTexture(gl.TEXTURE0 + public.textureUnit);\r\n        gl.bindTexture(gl.TEXTURE_2D, private.glTexture);\r\n\r\n        if (!private.generated) {\r\n            gl.generateMipmap(gl.TEXTURE_2D);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n            private.generated = true;\r\n        }\r\n\r\n        gl.uniform1i(uniform, public.textureUnit);\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n};\r\n","window.frag = window.frag || {};\r\nwindow.frag.Matrix = {\r\n    m3Identity: function () {\r\n        return [\r\n            1, 0, 0,\r\n            0, 1, 0,\r\n            0, 0, 1\r\n        ];\r\n    },\r\n\r\n    m3Invert: function (a) {\r\n        return a; // TODO: http://blog.acipo.com/matrix-inversion-in-javascript/\r\n    },\r\n\r\n    m3Transpose: function (a) {\r\n        return [\r\n            a[0], a[3], a[6],\r\n            a[1], a[4], a[7],\r\n            a[2], a[5], a[8],\r\n        ];\r\n    },\r\n\r\n    m3Xm3: function (a, b) {\r\n        const a00 = a[0 * 3 + 0];\r\n        const a01 = a[0 * 3 + 1];\r\n        const a02 = a[0 * 3 + 2];\r\n        const a10 = a[1 * 3 + 0];\r\n        const a11 = a[1 * 3 + 1];\r\n        const a12 = a[1 * 3 + 2];\r\n        const a20 = a[2 * 3 + 0];\r\n        const a21 = a[2 * 3 + 1];\r\n        const a22 = a[2 * 3 + 2];\r\n\r\n        const b00 = b[0 * 3 + 0];\r\n        const b01 = b[0 * 3 + 1];\r\n        const b02 = b[0 * 3 + 2];\r\n        const b10 = b[1 * 3 + 0];\r\n        const b11 = b[1 * 3 + 1];\r\n        const b12 = b[1 * 3 + 2];\r\n        const b20 = b[2 * 3 + 0];\r\n        const b21 = b[2 * 3 + 1];\r\n        const b22 = b[2 * 3 + 2];\r\n        return [\r\n            b00 * a00 + b01 * a10 + b02 * a20,\r\n            b00 * a01 + b01 * a11 + b02 * a21,\r\n            b00 * a02 + b01 * a12 + b02 * a22,\r\n            b10 * a00 + b11 * a10 + b12 * a20,\r\n            b10 * a01 + b11 * a11 + b12 * a21,\r\n            b10 * a02 + b11 * a12 + b12 * a22,\r\n            b20 * a00 + b21 * a10 + b22 * a20,\r\n            b20 * a01 + b21 * a11 + b22 * a21,\r\n            b20 * a02 + b21 * a12 + b22 * a22,\r\n        ];\r\n    },\r\n\r\n    m3Xv3: function (a, b) {\r\n        const a00 = a[0 * 3 + 0];\r\n        const a01 = a[0 * 3 + 1];\r\n        const a02 = a[0 * 3 + 2];\r\n        const a10 = a[1 * 3 + 0];\r\n        const a11 = a[1 * 3 + 1];\r\n        const a12 = a[1 * 3 + 2];\r\n        const a20 = a[2 * 3 + 0];\r\n        const a21 = a[2 * 3 + 1];\r\n        const a22 = a[2 * 3 + 2];\r\n\r\n        const b0 = b[0];\r\n        const b1 = b[1];\r\n        const b2 = b[2];\r\n\r\n        return [\r\n            b0 * a00 + b1 * a10 + b2 * a20,\r\n            b0 * a01 + b1 * a11 + b2 * a21,\r\n            b0 * a02 + b1 * a12 + b2 * a22,\r\n        ];\r\n    },\r\n\r\n    m4Identity: function () {\r\n        return [\r\n            1, 0, 0, 0,\r\n            0, 1, 0, 0,\r\n            0, 0, 1, 0,\r\n            0, 0, 0, 1\r\n        ];\r\n    },\r\n\r\n    m4Invert: function (a) {\r\n        // TODO: http://blog.acipo.com/matrix-inversion-in-javascript/\r\n        return [\r\n            a[0], a[4], a[8],\r\n            a[1], a[5], a[9],\r\n            a[2], a[6], a[10],\r\n            a[3], a[7], a[11],\r\n        ];\r\n    },\r\n\r\n    m4Transpose: function (a) {\r\n        return [\r\n            a[0], a[4], a[8], a[12],\r\n            a[1], a[5], a[9], a[13],\r\n            a[2], a[6], a[10], a[14],\r\n            a[3], a[7], a[11], a[15],\r\n        ];\r\n    },\r\n\r\n    m4Xm4: function (a, b) {\r\n        const a00 = a[0 * 4 + 0];\r\n        const a01 = a[0 * 4 + 1];\r\n        const a02 = a[0 * 4 + 2];\r\n        const a03 = a[0 * 4 + 3];\r\n        const a10 = a[1 * 4 + 0];\r\n        const a11 = a[1 * 4 + 1];\r\n        const a12 = a[1 * 4 + 2];\r\n        const a13 = a[1 * 4 + 3];\r\n        const a20 = a[2 * 4 + 0];\r\n        const a21 = a[2 * 4 + 1];\r\n        const a22 = a[2 * 4 + 2];\r\n        const a23 = a[2 * 4 + 3];\r\n        const a30 = a[3 * 4 + 0];\r\n        const a31 = a[3 * 4 + 1];\r\n        const a32 = a[3 * 4 + 2];\r\n        const a33 = a[3 * 4 + 3];\r\n\r\n        const b00 = b[0 * 4 + 0];\r\n        const b01 = b[0 * 4 + 1];\r\n        const b02 = b[0 * 4 + 2];\r\n        const b03 = b[0 * 4 + 3];\r\n        const b10 = b[1 * 4 + 0];\r\n        const b11 = b[1 * 4 + 1];\r\n        const b12 = b[1 * 4 + 2];\r\n        const b13 = b[1 * 4 + 3];\r\n        const b20 = b[2 * 4 + 0];\r\n        const b21 = b[2 * 4 + 1];\r\n        const b22 = b[2 * 4 + 2];\r\n        const b23 = b[2 * 4 + 3];\r\n        const b30 = b[3 * 4 + 0];\r\n        const b31 = b[3 * 4 + 1];\r\n        const b32 = b[3 * 4 + 2];\r\n        const b33 = b[3 * 4 + 3];\r\n\r\n        return [\r\n            b00 * a00 + b01 * a10 + b02 * a20 + b03 * a30,\r\n            b00 * a01 + b01 * a11 + b02 * a21 + b03 * a31,\r\n            b00 * a02 + b01 * a12 + b02 * a22 + b03 * a32,\r\n            b00 * a03 + b01 * a13 + b02 * a23 + b03 * a33,\r\n            b10 * a00 + b11 * a10 + b12 * a20 + b13 * a30,\r\n            b10 * a01 + b11 * a11 + b12 * a21 + b13 * a31,\r\n            b10 * a02 + b11 * a12 + b12 * a22 + b13 * a32,\r\n            b10 * a03 + b11 * a13 + b12 * a23 + b13 * a33,\r\n            b20 * a00 + b21 * a10 + b22 * a20 + b23 * a30,\r\n            b20 * a01 + b21 * a11 + b22 * a21 + b23 * a31,\r\n            b20 * a02 + b21 * a12 + b22 * a22 + b23 * a32,\r\n            b20 * a03 + b21 * a13 + b22 * a23 + b23 * a33,\r\n            b30 * a00 + b31 * a10 + b32 * a20 + b33 * a30,\r\n            b30 * a01 + b31 * a11 + b32 * a21 + b33 * a31,\r\n            b30 * a02 + b31 * a12 + b32 * a22 + b33 * a32,\r\n            b30 * a03 + b31 * a13 + b32 * a23 + b33 * a33,\r\n        ];\r\n    },\r\n\r\n    m4Xv4: function (a, b) {\r\n        const c0r0 = a[0];\r\n        const c0r1 = a[1];\r\n        const c0r2 = a[2];\r\n        const c0r3 = a[3];\r\n        const c1r0 = a[4];\r\n        const c1r1 = a[5];\r\n        const c1r2 = a[6];\r\n        const c1r3 = a[7];\r\n        const c2r0 = a[8];\r\n        const c2r1 = a[9];\r\n        const c2r2 = a[10];\r\n        const c2r3 = a[11];\r\n        const c3r0 = a[12];\r\n        const c3r1 = a[13];\r\n        const c3r2 = a[14];\r\n        const c3r3 = a[15];\r\n\r\n        const b0 = b[0];\r\n        const b1 = b[1];\r\n        const b2 = b[2];\r\n        const b3 = b[3];\r\n\r\n        return [\r\n            b0 * c0r0 + b1 * c1r0 + b2 * c2r0 + b3 * c3r0,\r\n            b0 * c0r1 + b1 * c1r1 + b2 * c2r1 + b3 * c3r1,\r\n            b0 * c0r2 + b1 * c1r2 + b2 * c2r2 + b3 * c3r2,\r\n            b0 * c0r3 + b1 * c1r3 + b2 * c2r3 + b3 * c3r3,\r\n        ];\r\n    },\r\n}\r\n/*\r\n// Unit tests framework\r\n\r\nwindow.tests = window.tests || {};\r\n\r\nwindow.tests.expectArray = function (name, expected, actual) {\r\n    if (actual.length !== expected.length) console.log('Test ' + name + ' wrong length array');\r\n    for (let i = 0; i < expected.length; i++) {\r\n        if (Math.abs(expected[i] - actual[i]) > 0.001)\r\n            console.log('Test ' + name + ' index ' + i + ' was ' + actual[i] + ' expecting ' + expected[i]);\r\n    }\r\n}\r\n\r\n// Unit tests for matrix\r\n\r\nwindow.tests.matrix = {\r\n    t1: window.frag.Matrix.m4Transpose([\r\n         1,  2,  3,  4,\r\n         5,  6,  7,  8,\r\n         9, 10, 11, 12,\r\n        13, 14, 15, 16,\r\n    ]),\r\n\r\n    run: function (test) {\r\n        window.tests.expectArray(\"Transpose matrix\", test.t1, [\r\n            1, 5,  9, 13,\r\n            2, 6, 10, 14,\r\n            3, 7, 11, 15,\r\n            4, 8, 12, 16,\r\n        ]);\r\n    }\r\n}\r\n\r\nwindow.tests.matrix.run(window.tests.matrix);\r\n*/","window.frag = window.frag || {};\r\nwindow.frag.Triangle = {\r\n    makeTriangleFromVectors: function (a, b, c) {\r\n        return { a, b, c };\r\n    },\r\n\r\n    makeTriangleFromArray2D: function (array, offsetA, offsetB, offsetC) {\r\n        if (!array) return null;\r\n        return {\r\n            a: [array[offsetA], array[offsetA + 1]],\r\n            b: [array[offsetB], array[offsetB + 1]],\r\n            c: [array[offsetC], array[offsetC + 1]],\r\n        };\r\n    },\r\n\r\n    makeTriangleFromArray3D: function (array, offsetA, offsetB, offsetC) {\r\n        if (!array) return null;\r\n        return {\r\n            a: [array[offsetA], array[offsetA + 1], array[offsetA + 2]],\r\n            b: [array[offsetB], array[offsetB + 1], array[offsetB + 2]],\r\n            c: [array[offsetC], array[offsetC + 1], array[offsetC + 2]],\r\n        };\r\n    },\r\n\r\n    normal: function (triangle) {\r\n        const Vector = window.frag.Vector;\r\n        const v1 = Vector.sub(triangle.a, triangle.b);\r\n        const v2 = Vector.sub(triangle.c, triangle.b);\r\n        return Vector.normalize(Vector.cross(v1, v2));\r\n    },\r\n}\r\n","window.frag = window.frag || {};\r\nwindow.frag.Vector = {\r\n    extract2D: function (array, offset) {\r\n        if (!array) return null;\r\n        return [array[offset], array[offset + 1]];\r\n    },\r\n    extract3D: function (array, offset) {\r\n        if (!array) return null;\r\n        return [array[offset], array[offset + 1], array[offset + 2]];\r\n    },\r\n    zero: function (dimensions) {\r\n        const vector = [0, 0, 0, 0, 0];\r\n        vector.length = dimensions;\r\n        return vector;\r\n    },\r\n    add: function (a, b) {\r\n        const result = [];\r\n        if (Array.isArray(b))\r\n            for (let i = 0; i < a.length; i++) result.push(a[i] + b[i]);\r\n        else\r\n            for (let i = 0; i < a.length; i++) result.push(a[i] + b);\r\n        return result;\r\n    },\r\n    sub: function (a, b) {\r\n        const result = [];\r\n        if (Array.isArray(b))\r\n            for (let i = 0; i < a.length; i++) result.push(a[i] - b[i]);\r\n        else\r\n            for (let i = 0; i < a.length; i++) result.push(a[i] - b);\r\n        return result;\r\n    },\r\n    mult: function (a, b) {\r\n        const result = [];\r\n        if (Array.isArray(b))\r\n            for (let i = 0; i < a.length; i++) result.push(a[i] * b[i]);\r\n        else\r\n            for (let i = 0; i < a.length; i++) result.push(a[i] * b);\r\n        return result;\r\n    },\r\n    div: function (a, b) {\r\n        const result = [];\r\n        if (Array.isArray(b))\r\n            for (let i = 0; i < a.length; i++) result.push(a[i] / b[i]);\r\n        else\r\n            for (let i = 0; i < a.length; i++) result.push(a[i] / b);\r\n        return result;\r\n    },\r\n    length: function (a) {\r\n        let sum = 0;\r\n        for (let i = 0; i < a.length; i++) sum += a[i] * a[i];\r\n        return Math.sqrt(sum);\r\n    },\r\n    average: function (a, b) {\r\n        const result = [];\r\n        for (let i = 0; i < a.length; i++) result.push((a[i] + b[i]) * 0.5);\r\n        return result;\r\n    },\r\n    cross: function (a, b) {\r\n        return [\r\n            a[1] * b[2] - a[2] * b[1],\r\n            a[2] * b[0] - a[0] * b[2],\r\n            a[0] * b[1] - a[1] * b[0],\r\n        ];\r\n    },\r\n    dot: function (a, b) {\r\n        let result = 0;\r\n        for (let i = 0; i < a.length; i++)\r\n            result += a[i] * b[i];\r\n        return result;\r\n    },\r\n    normalize: function (a) {\r\n        const length = window.frag.Vector.length(a);\r\n        if (length < 1e-5) return a;\r\n\r\n        const result = [];\r\n        for (let i = 0; i < a.length; i++) result.push(a[i] / length);\r\n        return result;\r\n    },\r\n    append: function(a, v) {\r\n        for (let i = 0; i < v.length; i++) a.push(v[i]);\r\n    },\r\n    eulerAngles: function(directionVector, upVector) {\r\n        const Vector = window.frag.Vector;\r\n        if (!upVector) upVector = [0, 1, 0];\r\n\r\n        const dir = Vector.normalize(directionVector);\r\n        const up = Vector.normalize(upVector);\r\n\r\n        const pitch = Math.asin(dir[1]);\r\n        const yaw = Math.atan2(dir[0], dir[2]);\r\n\r\n        const wingDir = [-dir[2], 0, dir[0]];\r\n        const vertical = Vector.cross(wingDir, dir);\r\n        const roll = Math.atan2(Vector.dot(wingDir, up), Vector.dot(vertical, up));\r\n\r\n        return [roll, yaw, pitch];\r\n    }\r\n}\r\n","// Represents a collection of mesh fragments where each\r\n// fragment is a collection of triangles\r\nwindow.frag.MeshData = function () {\r\n    const frag = window.frag;\r\n    const gl = frag.gl;\r\n\r\n    const private = {\r\n        glBuffer: gl.createBuffer(),\r\n        meshFragments: [],\r\n        debugFragments: [],\r\n        finalized: false,\r\n        fromBuffer: false,\r\n        smoothShading: true,\r\n        smoothTexture: false,\r\n        wireframe: false,\r\n        normalLength: 0,\r\n        normalColor: [0, 0, 255],\r\n    }\r\n\r\n    const public = {\r\n        __private: private,\r\n        calcNormals: true,\r\n        calcTangents: true,\r\n        calcBitangents: false,\r\n    };\r\n\r\n    public.dispose = function () {\r\n        if (private.glBuffer) {\r\n            gl.deleteBuffer(private.glBuffer);\r\n            private.glBuffer = null;\r\n        }\r\n    }\r\n\r\n    public.name = function (value) {\r\n        private.name = value;\r\n        return public;\r\n    }\r\n\r\n    public.clear = function () {\r\n        private.meshFragments.length = 0;\r\n        private.finalized = false;\r\n        return public;\r\n    }\r\n\r\n    public.shadeSmooth = function () {\r\n        private.smoothShading = true;\r\n        private.finalized = false;\r\n        return public;\r\n    }\r\n\r\n    public.shadeFlat = function () {\r\n        private.smoothShading = false;\r\n        private.finalized = false;\r\n        return public;\r\n    }\r\n\r\n    public.textureSmooth = function () {\r\n        private.smoothTexture = true;\r\n        private.finalized = false;\r\n        return public;\r\n    }\r\n\r\n    public.textureFlat = function () {\r\n        private.smoothTexture = false;\r\n        private.finalized = false;\r\n        return public;\r\n    }\r\n\r\n    public.wireframe = function (drawWireframe) {\r\n        private.wireframe = !!drawWireframe;\r\n        private.finalized = false;\r\n        return public;\r\n    }\r\n\r\n    public.drawNormals = function (length, color) {\r\n        private.normalLength = length;\r\n        if (color !== undefined) private.normalColor = color;\r\n        private.finalized = false;\r\n        return public;\r\n    }\r\n\r\n    private.Fragment = function(vertexData) {\r\n        return {\r\n            vertexData,\r\n            renderData: null,\r\n            vertexDataOffset: undefined,\r\n            colorDataOffset: undefined,\r\n            uvDataOffset: undefined,\r\n            normalDataOffset: undefined,\r\n            tangentDataOffset: undefined,\r\n            bitangentDataOffset: undefined,\r\n        };\r\n    }\r\n\r\n    private.addFragment = function (vertexData) {\r\n        private.meshFragments.push(private.Fragment(vertexData));\r\n        private.finalized = false;\r\n        return public;\r\n    }\r\n\r\n    public.addVertexData = function (vertexData) {\r\n        return private.addFragment(vertexData);\r\n    }\r\n\r\n    public.addTriangles2D = function (verticies, colors, uvs, normals, tangents, bitangents) {\r\n        const vertexData = frag.VertexData().setTriangles2D(verticies, colors, uvs, normals, tangents, bitangents);\r\n        return private.addFragment(vertexData);\r\n    }\r\n\r\n    public.addTriangles = function (verticies, colors, uvs, normals, tangents, bitangents) {\r\n        const vertexData = frag.VertexData().setTriangles(verticies, colors, uvs, normals, tangents, bitangents);\r\n        return private.addFragment(vertexData);\r\n    }\r\n\r\n    public.addTriangleStrip = function (verticies, colors, uvs, normals, tangents, bitangents) {\r\n        const vertexData = frag.VertexData().setTriangleStrip(verticies, colors, uvs, normals, tangents, bitangents);\r\n        return private.addFragment(vertexData);\r\n    }\r\n\r\n    public.addTriangleFan = function (verticies, colors, uvs, normals, tangents, bitangents) {\r\n        const vertexData = frag.VertexData().setTriangleFan(verticies, colors, uvs, normals, tangents, bitangents);\r\n        return private.addFragment(vertexData);\r\n    }\r\n\r\n    public.fromBuffer = function (buffer, size, count, primitiveType, vertexDataOffset, colorDataOffset, uvDataOffset, normalDataOffset, tangentDataOffset, bitangentDataOffset)\r\n    {\r\n        const vertexData = frag.VertexData();\r\n        vertexData.vertexDimensions = size;\r\n        vertexData.vertexCount = count;\r\n        vertexData.primitiveType = primitiveType;\r\n        vertexData.extractTriangles = function () { };\r\n\r\n        private.addFragment(vertexData);\r\n        const fragment = private.meshFragments[private.meshFragments.length - 1];\r\n\r\n        fragment.renderData = vertexData;\r\n        fragment.vertexDataOffset = vertexDataOffset;\r\n        fragment.colorDataOffset = colorDataOffset;\r\n        fragment.uvDataOffset = uvDataOffset;\r\n        fragment.normalDataOffset = normalDataOffset;\r\n        fragment.tangentDataOffset = tangentDataOffset;\r\n        fragment.bitangentDataOffset = bitangentDataOffset;\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, private.glBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, buffer, gl.STATIC_DRAW);\r\n\r\n        private.finalized = true;\r\n        private.fromBuffer = true;\r\n\r\n        return public;\r\n    }\r\n\r\n    private.addFragmentDebugInfo = function(fragment) {\r\n        if (!private.wireframe && private.normalLength == 0) return;\r\n\r\n        let newFragment = fragment;\r\n        if (!private.wireframe) {\r\n            newFragment = private.Fragment(fragment.vertexData)\r\n            private.debugFragments.push(newFragment);\r\n        }\r\n\r\n        const verticies = [];\r\n        const colors = [];\r\n        const uvs = [];\r\n        const normals = [];\r\n\r\n        const addVertex = function (i) {\r\n            const vertex = fragment.renderData.getVertexVector(i);\r\n            const color = fragment.renderData.getColor(i);\r\n            const uv = fragment.renderData.getUvVector(i);\r\n            const normal = fragment.renderData.getNormalVector(i);\r\n            if (vertex) vertex.forEach(v => verticies.push(v));\r\n            if (color) color.forEach((c) => colors.push(c));\r\n            else private.normalColor.forEach(() => colors.push(0));\r\n            if (uv) uv.forEach(t => uvs.push(t));\r\n            if (normal) normal.forEach(n => normals.push(n));\r\n        };\r\n\r\n        const addNormal = function (i) {\r\n            const vertex = fragment.renderData.getVertexVector(i);\r\n            const uv = fragment.renderData.getUvVector(i);\r\n            const normal = fragment.renderData.getNormalVector(i);\r\n\r\n            if (vertex) {\r\n                for (let j = 0; j < vertex.length; j++) {\r\n                    verticies.push(vertex[j])\r\n                }\r\n                for (let j = 0; j < vertex.length; j++) {\r\n                    verticies.push(vertex[j] + normal[j] * private.normalLength)\r\n                }\r\n            }\r\n\r\n            private.normalColor.forEach((c) => colors.push(c));\r\n            private.normalColor.forEach((c) => colors.push(c));\r\n\r\n            if (uv) {\r\n                uv.forEach(t => uvs.push(t));\r\n                uv.forEach(t => uvs.push(t));\r\n            }\r\n\r\n            if (normal) {\r\n                normal.forEach(n => normals.push(n));\r\n                normal.forEach(n => normals.push(n));\r\n            }\r\n        };\r\n\r\n        fragment.vertexData.extractTriangles(function (a, b, c) {\r\n            if (private.wireframe) {\r\n                addVertex(a); addVertex(b);\r\n                addVertex(b); addVertex(c);\r\n                addVertex(c); addVertex(a);\r\n            }\r\n            if (private.normalLength > 0) {\r\n                addNormal(a);\r\n                addNormal(b);\r\n                addNormal(b);\r\n            }\r\n        });\r\n\r\n        if (fragment.vertexData.vertexDimensions == 2)\r\n            newFragment.renderData = frag.VertexData().setLines2D(verticies, colors, uvs, normals);\r\n        else\r\n            newFragment.renderData = frag.VertexData().setLines(verticies, colors, uvs, normals);\r\n    }\r\n\r\n    private.finalize = function () {\r\n        private.finalized = true;\r\n\r\n        const optimizer = frag.MeshOptimizer()\r\n            .setFragments(private.meshFragments)\r\n            .initialize(private.smoothShading, private.smoothTexture);\r\n\r\n        if (public.calcTangents) optimizer.calcTangentsFromUvs();\r\n        if (public.calcBitangents) optimizer.calcBitangentsFromUvs();\r\n        if (public.calcNormals) optimizer.calcNormalsFromCross();\r\n        if (public.calcNormals) optimizer.calcNormalsFromGeometry();\r\n        if (public.calcBitangents) optimizer.calcBitangentsFromCross();\r\n\r\n        private.debugFragments = [];\r\n        private.meshFragments.forEach((f) => {\r\n            private.addFragmentDebugInfo(f);\r\n        });\r\n\r\n        let length = 0;\r\n        const countFragmentLength = function(fragment){\r\n            length += fragment.renderData.verticies.length;\r\n            if (fragment.renderData.colors) length += fragment.renderData.colors.length;\r\n            if (fragment.renderData.uvs) length += fragment.renderData.uvs.length;\r\n            if (fragment.renderData.normals) length += fragment.renderData.normals.length;\r\n            if (fragment.renderData.tangents) length += fragment.renderData.tangents.length;\r\n            if (fragment.renderData.bitangents) length += fragment.renderData.bitangents.length;\r\n        }\r\n        private.meshFragments.forEach(countFragmentLength);\r\n        private.debugFragments.forEach(countFragmentLength);\r\n        \r\n        const buffer = new Float32Array(length);\r\n\r\n        let offset = 0;\r\n\r\n        const copy = function (arr) {\r\n            if (!arr) return undefined;\r\n\r\n            for (let i = 0; i < arr.length; i++) {\r\n                buffer[offset + i] = arr[i];\r\n            }\r\n            const o = offset;\r\n            offset += arr.length;\r\n            return o * Float32Array.BYTES_PER_ELEMENT;\r\n        };\r\n\r\n        const copyFragmentData = function(fragment) {\r\n            fragment.vertexDataOffset = copy(fragment.renderData.verticies);\r\n            fragment.colorDataOffset = copy(fragment.renderData.colors);\r\n            fragment.uvDataOffset = copy(fragment.renderData.uvs);\r\n            fragment.normalDataOffset = copy(fragment.renderData.normals);\r\n            fragment.tangentDataOffset = copy(fragment.renderData.tangents);\r\n            fragment.bitangentDataOffset = copy(fragment.renderData.bitangents);\r\n        };\r\n        private.meshFragments.forEach(copyFragmentData);\r\n        private.debugFragments.forEach(copyFragmentData);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, private.glBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, buffer, gl.STATIC_DRAW);\r\n\r\n        return public;\r\n    }\r\n\r\n    private.drawFragmentPosition = function(shader, fragment) {\r\n        if (shader.attributes.position >= 0) {\r\n            if (fragment.vertexDataOffset != undefined) {\r\n                gl.enableVertexAttribArray(shader.attributes.position)\r\n                gl.vertexAttribPointer(shader.attributes.position, fragment.renderData.vertexDimensions, gl.FLOAT, false, 0, fragment.vertexDataOffset);\r\n            } else {\r\n                gl.disableVertexAttribArray(shader.attributes.position)\r\n            }\r\n        }\r\n    }\r\n\r\n    private.drawFragmentColor = function(shader, fragment) {\r\n        if (shader.attributes.color >= 0) {\r\n            if (fragment.colorDataOffset != undefined) {\r\n                gl.enableVertexAttribArray(shader.attributes.color)\r\n                gl.vertexAttribPointer(shader.attributes.color, fragment.renderData.colorDimensions, gl.FLOAT, false, 0, fragment.colorDataOffset);\r\n            } else {\r\n                gl.disableVertexAttribArray(shader.attributes.color)\r\n            }\r\n        }\r\n    }\r\n\r\n    private.drawFragmentTexture = function(shader, fragment) {\r\n        if (shader.attributes.texture >= 0) {\r\n            if (fragment.uvDataOffset != undefined) {\r\n                gl.enableVertexAttribArray(shader.attributes.texture);\r\n                gl.vertexAttribPointer(shader.attributes.texture, fragment.renderData.uvDimensions, gl.FLOAT, false, 0, fragment.uvDataOffset);\r\n            } else {\r\n                gl.disableVertexAttribArray(shader.attributes.texture)\r\n            }\r\n        }\r\n    }\r\n\r\n    private.drawFragmentNormals = function(shader, fragment) {\r\n        if (shader.attributes.normal >= 0) {\r\n            if (fragment.normalDataOffset != null) {\r\n                gl.enableVertexAttribArray(shader.attributes.normal);\r\n                gl.vertexAttribPointer(shader.attributes.normal, fragment.renderData.normalDimensions, gl.FLOAT, true, 0, fragment.normalDataOffset);\r\n            } else {\r\n                gl.disableVertexAttribArray(shader.attributes.normal)\r\n            }\r\n        }\r\n    }\r\n\r\n    private.drawFragmentTangents = function(shader, fragment) {\r\n        if (shader.attributes.tangent >= 0) {\r\n            if (fragment.tangentDataOffset != null) {\r\n                gl.enableVertexAttribArray(shader.attributes.tangent);\r\n                gl.vertexAttribPointer(shader.attributes.tangent, fragment.renderData.normalDimensions, gl.FLOAT, true, 0, fragment.tangentDataOffset);\r\n            } else {\r\n                gl.disableVertexAttribArray(shader.attributes.tangent)\r\n            }\r\n        }\r\n    }\r\n\r\n    private.drawFragmentBitangents = function(shader, fragment) {\r\n        if (shader.attributes.bitangent >= 0) {\r\n            if (fragment.bitangentDataOffset != null) {\r\n                gl.enableVertexAttribArray(shader.attributes.bitangent);\r\n                gl.vertexAttribPointer(shader.attributes.bitangent, fragment.renderData.normalDimensions, gl.FLOAT, true, 0, fragment.bitangentDataOffset);\r\n            } else {\r\n                gl.disableVertexAttribArray(shader.attributes.bitangent)\r\n            }\r\n        }\r\n    }\r\n\r\n    private.drawFragment = function(shader, fragment) {\r\n        private.drawFragmentPosition(shader, fragment);\r\n        private.drawFragmentColor(shader, fragment);\r\n        private.drawFragmentTexture(shader, fragment);\r\n        private.drawFragmentNormals(shader, fragment);\r\n        private.drawFragmentTangents(shader, fragment);\r\n        private.drawFragmentBitangents(shader, fragment);\r\n        gl.drawArrays(fragment.renderData.primitiveType, 0, fragment.renderData.vertexCount);\r\n    }\r\n\r\n    public.draw = function (gl, shader) {\r\n        if (!private.finalized && !private.fromBuffer) private.finalize();\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, private.glBuffer);\r\n\r\n        for (let i = 0; i < private.meshFragments.length; i++) {\r\n            const fragment = private.meshFragments[i];\r\n            private.drawFragment(shader, fragment);\r\n        }\r\n\r\n        for (let i = 0; i < private.debugFragments.length; i++) {\r\n            const fragment = private.debugFragments[i];\r\n            private.drawFragment(shader, fragment);\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n};\r\n","// Applies mesh smoothing and calculates normals and binormals where required\r\nwindow.frag.MeshOptimizer = function () {\r\n    const frag = window.frag;\r\n\r\n    const private = {\r\n        meshFragments: null,\r\n        smoothShading: true,\r\n        smoothTexture: false,\r\n        fragmentTriangles: null,\r\n        groups: null,\r\n        groupIndecies: null,\r\n    }\r\n\r\n    const public = {\r\n        __private: private,\r\n    };\r\n\r\n    private.ensureTriangles = function () {\r\n        if (private.fragmentTriangles) return;\r\n\r\n        private.fragmentTriangles = [];\r\n\r\n        private.meshFragments.forEach(fragment => {\r\n            const vertexData = fragment.vertexData;\r\n            const fragmentTriangles = {\r\n                triangles: [],\r\n                vertexTriangleIndecies: []\r\n            };\r\n            fragmentTriangles.vertexTriangleIndecies.length = vertexData.vertexCount;\r\n            if (vertexData.verticies) {\r\n                vertexData.extractTriangles(function (a, b, c) {\r\n                    const vectorA = vertexData.getVertexVector(a);\r\n                    const vectorB = vertexData.getVertexVector(b);\r\n                    const vectorC = vertexData.getVertexVector(c);\r\n\r\n                    const fragmentTriangle = {\r\n                        triangle: frag.Triangle.makeTriangleFromVectors(vectorA, vectorB, vectorC),\r\n                        normal: null,\r\n                        tangent: null,\r\n                        bitangent: null\r\n                    };\r\n                    fragmentTriangle.normal = frag.Triangle.normal(fragmentTriangle.triangle);\r\n\r\n                    if (vertexData.uvs) {\r\n                        const uvA = vertexData.getUvVector(a);\r\n                        const uvB = vertexData.getUvVector(b);\r\n                        const uvC = vertexData.getUvVector(c);\r\n\r\n                        const deltaPos1 = frag.Vector.sub(vectorB, vectorA);\r\n                        const deltaPos2 = frag.Vector.sub(vectorC, vectorA);\r\n                        const deltaUv1 = frag.Vector.sub(uvB, uvA);\r\n                        const deltaUv2 = frag.Vector.sub(uvC, uvA);\r\n\r\n                        const r = deltaUv1[0] * deltaUv2[1] - deltaUv1[1] * deltaUv2[0];\r\n                        if (r === 0) {\r\n                            fragmentTriangle.tangent = frag.Vector.zero(vertexData.normalDimensions);\r\n                            fragmentTriangle.bitangent = frag.Vector.zero(vertexData.normalDimensions);\r\n                        } else {\r\n                            const ri = 1 / r;\r\n                            fragmentTriangle.tangent = frag.Vector.normalize(frag.Vector.mult(frag.Vector.sub(frag.Vector.mult(deltaPos1, deltaUv2[1]), frag.Vector.mult(deltaPos2, deltaUv1[1])), ri));\r\n                            fragmentTriangle.bitangent = frag.Vector.normalize(frag.Vector.mult(frag.Vector.sub(frag.Vector.mult(deltaPos2, deltaUv1[0]), frag.Vector.mult(deltaPos1, deltaUv2[0])), ri));\r\n                        }\r\n                    }\r\n\r\n                    fragmentTriangles.triangles.push(fragmentTriangle);\r\n                    const index = fragmentTriangles.triangles.length - 1;\r\n\r\n                    fragmentTriangles.vertexTriangleIndecies[a] = index;\r\n                    fragmentTriangles.vertexTriangleIndecies[b] = index;\r\n                    fragmentTriangles.vertexTriangleIndecies[c] = index;\r\n                });\r\n            }\r\n\r\n            private.fragmentTriangles.push(fragmentTriangles);\r\n        });\r\n    }\r\n\r\n    private.ensureGroups = function () {\r\n        if (private.groups) return;\r\n\r\n        private.groups = [];\r\n        private.groupIndecies = {};\r\n\r\n        const equal = function (vertexData, index, vertex) {\r\n            if (vertexData.vertexDimensions !== vertex.length) return false;\r\n            const offset = vertexData.vertexIndex(index);\r\n            for (var i = 0; i < vertex.length; i++)\r\n                if (Math.abs(vertexData.verticies[offset + i] - vertex[i]) > 0.00001) return false;\r\n            return true;\r\n        };\r\n\r\n        for (let fragmentIndex = 0; fragmentIndex < private.meshFragments.length; fragmentIndex++) {\r\n            const fragment = private.meshFragments[fragmentIndex];\r\n            const groupIndecies = private.groupIndecies[fragmentIndex] || [];\r\n            private.groupIndecies[fragmentIndex] = groupIndecies;\r\n\r\n            if (fragment.vertexData.verticies) {\r\n                for (let vertexIndex = 0; vertexIndex < fragment.vertexData.vertexCount; vertexIndex++) {\r\n                    let found = false;\r\n                    for (var groupIndex = 0; !found && groupIndex < private.groups.length; groupIndex++) {\r\n                        const group = private.groups[groupIndex];\r\n                        if (equal(fragment.vertexData, vertexIndex, group.vertex)) {\r\n                            group.fragmentIndecies[fragmentIndex] = group.fragmentIndecies[fragmentIndex] || [];\r\n                            group.fragmentIndecies[fragmentIndex].push(vertexIndex);\r\n                            groupIndecies.push(groupIndex);\r\n                            found = true;\r\n                        }\r\n                    }\r\n                    if (!found) {\r\n                        groupIndecies.push(private.groups.length);\r\n                        const group = {\r\n                            vertex: fragment.vertexData.getVertexVector(vertexIndex),\r\n                            fragmentIndecies: {},\r\n                            normal: frag.Vector.zero(fragment.vertexData.normalDimensions),\r\n                            uv: frag.Vector.zero(fragment.vertexData.uvDimensions),\r\n                        };\r\n                        group.fragmentIndecies[fragmentIndex] = [vertexIndex];\r\n                        private.groups.push(group);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    private.calcGroupNormals = function () {\r\n        private.ensureGroups();\r\n        for (let groupIndex = 0; groupIndex < private.groups.length; groupIndex++) {\r\n            const group = private.groups[groupIndex];\r\n            group.normal = frag.Vector.zero(private.meshFragments[0].renderData.normalDimensions);\r\n            for (const fragmentIndex in group.fragmentIndecies) {\r\n                const fragment = private.meshFragments[fragmentIndex];\r\n                const vertexData = fragment.renderData ? fragment.renderData : fragment.vertexData;\r\n                if (vertexData && vertexData.normals) {\r\n                    const fragmentIndecies = group.fragmentIndecies[fragmentIndex];\r\n                    for (let i = 0; i < fragmentIndecies.length; i++) {\r\n                        const vertexIndex = fragmentIndecies[i];\r\n                        const vertexNormal = vertexData.getNormalVector(vertexIndex);\r\n                        group.normal = frag.Vector.add(group.normal, vertexNormal);\r\n                    }\r\n                }\r\n            };\r\n            group.normal = frag.Vector.normalize(group.normal);\r\n        }\r\n    };\r\n\r\n    private.calcGroupUvs = function () {\r\n        private.ensureGroups();\r\n        for (let groupIndex = 0; groupIndex < private.groups.length; groupIndex++) {\r\n            const group = private.groups[groupIndex];\r\n            for (const fragmentIndex in group.fragmentIndecies) {\r\n                const fragment = private.meshFragments[fragmentIndex];\r\n                const vertexData = fragment.renderData ? fragment.renderData : fragment.vertexData;\r\n                if (vertexData) {\r\n                    const fragmentIndicies = group.fragmentIndecies[fragmentIndex];\r\n                    if (fragmentIndicies.length > 0) {\r\n                        const vertexIndex = fragmentIndicies[0];\r\n                        group.uv = vertexData.getUvVector(vertexIndex);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    private.calcSmoothShading = function () {\r\n        for (let fragmentIndex = 0; fragmentIndex < private.meshFragments.length; fragmentIndex++) {\r\n            const fragment = private.meshFragments[fragmentIndex];\r\n            if (!fragment.renderData.normals) return;\r\n        }\r\n\r\n        private.calcGroupNormals();\r\n\r\n        for (let fragmentIndex = 0; fragmentIndex < private.meshFragments.length; fragmentIndex++) {\r\n            const fragment = private.meshFragments[fragmentIndex];\r\n            const renderData = fragment.renderData;\r\n            const groupIndecies = private.groupIndecies[fragmentIndex];\r\n            if (groupIndecies.length) {\r\n                renderData.normals = [];\r\n                for (var vertexIndex = 0; vertexIndex < renderData.vertexCount; vertexIndex++) {\r\n                    const group = private.groups[groupIndecies[vertexIndex]];\r\n                    for (var i = 0; i < renderData.normalDimensions; i++)\r\n                        renderData.normals.push(group.normal[i]);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private.calcSmoothTexture = function () {\r\n        private.calcGroupUvs();\r\n        for (let fragmentIndex = 0; fragmentIndex < private.meshFragments.length; fragmentIndex++) {\r\n            const vertexData = private.meshFragments[fragmentIndex].renderData;\r\n            const groupIndecies = private.groupIndecies[fragmentIndex];\r\n            if (groupIndecies.length) {\r\n                vertexData.uvs = [];\r\n                for (var vertexIndex = 0; vertexIndex < vertexData.vertexCount; vertexIndex++) {\r\n                    const group = private.groups[groupIndecies[vertexIndex]];\r\n                    for (var i = 0; i < vertexData.uvDimensions; i++)\r\n                        vertexData.uvs.push(group.uv[i]);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public.setFragments = function (meshFragments) {\r\n        private.meshFragments = meshFragments;\r\n        return public;\r\n    };\r\n\r\n    public.initialize = function (smoothShading, smoothTexture) {\r\n        private.smoothShading = smoothShading;\r\n        private.smoothTexture = smoothTexture;\r\n\r\n        private.meshFragments.forEach((fragment) => {\r\n            fragment.renderData = fragment.vertexData.clone();\r\n        });\r\n\r\n        if (smoothTexture) {\r\n            private.calcSmoothTexture();\r\n        }\r\n        return public;\r\n    };\r\n\r\n    public.calcTangentsFromUvs = function () {\r\n        for (let fragmentIndex = 0; fragmentIndex < private.meshFragments.length; fragmentIndex++) {\r\n            const fragment = private.meshFragments[fragmentIndex];\r\n            const renderData = fragment.renderData;\r\n            const vertexData = fragment.vertexData;\r\n            if (!renderData.tangents) {\r\n                if (vertexData.tangents) {\r\n                    renderData.tangents = [];\r\n                    for (let vertexIndex = 0; vertexIndex < vertexData.vertexCount; vertexIndex++) {\r\n                        for (var i = 0; i < vertexData.normalDimensions; i++) {\r\n                            renderData.tangents.push(vertexData.tangents[vertexData.tangentIndex(vertexIndex, i)]);\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (renderData.uvs) {\r\n                        private.ensureTriangles();\r\n                        const fragmentTriangles = private.fragmentTriangles[fragmentIndex];\r\n                        if (fragmentTriangles && fragmentTriangles.triangles) {\r\n                            renderData.tangents = [];\r\n                            renderData.tangents.length = renderData.normalDimensions * renderData.vertexCount;\r\n                            for (let vertexIndex = 0; vertexIndex < renderData.vertexCount; vertexIndex++) {\r\n                                const triangleIndex = fragmentTriangles.vertexTriangleIndecies[vertexIndex];\r\n                                const triangle = fragmentTriangles.triangles[triangleIndex];\r\n                                if (triangle) {\r\n                                    renderData.setTangentVector(vertexIndex, triangle.tangent);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return public;\r\n    };\r\n\r\n    public.calcBitangentsFromUvs = function () {\r\n        for (let fragmentIndex = 0; fragmentIndex < private.meshFragments.length; fragmentIndex++) {\r\n            const fragment = private.meshFragments[fragmentIndex];\r\n            const renderData = fragment.renderData;\r\n            const vertexData = fragment.vertexData;\r\n            if (!renderData.bitangents) {\r\n                if (vertexData.bitangents) {\r\n                    renderData.bitangents = [];\r\n                    for (let vertexIndex = 0; vertexIndex < vertexData.vertexCount; vertexIndex++) {\r\n                        for (var i = 0; i < vertexData.normalDimensions; i++) {\r\n                            renderData.bitangents.push(vertexData.bitangents[vertexData.bitangentIndex(vertexIndex, i)]);\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (renderData.uvs) {\r\n                        private.ensureTriangles();\r\n                        const fragmentTriangles = private.fragmentTriangles[fragmentIndex];\r\n                        if (fragmentTriangles && fragmentTriangles.triangles) {\r\n                            renderData.bitangents = [];\r\n                            renderData.bitangents.length = renderData.normalDimensions * renderData.vertexCount;\r\n                            for (let vertexIndex = 0; vertexIndex < renderData.vertexCount; vertexIndex++) {\r\n                                const triangleIndex = fragmentTriangles.vertexTriangleIndecies[vertexIndex];\r\n                                const triangle = fragmentTriangles.triangles[triangleIndex];\r\n                                if (triangle) {\r\n                                    renderData.setBitangentVector(vertexIndex, triangle.bitangent);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return public;\r\n    };\r\n\r\n    public.calcNormalsFromCross = function () {\r\n        for (let fragmentIndex = 0; fragmentIndex < private.meshFragments.length; fragmentIndex++) {\r\n            const fragment = private.meshFragments[fragmentIndex];\r\n            const renderData = fragment.renderData;\r\n            const vertexData = fragment.vertexData;\r\n            if (!renderData.normals) {\r\n                if (vertexData.normals) {\r\n                    renderData.normals = [];\r\n                    for (let vertexIndex = 0; vertexIndex < vertexData.vertexCount; vertexIndex++) {\r\n                        for (var i = 0; i < vertexData.normalDimensions; i++) {\r\n                            renderData.normals.push(vertexData.normals[vertexData.normalIndex(vertexIndex, i)]);\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (renderData.tangents && renderData.bitangents) {\r\n                        renderData.normals = [];\r\n                        for (let vertexIndex = 0; vertexIndex < vertexData.vertexCount; vertexIndex++) {\r\n                            const tangent = renderData.getTangentVector(vertexIndex);\r\n                            const bitangent = renderData.getBitangentVector(vertexIndex);\r\n                            const normal = frag.Vector.cross(tangent, bitangent);\r\n                            for (var i = 0; i < normal.length; i++) {\r\n                                renderData.normals.push(normal[i]);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (private.smoothShading) {\r\n            private.calcSmoothShading();\r\n        }\r\n        return public;\r\n    };\r\n\r\n    public.calcNormalsFromGeometry = function () {\r\n        for (let fragmentIndex = 0; fragmentIndex < private.meshFragments.length; fragmentIndex++) {\r\n            const fragment = private.meshFragments[fragmentIndex];\r\n            const renderData = fragment.renderData;\r\n            const vertexData = fragment.vertexData;\r\n            if (!renderData.normals) {\r\n                if (vertexData.normals) {\r\n                    renderData.normals = [];\r\n                    for (let vertexIndex = 0; vertexIndex < vertexData.vertexCount; vertexIndex++) {\r\n                        for (var i = 0; i < vertexData.normalDimensions; i++) {\r\n                            renderData.normals.push(vertexData.normals[vertexData.normalIndex(vertexIndex, i)]);\r\n                        }\r\n                    }\r\n                } else {\r\n                    private.ensureTriangles();\r\n                    const fragmentTriangles = private.fragmentTriangles[fragmentIndex];\r\n                    if (fragmentTriangles && fragmentTriangles.triangles) {\r\n                        renderData.normals = [];\r\n                        renderData.normals.length = renderData.normalDimensions * renderData.vertexCount;\r\n                        for (let vertexIndex = 0; vertexIndex < renderData.vertexCount; vertexIndex++) {\r\n                            const triangleIndex = fragmentTriangles.vertexTriangleIndecies[vertexIndex];\r\n                            const triangle = fragmentTriangles.triangles[triangleIndex];\r\n                            if (triangle) renderData.setNormalVector(vertexIndex, triangle.normal);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (private.smoothShading) {\r\n            private.calcSmoothShading();\r\n        }\r\n        return public;\r\n    };\r\n\r\n    public.calcBitangentsFromCross = function () {\r\n        for (let fragmentIndex = 0; fragmentIndex < private.meshFragments.length; fragmentIndex++) {\r\n            const fragment = private.meshFragments[fragmentIndex];\r\n            const renderData = fragment.renderData;\r\n            const vertexData = fragment.vertexData;\r\n            if (!renderData.bitangents) {\r\n                if (vertexData.bitangents) {\r\n                    renderData.bitangents = [];\r\n                    for (let vertexIndex = 0; vertexIndex < vertexData.vertexCount; vertexIndex++) {\r\n                        for (var i = 0; i < vertexData.normalDimensions; i++) {\r\n                            renderData.bitangents.push(vertexData.bitangents[vertexData.bitangentIndex(vertexIndex, i)]);\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (renderData.tangents && renderData.normals) {\r\n                        renderData.bitangents = [];\r\n                        for (let vertexIndex = 0; vertexIndex < vertexData.vertexCount; vertexIndex++) {\r\n                            const normal = renderData.getNormalVector(vertexIndex);\r\n                            const tangent = renderData.getTangentVector(vertexIndex);\r\n                            const bitangent = frag.Vector.cross(normal, tangent);\r\n                            for (var i = 0; i < bitangent.length; i++) {\r\n                                renderData.bitangents.push(bitangent[i]);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return public;\r\n    };\r\n\r\n    return public;\r\n};\r\n","window.frag.Model = function (is3d, parent) {\r\n    const frag = window.frag;\r\n\r\n    if (is3d === undefined) {\r\n        if (parent && parent.location)\r\n            is3d = parent.location.is3d;\r\n        else\r\n            is3d = true;\r\n    }\r\n\r\n    const private = {\r\n        name: null,\r\n        parent,\r\n        children: [],\r\n        meshData: null,\r\n        shader: null,\r\n        material: null,\r\n        enabled: true\r\n    }\r\n\r\n    const public = {\r\n        __private: private,\r\n        location: frag.Location(is3d),\r\n        animations: []\r\n    };\r\n\r\n    public.dispose = function(){\r\n    }\r\n\r\n    public.addFlattenedChildren = function (flattenedChildren, predicate) {\r\n        for (let i = 0; i < private.children.length; i++) {\r\n            let child = private.children[i];\r\n            if (predicate(child)) flattenedChildren.push(child);\r\n            child.addFlattenedChildren(flattenedChildren, predicate);\r\n        }\r\n    }\r\n\r\n    public.getPosition = function() {\r\n        return frag.ScenePosition(public.location);\r\n    }\r\n\r\n    public.name = function (value) {\r\n        private.name = value;\r\n        return public;\r\n    }\r\n\r\n    public.getName = function () {\r\n        return private.name;\r\n    }\r\n\r\n    public.shader = function (value) {\r\n        if (value.is3d !== public.location.is3d){\r\n            const m = public.location.is3d ? \"3D\" : \"2D\";\r\n            console.error(\"Model '\" + private.name + \"' has a \" + m + \" location and must use a \" + m + \" shader\");\r\n        }\r\n        private.shader = value;\r\n        return public;\r\n    }\r\n\r\n    public.getShader = function () {\r\n        if (private.shader) return private.shader;\r\n        if (private.parent) return private.parent.getShader();\r\n        return undefined;\r\n    }\r\n\r\n    public.mesh = function (value) {\r\n        private.meshData = value;\r\n        return public;\r\n    }\r\n\r\n    public.getMesh = function() {\r\n        return private.meshData;\r\n    }\r\n\r\n    public.material = function (value) {\r\n        private.material = value;\r\n        return public;\r\n    }\r\n\r\n    public.enable = function() {\r\n        private.enabled = true;\r\n    }\r\n\r\n    public.disable = function() {\r\n        private.enabled = false;\r\n    }\r\n\r\n    public.getMaterial = function () {\r\n        if (private.material) return private.material;\r\n        if (private.parent) return private.parent.getMaterial();\r\n        return undefined;\r\n    }\r\n\r\n    public.addChild = function (child) {\r\n        if (child) {\r\n            child.__private.parent = public;\r\n        } else {\r\n            child = window.frag.Model(undefined, public);\r\n        }\r\n        private.children.push(child);\r\n        return child;\r\n    }\r\n\r\n    public.shadeSmooth = function (depth) {\r\n        if (depth === undefined) depth = -1;\r\n        if (private.meshData) private.meshData.shadeSmooth();\r\n        \r\n        if (depth === 0) return public;\r\n        private.children.forEach((c) => { c.shadeSmooth(depth-1); });\r\n        return public;\r\n    }\r\n\r\n    public.shadeFlat = function (depth) {\r\n        if (depth === undefined) depth = -1;\r\n        if (private.meshData) private.meshData.shadeFlat();\r\n        \r\n        if (depth === 0) return public;\r\n        private.children.forEach((c) => { c.shadeFlat(depth-1); });\r\n        return public;\r\n    }\r\n\r\n    public.textureSmooth = function (depth) {\r\n        if (depth === undefined) depth = -1;\r\n        if (private.meshData) private.meshData.textureSmooth();\r\n        \r\n        if (depth === 0) return public;\r\n        private.children.forEach((c) => { c.textureSmooth(depth-1); });\r\n        return public;\r\n    }\r\n\r\n    public.textureFlat = function (depth) {\r\n        if (depth === undefined) depth = -1;\r\n        if (private.meshData) private.meshData.textureFlat();\r\n        \r\n        if (depth === 0) return public;\r\n        private.children.forEach((c) => { c.textureFlat(depth-1); });\r\n        return public;\r\n    }\r\n\r\n    public.wireframe = function (drawWireframe, depth) {\r\n        if (depth === undefined) depth = -1;\r\n        if (private.meshData) private.meshData.wireframe(drawWireframe);\r\n        \r\n        if (depth === 0) return public;\r\n        private.children.forEach((c) => { c.wireframe(drawWireframe, depth-1); });\r\n        return public;\r\n    }\r\n\r\n    public.drawNormals = function(length, color, depth) {\r\n        if (depth === undefined) depth = -1;\r\n        if (private.meshData) private.meshData.drawNormals(length, color);\r\n\r\n        if (depth === 0) return public;\r\n        private.children.forEach((c) => { c.drawNormals(length, color, depth-1); });\r\n        return public;\r\n    }\r\n\r\n    public.addAnimation = function (modelAnimation) {\r\n        const children = [];\r\n        public.addFlattenedChildren(children, function (child) { return child.getName(); });\r\n\r\n        const childAnimations = [];\r\n        const graphs = modelAnimation.getChannelGraphs();\r\n        for (let i = 0; i < children.length; i++) {\r\n            const child = children[i];\r\n            const childName = child.getName();\r\n            for (let j = 0; j < graphs.length; j++) {\r\n                const graph = graphs[j];\r\n                if (graph.pattern.test(childName)) {\r\n                    childAnimations.push({\r\n                        graph: graph,\r\n                        model: child\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        if (childAnimations.length > 0)\r\n            public.animations.push({ modelAnimation, childAnimations });\r\n\r\n        return public;\r\n    }\r\n\r\n    public.draw = function (drawContext, modelToWorldMatrix, modelToClipMatrix, animationMap) {\r\n        if (!public.location) return public;\r\n\r\n        const animationState = animationMap && private.name ? animationMap[private.name] : null;\r\n        const location = animationState\r\n            ? public.location.clone().add(animationState.location)\r\n            : public.location;\r\n        const localMatrix = location.getMatrix();\r\n\r\n        if (location.is3d) {\r\n            modelToWorldMatrix = frag.Matrix.m4Xm4(modelToWorldMatrix, localMatrix);\r\n            modelToClipMatrix = frag.Matrix.m4Xm4(modelToClipMatrix, localMatrix);\r\n        } else {\r\n            modelToWorldMatrix = frag.Matrix.m3Xm3(modelToWorldMatrix, localMatrix);\r\n            modelToClipMatrix = frag.Matrix.m3Xm3(modelToClipMatrix, localMatrix);\r\n        }\r\n\r\n        const shader = drawContext.shader || public.getShader();\r\n\r\n        if (shader !== undefined && private.meshData && private.enabled) {\r\n            shader.bind(drawContext.gl);\r\n\r\n            if (drawContext.isHitTest && shader.uniforms.color !== undefined) {\r\n                const sceneObjectId = drawContext.sceneObjects.length - 1;\r\n                const modelId = drawContext.models.length;\r\n                drawContext.models.push(public);\r\n\r\n                const red = sceneObjectId >> 4;\r\n                const green = ((sceneObjectId & 0x0f) << 4) | ((modelId & 0xf0000) >> 16);\r\n                const blue = (modelId & 0xff00) >> 8;\r\n                const alpha = modelId & 0xff;\r\n                drawContext.gl.uniform4f(shader.uniforms.color, red / 255, green / 255, blue / 255, alpha / 255);\r\n            }\r\n\r\n            var material = public.getMaterial();\r\n            if (material) material.apply(drawContext.gl, shader);\r\n\r\n            if (shader.uniforms.clipMatrix !== undefined) {\r\n                const modelToClipTransform = location.is3d ? frag.Transform(modelToClipMatrix) : frag.Transform2D(modelToClipMatrix);\r\n                modelToClipTransform.apply(drawContext.gl, shader.uniforms.clipMatrix);\r\n            }\r\n\r\n            if (shader.uniforms.modelMatrix !== undefined) {\r\n                const modelToWorldTransform = location.is3d ? frag.Transform(modelToWorldMatrix) : frag.Transform2D(modelToWorldMatrix);\r\n                modelToWorldTransform.apply(drawContext.gl, shader.uniforms.modelMatrix);\r\n            }\r\n\r\n            private.meshData.draw(drawContext.gl, shader);\r\n\r\n            shader.unbind(drawContext.gl);\r\n        }\r\n\r\n        for (let i = 0; i < private.children.length; i++)\r\n            private.children[i].draw(drawContext, modelToWorldMatrix, modelToClipMatrix, animationMap);\r\n\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n};\r\n","// A public is a camera and a collection of meshes. The camera defines how the\r\n// meshes will be projected onto the viewport. Several scenes can be projecterd onto\r\n// the same viewport, but only one of these scenes should set the viewport and the rest\r\n// should adjust to the viewport.\r\n\r\nwindow.frag.Scene = function() {\r\n    const private = {\r\n        sceneObjects: [],\r\n        activeCamera: null\r\n    }\r\n\r\n    private.cameraUpdated = function() {\r\n    }\r\n\r\n    const public = {\r\n        __private: private\r\n    };\r\n\r\n    public.dispose = function() {\r\n        if (private.activeCamera)\r\n            private.activeCamera.worldToClipTransform.observableMatrix.unsubscribe(private.cameraUpdated);\r\n    }\r\n\r\n    public.addObject = function(sceneObject) {\r\n        private.sceneObjects.push(sceneObject);\r\n        return public;\r\n    };\r\n\r\n    public.removeObject = function(sceneObject) {\r\n        for (let i = 0; i < private.sceneObjects.length; i++) {\r\n            if (private.sceneObjects[i] === sceneObject) {\r\n                private.sceneObjects.splice(i, 1);\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public.camera = function(camera) {\r\n        if (private.activeCamera)\r\n            private.activeCamera.worldToClipTransform.observableMatrix.unsubscribe(private.cameraUpdated);\r\n\r\n        private.activeCamera = camera;\r\n\r\n        if (camera)\r\n            camera.worldToClipTransform.observableMatrix.subscribe(private.cameraUpdated);\r\n\r\n        return public;\r\n    }\r\n\r\n    public.getCamera = function() {\r\n        return private.activeCamera;\r\n    }\r\n\r\n    public.setViewport = function (gl) {\r\n        if (private.activeCamera)\r\n            private.activeCamera.setViewport(gl);\r\n        return public;\r\n    }\r\n\r\n    public.adjustToViewport = function (gl) {\r\n        if (private.activeCamera)\r\n            private.activeCamera.adjustToViewport(gl);\r\n        return public;\r\n    }\r\n\r\n    public.draw = function (drawContext) {\r\n        if (private.activeCamera) {\r\n            drawContext.worldToClipTransform = private.activeCamera.worldToClipTransform;\r\n            for (let i = 0; i < private.sceneObjects.length; i++)\r\n                private.sceneObjects[i].draw(drawContext);\r\n        }\r\n    }\r\n\r\n    return public;\r\n};","window.frag.SceneObject = function (model) {\r\n    const frag = window.frag;\r\n\r\n    const private = {\r\n        model,\r\n        enabled: true,\r\n        location: null,\r\n        animationLocation: null,\r\n        animationMap: {}\r\n    };\r\n\r\n    const public = {\r\n        __private: private,\r\n        animations: {}\r\n    };\r\n\r\n    for (let i = 0; i < model.animations.length; i++) {\r\n        const animation = model.animations[i];\r\n        for (let j = 0; j < animation.childAnimations.length; j++) {\r\n            const childModelName = animation.childAnimations[j].model.getName();\r\n            if (!private.animationMap[childModelName]) {\r\n                const animationState = window.frag.ObjectAnimationState();\r\n                if (window.frag.debugAnimations) {\r\n                    animationState.__private.modelName = model.getName();\r\n                    animationState.__private.childModelName = childModelName;\r\n                }\r\n                private.animationMap[childModelName] = animationState;\r\n            }\r\n        }\r\n        const objectAnimation = window.frag.SceneObjectAnimation(animation, private.animationMap);\r\n        public.animations[animation.modelAnimation.getName()] = objectAnimation;\r\n    };\r\n\r\n    private.getLocation = function () {\r\n        if (private.location) return private.location;\r\n        if (!private.model.location) return null;\r\n        private.location = frag.Location(private.model.location.is3d);\r\n        return private.location;\r\n    };\r\n\r\n    private.getAnimationLocation = function () {\r\n        if (private.animationLocation) return private.animationLocation;\r\n        if (!private.model.location) return null;\r\n        private.animationLocation = frag.Location(private.model.location.is3d);\r\n        return private.animationLocation;\r\n    };\r\n\r\n    /**\r\n     * @returns a ScemePosition object that can be used to manipulate the position\r\n     * scale and orientation of this object in the scene\r\n     */\r\n    public.getPosition = function () {\r\n        const location = private.getLocation();\r\n        if (!location) return null;\r\n        return frag.ScenePosition(location);\r\n    };\r\n\r\n    /**\r\n     * @returns a ScenePosition object that can be used to change the animation\r\n     * position of the scene object. The animation position is added to the scene\r\n     * object's static position to create a temporary animation effect\r\n     */\r\n    public.getAnimationPosition = function () {\r\n        const location = private.getAnimationLocation();\r\n        if (!location) return null;\r\n        return frag.ScenePosition(location);\r\n    };\r\n\r\n    /**\r\n     * Clears any animation position that was set. This is more efficient\r\n     * than setting the animation location to zero\r\n     */\r\n    public.clearAnimationPosition = function () {\r\n        private.animationLocation = null;\r\n        return public;\r\n    };\r\n\r\n    /**\r\n     * Includes this object in the scene. Call this function when the object\r\n     * could possibly be seen by the player. The engine will go through the\r\n     * process of transforming the mesh into screen space and clip anything\r\n     * that is not within the screen bounds. To avoid this expensive operations\r\n     * for objects that you know cannot be seen by the player, call the disable() \r\n     * function.\r\n     */\r\n    public.enable = function () {\r\n        private.enabled = true;\r\n        return public;\r\n    };\r\n\r\n    /**\r\n     * Excludes this object in the scene. Call this function when the object\r\n     * is not viewable through the player's viewport - for example it moved\r\n     * behind the player's point of view.\r\n     */\r\n     public.disable = function () {\r\n        private.enabled = false;\r\n        return public;\r\n    };\r\n\r\n    /**\r\n     * Frees any resources consumed by this scene object and removes it from\r\n     * the scene.\r\n     */\r\n    public.dispose = function() {\r\n        public.disable();\r\n        for (let animationName in public.animations) {\r\n            public.animations[animationName].dispose();\r\n        }\r\n        return public;\r\n    }\r\n\r\n    /**\r\n     * This is used internally by the engine. Don't call this from your game code\r\n     */\r\n    public.draw = function (drawContext) {\r\n        if (!private.enabled) return public;\r\n\r\n        let location = private.getLocation();\r\n        if (!location) return public;\r\n\r\n        if (private.animationLocation) {\r\n            location = location.clone().add(private.animationLocation);\r\n        }\r\n\r\n        const worldToClipMatrix = drawContext.worldToClipTransform.getMatrix();\r\n        const modelToWorldMatrix = location.getMatrix();\r\n        const modelToClipMatrix = drawContext.worldToClipTransform.is3d\r\n            ? frag.Matrix.m4Xm4(worldToClipMatrix, modelToWorldMatrix)\r\n            : frag.Matrix.m3Xm3(worldToClipMatrix, modelToWorldMatrix);\r\n\r\n        if (drawContext.isHitTest) {\r\n            drawContext.sceneObjects.push(public);\r\n        }\r\n\r\n        private.model.draw(drawContext, modelToWorldMatrix, modelToClipMatrix, private.animationMap);\r\n\r\n        return public;\r\n    };\r\n\r\n    return public;\r\n};","// This class provides a set of helper methods for\r\n// manipulating a Location object\r\nwindow.frag.ScenePosition = function (location) {\r\n    const private = {\r\n        location: null,\r\n    };\r\n\r\n    const public = {\r\n        __private: private,\r\n    };\r\n\r\n    public.setLocation = function (value) {\r\n        private.location = value || window.frag.Location();\r\n        return public;\r\n    }\r\n    public.setLocation(location);\r\n\r\n    public.getMatrix = function () {\r\n        return private.location.getMatrix();\r\n    }\r\n\r\n    public.getScaleX = function () {\r\n        return private.location.scaleX;\r\n    }\r\n\r\n    public.getScaleY = function () {\r\n        return private.location.scaleY;\r\n    }\r\n\r\n    public.getScaleZ = function () {\r\n        return private.location.scaleZ;\r\n    }\r\n\r\n    public.scale = function (s) {\r\n        private.location.scaleX = s;\r\n        private.location.scaleY = s;\r\n        private.location.scaleZ = s;\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.scaleXYZ = function (x, y, z) {\r\n        private.location.scaleX = x;\r\n        private.location.scaleY = y;\r\n        private.location.scaleZ = z;\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.scaleX = function (x) {\r\n        private.location.scaleX = x;\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.scaleY = function (y) {\r\n        private.location.scaleY = y;\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.scaleZ = function (z) {\r\n        private.location.scaleZ = z;\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.scaleBy = function(scales){\r\n        public.scaleXYZ(\r\n            private.location.scaleX * scales[0],\r\n            private.location.scaleY * scales[1],\r\n            private.location.scaleZ * scales[2]);\r\n    }\r\n\r\n    public.scaleByXYZ = function(xScale, yScale, zScale){\r\n        public.scaleXYZ(\r\n            private.location.scaleX * xScale,\r\n            private.location.scaleY * yScale,\r\n            private.location.scaleZ * zScale);\r\n    }\r\n\r\n    public.getRotateX = function () {\r\n        return private.location.rotateX;\r\n    }\r\n\r\n    public.getRotateY = function () {\r\n        return private.location.rotateY;\r\n    }\r\n\r\n    public.getRotateZ = function () {\r\n        return private.location.rotateZ;\r\n    }\r\n\r\n    public.getRotate = function() {\r\n        if (private.location.is3d)\r\n            return [private.location.rotateX, private.location.rotateY, private.location.rotateZ];\r\n        else\r\n            return [private.location.rotateX, private.location.rotateY];\r\n    }\r\n\r\n    public.rotate = function(v) {\r\n        private.location.rotateX = v[0];\r\n        if (v.length > 1) private.location.rotateY = v[1];\r\n        if (v.length > 2) private.location.rotateZ = v[2];\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.rotateXYZ = function (x, y, z) {\r\n        private.location.rotateX = x;\r\n        private.location.rotateY = y;\r\n        private.location.rotateZ = z;\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.rotateX = function (x) {\r\n        private.location.rotateX = x;\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.rotateY = function (y) {\r\n        private.location.rotateY = y;\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.rotateZ = function (z) {\r\n        private.location.rotateZ = z;\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.rotateBy = function(euler){\r\n        public.rotateXYZ(\r\n            private.location.rotateX + euler[0],\r\n            private.location.rotateY + euler[1],\r\n            private.location.rotateZ + euler[2]);\r\n    }\r\n\r\n    public.rotateByXYZ = function(x, y, z){\r\n        public.rotateXYZ(\r\n            private.location.rotateX + x,\r\n            private.location.rotateY + y,\r\n            private.location.rotateZ + z);\r\n    }\r\n\r\n    public.getLocationX = function () {\r\n        return private.location.translateX;\r\n    }\r\n\r\n    public.getLocationY = function () {\r\n        return private.location.translateY;\r\n    }\r\n\r\n    public.getLocationZ = function () {\r\n        return private.location.translateZ;\r\n    }\r\n\r\n    public.getLocation = function() {\r\n        if (private.location.is3d)\r\n            return [private.location.translateX, private.location.translateY, private.location.translateZ];\r\n        else\r\n            return [private.location.translateX, private.location.translateY];\r\n    }\r\n\r\n    public.location = function(v) {\r\n        private.location.translateX = v[0];\r\n        if (v.length > 1) private.location.translateY = v[1];\r\n        if (v.length > 2) private.location.translateZ = v[2];\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.locationXYZ = function (x, y, z) {\r\n        private.location.translateX = x;\r\n        private.location.translateY = y;\r\n        private.location.translateZ = z;\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.locationX = function (x) {\r\n        private.location.translateX = x;\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.locationY = function (y) {\r\n        private.location.translateY = y;\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.locationZ = function (z) {\r\n        private.location.translateZ = z;\r\n        private.location.isModified = true;\r\n        return public;\r\n    }\r\n\r\n    public.moveBy = function(direction){\r\n        public.locationXYZ(\r\n            private.location.translateX + direction[0],\r\n            private.location.translateY + direction[1],\r\n            private.location.translateZ + direction[2]);\r\n    }\r\n\r\n    public.moveByXYZ = function(x, y, z){\r\n        public.locationXYZ(\r\n            private.location.translateX + x,\r\n            private.location.translateY + y,\r\n            private.location.translateZ + z);\r\n    }\r\n\r\n    return public;\r\n};","window.frag.VertexData = function() {\r\n    const frag = window.frag;\r\n    const gl = frag.gl;\r\n\r\n    const private = {\r\n    };\r\n\r\n    const public = {\r\n        __private: private,\r\n        primitiveType: gl.TRIANGLES,\r\n        vertexCount: 0,\r\n        verticies: undefined,\r\n        vertexDimensions: 3,\r\n        colors: undefined,\r\n        colorDimensions: 3,\r\n        uvs: undefined,\r\n        uvDimensions: 2,\r\n        normals: undefined,\r\n        normalDimensions: 3,\r\n        tangents: undefined,\r\n        bitangents: undefined,\r\n    };\r\n\r\n    public.clone = function () {\r\n        const clone = frag.VertexData();\r\n\r\n        clone.primitiveType = public.primitiveType;\r\n        clone.vertexCount = public.vertexCount;\r\n        clone.vertexDimensions = public.vertexDimensions;\r\n        clone.colorDimensions = public.colorDimensions;\r\n        clone.uvDimensions = public.uvDimensions;\r\n        clone.normalDimensions = public.normalDimensions;\r\n\r\n        clone.verticies = public.verticies;\r\n\r\n        if (public.colors) clone.colors = Array.from(public.colors);\r\n        if (public.uvs) clone.uvs = Array.from(public.uvs);\r\n        if (public.normals) clone.normals = Array.from(public.normals);\r\n        if (public.tangents) clone.tangents = Array.from(public.tangents);\r\n        if (public.bitangents) clone.bitangents = Array.from(public.bitangents);\r\n\r\n        return clone;\r\n    }\r\n\r\n    public.vertexIndex = function (index, coord) { return index * public.vertexDimensions + (coord || 0); };\r\n    public.colorIndex = function (index, coord) { return index * public.colorDimensions + (coord || 0); };\r\n    public.uvIndex = function (index, coord) { return index * public.uvDimensions + (coord || 0); };\r\n    public.normalIndex = function (index, coord) { return index * public.normalDimensions + (coord || 0); };\r\n    public.tangentIndex = function (index, coord) { return index * public.normalDimensions + (coord || 0); };\r\n    public.bitangentIndex = function (index, coord) { return index * public.normalDimensions + (coord || 0); };\r\n\r\n    private.getVector = function (array, index, dimensions) {\r\n        if (dimensions === 2) return frag.Vector.extract2D(array, index);\r\n        return frag.Vector.extract3D(array, index);\r\n    };\r\n\r\n    private.setVector = function (array, index, v) {\r\n        for (i = 0; i < v.length; i++)\r\n            array[index + i] = v[i];\r\n    };\r\n\r\n    public.getVertexVector = function (index) {\r\n        return private.getVector(public.verticies, public.vertexIndex(index), public.vertexDimensions);\r\n    };\r\n\r\n    public.setVertexVector = function (index, v) {\r\n        return private.setVector(public.verticies, public.vertexIndex(index), v);\r\n    };\r\n\r\n    public.getColor = function (index) {\r\n        return private.getVector(public.colors, public.colorIndex(index), public.colorDimensions);\r\n    };\r\n\r\n    public.setColor = function (index, v) {\r\n        return private.setVector(public.colors, public.colorIndex(index), v);\r\n    };\r\n\r\n    public.getUvVector = function (index) {\r\n        return private.getVector(public.uvs, public.uvIndex(index), public.uvDimensions);\r\n    };\r\n\r\n    public.setUvVector = function (index, v) {\r\n        return private.setVector(public.uvs, public.uvIndex(index), v);\r\n    };\r\n\r\n    public.getNormalVector = function (index) {\r\n        return private.getVector(public.normals, public.normalIndex(index), public.normalDimensions);\r\n    };\r\n\r\n    public.setNormalVector = function (index, v) {\r\n        return private.setVector(public.normals, public.normalIndex(index), v);\r\n    };\r\n\r\n    public.getTangentVector = function (index) {\r\n        return private.getVector(public.tangents, public.tangentIndex(index), public.normalDimensions);\r\n    };\r\n\r\n    public.setTangentVector = function (index, v) {\r\n        return private.setVector(public.tangents, public.tangentIndex(index), v);\r\n    };\r\n\r\n    public.getBitangentVector = function (index) {\r\n        return private.getVector(public.bitangents, public.bitangentIndex(index), public.normalDimensions);\r\n    };\r\n\r\n    public.setBitangentVector = function (index, v) {\r\n        return private.setVector(public.bitangents, public.bitangentIndex(index), v);\r\n    };\r\n\r\n    public.setTriangles2D = function (verticies, colors, uvs, normals, tangents, bitangents) {\r\n        public.primitiveType = gl.TRIANGLES;\r\n\r\n        public.vertexDimensions = 2;\r\n        public.verticies = verticies;\r\n        public.vertexCount = verticies.length / public.vertexDimensions;\r\n\r\n        public.colorDimensions = 3;\r\n        public.colors = colors;\r\n\r\n        public.uvDimensions = 2;\r\n        public.uvs = uvs;\r\n\r\n        public.normalDimensions = 3;\r\n        public.normals = normals;\r\n        public.tangents = tangents;\r\n        public.bitangents = bitangents;\r\n\r\n        public.extractTriangles = function (addTriangle) {\r\n            for (let i = 0; i < public.vertexCount; i += 3) {\r\n                addTriangle(i, i + 1, i + 2);\r\n            }\r\n        };\r\n\r\n        return public;\r\n    }\r\n\r\n    public.setTriangles = function (verticies, colors, uvs, normals, tangents, bitangents) {\r\n        public.primitiveType = gl.TRIANGLES;\r\n\r\n        public.vertexDimensions = 3;\r\n        public.verticies = verticies;\r\n        public.vertexCount = verticies.length / public.vertexDimensions;\r\n\r\n        public.colorDimensions = 3;\r\n        public.colors = colors;\r\n\r\n        public.uvDimensions = 2;\r\n        public.uvs = uvs;\r\n\r\n        public.normalDimensions = 3;\r\n        public.normals = normals;\r\n        public.tangents = tangents;\r\n        public.bitangents = bitangents;\r\n\r\n        public.extractTriangles = function (addTriangle) {\r\n            for (let i = 0; i < public.vertexCount; i += 3) {\r\n                addTriangle(i, i + 1, i + 2);\r\n            }\r\n        };\r\n\r\n        return public;\r\n    }\r\n\r\n    public.setTriangleStrip = function (verticies, colors, uvs, normals, tangents, bitangents) {\r\n        public.primitiveType = gl.TRIANGLE_STRIP;\r\n\r\n        public.vertexDimensions = 3;\r\n        public.verticies = verticies;\r\n        public.vertexCount = verticies.length / public.vertexDimensions;\r\n\r\n        public.colorDimensions = 3;\r\n        public.colors = colors;\r\n\r\n        public.uvDimensions = 2;\r\n        public.uvs = uvs;\r\n\r\n        public.normalDimensions = 3;\r\n        public.normals = normals;\r\n        public.tangents = tangents;\r\n        public.bitangents = bitangents;\r\n\r\n        public.extractTriangles = function (addTriangle) {\r\n            const triangleCount = public.vertexCount - 2;\r\n            for (let i = 0; i < triangleCount; i++) {\r\n                if ((i & 1) === 0) addTriangle(i, i + 1, i + 2);\r\n                else addTriangle(i + 2, i + 1, i);\r\n            }\r\n        };\r\n\r\n        return public;\r\n    }\r\n\r\n    public.setTriangleFan = function (verticies, colors, uvs, normals, tangents, bitangents) {\r\n        public.primitiveType = gl.TRIANGLE_FAN;\r\n\r\n        public.vertexDimensions = 3;\r\n        public.verticies = verticies;\r\n        public.vertexCount = verticies.length / public.vertexDimensions;\r\n\r\n        public.colorDimensions = 3;\r\n        public.colors = colors;\r\n\r\n        public.uvDimensions = 2;\r\n        public.uvs = uvs;\r\n\r\n        public.normalDimensions = 3;\r\n        public.normals = normals;\r\n        public.tangents = tangents;\r\n        public.bitangents = bitangents;\r\n\r\n        public.extractTriangles = function (addTriangle) {\r\n            const triangleCount = public.vertexCount - 2;\r\n            for (let i = 0; i < triangleCount; i++) {\r\n                addTriangle(0, i + 1, i + 2);\r\n            }\r\n        };\r\n\r\n        return public;\r\n    }\r\n\r\n    public.setLines2D = function (verticies, colors, uvs, normals) {\r\n        public.primitiveType = gl.LINES;\r\n\r\n        public.vertexDimensions = 2;\r\n        public.verticies = verticies;\r\n        public.vertexCount = verticies.length / public.vertexDimensions;\r\n\r\n        public.colorDimensions = 3;\r\n        public.colors = colors;\r\n\r\n        public.uvDimensions = 2;\r\n        public.uvs = uvs;\r\n\r\n        public.normalDimensions = 3;\r\n        public.normals = normals;\r\n        public.tangents = null;\r\n        public.bitangents = null;\r\n\r\n        public.extractTriangles = function () { };\r\n\r\n        return public;\r\n    }\r\n\r\n    public.setLines = function (verticies, colors, uvs, normals) {\r\n        public.primitiveType = gl.LINES;\r\n\r\n        public.vertexDimensions = 3;\r\n        public.verticies = verticies;\r\n        public.vertexCount = verticies.length / public.vertexDimensions;\r\n\r\n        public.colorDimensions = 3;\r\n        public.colors = colors;\r\n\r\n        public.uvDimensions = 2;\r\n        public.uvs = uvs;\r\n\r\n        public.normalDimensions = 3;\r\n        public.normals = normals;\r\n        public.tangents = null;\r\n        public.bitangents = null;\r\n\r\n        public.extractTriangles = function () { };\r\n\r\n        return public;\r\n    }\r\n\r\n    public.setLineStrip = function (verticies, colors, uvs, normals) {\r\n        public.primitiveType = gl.LINE_STRIP;\r\n\r\n        public.vertexDimensions = 3;\r\n        public.verticies = verticies;\r\n        public.vertexCount = verticies.length / public.vertexDimensions;\r\n\r\n        public.colorDimensions = 3;\r\n        public.colors = colors;\r\n\r\n        public.uvDimensions = 2;\r\n        public.uvs = uvs;\r\n\r\n        public.normalDimensions = 3;\r\n        public.normals = normals;\r\n        public.tangents = null;\r\n        public.bitangents = null;\r\n\r\n        public.extractTriangles = function () { };\r\n\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n};\r\n","window.frag.createShader = function (name, type, source) {\r\n    const frag = window.frag;\r\n    const gl = frag.gl;\r\n\r\n    //if (frag.debugShaderBuilder) {\r\n        console.log(\"\\n// \" + name + \" \" + (type === gl.VERTEX_SHADER ? \"vertex\" : \"fragment\") + \" shader\\n\" + source);\r\n\r\n    var shader = gl.createShader(type);\r\n    gl.shaderSource(shader, source);\r\n    gl.compileShader(shader);\r\n    var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (success) return shader;\r\n\r\n    console.error('Failed to compile shader ' + name);\r\n    console.log(gl.getShaderInfoLog(shader));\r\n    gl.deleteShader(shader);\r\n};\r\n\r\nwindow.frag.createProgram = function (name, vertexShader, fragmentShader) {\r\n    const frag = window.frag;\r\n    const gl = frag.gl;\r\n\r\n    var program = gl.createProgram();\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n    gl.linkProgram(program);\r\n    var success = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n    if (success) return program;\r\n\r\n    console.error('Failed to link shaders into program ' + name);\r\n    console.log(frag.gl.getProgramInfoLog(program));\r\n    gl.deleteProgram(program);\r\n};\r\n\r\nwindow.frag.CustomShader = function (is3d) {\r\n    const private = {\r\n        name: \"Custom\",\r\n        vSource: null,\r\n        fSource: null,\r\n        bindList: [],\r\n        unbindList: [],\r\n    };\r\n\r\n    const public = {\r\n        __private: private,\r\n        attributes: {},\r\n        uniforms: {},\r\n        is3d: is3d === undefined ? true : is3d,\r\n    }\r\n\r\n    public.name = function (name) {\r\n        private.name = name;\r\n        return public;\r\n    }\r\n\r\n    public.source = function (vertexShaderSource, fragmentShaderSource) {\r\n        //if (frag.debugShaderBuilder) {\r\n            console.log(\"\\n// \" + private.name + \" vertext shader\\n\" + vertexShaderSource);\r\n            console.log(\"\\n// \" + private.name + \" fragment shader\\n\" + fragmentShaderSource);\r\n        //}\r\n\r\n        private.vSource = vertexShaderSource;\r\n        private.fSource = fragmentShaderSource;\r\n\r\n        const vertexShader = frag.createShader(private.name, frag.gl.VERTEX_SHADER, vertexShaderSource);\r\n        const fragmentShader = frag.createShader(private.name, frag.gl.FRAGMENT_SHADER, fragmentShaderSource);\r\n        public.program = frag.createProgram(private.name, vertexShader, fragmentShader);\r\n\r\n        return public;\r\n    }\r\n\r\n    public.onBind = function (fn) {\r\n        private.bindList.push(fn);\r\n        return public;\r\n    }\r\n\r\n    public.onUnbind = function (fn) {\r\n        private.unbindList.push(fn);\r\n        return public;\r\n    }\r\n\r\n    public.attribute = function (name) {\r\n        if (!public.program) {\r\n            console.error(\"You must set the \" + private.name + \" shader source before defining attributes\");\r\n            return public;\r\n        }\r\n\r\n        const attribute = frag.gl.getAttribLocation(public.program, \"a_\" + name);\r\n\r\n        if (attribute === undefined) {\r\n            console.error(\"Shader program \" + private.name + \" does not have attribute a_\" + name);\r\n            return public;\r\n        }\r\n\r\n        public.attributes[name] = attribute;\r\n        return public;\r\n    }\r\n\r\n    public.uniform = function (name, glType, initialValue) {\r\n        if (!public.program) {\r\n            console.error(\"You must set the \" + private.name + \" shader source before defining uniforms\");\r\n            return public;\r\n        }\r\n\r\n        const uniform = frag.gl.getUniformLocation(public.program, \"u_\" + name);\r\n\r\n        if (!uniform) {\r\n            console.error(\"Shader program \" + private.name + \" does not have uniform u_\" + name);\r\n            return public;\r\n        }\r\n\r\n        public.uniforms[name] = uniform;\r\n\r\n        if (glType) {\r\n            private[name] = initialValue;\r\n            public[name] = function (newValue) { \r\n                private[name] = newValue;\r\n                return public;\r\n            }\r\n            private.bindList.push(function (gl) {\r\n                if (private[name] !== undefined) {\r\n                    //console.log(\"gl.uniform\" + glType + \"(\" + name + \",\" + private[name] + \")\")\r\n                    gl[\"uniform\" + glType](uniform, private[name]);\r\n                }\r\n            });\r\n        }\r\n\r\n        return public;\r\n    }\r\n\r\n    public.bind = function (gl) {\r\n        gl.useProgram(public.program);\r\n        private.bindList.forEach(f => f(gl));\r\n        return public;\r\n    }\r\n\r\n    public.unbind = function (gl) {\r\n        private.unbindList.forEach(f => f(gl));\r\n        return public;\r\n    }\r\n\r\n    return public;\r\n};\r\n","window.frag.startFunctions.push(function(frag) {\r\n    const vertexShader = \r\n        \"attribute vec4 a_position;\\n\" +\r\n        \"attribute vec2 a_texcoord;\\n\" +\r\n        \"attribute vec3 a_normal;\\n\" +\r\n        \"uniform mat4 u_modelMatrix;\\n\" +\r\n        \"uniform mat4 u_clipMatrix;\\n\" +\r\n        \"uniform vec3 u_lightDirection;\\n\" +\r\n        \"varying vec2 v_texcoord;\\n\" +\r\n        \"varying vec3 v_lightDirection;\\n\" +\r\n        \"varying vec3 v_normal;\\n\" +\r\n        \"void main() {\\n\" +\r\n        \"  vec4 position = a_position;\\n\" +\r\n        \"  position = u_clipMatrix * position;\\n\" +\r\n        \"  gl_Position = position;\\n\" +\r\n        \"  v_texcoord = a_texcoord;\\n\" +\r\n        \"  v_normal = (u_modelMatrix * vec4(a_normal, 0)).xyz;\\n\" +\r\n        \"  v_lightDirection = u_lightDirection;\\n\" +\r\n        \"}\";\r\n\r\n    const fragmentShader = \r\n        \"precision mediump float;\\n\" +\r\n        \"uniform sampler2D u_diffuse;\\n\" +\r\n        \"uniform float u_ambientLight;\\n\" +\r\n        \"varying vec2 v_texcoord;\\n\" +\r\n        \"varying vec3 v_lightDirection;\\n\" +\r\n        \"varying vec3 v_normal;\\n\" +\r\n        \"void main() {\\n\" +\r\n        \"  vec3 normal = normalize(v_normal);\\n\" +\r\n        \"  vec3 lightDirection = v_lightDirection;\\n\" +\r\n        \"  float light = max(dot(normal, lightDirection), 0.0);\\n\" +\r\n        \"  light += u_ambientLight;\\n\" +\r\n        \"  gl_FragColor = vec4(0, 0, 0, 1.0);\\n\" +\r\n        \"  gl_FragColor += texture2D(u_diffuse, vec2(v_texcoord.x, 1.0 - v_texcoord.y));\\n\" +\r\n        \"  gl_FragColor.rgb *= light;\\n\" +\r\n        \"}\\n\";\r\n    \r\n    frag.fontShader = frag.CustomShader()\r\n        .name(\"Font\")\r\n        .source(vertexShader, fragmentShader)\r\n        .uniform(\"clipMatrix\")\r\n        .uniform(\"diffuse\");\r\n});\r\n","// This builds a custom shader based on a set of options\r\nwindow.frag.Shader = function () {\r\n    const none = \"None\";\r\n    const private = {\r\n        name: \"Custom\",\r\n        verticies: \"XYZ\",\r\n        x: 0,\r\n        y: 0,\r\n        z: 0,\r\n        colors: none,\r\n        matrix: \"mat4\",\r\n        textureCoords: none,\r\n        diffuseTexture: none,\r\n        emmissiveTexture: none,\r\n        displacementTexture: none,\r\n        normalMap: none,\r\n        roughnessTexture: none,\r\n        shininessTexture: none,\r\n        metalinessTexture: none,\r\n        normals: none,\r\n        tangents: none,\r\n        bitangents: none,\r\n        directionalLight: none,\r\n        ambientLight: none,\r\n    };\r\n\r\n    const public = {\r\n        __private: private,\r\n    };\r\n\r\n    public.name = function (name) { private.name = name; return public; }\r\n\r\n    public.verticiesXY = function (z) { private.verticies = \"XY\"; private.z = z; return public; }\r\n    public.verticiesXZ = function (y) { private.verticies = \"XZ\"; private.y = y; return public; }\r\n    public.verticiesYZ = function (x) { private.verticies = \"YZ\"; private.x = x; return public; }\r\n    public.verticiesXYZ = function () { private.verticies = \"XYZ\"; return public; }\r\n    public.verticiesNone = function () { private.verticies = none; return public; }\r\n\r\n    public.matrix2D = function () { private.matrix = \"mat3\"; return public; }\r\n    public.matrix3D = function () { private.matrix = \"mat4\"; return public; }\r\n    public.matrixNone = function () { private.matrix = none; return public; }\r\n           \r\n    public.normals = function () { private.normals = \"vec3\"; return public; }\r\n\r\n    public.colorsRGB = function() { private.colors = \"vec3\"; return public; }\r\n    public.colorsRGBA = function() { private.colors = \"vec4\"; return public; }\r\n    public.colorsNone = function() { private.colors = none; return public; }\r\n\r\n    public.diffuseTexture = function () {\r\n        private.diffuseTexture = \"RGB\";\r\n        private.colors = none;\r\n        if (private.textureCoords === none) private.textureCoords = \"vec2\";\r\n        return public; \r\n    };\r\n\r\n    public.emmissiveTexture = function () {\r\n        private.emmissiveTexture = \"RGB\";\r\n        if (private.textureCoords === none) private.textureCoords = \"vec2\";\r\n        return public;\r\n    };\r\n\r\n    public.normalMapStandard = function () {\r\n        private.normalMap = \"Standard\";\r\n        if (private.textureCoords === none) private.textureCoords = \"vec2\";\r\n        if (private.normals === none) private.normals = \"vec3\";\r\n        if (private.tangents === none) private.tangents = \"vec3\";\r\n        return public; \r\n    };\r\n\r\n    public.normalMapOpenGL = function () {\r\n        private.normalMap = \"OpenGL\";\r\n        if (private.textureCoords === none) private.textureCoords = \"vec2\";\r\n        if (private.normals === none) private.normals = \"vec3\";\r\n        if (private.tangents === none) private.tangents = \"vec3\";\r\n        return public; \r\n    };\r\n\r\n    public.displacementTextureRaised = function () {\r\n        private.displacementTexture = \"Raised\";\r\n        if (private.textureCoords === none) private.textureCoords = \"vec2\";\r\n        if (private.normals === none) private.normals = \"vec3\";\r\n        return public;\r\n    };\r\n\r\n    public.displacementTextureSunken = function () {\r\n        private.displacementTexture = \"Sunken\";\r\n        if (private.textureCoords === none) private.textureCoords = \"vec2\";\r\n        if (private.normals === none) private.normals = \"vec3\";\r\n        return public;\r\n    };\r\n\r\n    public.displacementTextureSigned = function () {\r\n        private.displacementTexture = \"Signed\";\r\n        if (private.textureCoords === none) private.textureCoords = \"vec2\";\r\n        if (private.normals === none) private.normals = \"vec3\";\r\n        return public;\r\n    };\r\n\r\n    public.tangents = function () {\r\n        private.tangents = \"vec3\";\r\n        if (private.normals === none) private.normals = \"vec3\";\r\n        return public;\r\n    };\r\n\r\n    public.bitangents = function () {\r\n        private.bitangents = \"vec3\";\r\n        if (private.normals === none) private.normals = \"vec3\";\r\n        return public; \r\n    };\r\n\r\n    public.directionalLightColor = function () {\r\n        public.matrix3D();\r\n        private.directionalLight = \"Color\";\r\n        if (private.ambientLight === none) private.ambientLight = \"Balanced\";\r\n        if (private.normals === none) private.normals = \"vec3\";\r\n        return public;\r\n    }\r\n\r\n    public.directionalLightWhite = function () {\r\n        public.matrix3D();\r\n        private.directionalLight = \"White\";\r\n        if (private.ambientLight === none) private.ambientLight = none;\r\n        if (private.normals === none) private.normals = \"vec3\";\r\n        return public;\r\n    }\r\n\r\n    public.directionalLightGrey = function () {\r\n        public.matrix3D();\r\n        private.directionalLight = \"Grey\";\r\n        if (private.ambientLight === none) private.ambientLight = \"Balanced\";\r\n        if (private.normals === none) private.normals = \"vec3\";\r\n        return public;\r\n    }\r\n\r\n    public.directionalLightNone = function () {\r\n        private.directionalLight = none;\r\n        return public;\r\n    }\r\n\r\n    public.ambientLightBalanced = function () {\r\n        private.ambientLight = \"Balanced\";\r\n        return public;\r\n    }\r\n\r\n    public.ambientLightNone = function () {\r\n        private.ambientLight = none;\r\n        return public;\r\n    }\r\n\r\n    public.ambientLightFixed = function () {\r\n        private.ambientLight = \"Fixed\";\r\n        return public;\r\n    }\r\n\r\n    private.addAttributeDeclarations = function(shader) {\r\n        if (private.verticies === \"XYZ\") shader.vSource += \"attribute vec4 a_position;\\n\";\r\n        else if (private.verticies !== none) shader.vSource += \"attribute vec2 a_position;\\n\";\r\n\r\n        if (private.colors !== none) shader.vSource += \"attribute \" + private.colors + \" a_color;\\n\";\r\n        if (private.textureCoords !== none) shader.vSource += \"attribute \" + private.textureCoords + \" a_texcoord;\\n\";\r\n        if (private.normals !== none) shader.vSource += \"attribute \" + private.normals + \" a_normal;\\n\";\r\n        if (private.tangents !== none) shader.vSource += \"attribute \" + private.tangents + \" a_tangent;\\n\";\r\n        if (private.bitangents !== none) shader.vSource += \"attribute \" + private.bitangents + \" a_bitangent;\\n\";\r\n    }\r\n\r\n    private.addUniformDeclarations = function (shader) {\r\n        if (private.matrix !== none) {\r\n            if (private.directionalLight !== none)\r\n                shader.vSource += \"uniform \" + private.matrix + \" u_modelMatrix;\\n\";\r\n            shader.vSource += \"uniform \" + private.matrix + \" u_clipMatrix;\\n\";\r\n        }\r\n        if (private.directionalLight !== none) shader.vSource += \"uniform vec3 u_lightDirection;\\n\";\r\n        if (private.directionalLight === \"Color\") shader.vSource += \"uniform vec3 u_lightColor;\\n\";\r\n        if (private.displacementTexture !== none) shader.vSource += \"uniform float u_displacementScale;\\n\";\r\n        if (private.displacementTexture !== none || private.roughnessTexture !== none || private.shininessTexture != none) shader.vSource += \"uniform sampler2D u_surface;\\n\";\r\n\r\n        if (private.normalMap !== none) shader.fSource += \"uniform sampler2D u_normalMap;\\n\";\r\n        if (private.textureCoords !== none) {\r\n            if (private.diffuseTexture !== none) shader.fSource += \"uniform sampler2D u_diffuse;\\n\";\r\n            if (private.emmissiveTexture !== none) shader.fSource += \"uniform sampler2D u_emmissive;\\n\";\r\n        }\r\n        if (private.ambientLight !== none) shader.fSource += \"uniform float u_ambientLight;\\n\";\r\n    }\r\n\r\n    private.addVaryingDeclarations = function (shader) {\r\n        const add = function (type, name) {\r\n            const statement = \"varying \" + type + \" \" + name + \";\\n\";\r\n            shader.vSource += statement;\r\n            shader.fSource += statement;\r\n        }\r\n\r\n        if (private.textureCoords !== none) add(private.textureCoords, \"v_texcoord\");\r\n        if (private.colors !== none) add(private.colors, \"v_color\");\r\n        if (private.directionalLight !== none) {\r\n            add(\"vec3\", \"v_lightDirection\");\r\n            if (private.directionalLight === \"Color\") add(\"vec3\", \"v_lightColor\");\r\n            if (private.normalMap === none) add(private.normals, \"v_normal\");\r\n        }\r\n    }\r\n\r\n    private.addLogic = function (shader) {\r\n        if (private.verticies === \"XYZ\") shader.vSource += \"  vec4 position = a_position;\\n\";\r\n        else if (private.verticies !== none) shader.vSource += \"  vec2 position = a_position;\\n\";\r\n\r\n        if (private.displacementTexture !== none || private.roughnessTexture !== none || private.shininessTexture != none) {\r\n            shader.vSource += \"  vec4 surface = texture2D(u_surface, vec2(a_texcoord.x, 1.0 - a_texcoord.y));\\n\";\r\n        }\r\n\r\n        if (private.displacementTexture !== none) {\r\n            if (private.verticies === \"XYZ\" && private.normals === \"vec3\") {\r\n                if (private.displacementTexture === \"Sunken\") shader.vSource += \"  float displacement = -surface.r;\\n\";\r\n                else if (private.displacementTexture === \"Signed\") shader.vSource += \"  float displacement = surface.r * 2.0 - 1.0;\\n\";\r\n                else if (private.displacementTexture === \"Raised\") shader.vSource += \"  float displacement = surface.r;\\n\";\r\n                shader.vSource += \"  position = vec4(position.xyz + (a_normal * displacement * u_displacementScale), position.w);\\n\";\r\n            }\r\n        }\r\n\r\n        if (private.verticies === \"XYZ\") shader.vSource += \"  position = u_clipMatrix * position;\\n\";\r\n        else if (private.verticies !== none) shader.vSource += \"  position = (u_clipMatrix * vec3(position, 1)).xy;\\n\";\r\n\r\n        if (private.verticies === \"XYZ\") shader.vSource += \"  gl_Position = position;\\n\";\r\n        else if (private.verticies === \"XY\") shader.vSource += \"  gl_Position = vec4(position, \" + private.z + \", 1);\\n\";\r\n        else if (private.verticies === \"XZ\") shader.vSource += \"  gl_Position = vec4(position.x, \" + private.y + \", position.y, 1);\\n\";\r\n        else if (private.verticies === \"YZ\") shader.vSource += \"  gl_Position = vec4(\" + private.x + \", position, 1);\\n\";\r\n\r\n        if (private.textureCoords !== none) shader.vSource += \"  v_texcoord = a_texcoord;\\n\";\r\n\r\n        if (private.directionalLight !== none) {\r\n            if (private.normalMap !== none) {\r\n                shader.vSource += \"  vec3 T = normalize(vec3(u_modelMatrix * vec4(a_tangent, 0.0)));\\n\";\r\n                if (private.bitangents !== none)\r\n                    shader.vSource += \"  vec3 B = normalize(vec3(u_modelMatrix * vec4(a_bitangent, 0.0)));\\n\";\r\n                else\r\n                    shader.vSource += \"  vec3 B = normalize(vec3(u_modelMatrix * vec4(cross(a_normal, a_tangent), 0.0)));\\n\";\r\n                shader.vSource += \"  vec3 N = normalize(vec3(u_modelMatrix * vec4(a_normal, 0.0)));\\n\";\r\n                shader.vSource += \"  mat3 TBN = transpose(mat3(T, B, N));\\n\";\r\n                shader.vSource += \"  v_lightDirection = TBN * u_lightDirection;\\n\";\r\n                shader.fSource += \"  vec3 normal = texture2D(u_normalMap, vec2(v_texcoord.x, 1.0 - v_texcoord.y)).rgb * 2.0 - 1.0;\\n\";\r\n            } else {\r\n                shader.vSource += \"  v_normal = (u_modelMatrix * vec4(a_normal, 0)).xyz;\\n\";\r\n                shader.vSource += \"  v_lightDirection = u_lightDirection;\\n\";\r\n                shader.fSource += \"  vec3 normal = normalize(v_normal);\\n\";\r\n            }\r\n\r\n            shader.fSource += \"  vec3 lightDirection = v_lightDirection;\\n\";\r\n            shader.fSource += \"  float light = max(dot(normal, lightDirection), 0.0);\\n\";\r\n            if (private.ambientLight !== none) shader.fSource += \"  light += u_ambientLight;\\n\";\r\n        } else {\r\n            if (private.ambientLight !== none) shader.fSource += \"  float light = u_ambientLight;\\n\";\r\n        }\r\n\r\n        if (private.directionalLight === \"Color\") \r\n            shader.vSource += \"  v_lightColor = u_lightColor;\\n\";\r\n\r\n        if (private.colors === none)\r\n            shader.fSource += \"  gl_FragColor = vec4(0, 0, 0, 1.0);\\n\";\r\n        else if (private.colors === \"vec4\") {\r\n            shader.vSource += \"  v_color = a_color;\\n\";\r\n            shader.fSource += \"  gl_FragColor = v_color;\\n\";\r\n        } else {\r\n            shader.vSource += \"  v_color = a_color;\\n\";\r\n            shader.fSource += \"  gl_FragColor = vec4(v_color, 1.0);\\n\";\r\n        }\r\n\r\n        if (private.textureCoords === \"vec2\") {\r\n            if (private.diffuseTexture === \"RGB\")\r\n                shader.fSource += \"  gl_FragColor += texture2D(u_diffuse, vec2(v_texcoord.x, 1.0 - v_texcoord.y));\\n\";\r\n        }\r\n\r\n        if (private.ambientLight !== none || private.directionalLight !== none)\r\n            shader.fSource += \"  gl_FragColor.rgb *= light;\\n\";\r\n\r\n        if (private.textureCoords === \"vec2\") {\r\n            if (private.emmissiveTexture === \"RGB\")\r\n                shader.fSource += \"  gl_FragColor.rgb += texture2D(u_emmissive, vec2(v_texcoord.x, 1.0 - v_texcoord.y)).rgb;\\n\";\r\n        }\r\n    }\r\n\r\n    public.compile = function () {\r\n        const shader = {\r\n            name: private.name,\r\n            vSource: \"\",\r\n            fSource: \"precision mediump float;\\n\",\r\n            attributes: {},\r\n            uniforms: {},\r\n            is3d: private.matrix === \"mat4\",\r\n        };\r\n\r\n        private.addAttributeDeclarations(shader);\r\n        private.addUniformDeclarations(shader);\r\n        private.addVaryingDeclarations(shader);\r\n\r\n        if (private.directionalLight !== none) {\r\n            /*\r\n            shader.vSource += \"highp mat4 transpose(in highp mat4 inMatrix) {\\n\";\r\n            shader.vSource += \"    highp vec4 i0 = inMatrix[0];\\n\";\r\n            shader.vSource += \"    highp vec4 i1 = inMatrix[1];\\n\";\r\n            shader.vSource += \"    highp vec4 i2 = inMatrix[2];\\n\";\r\n            shader.vSource += \"    highp vec4 i3 = inMatrix[3];\\n\";\r\n            shader.vSource += \"    highp mat4 outMatrix = mat4(\\n\";\r\n            shader.vSource += \"        vec4(i0.x, i1.x, i2.x, i3.x),\\n\";\r\n            shader.vSource += \"        vec4(i0.y, i1.y, i2.y, i3.y),\\n\";\r\n            shader.vSource += \"        vec4(i0.z, i1.z, i2.z, i3.z),\\n\";\r\n            shader.vSource += \"        vec4(i0.w, i1.w, i2.w, i3.w)\\n\";\r\n            shader.vSource += \"    );\\n\";\r\n            shader.vSource += \"    return outMatrix;\\n\";\r\n            shader.vSource += \"}\\n\";\r\n            */\r\n            shader.vSource += \"highp mat3 transpose(in highp mat3 inMatrix) {\\n\";\r\n            shader.vSource += \"    highp vec3 i0 = inMatrix[0];\\n\";\r\n            shader.vSource += \"    highp vec3 i1 = inMatrix[1];\\n\";\r\n            shader.vSource += \"    highp vec3 i2 = inMatrix[2];\\n\";\r\n            shader.vSource += \"    highp mat3 outMatrix = mat3(\\n\";\r\n            shader.vSource += \"        vec3(i0.x, i1.x, i2.x),\\n\";\r\n            shader.vSource += \"        vec3(i0.y, i1.y, i2.y),\\n\";\r\n            shader.vSource += \"        vec3(i0.z, i1.z, i2.z)\\n\";\r\n            shader.vSource += \"    );\\n\";\r\n            shader.vSource += \"    return outMatrix;\\n\";\r\n            shader.vSource += \"}\\n\";\r\n        }\r\n\r\n        shader.vSource += \"void main() {\\n\";\r\n        shader.fSource += \"void main() {\\n\";\r\n\r\n        private.addLogic(shader);\r\n\r\n        shader.vSource += \"}\\n\";\r\n        shader.fSource += \"}\\n\";\r\n\r\n        const vertexShader = frag.createShader(shader.name, frag.gl.VERTEX_SHADER, shader.vSource);\r\n        const fragmentShader = frag.createShader(shader.name, frag.gl.FRAGMENT_SHADER, shader.fSource);\r\n        shader.program = frag.createProgram(shader.name, vertexShader, fragmentShader);\r\n\r\n        if (!shader.program) return null;\r\n\r\n        const bindList = [];\r\n        const unbindList = [];\r\n\r\n        if (private.verticies !== none) {\r\n            shader.attributes.position = frag.gl.getAttribLocation(shader.program, \"a_position\");\r\n        }\r\n\r\n        if (private.colors !== none) {\r\n            shader.attributes.color = frag.gl.getAttribLocation(shader.program, \"a_color\");\r\n        }\r\n\r\n        if (private.textureCoords !== none) {\r\n            shader.attributes.texture = frag.gl.getAttribLocation(shader.program, \"a_texcoord\");\r\n        }\r\n\r\n        if (private.normals !== none) {\r\n            shader.attributes.normal = frag.gl.getAttribLocation(shader.program, \"a_normal\");\r\n        }\r\n\r\n        if (private.tangents !== none) {\r\n            shader.attributes.tangent = frag.gl.getAttribLocation(shader.program, \"a_tangent\");\r\n        }\r\n\r\n        if (private.bitangents !== none) {\r\n            shader.attributes.bitangent = frag.gl.getAttribLocation(shader.program, \"a_bitangent\");\r\n        }\r\n\r\n        if (private.matrix !== none) {\r\n            if (private.directionalLight !== none)\r\n                shader.uniforms.modelMatrix = frag.gl.getUniformLocation(shader.program, \"u_modelMatrix\");\r\n            shader.uniforms.clipMatrix = frag.gl.getUniformLocation(shader.program, \"u_clipMatrix\");\r\n        }\r\n\r\n        if (private.diffuseTexture !== none) {\r\n            shader.uniforms.diffuse = frag.gl.getUniformLocation(shader.program, \"u_diffuse\");\r\n        }\r\n\r\n        if (private.emmissiveTexture !== none) {\r\n            shader.uniforms.emmissive = frag.gl.getUniformLocation(shader.program, \"u_emmissive\");\r\n        }\r\n\r\n        if (private.displacementTexture !== none || private.roughnessTexture !== none || private.shininessTexture != none) {\r\n            shader.uniforms.surface = frag.gl.getUniformLocation(shader.program, \"u_surface\");\r\n        }\r\n\r\n        if (private.displacementTexture !== none) {\r\n            shader.uniforms.displacementScale = frag.gl.getUniformLocation(shader.program, \"u_displacementScale\");\r\n            bindList.push(function (gl) { gl.uniform1f(shader.uniforms.displacementScale, shader._displacementScale); });\r\n            shader._displacementScale = 0.2;\r\n            shader.displacementScale = function (scale) {\r\n                shader._displacementScale = scale;\r\n                return shader;\r\n            };\r\n        }\r\n\r\n        if (private.normalMap !== none) {\r\n            shader.uniforms.normalMap = frag.gl.getUniformLocation(shader.program, \"u_normalMap\");\r\n        }\r\n\r\n        if (private.ambientLight !== none) {\r\n            shader.uniforms.ambientLight = frag.gl.getUniformLocation(shader.program, \"u_ambientLight\");\r\n            bindList.push(function (gl) { gl.uniform1f(shader.uniforms.ambientLight, shader._ambientLight); });\r\n            shader._ambientLight = 0.5;\r\n        }\r\n\r\n        if (private.directionalLight !== none) {\r\n            shader.uniforms.lightDirection = frag.gl.getUniformLocation(shader.program, \"u_lightDirection\");\r\n            bindList.push(function (gl) { gl.uniform3fv(shader.uniforms.lightDirection, shader._lightDirection); });\r\n\r\n            if (private.directionalLight === \"Color\"){\r\n                shader.uniforms.lightColor = frag.gl.getUniformLocation(shader.program, \"u_lightColor\");\r\n                bindList.push(function (gl) { gl.uniform3fv(shader.uniforms.lightColor, shader._lightColor); });\r\n\r\n                shader.lightColor = function(color) {\r\n                    shader._lightColor = color;\r\n                    return shader;\r\n                }\r\n            }\r\n\r\n            const balanceAmbient = private.ambientLight === \"Balanced\";\r\n            shader.lightDirection = function (direction) {\r\n                const length = window.frag.Vector.length(direction);\r\n                if (length > 1) {\r\n                    shader._lightDirection = [-direction[0] / length, -direction[1] / length, -direction[2] / length];\r\n                    if (balanceAmbient) shader._ambientLight = 0;\r\n                } else {\r\n                    shader._lightDirection = [-direction[0], -direction[1], -direction[2]];\r\n                    if (balanceAmbient) shader._ambientLight = 1 - length;\r\n                }\r\n                return shader;\r\n            };\r\n            if (private.directionalLight === \"White\")\r\n                shader.lightDirection([0.8, -0.2, 0.8]);\r\n            else if (private.directionalLight === \"Grey\")\r\n                shader.lightDirection([0.5, -0.1, 0.5]);\r\n        }\r\n\r\n        shader.bind = function (gl) {\r\n            gl.useProgram(shader.program);\r\n            bindList.forEach(f => f(gl));\r\n        }\r\n\r\n        shader.unbind = function (gl) {\r\n            unbindList.forEach(f => f(gl));\r\n        }\r\n\r\n        return shader;\r\n    }\r\n    return public;\r\n};\r\n","window.frag.startFunctions.push(function(frag) {\r\n    frag.uiShader = frag.Shader()\r\n        .name(\"UI\")\r\n        .verticiesXY(-1)  // Renders in xy plane with z = -1\r\n        .matrix2D()       // Transformation matricies are 2D\r\n        .diffuseTexture() // Adds support for diffuse texture mapping\r\n        .compile();       // Compile the shader\r\n});\r\n","// This cube consists of a single sub-mesh so that smooth shading works correctly\r\nwindow.frag.Cube = function (facets, options) {\r\n    options = options || {};\r\n    if (options.drawFront === undefined) options.drawFront = true;\r\n    if (options.drawBack === undefined) options.drawBack = true;\r\n    if (options.drawTop === undefined) options.drawTop = true;\r\n    if (options.drawBottom === undefined) options.drawBottom = true;\r\n    if (options.drawLeft === undefined) options.drawLeft = true;\r\n    if (options.drawRight === undefined) options.drawRight = true;\r\n\r\n    let u0 = 0;\r\n    let u1 = 1 / 4;\r\n    let u2 = 2 / 4;\r\n    let u3 = 3 / 4;\r\n    let u4 = 1;\r\n\r\n    let v0 = 0;\r\n    let v1 = 1 / 3;\r\n    let v2 = 2 / 3;\r\n    let v3 = 1;\r\n\r\n    const corners = [\r\n        [-1, -1, -1],\r\n        [+1, -1, -1],\r\n        [+1, +1, -1],\r\n        [-1, +1, -1],\r\n        [+1, -1, +1],\r\n        [-1, -1, +1],\r\n        [-1, +1, +1],\r\n        [+1, +1, +1],\r\n    ];\r\n\r\n    const verticies = [];\r\n    const uvs = [];\r\n    const colors = options.color ? [] : undefined;\r\n\r\n    const addVertex = function(v) {\r\n        verticies.push(v[0]);\r\n        verticies.push(v[1]);\r\n        verticies.push(v[2]);\r\n        if (options.color) {\r\n            options.color.forEach(c => { colors.push(c); });\r\n        }\r\n    }\r\n\r\n    const addUv = function (u, v) {\r\n        uvs.push(u);\r\n        uvs.push(v);\r\n    }\r\n\r\n    const addFacetVerticies = function (bottomRight, topRight, bottomLeft, topLeft){\r\n        addVertex(bottomRight);\r\n        addVertex(topRight);\r\n        addVertex(bottomLeft);\r\n        addVertex(topLeft);\r\n        addVertex(bottomLeft);\r\n        addVertex(topRight);\r\n    }\r\n\r\n    const addFacetUvs = function (uLeft, vBottom, uRight, vTop) {\r\n        addUv(uRight, vBottom);\r\n        addUv(uRight, vTop);\r\n        addUv(uLeft, vBottom);\r\n        addUv(uLeft, vTop);\r\n        addUv(uLeft, vBottom);\r\n        addUv(uRight, vTop);\r\n    }\r\n\r\n    const addFace = function (bottomRight, bottomLeft, topLeft, uLeft, vBottom, uRight, vTop) {\r\n        for (var vFacet = 0; vFacet < facets; vFacet++) {\r\n            const vFracLow = vFacet / facets;\r\n            const vFracHigh = (vFacet + 1) / facets;\r\n\r\n            const vFacetBottom = (vTop - vBottom) * vFracLow + vBottom;\r\n            const vFacetTop = (vTop - vBottom) * vFracHigh + vBottom;\r\n\r\n            for (hFacet = 0; hFacet < facets; hFacet++) {\r\n                const hFracLow = hFacet / facets;\r\n                const hFracHigh = (hFacet + 1) / facets;\r\n\r\n                const Vector = window.frag.Vector;\r\n                const up = Vector.sub(corners[topLeft], corners[bottomLeft]);\r\n                const right = Vector.sub(corners[bottomRight], corners[bottomLeft]);\r\n\r\n                const facetBottomLeft = Vector.add(Vector.add(corners[bottomLeft], Vector.mult(right, hFracLow)), Vector.mult(up, vFracLow));\r\n                const facetBottomRight = Vector.add(Vector.add(corners[bottomLeft], Vector.mult(right, hFracHigh)), Vector.mult(up, vFracLow));\r\n                const facetTopLeft = Vector.add(Vector.add(corners[bottomLeft], Vector.mult(right, hFracLow)), Vector.mult(up, vFracHigh));\r\n                const facetTopRight = Vector.add(Vector.add(corners[bottomLeft], Vector.mult(right, hFracHigh)), Vector.mult(up, vFracHigh));\r\n\r\n                addFacetVerticies(facetBottomRight, facetTopRight, facetBottomLeft, facetTopLeft);\r\n\r\n                const uFacetLeft = (uRight - uLeft) * hFracLow + uLeft;\r\n                const uFacetRight = (uRight - uLeft) * hFracHigh + uLeft;\r\n\r\n                addFacetUvs(uFacetLeft, vFacetBottom, uFacetRight, vFacetTop);\r\n            }\r\n        }\r\n    }\r\n\r\n    if (options.duplicateTexture) {\r\n        if (options.drawFront) addFace(1, 0, 3, u4, v3, u0, v0); // front\r\n        if (options.drawBottom) addFace(4, 5, 0, u4, v3, u0, v0); // bottom\r\n        if (options.drawLeft) addFace(0, 5, 6, u4, v3, u0, v0); // left\r\n        if (options.drawRight) addFace(4, 1, 2, u4, v3, u0, v0); // right\r\n        if (options.drawBack) addFace(5, 4, 7, u4, v3, u0, v0); // back\r\n        if (options.drawTop) addFace(6, 7, 2, u4, v3, u0, v0); // top\r\n    } else {\r\n        if (options.drawFront) addFace(1, 0, 3, u1, v2, u0, v1); // front\r\n        if (options.drawBottom) addFace(4, 5, 0, u2, v2, u1, v1); // bottom\r\n        if (options.drawLeft) addFace(0, 5, 6, u2, v2, u1, v3); // left\r\n        if (options.drawRight) addFace(4, 1, 2, u1, v1, u2, v0); // right\r\n        if (options.drawBack) addFace(5, 4, 7, u2, v1, u3, v2); // back\r\n        if (options.drawTop) addFace(6, 7, 2, u3, v1, u4, v2); // top\r\n    }\r\n\r\n    return window.frag.MeshData().addTriangles(verticies, colors, uvs);\r\n};","window.frag.Cylinder = function (facets, options) {\r\n    facets = facets || 32;\r\n    options = options || {};\r\n\r\n    const top = [0, 0, -1];\r\n    const topUvs = [0.5, 0.5];\r\n    const topNormals = [0, 0, -1];\r\n    const topColors = options.color ? Array.from(options.color) : undefined;\r\n\r\n    const bottom = [0, 0, 1];\r\n    const bottomUvs = [0.5, 0.5];\r\n    const bottomNormals = [0, 0, 1];\r\n    const bottomColors = options.color ? Array.from(options.color) : undefined;\r\n\r\n    const side = [];\r\n    const sideColors = options.color ? [] : undefined;\r\n    const sideUvs = [];\r\n    const sideNormals = [];\r\n\r\n    const step = Math.PI * 2 / facets;\r\n\r\n    for (var i = 0; i <= facets; i++) {\r\n        const angle = -i * step;\r\n        const x = Math.sin(angle);\r\n        const y = Math.cos(angle);\r\n\r\n        top.push(x);\r\n        top.push(y);\r\n        top.push(-1);\r\n\r\n        if (options.color) \r\n            options.color.forEach(c => topColors.push(c));\r\n\r\n        topUvs.push((x + 1) * 0.5);\r\n        topUvs.push((y + 1) * 0.5);\r\n\r\n        topNormals.push(x);\r\n        topNormals.push(y);\r\n        topNormals.push(-1);\r\n\r\n        side.push(x);\r\n        side.push(y);\r\n        side.push(-1);\r\n        side.push(x);\r\n        side.push(y);\r\n        side.push(1);\r\n\r\n        if (options.color) {\r\n            options.color.forEach(c => sideColors.push(c));\r\n            options.color.forEach(c => sideColors.push(c));\r\n        }\r\n\r\n        sideUvs.push((x + 1) * 0.5);\r\n        sideUvs.push((y + 1) * 0.5);\r\n        sideUvs.push((x + 1) * 0.5);\r\n        sideUvs.push((y + 1) * 0.5);\r\n\r\n        sideNormals.push(x);\r\n        sideNormals.push(y);\r\n        sideNormals.push(0);\r\n        sideNormals.push(x);\r\n        sideNormals.push(y);\r\n        sideNormals.push(0);\r\n    }\r\n\r\n    for (var i = 0; i <= facets; i++) {\r\n        const angle = i * step;\r\n        const x = Math.sin(angle);\r\n        const y = Math.cos(angle);\r\n\r\n        bottom.push(x);\r\n        bottom.push(y);\r\n        bottom.push(1);\r\n\r\n        if (options.color) \r\n            options.color.forEach(c => bottomColors.push(c));\r\n\r\n        bottomUvs.push((x + 1) * 0.5);\r\n        bottomUvs.push((y + 1) * 0.5);\r\n\r\n        bottomNormals.push(x);\r\n        bottomNormals.push(y);\r\n        bottomNormals.push(1);\r\n    }\r\n\r\n    side.push(0);\r\n    side.push(1);\r\n    side.push(1);\r\n    \r\n    if (options.color) \r\n        options.color.forEach(c => sideColors.push(c));\r\n\r\n    sideUvs.push(0.5);\r\n    sideUvs.push(1);\r\n\r\n    sideNormals.push(0);\r\n    sideNormals.push(1);\r\n    sideNormals.push(0);\r\n\r\n    return window.frag.MeshData()\r\n        .addTriangleFan(top, topColors, topUvs, topNormals)\r\n        .addTriangleFan(bottom, bottomColors, bottomUvs, bottomNormals)\r\n        .addTriangleStrip(side, sideColors, sideUvs, sideNormals);\r\n};","window.frag.Disc = function (facets, options) {\r\n    facets = facets || 32;\r\n    options = options || {};\r\n\r\n    const verticies = [0, 0, 0];\r\n    const uvs = [0.5, 0.5];\r\n    const normals = [0, 0, -1];\r\n\r\n    const step = Math.PI * 2 / facets;\r\n\r\n    for (var i = 0; i <= facets; i++) {\r\n        const angle = -i * step;\r\n        const x = Math.sin(angle);\r\n        const y = Math.cos(angle);\r\n\r\n        verticies.push(x);\r\n        verticies.push(y);\r\n        verticies.push(0);\r\n\r\n        normals.push(0);\r\n        normals.push(0);\r\n        normals.push(-1);\r\n\r\n        uvs.push((x + 1) * 0.5);\r\n        uvs.push((y + 1) * 0.5);\r\n    }\r\n\r\n    return window.frag.MeshData().addTriangleFan(verticies, uvs, normals);\r\n};","window.frag.Plane = function (facets, options) {\r\n    facets = facets || 1;\r\n    options = options || {};\r\n\r\n    if (facets === 1) {\r\n        const c = options.color || [0, 0, 0];\r\n        const data = new Float32Array([\r\n            1, -1, 0, 1, 1, 0, -1, -1, 0, -1, 1, 0, // verticies\r\n            c[0], c[1], c[2], c[0], c[1], c[2], c[0], c[1], c[2], c[0], c[1], c[2],  // colors\r\n            1, 0, 1, 1, 0, 0, 0, 1, // uvs\r\n            0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, // normals \r\n            1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, // tangents\r\n            0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, // bitangents\r\n        ]);\r\n\r\n        return window.frag.MeshData().fromBuffer(\r\n            data.buffer, 3, 4, window.frag.gl.TRIANGLE_STRIP,\r\n            0 * Float32Array.BYTES_PER_ELEMENT,\r\n            12 * Float32Array.BYTES_PER_ELEMENT,\r\n            24 * Float32Array.BYTES_PER_ELEMENT,\r\n            32 * Float32Array.BYTES_PER_ELEMENT,\r\n            44 * Float32Array.BYTES_PER_ELEMENT,\r\n            56 * Float32Array.BYTES_PER_ELEMENT,\r\n        );\r\n    }\r\n \r\n    const verticies = [];\r\n    const uvs = [];\r\n    const normals = [];\r\n    const colors = options.color ? [] : undefined;\r\n\r\n    const add = function (x, y) {\r\n        verticies.push(x);\r\n        verticies.push(y);\r\n        verticies.push(0);\r\n\r\n        if (options.color)\r\n            options.color.forEach(c => colors.push(c));\r\n\r\n        uvs.push((x + 1) * 0.5);\r\n        uvs.push((y + 1) * 0.5);\r\n\r\n        normals.push(0);\r\n        normals.push(0);\r\n        normals.push(-1);\r\n    }\r\n\r\n    for (var row = 0; row < facets; row++) {\r\n        const y0 = (facets - row - 1) * 2 / facets - 1;\r\n        const y1 = (facets - row) * 2 / facets - 1;\r\n        const evenRow = (row & 1) === 0;\r\n\r\n        if (evenRow) {\r\n            add(1, y0);\r\n            for (var column = 0; column < facets; column++) {\r\n                const x0 = (facets - column - 1) * 2 / facets - 1;\r\n                const x1 = (facets - column) * 2 / facets - 1;\r\n                add(x1, y1);\r\n                add(x0, y0);\r\n            }\r\n            add(-1, y1);\r\n        } else {\r\n            add(-1, y1);\r\n            for (var column = 0; column < facets; column++) {\r\n                const x0 = column * 2 / facets - 1;\r\n                const x1 = (column + 1) * 2 / facets - 1;\r\n                add(x0, y0);\r\n                add(x1, y1);\r\n            }\r\n            add(1, y0);\r\n        }\r\n    }\r\n\r\n    return window.frag.MeshData().addTriangleStrip(verticies, colors, uvs, normals);\r\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","require(\"./Math/Vector\");\r\nrequire(\"./Math/Triangle\");\r\nrequire(\"./Math/Matrix\");\r\n\r\nrequire(\"./Framework/Init\");\r\nrequire(\"./Framework/Observable\");\r\nrequire(\"./Framework/Transform\");\r\nrequire(\"./Framework/Transform2D\");\r\nrequire(\"./Framework/Location\");\r\nrequire(\"./Framework/Framework\");\r\n\r\nrequire(\"./Shaders/CustomShader\");\r\nrequire(\"./Shaders/Shader\");\r\nrequire(\"./Shaders/UiShader\");\r\nrequire(\"./Shaders/FontShader\");\r\n\r\nrequire(\"./Materials/Texture\");\r\nrequire(\"./Materials/Font\");\r\nrequire(\"./Materials/Material\");\r\n\r\nrequire(\"./SceneGraph/VertexData\");\r\nrequire(\"./SceneGraph/MeshData\");\r\nrequire(\"./SceneGraph/MeshOptimizer\");\r\nrequire(\"./SceneGraph/Model\");\r\nrequire(\"./SceneGraph/ScenePosition\");\r\nrequire(\"./SceneGraph/SceneObject\");\r\nrequire(\"./SceneGraph/Scene\");\r\n\r\nrequire(\"./Cameras/UiCamera\");\r\nrequire(\"./Cameras/OrthographicCamera\");\r\nrequire(\"./Cameras/PerspectiveCamera\");\r\n\r\nrequire(\"./Animations/Animation\");\r\nrequire(\"./Animations/ObjectAnimationState\");\r\nrequire(\"./Animations/ModelAnimation\");\r\nrequire(\"./Animations/SceneObjectAnimation\");\r\nrequire(\"./Animations/ValueAnimationAction\");\r\nrequire(\"./Animations/KeyframeAnimationAction\");\r\nrequire(\"./Animations/ParallelAnimationAction\");\r\nrequire(\"./Animations/RepeatAnimationAction\");\r\nrequire(\"./Animations/PositionAnimationAction\");\r\n\r\nrequire(\"./Shapes/Cube\");\r\nrequire(\"./Shapes/Cylinder\");\r\nrequire(\"./Shapes/Disc\");\r\nrequire(\"./Shapes/Plane\");\r\n\r\nrequire(\"./Loaders/AssetCatalog\");\r\nrequire(\"./Loaders/MaterialLoader\");\r\nrequire(\"./Loaders/PackageLoader\");\r\n\r\nrequire(\"./Input/HitTest\");\r\nrequire(\"./Input/InputMethod\");\r\nrequire(\"./Input/DigitalState\");\r\nrequire(\"./Input/AnalogState\");\r\nrequire(\"./Input/DigitalInput\");\r\nrequire(\"./Input/AnalogInput\");\r\nrequire(\"./Input/DigitalAction\");\r\nrequire(\"./Input/AnalogAction\");\r\n"],"sourceRoot":""}