<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' lang='en-US'>
<head>
    <title>Multiple engines</title>
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .scene {
            width: 40vw;
            height: 90vh;
            touch-action: none;
            display: inline-block;
            border: 2px solid darkgrey;
            margin: 15px;
        }
    </style>
</head>
<body>
    <canvas id='scene1' class='scene'></canvas>
    <canvas id='scene2' class='scene'></canvas>
    <script src='frag.min.js'></script>
    <script>
        const degToRad = Math.PI / 180;

        /*************************************
         * Shared code
        **************************************/

        const setupEnvironment = function (elementId) {
            const engine = window.frag.Engine({ canvas: document.getElementById(elementId) }).start();
            const camera = engine.PerspectiveCamera().frustrum(35 * degToRad, -100, 100).scaleX(100).moveToZ(-120);
            const scene = engine.Scene().camera(camera);
            engine.mainScene(scene);
            const shader = frag.Shader(engine).colorsRGB().directionalLightGrey().compile();
            return { engine, scene, shader };
        }

        const setupInputs = function (env) {
            const panXState = env.engine.AnalogState(
                env.engine.AnalogAction("move-camera-x"), { minValue: 100, maxValue: -100 });

            const panYState = env.engine.AnalogState(
                env.engine.AnalogAction("move-camera-y"), { minValue: -100, maxValue: 100 });

            env.engine.AnalogInput("left-pointer-horizontal", panXState).enable();
            env.engine.AnalogInput("left-pointer-vertical", panYState).enable();
        }

        const spinningCube = function (env, color, duration) {
            const engine = env.engine;
            const scene = env.scene;
            const shader = env.shader;

            const mesh = engine.Cube(1, { color })
            const model = engine.Model().mesh(mesh).shader(shader).shadeFlat();

            const cube = engine.SceneObject(model);
            cube.getPosition().scale(40);
            scene.addObject(cube);

            const spinningAnimation = frag.Animation(engine)
                .perform(
                    frag.ValueAnimationAction(engine)
                        .setDuration(duration)
                        .onStep((a, r) => {
                            const angle = Math.PI * 2 * r;
                            cube.getPosition().rotateXYZ(angle, -angle, 0)
                        }),
                    true)
                .start();
            return cube;
        }

        /*************************************
         * Scene 1 
        **************************************/
        const env1 = setupEnvironment("scene1");
        spinningCube(env1, [0.8, 0.1, 0.4], 2000);
        setupInputs(env1);

        /*************************************
         * Scene 2
        **************************************/
        const env2 = setupEnvironment("scene2");
        spinningCube(env2, [0.1, 0.8, 0.4], 1500);
        setupInputs(env2);

    </script>
</body>
