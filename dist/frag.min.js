(()=>{var t={6627:()=>{window.frag.Animation=function(e,t,n){const r={stopAfter:0,isRunning:!1},i=t||{};i.__private=r;const a=100;return i.dispose=function(){e.removeAnimation(i)},i.getIsRunning=function(){return r.isRunning},i.setDuration=function(e){return i.duration=e,i},i.setInterval=function(e){return i.interval=e,i},i.action=function(t,n,o){if(void 0!==r.stopAfter&&(r.stopAt=n+r.stopAfter,delete r.stopAfter),void 0!==r.stopAt&&n>=r.stopAt){if(r.sequence){let e=r.sequence[r.sequenceIndex];e&&e.stop&&e.stop(i,n)}return e.deactivateAnimation(i),r.disposeOnStop&&i.dispose(),void(r.isRunning=!1)}if(r.sequence){let e=r.sequence[r.sequenceIndex];r.nextStepTick?n>=r.nextStepTick&&(e.stop&&e.stop(i,n),r.sequenceIndex++,r.sequenceIndex===r.sequence.length?r.autoRestart?(r.sequenceIndex=0,e=r.sequence[r.sequenceIndex],e.start&&e.start(i,n),r.nextStepTick=n+(e.duration||a)):r.stopAt=n:(e=r.sequence[r.sequenceIndex],e.start&&e.start(i,n),i.interval=e.interval,r.nextStepTick=n+(e.duration||a))):(e.start&&e.start(i,n),r.nextStepTick=n+(e.duration||a)),r.action=e.action,i.nextGameTick=n+(e.interval||5)}else void 0!==r.frameRepeat?i.nextFrameTick=o+r.frameRepeat:void 0!==r.tickRepeat&&(i.nextGameTick=n+r.tickRepeat);r.action&&r.action(i,n,o)},i.sequence=function(e,t){Array.isArray(e)?r.sequence=e:r.sequence=[e],r.sequenceIndex=0,r.autoRestart=t;let n=0;for(let e=0;e<r.sequence.length;e++){const t=r.sequence[e];void 0!==t.duration?n+=t.duration:n+=a}return i.duration=n,i},i.perform=function(e,t){return i.sequence(e,t)},i.start=function(){return delete r.nextStepTick,delete r.stopAfter,delete r.stopAt,e.activateAnimation(i),r.isRunning=!0,i},i.stop=function(){return r.stopAfter=0,i},i.repeatTicks=function(e,t){return delete r.autoRestart,delete r.frameRepeat,delete r.sequence,r.tickRepeat=t||e.interval||20,r.action=e,i},i.repeatFrames=function(e,t){return delete r.autoRestart,delete r.tickRepeat,delete r.sequence,r.frameRepeat=t||1,r.action=e,i},i.stopAfter=function(e){return r.stopAfter=e,delete r.stopAt,i},i.disposeOnStop=function(e){return r.disposeOnStop=void 0===e||e,i},n||e.addAnimation(i),i}},4600:()=>{window.frag.KeyframeAnimationAction=function(e){const t={startTick:void 0,currentFrame:void 0,keyframes:{}},n={__private:t,interval:10,frames:100,start:function(e,r){return t.startTick=r,t.currentFrame=-1,n},action:function(e,r){let i=Math.floor((r-t.startTick)/n.interval);for(;t.currentFrame<i;){t.currentFrame++;const e=t.keyframes[t.currentFrame];if(e)for(let n=0;n<e.length;n++)e[n].action(t.currentFrame,e[n].data,r)}return n},setFrames:function(e,t){return n.interval=e,n.frames=t||n.frames,n.duration=n.interval*n.frames,n},add:function(e,r,i){let a=t.keyframes[e];return a||(a=[],t.keyframes[e]=a),a.push({action:r,data:i}),n},dispose:function(){}};return n}},4544:()=>{window.frag.ModelAnimation=function(e){const t={loop:!1,interval:10,frames:50,channelGraphs:[],name:""},n={__private:t,getChannelGraphs:function(){return t.channelGraphs},name:function(e){return t.name=e,n},getName:function(){return t.name},loop:function(e){return t.loop=e,n},getLoop:function(){return t.loop},interval:function(e){return t.interval=e,n},getInterval:function(){return t.interval},frames:function(e){return t.frames=e,n},getFrames:function(){return t.frames}},r=function(e){const n=[];let r;n.length=t.frames;let i=0;for(let a=0;a<t.frames;a++){const t=e[a];if(void 0!==t){if(r=t.value,"linear"===t.transition){const e=n[i],t=(r-e)/(a-i);for(let r=i+1;r<a;r++)n[r]=e+(r-i)*t}i=a}n[a]=r}return n};return n.addChannel=function(e){t.channelGraphs.push({pattern:e.pattern,channel:e.channel,frameValues:r(e.keyframes)})},n.dispose=function(){},n}},9023:()=>{window.frag.ObjectAnimationState=function(e){const t={__private:{},location:window.frag.Location(e),getMatrix:function(){return t.location.getMatrix()},getUpdateFunction:function(e){switch(e){case"translate-x":return function(e){t.location.translateX=e,t.location.isModified=!0};case"translate-y":return function(e){t.location.translateY=e,t.location.isModified=!0};case"translate-z":return function(e){t.location.translateZ=e,t.location.isModified=!0};case"scale-x":return function(e){t.location.scaleX=e,t.location.isModified=!0};case"scale-y":return function(e){t.location.scaleY=e,t.location.isModified=!0};case"scale-z":return function(e){t.location.scaleZ=e,t.location.isModified=!0};case"rotate-x":return function(e){t.location.rotateX=e,t.location.isModified=!0};case"rotate-y":return function(e){t.location.rotateY=e,t.location.isModified=!0};case"rotate-z":return function(e){t.location.rotateZ=e,t.location.isModified=!0}}return console.warn("Unsupported animation channel "+e),function(){}},dispose:function(){}};return t}},9622:()=>{window.frag.ParallelAnimationAction=function(e,t){const n={actions:t},r={__private:n,duration:30,interval:5,setDuration:function(e){return r.duration=e,r},setInterval:function(e){return r.interval=e,r},start:function(e,t){return n.actions.forEach((n=>{n.start&&n.start(e,t)})),r},action:function(e,t){return n.actions.forEach((n=>{n.action&&n.action(e,t)})),r},stop:function(e,t){n.actions.forEach((n=>{n.stop&&n.stop(e,t)}))},dispose:function(){}};return r}},2201:()=>{window.frag.PositionAnimationAction=function(e,t,n,r){const i=window.frag.Vector,a={scenePosition:t,invLinearVelocity:n,invAngularVelocity:r,startLocation:void 0,startRotate:void 0,moveBy:void 0,rotateBy:void 0,moveTo:void 0,rotateTo:void 0},o={__private:a,setInterval:function(e){return o.interval=e,o},moveBy:function(e,t){t=t||a.invLinearVelocity||1;let n=i.length(e);return o.duration=Math.floor(t*n+1),a.moveBy=e,o},moveTo:function(e,t){return t&&(a.invAngularVelocity=void 0),a.invLinearVelocity=t||a.invLinearVelocity||1,a.moveTo=e,o},rotateBy:function(e,t){t=t||a.invAngularVelocity||10;let n=i.length(e);return o.duration=Math.floor(t*n+1),a.rotateBy=e,o},rotateTo:function(e,t){return t&&(a.invLinearVelocity=void 0),a.invAngularVelocity=t||a.invAngularVelocity||10,a.rotateTo=e,o},moveByXYZ:function(e,t,n,r){return o.moveBy([e,t,n],r)},moveByXY:function(e,t,n){return o.moveBy([e,t,0],n)},moveToXYZ:function(e,t,n,r){return o.moveTo([e,t,n],r)},moveToXY:function(e,t,n){return o.moveTo([e,t,0],n)},rotateByXYZ:function(e,t,n,r){return o.rotateBy([e,t,n],r)},rotateByXY:function(e,t,n){return o.rotateBy([e,t,0],n)},rotateToXYZ:function(e,t,n,r){return o.rotateTo([e,t,n],r)},rotateToXY:function(e,t,n){return o.rotateTo([e,t,0],n)},onStart:function(e){return a.onStart=e,o},onStop:function(e){return a.onStop=e,o},start:function(e,t){if(a.startLocation=a.scenePosition.getLocation(),a.startRotate=a.scenePosition.getRotate(),a.rotateTo&&a.invAngularVelocity){a.rotateDelta=function(e,t){const n=i.sub(e,t);for(let e=0;e<n.length;e++){for(;n[e]<-Math.PI;)n[e]+=2*Math.PI;for(;n[e]>Math.PI;)n[e]-=2*Math.PI}return n}(a.rotateTo,a.startRotate);const e=i.length(a.rotateDelta);o.duration=Math.floor(a.invAngularVelocity*e+1)}if(a.moveTo&&a.invLinearVelocity){a.moveDelta=(n=a.moveTo,r=a.startLocation,i.sub(n,r));const e=i.length(a.moveDelta);o.duration=Math.floor(a.invLinearVelocity*e+1)}var n,r;return a.startTick=t,a.endTick=t+o.duration,a.onStart&&a.onStart(e,o,t),o},action:function(e,t){const n=(t-a.startTick)/o.duration;let r=a.moveBy,s=a.rotateBy;return a.moveDelta&&(r=a.moveDelta),a.rotateDelta&&(s=a.rotateDelta),r&&a.scenePosition.location(i.add(a.startLocation,i.mult(r,n))),s&&a.scenePosition.rotate(i.add(a.startRotate,i.mult(s,n))),o},stop:function(e,t){return a.onStop&&a.onStop(e,o,t),o},dispose:function(){o.stop()}};return o}},666:()=>{window.frag.RepeatAnimationAction=function(e,t,n){return{duration:t.duration*n,interval:t.interval,start:t.start,stop:t.stop,action:t.action,dispose:function(){}}}},3890:()=>{window.frag.SceneObjectAnimation=function(e,t,n){const r=t.modelAnimation,i=t.childAnimations,a=[];for(let e=0;e<i.length;e++){const t=i[e],r=t.model.getName();if(animationState=n[r],animationState){const e=t.graph,n=animationState.getUpdateFunction(e.channel);a.push((function(t){n(e.frameValues[t])}))}}const o=function(e){for(let t=0;t<a.length;t++)a[t](e)},s=window.frag.KeyframeAnimationAction(e).setFrames(r.getInterval(),r.getFrames());for(let e=0;e<r.getFrames();e++)s.add(e,o);return window.frag.Animation(e).perform(s,r.getLoop())}},9889:()=>{window.frag.ValueAnimationAction=function(e){const t={},n={__private:t,duration:30,interval:5,setDuration:function(e){return n.duration=e,n},setInterval:function(e){return n.interval=e,n},onStart:function(e){return t.onStart=e,n},onStop:function(e){return t.onStop=e,n},onStep:function(e){return t.onStep=e,n},start:function(e,r){return t.startTick=r,t.endTick=r+n.duration,t.onStart&&t.onStart(e,n,r),n},action:function(e,r){if(t.onStep){const i=(r-t.startTick)/n.duration;t.onStep(e,i,n,r)}return n},stop:function(e,r){return t.onStop&&t.onStop(e,n,r),n},dispose:function(){n.stop()}};return n}},2588:()=>{window.frag.FrustumCamera=function(e){const t={zNear:100,zFar:200,xScale:100},n={};return window.frag.cameraMixin(e,t,n),n.frustum=function(e,r,i){return r<=0&&console.error("You cannot include things that are behind the camera in the cameras field of view. zNear must be greater than zero"),r>=i&&console.error("The camera zFar must be greater than zNear"),e<=0&&console.error("Camera x-scale must be greater than zero"),t.xScale=e,t.zNear=r,t.zFar=i,t.frustumChanged=!0,n},t.updateFrustum=function(){t.frustumChanged&&(t.projectionMatrix=window.frag.Matrix.frustum(-t.xScale,t.xScale,-t.xScale/t.aspectRatio,t.xScale/t.aspectRatio,t.zNear,t.zFar),t.frustumChanged=!1,t.transformChanged=!0)},n}},3014:()=>{window.frag.OrthographicCamera=function(e){const t={zNear:100,zFar:200,xScale:100},n={};return window.frag.cameraMixin(e,t,n),n.frustum=function(e,r,i){return r<=0&&console.error("You cannot include things that are behind the camera in the cameras field of view. zNear must be greater than zero"),r>=i&&console.error("The camera zFar must be greater than zNear"),e<=0&&console.error("Camera x-scale must be greater than zero"),t.xScale=e,t.zNear=r,t.zFar=i,t.frustumChanged=!0,n},t.updateFrustum=function(){t.frustumChanged&&(t.projectionMatrix=window.frag.Matrix.orthographic(-t.xScale,t.xScale,-t.xScale/aspectRatio,t.xScale/aspectRatio,t.zNear,t.zFar),t.frustumChanged=!1,t.transformChanged=!0)},n}},3906:()=>{window.frag.PerspectiveCamera=function(e){const t={fov:45*Math.PI/180,zNear:100,zFar:200,aspectRatio:1},n={};return window.frag.cameraMixin(e,t,n),n.frustum=function(e,r,i){return e<=0&&console.error("Camera field of view must be greater than zero"),e>=.5*Math.PI&&console.error("Camera field of view must be less than 90 degrees"),r<=0&&console.error("You cannot include things that are behind the camera in the cameras field of view. zNear must be greater than zero"),r>=i&&console.error("The camera zFar must be greater than zNear"),t.fov=e,t.zNear=r,t.zFar=i,t.frustumChanged=!0,n},t.updateFrustum=function(){t.frustumChanged&&(t.projectionMatrix=window.frag.Matrix.perspective(t.fieldOfView,t.aspectRatio,t.zNear,t.zFar),t.frustumChanged=!1,t.transformChanged=!0)},n}},3270:()=>{window.frag.UiCamera=function(e){const t={aspectRatio:1},n={worldToClipTransform:window.frag.Transform2D(e).identity(),scaleX:function(e){var r=n.worldToClipTransform.getMatrix();return r[0]=1/e,n.worldToClipTransform.setMatrix(r),t.aspectRatio=-1,n},setViewport:function(){const t=e.gl;return t.viewport(0,0,t.canvas.clientWidth,t.canvas.clientHeight),t.canvas.width=t.canvas.clientWidth,t.canvas.height=t.canvas.clientHeight,n.adjustToViewport()},adjustToViewport:function(){const r=e.gl,i=r.drawingBufferWidth/r.drawingBufferHeight;if(t.aspectRatio!=i){const e=n.worldToClipTransform.getMatrix();e[4]=e[0]*i,n.worldToClipTransform.setMatrix(e),t.aspectRatio=i}return n},dispose:function(){}};return n}},6611:()=>{window.frag.cameraMixin=function(e,t,n){t.worldTransform=window.frag.Transform3D(e),t.position=window.frag.ScenePosition(e),t.parentPosition=null,t.parentLocation=null,t.projectionMatrix=null,t.worldMatrix=null,t.transformChanged=!0,t.positionChanged=!0,t.frustumChanged=!0,t.aspectRatio=1,n.__private=t,n.worldToClipTransform=window.frag.Transform3D(e),n.dispose=function(){n.parent(null),t.position.observableLocation.unsubscribe(t.onPositionChanged),t.worldToClipTransform.dispose(),t.position.dispose()},t.onPositionChanged=function(){t.positionChanged=!0},t.position.observableLocation.subscribe(t.onPositionChanged),n.getPosition=function(){return t.position},t.updateAspect=function(){const n=e.gl.drawingBufferWidth/e.gl.drawingBufferHeight;n!==t.aspectRatio&&(t.aspectRatio=n,t.frustumChanged=!0)},t.updateWorld=function(){if(t.positionChanged){let e=t.position.getMatrix();if(t.parentLocation){const n=t.parentLocation.getMatrix();e=window.frag.Matrix.m4Xm4(n,e)}t.worldMatrix=window.frag.Matrix.m4Invert(e),t.positionChanged=!1,t.transformChanged=!0}},n.setViewport=function(){const t=e.gl;return t.viewport(0,0,t.canvas.clientWidth,t.canvas.clientHeight),t.canvas.width=t.canvas.clientWidth,t.canvas.height=t.canvas.clientHeight,n.adjustToViewport()},n.adjustToViewport=function(){e.gl;const r=window.frag.Matrix;return t.updateAspect(),t.updateFrustum(),t.updateWorld(),t.transformChanged&&(n.worldToClipTransform.setMatrix(r.m4Xm4(t.projectionMatrix,t.worldMatrix)),t.transformChanged=!1),n},t.parentPositionChanged=function(e){t.parentLocation=e,t.positionChanged=!0},n.parent=function(e){return t.parentPosition&&t.parentPosition.observableLocation.unsubscribe(t.parentPositionChanged),e&&e.getPosition&&(e=e.getPosition()),t.parentPosition=e,e?e.observableLocation.subscribe(t.parentPositionChanged):t.parentPositionChanged(null),n}}},1264:()=>{window.frag.DynamicData=function(e,t,n){const r={width:t,depth:n,data:[]};for(let e=0;e<t*n;e++)r.data.push({height:0,material:null,uniforms:null});return{__private:r,dispose:function(){},get:function(e,t){return r.data[e*r.depth+t]},getWidth:function(){return r.width},getDepth:function(){return r.depth}}}},5854:()=>{window.frag.DynamicSurface=function(e,t){const n={data:t,tiles:[],meshFragments:[],mesh:null,location:window.frag.Location(e,!0),position:null,enabled:!0,shader:null,fragmentsModified:!0,width:0,depth:0,originX:0,originZ:0};n.position=window.frag.ScenePosition(e,n.location);const r={__private:n,isDynamicSurface:!0};return n.tileAt=function(e,t){return n.tiles[e*n.depth+t]},n.getOffset=function(e){return{x:Math.floor(e/n.depth),z:e%n.depth}},n.sanitizeX=function(e){if(e<0)return 0;const r=t.getWidth()-n.width;return e>=r?r:Math.floor(e)},n.sanitizeZ=function(e){if(e<0)return 0;const r=t.getDepth()-n.depth;return e>=r?r:Math.floor(e)},n.updateMeshFragments=function(){for(let t=0;t<n.tiles.length;t++){const r=n.tiles[t],i=n.meshFragments[t];i.material=r.getMaterial(),i.uniforms=r.getUniforms();const a=i.vertexData;for(var e=0;e<r.sharedVerticies.length;e++){const t=a.getVertexVector(e);t[1]=r.sharedVerticies[e].getHeight(),a.setVertexVector(e,t)}}n.mesh.fragmentsUpdated()},n.logDebugInfo=function(){const e=function(e){return Math.floor(1e3*e)/1e3};for(let t=0;t<n.width;t++)for(let r=0;r<n.depth;r++){const i=n.tileAt(t,r);console.log("Tile ["+t+","+r+"]","x="+i.getX(),"z="+i.getZ(),"h="+e(i.getHeight()));for(let t=0;t<i.sharedVerticies.length;t++){const n=i.sharedVerticies[t],r=n.__private.tiles;let a="  V"+t+" h="+e(n.getHeight());if(1===r.length){a+=" from ";const t=n.__private.tiles[0];a+="T["+t.getX()+","+t.getZ()+"] h="+e(t.getHeight())}else{a+=" average(";for(let t=0;t<r.length;t++){const r=n.__private.tiles[t];t>0&&(a+=", "),a+="T["+r.getX()+","+r.getZ()+"] h="+e(r.getHeight())}a+=")"}console.log(a)}}},n.createHorizontalHexagons=function(){const t=Math.sqrt(3),r=-.5*n.width*1.5,i=-.5*n.depth*t,a=[.5,.5,0,.5,.25,0,.75,0,1,.5,.75,1,.25,1,0,.5],o=[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0];for(let s=0;s<n.width;s++){const c=s%2;for(let l=0;l<n.depth;l++){const u=window.frag.DynamicTile(e).dynamicData(n.data).x(s).z(l);n.tiles.push(u);const f=r+1.5*s,d=i+l*t-c*t*.5,m=[f,0,d,f-1,0,d,f-.5,0,d-.5*t,f+.5,0,d-.5*t,f+1,0,d,f+.5,0,d+.5*t,f-.5,0,d+.5*t,f-1,0,d],g=n.mesh.addTriangleFan({verticies:m,uvs:a,normals:o});n.meshFragments.push(g)}}for(let t=0;t<n.width;t++){const r=t%2,i=(t+1)%2;for(let a=0;a<n.depth;a++){const o=n.tileAt(t,a);if(o.sharedVerticies=[window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o)],t>0){if(a>=i){const e=n.tileAt(t-1,a-i);o.sharedVerticies[1].addTile(e),o.sharedVerticies[2].addTile(e),o.sharedVerticies[7].addTile(e)}if(a<n.depth-r){const e=n.tileAt(t-1,a+r);o.sharedVerticies[1].addTile(e),o.sharedVerticies[6].addTile(e),o.sharedVerticies[7].addTile(e)}}if(t<n.width-1){if(a>=i){const e=n.tileAt(t+1,a-i);o.sharedVerticies[3].addTile(e),o.sharedVerticies[4].addTile(e)}if(a<n.depth-r){const e=n.tileAt(t+1,a+r);o.sharedVerticies[4].addTile(e),o.sharedVerticies[5].addTile(e)}}if(a>0){const e=n.tileAt(t,a-1);o.sharedVerticies[2].addTile(e),o.sharedVerticies[3].addTile(e)}if(a<n.depth-1){const e=n.tileAt(t,a+1);o.sharedVerticies[5].addTile(e),o.sharedVerticies[6].addTile(e)}}}},n.createVerticalHexagons=function(){const t=Math.sqrt(3),r=-.5*n.width*1.5,i=-.5*n.depth*t,a=[.5,.5,0,.5,.25,0,.75,0,1,.5,.75,1,.25,1,0,.5],o=[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0];for(let s=0;s<n.width;s++){const c=s%2;for(let l=0;l<n.depth;l++){const u=window.frag.DynamicTile(e).dynamicData(n.data).x(s).z(l);n.tiles.push(u);const f=r+1.5*s,d=i+l*t-c*t*.5,m=[f,0,d,f-1,0,d,f-.5,0,d-.5*t,f+.5,0,d-.5*t,f+1,0,d,f+.5,0,d+.5*t,f-.5,0,d+.5*t,f-1,0,d],g=n.mesh.addTriangleFan({verticies:m,uvs:a,normals:o});n.meshFragments.push(g)}}for(let t=0;t<n.width;t++){const r=t%2,i=(t+1)%2;for(let a=0;a<n.depth;a++){const o=n.tileAt(t,a);if(o.sharedVerticies=[window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o)],t>0){if(a>=i){const e=n.tileAt(t-1,a-i);o.sharedVerticies[1].addTile(e),o.sharedVerticies[2].addTile(e),o.sharedVerticies[7].addTile(e)}if(a<n.depth-r){const e=n.tileAt(t-1,a+r);o.sharedVerticies[1].addTile(e),o.sharedVerticies[6].addTile(e),o.sharedVerticies[7].addTile(e)}}if(t<n.width-1){if(a>=i){const e=n.tileAt(t+1,a-i);o.sharedVerticies[3].addTile(e),o.sharedVerticies[4].addTile(e)}if(a<n.depth-r){const e=n.tileAt(t+1,a+r);o.sharedVerticies[4].addTile(e),o.sharedVerticies[5].addTile(e)}}if(a>0){const e=n.tileAt(t,a-1);o.sharedVerticies[2].addTile(e),o.sharedVerticies[3].addTile(e)}if(a<n.depth-1){const e=n.tileAt(t,a+1);o.sharedVerticies[5].addTile(e),o.sharedVerticies[6].addTile(e)}}}},r.dispose=function(){},r.enabled=function(e){n.enabled=e},r.getLocation=function(){return n.location},r.getPosition=function(){return n.position},r.getMesh=function(){return n.mesh},r.shader=function(e){return n.shader=e,r},r.getShader=function(){return n.shader},r.setOrigin=function(t,r){if(t=n.sanitizeX(t),r=n.sanitizeZ(r),t!==n.originX||r!==n.originZ){n.originX=t,n.originZ=r;for(let e=0;e<n.tiles.length;e++){const i=n.getOffset(e);n.tiles[e].x(i.x+t).z(i.z+r)}n.fragmentsModified=!0,e.debugDynamicSurface&&n.logDebugInfo()}},r.dataModified=function(){return n.fragmentsModified=!0,e.debugDynamicSurface&&n.logDebugInfo(),r},r.createSquares=function(t,i){n.tiles.length=0,n.meshFragments.length=0,n.mesh=window.frag.Mesh(e),n.width=t,n.depth=i;const a=-t,o=-i,s=[1,0,1,1,0,0,0,1],c=[0,1,0,0,1,0,0,1,0,0,1,0];for(let r=0;r<t;r++)for(let t=0;t<i;t++){const i=window.frag.DynamicTile(e).dynamicData(n.data).x(r).z(t);n.tiles.push(i);const l=a+2*r,u=o+2*t,f=[l+1,0,u-1,l+1,0,u+1,l-1,0,u-1,l-1,0,u+1],d=n.mesh.addTriangleStrip({verticies:f,uvs:s,normals:c});n.meshFragments.push(d)}for(let r=0;r<t;r++)for(let a=0;a<i;a++){const o=n.tileAt(r,a);if(o.sharedVerticies=[window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o),window.frag.SharedVertex(e).addTile(o)],0!==r){let e=n.tileAt(r-1,a);o.sharedVerticies[2].addTile(e),o.sharedVerticies[3].addTile(e),0!==a&&(e=n.tileAt(r-1,a-1),o.sharedVerticies[2].addTile(e)),a!==i-1&&(e=n.tileAt(r-1,a+1),o.sharedVerticies[3].addTile(e))}if(r!==t-1){let e=n.tileAt(r+1,a);o.sharedVerticies[0].addTile(e),o.sharedVerticies[1].addTile(e),0!==a&&(e=n.tileAt(r+1,a-1),o.sharedVerticies[0].addTile(e)),a!==i-1&&(e=n.tileAt(r+1,a+1),o.sharedVerticies[1].addTile(e))}if(0!==a){let e=n.tileAt(r,a-1);o.sharedVerticies[0].addTile(e),o.sharedVerticies[2].addTile(e)}if(a!==i-1){let e=n.tileAt(r,a+1);o.sharedVerticies[1].addTile(e),o.sharedVerticies[3].addTile(e)}}return e.debugDynamicSurface&&n.logDebugInfo(),r},r.createHexagons=function(t,i,a){return n.tiles.length=0,n.meshFragments.length=0,n.mesh=window.frag.Mesh(e),n.width=t,n.depth=i,a?n.createVerticalHexagons():n.createHorizontalHexagons(),e.debugDynamicSurface&&n.logDebugInfo(),r},r.draw=function(e){return n.enabled&&n.mesh?(n.fragmentsModified&&(n.updateMeshFragments(),n.fragmentsModified=!1),e.beginSceneObject(r),n.mesh.draw(e,(function(e,t){return n.tiles[t]})),e.endSceneObject(),r):r},r}},922:()=>{window.frag.DynamicTile=function(e){const t={dynamicData:null,tileData:null,x:0,z:0,modified:!0},n={__private:t,isDynamicTile:!0,sharedVerticies:[]};return t.update=function(){t.modified&&(t.tileData=t.dynamicData.get(t.x,t.z),t.modified=!1)},n.dispose=function(){},n.dynamicData=function(e){return t.dynamicData=e,t.modified=!0,n},n.x=function(e){return t.x=e,t.modified=!0,n},n.getX=function(){return t.x},n.z=function(e){return t.z=e,t.modified=!0,n},n.getZ=function(){return t.z},n.getData=function(){return t.update(),t.tileData},n.getMaterial=function(){return t.update(),t.tileData.material},n.getHeight=function(){return t.update(),t.tileData.height},n.getUniforms=function(){return t.update(),t.tileData.uniforms},n}},4765:()=>{window.frag.SharedVertex=function(e){const t={tiles:[]},n={__private:t,dispose:function(){},clear:function(){return t.tiles.length=0,n},addTile:function(e){return t.tiles.push(e),n},getHeight:function(){return t.tiles.reduce((function(e,t){return e+t.getHeight()}),0)/t.tiles.length}};return n}},3163:()=>{window.frag=window.frag||{},window.frag.Engine=function(e){e=e||{};const t={startFunctions:[],scenes:[],activeAnimations:{},inactiveAnimations:{},running:!1,startTime:performance.now(),gameTick:0,frameTick:0,mainScene:null,nextAnimationId:0,currentFrameCount:0,frameCounts:[],frameCountsSum:0,nextFpsPush:0,hitTestShader:null,nextTextureUnit:0},n={__private:t,isEngine:!0,isRendering:!1,canvas:e.canvas||document.getElementById("scene"),renderInterval:e.renderInterval||15,gameTickMs:e.gameTickMs||10,debugPackageLoader:void 0!==e.debugPackageLoader&&e.debugPackageLoader,debugShaderBuilder:void 0!==e.debugShaderBuilder&&e.debugShaderBuilder,debugAnimations:void 0!==e.debugAnimations&&e.debugAnimations,debugMeshes:void 0!==e.debugMeshes&&e.debugMeshes,debugInputs:void 0!==e.debugInputs&&e.debugInputs,debugParticles:void 0!==e.debugParticles&&e.debugParticles,debugConstructors:void 0!==e.debugConstructors&&e.debugConstructors,debugDynamicSurface:void 0!==e.debugDynamicSurface&&e.debugDynamicSurface,transparency:void 0!==e.transparency&&e.transparency,fps:0};n.gl=n.canvas.getContext("webgl"),n.maxTextureUnits=n.gl.getParameter(n.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),n.correctClock=function(e){let r=e-t.gameTick;r>0?t.startTime+=n.gameTickMs:r<0&&(t.startTime-=n.gameTickMs)},n.allocateTextureUnit=function(){const e=t.nextTextureUnit;return t.nextTextureUnit=(t.nextTextureUnit+1)%n.maxTextureUnits,e},n.mainScene=function(e){return t.mainScene&&t.mainScene.dispose(),t.mainScene=e,n},n.getGameTick=function(){return t.gameTick},n.getElapsedSeconds=function(){return t.gameTick*n.gameTickMs/1e3},n.getMainScene=function(){return t.mainScene},n.addScene=function(e){return t.scenes.push(e),n},n.removeScene=function(e){for(let n=0;n<t.scenes.length;n++)if(t.scenes[n]===e)return t.scenes.splice(n,1),!0;return!1},n.activateAnimation=function(e){return t.activeAnimations[e.id]=e,delete t.inactiveAnimations[e.id],n},n.deactivateAnimation=function(e){return t.inactiveAnimations[e.id]=e,delete t.activeAnimations[e.id],n},n.addAnimation=function(e){return e.id=t.nextAnimationId++,t.inactiveAnimations[e.id]=e,n},n.removeAnimation=function(e){return delete t.inactiveAnimations[e.id],delete t.activeAnimations[e.id],n},t.playAnimations=function(){for(let e in t.activeAnimations){let n=t.activeAnimations[e];void 0!==n.nextFrameTick?t.frameTick>=n.nextFrameTick&&(n.nextFrameTick=t.frameTick+10,n.action(null,t.gameTick,t.frameTick)):null!=n.nextGameTick?t.gameTick>=n.nextGameTick&&(n.nextGameTick=t.gameTick+5,n.action(null,t.gameTick,t.frameTick)):n.nextGameTick=t.gameTick+5}},n.hitTest=function(e,r,i,a,o){if(i=i||n.canvas.clientWidth,a=a||n.canvas.clientHeight,o=o||n.getMainScene(),!t.hitTestShader){const e="attribute vec4 a_position;\nuniform mat4 u_clipMatrix;\nvoid main() {;\n  gl_Position = u_clipMatrix * a_position;\n}",r="precision mediump float;\nuniform vec4 u_color;\nvoid main() {;\n  gl_FragColor = u_color;\n}";t.hitTestShader=frag.CustomShader(n).name("Hit test").source(e,r).attribute("position").uniform("clipMatrix").uniform("color")}const s=n.gl,c=s.createTexture();s.bindTexture(s.TEXTURE_2D,c),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,i,a,0,s.RGBA,s.UNSIGNED_BYTE,null);const l=s.createFramebuffer();s.bindFramebuffer(s.FRAMEBUFFER,l),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,c,0);const u=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,u),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,i,a),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,u),s.viewport(0,0,i,a),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);const f=frag.DrawContext(n).forHitTest(t.hitTestShader);if(s.disable(s.BLEND),Array.isArray(o))for(let e=0;e<o.length;e++)o[e].adjustToViewport(),o[e].draw(f);else o.adjustToViewport(),o.draw(f);const d=new Uint8Array(4);s.readPixels(e,a-r,1,1,s.RGBA,s.UNSIGNED_BYTE,d),s.bindFramebuffer(s.FRAMEBUFFER,null),engine.transparency&&s.enable(s.BLEND);const m=d[0],g=d[1],h=d[2],v=d[3]|h<<8|(15&g)<<16,p=(240&g)>>4|m<<4;return v<f.fragments.length&&p<f.sceneObjects.length?{sceneObject:f.sceneObjects[p],fragment:f.fragments[v]}:null},n.render=function(){if(!t.mainScene)return n;const e=performance.now();t.gameTick=Math.floor((e-t.startTime)/n.gameTickMs),t.frameTick++,t.playAnimations();const r=n.gl;r.bindFramebuffer(r.FRAMEBUFFER,null),t.mainScene.setViewport(),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),n.isRendering=!0;const i=frag.DrawContext(n).forRender(t.gameTick);t.mainScene.draw(i);for(let e=0;e<t.scenes.length;e++)t.scenes[e].adjustToViewport(),t.scenes[e].draw(i);n.isRendering=!1;const a=performance.now();return t.currentFrameCount++,a>t.nextFpsPush&&(t.nextFpsPush=a+100,t.frameCountsSum+=t.currentFrameCount,t.frameCounts.push(t.currentFrameCount),t.currentFrameCount=0,t.frameCounts.length>20&&(t.frameCountsSum-=t.frameCounts.shift()),n.fps=10*t.frameCountsSum/t.frameCounts.length),n},t.renderLoop=function(){n.render(),t.running&&setTimeout(t.renderLoop,n.renderInterval)},n.onStart=function(e){return t.startFunctions.push(e),n},n.initialize=function(){for(var e=0;e<t.startFunctions.length;e++)t.startFunctions[e](n)},n.start=function(){return n.initialize(),t.running=!0,t.renderLoop(),n},n.stop=function(){return t.running=!1,n},n.dispose=function(){n.stop()},n.onStart((function(e){e.canvas.addEventListener("contextmenu",(e=>e.preventDefault()));const t=e.gl;return t.clearColor(1,1,1,1),t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),e.transparency&&(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)),n}));for(let e=0;e<window.frag.classes.length;e++){const t=window.frag.classes[e];n[t]=function(){const e=Array.prototype.slice.call(arguments);return e.unshift(n),frag[t].apply(null,e)}}return n}},1821:()=>{window.frag.Location=function(e,t){const n={is3d:t,isModified:!1,matrix:null,translateX:0,translateY:0,translateZ:0,scaleX:1,scaleY:1,scaleZ:1,rotateX:0,rotateY:0,rotateZ:0,dispose:function(){},clone:function(){const t=window.frag.Location(e,n.is3d);return t.isModified=n.isModified,t.matrix=n.matrix,t.translateX=n.translateX,t.translateY=n.translateY,t.translateZ=n.translateZ,t.scaleX=n.scaleX,t.scaleY=n.scaleY,t.scaleZ=n.scaleZ,t.rotateX=n.rotateX,t.rotateY=n.rotateY,t.rotateZ=n.rotateZ,t},add:function(e){return n.translateX+=e.translateX,n.translateY+=e.translateY,n.translateZ+=e.translateZ,n.scaleX*=e.scaleX,n.scaleY*=e.scaleY,n.scaleZ*=e.scaleZ,n.rotateX+=e.rotateX,n.rotateY+=e.rotateY,n.rotateZ+=e.rotateZ,n.isModified=!0,n},getMatrix:function(){if(n.matrix&&!n.isModified)return n.matrix;let t;return t=n.is3d?window.frag.Transform3D(e).translateXYZ(n.translateX,n.translateY,n.translateZ).rotateXYZ(n.rotateX,n.rotateY,n.rotateZ).scaleXYZ(n.scaleX,n.scaleY,n.scaleZ):window.frag.Transform2D(e).translateXY(n.translateX,n.translateY).rotate(n.rotateZ).scaleXY(n.scaleX,n.scaleY),n.matrix=t.getMatrix(),n.isModified=!1,n.matrix}};return n}},9607:()=>{window.frag.Observable=function(e,t){const n={notify:t,observers:[]};return{__private:n,dispose:function(){},subscribe:function(e){n.observers.push(e),n.notify(e)},unsubscribe:function(e){for(let t=0;t<n.observers.length;t++)if(n.observers[t]===e)return n.observers.splice(t,1),!0;return!1},notify:function(e){e=e||n.notify||function(e){e()};for(let t=0;t<n.observers.length;t++)e(n.observers[t])}}}},5363:()=>{window.frag.ObservableValue=function(e){let t=null;const n=frag.Observable(e,(e=>{e(t)}));return{get:function(){return t},set:function(e){t=e,n.notify()},subscribe:function(e){return n.subscribe(e)},unsubscribe:function(e){return n.unsubscribe(e)}}}},1346:()=>{window.frag.Transform=function(e,t){return t&&9===t.length?window.frag.Transform2D(e,t):window.frag.Transform3D(e,t)}},9670:()=>{window.frag.Transform2D=function(e,t){const n=window.frag,r={matrix:t},i={__private:r,observableMatrix:window.frag.Observable(e,(e=>{e(r.matrix)})),is3d:!1,dispose:function(){i.observableMatrix.dispose()},clone:function(t){return window.frag.Transform2D(e,t||r.matrix)},getMatrix:function(){return r.matrix},setMatrix:function(e){return r.matrix=e,i.observableMatrix.notify(),i},transform:function(e){return r.matrix?i.setMatrix(n.Matrix.m3Xm3(r.matrix,e)):i.setMatrix(e)},identity:function(){return i.setMatrix([1,0,0,0,1,0,0,0,1])},scale:function(e){return i.transform([e,0,0,0,e,0,0,0,1])},scaleXY:function(e,t){return i.transform([e,0,0,0,t,0,0,0,1])},translateX:function(e){return i.transform([1,0,0,0,1,0,e,0,1])},translateY:function(e){return i.transform([1,0,0,0,1,0,0,e,1])},translateXY:function(e,t){return i.transform([1,0,0,0,1,0,e,t,1])},rotate:function(e){var t=Math.cos(e),n=Math.sin(e);return i.transform([t,-n,0,n,t,0,0,0,1])},apply:function(t){return void 0!==t&&e.gl.uniformMatrix3fv(t,!1,i.getMatrix()),i}};return i}},7008:()=>{window.frag.Transform3D=function(e,t){const n=window.frag,r={matrix:t},i={__private:r,observableMatrix:window.frag.Observable(e,(e=>{e(r.matrix)})),is3d:!0,dispose:function(){i.observableMatrix.dispose()},clone:function(t){return window.frag.Transform3D(e,t||r.matrix)},getMatrix:function(){return r.matrix},setMatrix:function(e){return r.matrix=e,i.observableMatrix.notify(),i},transform:function(e){return r.matrix?i.setMatrix(n.Matrix.m4Xm4(r.matrix,e)):i.setMatrix(e)},identity:function(){return i.setMatrix([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},scale:function(e){return i.transform([e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])},scaleX:function(e){return i.transform([e,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},scaleY:function(e){return i.transform([1,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])},scaleZ:function(e){return i.transform([1,0,0,0,0,1,0,0,0,0,e,0,0,0,0,1])},scaleXY:function(e,t){return i.transform([e,0,0,0,0,t,0,0,0,0,1,0,0,0,0,1])},scaleXYZ:function(e,t,n){return i.transform([e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1])},translateX:function(e){return i.transform([1,0,0,0,0,1,0,0,0,0,1,0,e,0,0,1])},translateY:function(e){return i.transform([1,0,0,0,0,1,0,0,0,0,1,0,0,e,0,1])},translateZ:function(e){return i.transform([1,0,0,0,0,1,0,0,0,0,1,0,0,0,e,1])},translateXY:function(e,t){return i.transform([1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1])},translateXYZ:function(e,t,n){return i.transform([1,0,0,0,0,1,0,0,0,0,1,0,e,t,n,1])},translate:function(e){return i.translateXYZ(e[0],e[1],e[2])},rotateX:function(e){var t=Math.cos(e),n=Math.sin(e);return i.transform([1,0,0,0,0,t,n,0,0,-n,t,0,0,0,0,1])},rotateY:function(e){var t=Math.cos(e),n=Math.sin(e);return i.transform([t,0,-n,0,0,1,0,0,n,0,t,0,0,0,0,1])},rotateZ:function(e){var t=Math.cos(e),n=Math.sin(e);return i.transform([t,n,0,0,-n,t,0,0,0,0,1,0,0,0,0,1])},rotateXYZ:function(e,t,n){return e&&i.rotateX(e),t&&i.rotateY(t),n&&i.rotateZ(n),i},rotate:function(e){return 4===e.length&&(e=window.frag.Vector.euler(e)),i.rotateXYZ(e[0],e[1],e[2])},apply:function(t){return void 0!==t&&e.gl.uniformMatrix4fv(t,!1,i.getMatrix()),i}};return i}},2174:()=>{window.frag=window.frag||{},window.frag.classes=["Observable","ObservableValue","Transform","Transform2D","Transform3D","Location","CustomShader","Shader","UiShader","FontShader","Texture","Font","Material","VertexData","Mesh","MeshOptimizer","Model","ScenePosition","SceneObject","Scene","DrawContext","PositionLink","UiCamera","OrthographicCamera","PerspectiveCamera","FrustumCamera","Animation","ObjectAnimationState","ModelAnimation","SceneObjectAnimation","ValueAnimationAction","KeyframeAnimationAction","ParallelAnimationAction","RepeatAnimationAction","PositionAnimationAction","Cube","Cylinder","Disc","Plane","Sphere","AssetCatalog","PackageLoader","InputMethod","DigitalState","AnalogState","DigitalInput","AnalogInput","DigitalAction","AnalogAction","CustomParticleSystem","CustomParticleEmitter","MineExplosionEmitter","SphericalExplosionEmitter","SprayEmitter","RainEmitter","DynamicData","DynamicSurface","DynamicTile","SharedVertex"]},5217:()=>{window.frag.AnalogAction=function(e,t,n){const r=t.split("-");let i="move",a="z";for(let e=0;e<r.length;e++)/^move$/i.test(r[e])&&(i="move"),/^rotate$/i.test(r[e])&&(i="rotate"),/^scale$/i.test(r[e])&&(i="scale"),/^x$/i.test(r[e])&&(a="x"),/^y$/i.test(r[e])&&(a="y"),/^z$/i.test(r[e])&&(a="z"),/^right$/i.test(r[e])&&(a="right"),/^up$/i.test(r[e])&&(a="up"),/^forward$/i.test(r[e])&&(a="forward");const o=function(e){if("move"===i){if("x"===a)return function(t){e().locationX(t.value)};if("y"===a)return function(t){e().locationY(t.value)};if("z"===a)return function(t){e().locationZ(t.value)}}if("rotate"===i){if("x"===a)return function(t){e().rotateX(t.value)};if("y"===a)return function(t){e().rotateY(t.value)};if("z"===a)return function(t){e().rotateZ(t.value)}}return null};return/camera/i.test(t)?o((function(){return e.getMainScene().getCamera().getPosition()})):n&&n.sceneObject&&/sceneobject/i.test(t)?o(n.sceneObject.getPosition):null}},280:()=>{window.frag.AnalogInput=function(t,n,r,i){void 0===(i=i||{}).scale&&(i.scale=1);const a={inputName:n,analogState:r},o={__private:a,dispose:function(){o.disable()}},s=n.split("-");if(/mouse/i.test(n)){let e,n,r=0,c=!1,l=!1,u=!1;for(let e=0;e<s.length;e++)/^horizontal$/.test(s[e])&&(c=!1),/^vertical$/.test(s[e])&&(c=!0),/^inverted$/.test(s[e])&&(l=!0),/^wheel$/.test(s[e])&&(u=!0),/^left$/.test(s[e])&&(r=1),/^right$/.test(s[e])&&(r=2),/^middle$/.test(s[e])&&(r=4),/^back$/.test(s[e])&&(r=8),/^forward$/.test(s[e])&&(r=16),/^any$/.test(s[e])&&(r=255);const f=function(o){if(0===r){let e=c?(t.canvas.clientHeight-o.clientY)/t.canvas.clientHeight:o.clientX/t.canvas.clientWidth;e*=i.scale,e>1&&(e=1),l&&(e=1-e);const n=(a.analogState.maxValue-a.analogState.minValue)*e+a.analogState.minValue;t.debugInputs&&console.log("Analog input",a.inputName,"=",n),a.analogState.setValue(o,n,!0)}else if(0!=(o.buttons&r)){let r=c?(l?o.clientY-e:e-o.clientY)/t.canvas.clientHeight:(l?e-o.clientX:o.clientX-e)/t.canvas.clientWidth;r*=i.scale,r>1&&(r=1);const s=n+(a.analogState.maxValue-a.analogState.minValue)*r;t.debugInputs&&console.log("Analog input",a.inputName,"=",s),a.analogState.setValue(o,s,!0)}return!0},d=function(t){0!=(t.buttons&r)&&(e=c?t.clientY:t.clientX,n=a.analogState.getValue())},m=function(e){return t.debugInputs&&console.log("Analog input",a.inputName,"delta",e.deltaY),l?e.deltaY>0?a.analogState.decrement(e):a.analogState.increment(e):e.deltaY<0?a.analogState.decrement(e):a.analogState.increment(e),e.preventDefault(),!0};return o.enable=function(){return u?t.canvas.addEventListener("wheel",m,!1):(t.canvas.addEventListener("mousemove",f,!1),0!==r&&t.canvas.addEventListener("mousedown",d,!1)),o},o.disable=function(){return u?t.canvas.removeEventListener("wheel",m,!1):(t.canvas.removeEventListener("mousemove",f,!1),0!==r&&t.canvas.removeEventListener("mousedown",d,!1)),o},o}if(/keys/i.test(s[0])){let e="ArrowLeft",n="ArrowRight";s.length>1&&(e=s[1]),s.length>2&&(n=s[2]);const r=function(r){return r.key===e?(t.debugInputs&&console.log("Analog input",a.inputName,"decrement"),a.analogState.decrement(r),r.preventDefault()):r.key===n&&(t.debugInputs&&console.log("Analog input",a.inputName,"increment"),a.analogState.increment(r),r.preventDefault()),!0};return o.enable=function(){return document.addEventListener("keydown",r,!1),o},o.disable=function(){return document.removeEventListener("keydown",r,!1),o},o}if(/touch/i.test(n)){let e,n,r,c,l="horizontal",u=!1,f=!1,d=0;for(let e=0;e<s.length;e++)/^horizontal$/.test(s[e])&&(l="horizontal"),/^vertical$/.test(s[e])&&(l="vertical"),/^pinch$/.test(s[e])&&(l="pinch"),/^rotate$/.test(s[e])&&(l="rotate"),/^inverted$/.test(s[e])&&(u=!0),/^plus$/.test(s[e])&&(f=!0),/^1$/.test(s[e])&&(d=0),/^2$/.test(s[e])&&(d=1),/^3$/.test(s[e])&&(d=2);let m=null,g=null;if("horizontal"===l&&(m=function(o){if(f&&o.touches.length>d||o.touches.length===d+1){const s=o.touches.item(d);let l=(u?e-s.clientX:s.clientX-e)/r;l*=i.scale,l>1&&(l=1);const f=n+c*l;t.debugInputs&&console.log("Analog input",a.inputName,"=",f),a.analogState.setValue(o,f,!0)}return!0},g=function(i){if(i.touches.length===d+1){const o=i.touches.item(d);e=o.clientX,n=a.analogState.getValue(),c=a.analogState.maxValue-a.analogState.minValue,r=t.canvas.clientWidth}return!0}),"vertical"===l&&(m=function(o){if(f&&o.touches.length>d||o.touches.length===d+1){const s=o.touches.item(d);let l=(u?s.clientY-e:e-s.clientY)/r;l*=i.scale,l>1&&(l=1);const f=n+c*l;t.debugInputs&&console.log("Analog input",a.inputName,"=",f),a.analogState.setValue(o,f,!0)}return!0},g=function(i){if(i.touches.length===d+1){const o=i.touches.item(d);e=o.clientY,n=a.analogState.getValue(),c=a.analogState.maxValue-a.analogState.minValue,r=t.canvas.clientHeight}return!0}),"pinch"===l){const o=function(e){const t=e.touches.item(0),n=e.touches.item(1),r=n.clientX-t.clientX,i=n.clientY-t.clientY;return Math.sqrt(r*r+i*i)};m=function(s){if(f&&s.touches.length>1||2===s.touches.length){let l=(o(s)-e)/r;l*=i.scale,l>1&&(l=1),u&&(l=-l);const f=n+c*l;t.debugInputs&&console.log("Analog input",a.inputName,"=",f),a.analogState.setValue(s,f,!0)}return!0},g=function(i){return 2===i.touches.length&&(e=o(i),n=a.analogState.getValue(),c=a.analogState.maxValue-a.analogState.minValue,r=.5*Math.sqrt(t.canvas.clientHeight*t.canvas.clientHeight+t.canvas.clientWidth*t.canvas.clientWidth)),!0}}if("rotate"===l){const o=function(e){const t=e.touches.item(0),n=e.touches.item(1),r=n.clientX-t.clientX,i=n.clientY-t.clientY;return Math.atan2(i,r)};m=function(s){if(f&&s.touches.length>1||2===s.touches.length){let l=(o(s)-e)/r;l*=i.scale,l>1&&(l=1),u&&(l=-l);const f=n+c*l;t.debugInputs&&console.log("Analog input",a.inputName,"=",f),a.analogState.setValue(s,f,!0)}return!0},g=function(t){return 2===t.touches.length&&(e=o(t),n=a.analogState.getValue(),c=a.analogState.maxValue-a.analogState.minValue,r=.5*Math.PI),!0}}return o.enable=function(){return m&&t.canvas.addEventListener("touchmove",m,!1),g&&t.canvas.addEventListener("touchstart",g,!1),o},o.disable=function(){return m&&t.canvas.removeEventListener("touchmove",m,!1),g&&t.canvas.removeEventListener("touchstart",g,!1),o},o}if(/pointer/i.test(n)){let e,n,r=0,c=!1,l=!1;for(let e=0;e<s.length;e++)/^horizontal$/.test(s[e])&&(c=!1),/^vertical$/.test(s[e])&&(c=!0),/^inverted$/.test(s[e])&&(l=!0),/^left$/.test(s[e])&&(r=1),/^right$/.test(s[e])&&(r=2),/^middle$/.test(s[e])&&(r=4),/^back$/.test(s[e])&&(r=8),/^forward$/.test(s[e])&&(r=16),/^eraser$/.test(s[e])&&(r=32),/^any$/.test(s[e])&&(r=255);const u=function(o){if(0===r){let e=c?o.clientY/t.canvas.clientHeight:o.clientX/t.canvas.clientWidth;e*=i.scale,e>1&&(e=1),l&&(e=1-e);const n=(a.analogState.maxValue-a.analogState.minValue)*e+a.analogState.minValue;t.debugInputs&&console.log("Analog input",a.inputName,"=",n),a.analogState.setValue(o,n,!0)}else if(0!=(o.buttons&r)){let r=c?(l?e-o.clientY:o.clientY-e)/t.canvas.clientHeight:(l?e-o.clientX:o.clientX-e)/t.canvas.clientWidth;r*=i.scale,r>1&&(r=1);const s=n+(a.analogState.maxValue-a.analogState.minValue)*r;t.debugInputs&&console.log("Analog input",a.inputName,"=",s),a.analogState.setValue(o,s,!0)}return!0},f=function(t){0!=(t.buttons&r)&&(e=c?t.clientY:t.clientX,n=a.analogState.getValue())};return o.enable=function(){return t.canvas.addEventListener("pointermove",u,!1),0!==r&&t.canvas.addEventListener("pointerdown",f,!1),o},o.disable=function(){return t.canvas.removeEventListener("pointermove",u,!1),0!==r&&t.canvas.removeEventListener("pointerdown",f,!1),o},o}if(/gamepad/i.test(n)){let n,r=0,i=0,c=0,l=null,u=!1;for(let e=0;e<s.length;e++)/^horizontal$/.test(s[e])&&(c=0),/^vertical$/.test(s[e])&&(c=1),/^inverted$/.test(s[e])&&(u=!0),/^player1$/.test(s[e])&&(r=0),/^player2$/.test(s[e])&&(r=1),/^player3$/.test(s[e])&&(r=2),/^player4$/.test(s[e])&&(r=3),/^stick1$/.test(s[e])&&(i=0),/^stick2$/.test(s[e])&&(i=1),/^stick3$/.test(s[e])&&(i=2),/^stick4$/.test(s[e])&&(i=3);const f=2*i+c,d=function(e){if(l){const t=l.axes[f];u&&(t=-t),a.analogState.setVelocity(e,t*a.analogState.maxVelocity)}},m=function(i){t.debugInputs&&console.log("Gamepad",i.gamepad.index,"connected","id:"+i.gamepad.id,"with",e.gamepad.axes.length,"axes"),i.gamepad.index===r&&l.axes.length>f&&(l=i.gamepad,n=setInterval(d,50))},g=function(e){t.debugInputs&&console.log("Gamepad",e.gamepad.index,"disconnected","id:"+e.gamepad.id),e.gamepad.id===l.id&&(clearInterval(n),l=null)};return o.enable=function(){return window.addEventListener("gamepadconnected",m,!1),window.addEventListener("gamepaddisconnected",g,!1),o},o.disable=function(){return window.removeEventListener("gamepadconnected",m,!1),window.removeEventListener("gamepaddisconnected",g,!1),o},o}return/orientation/i.test(n),o}},6784:()=>{window.frag.AnalogState=function(e,t,n,r){window.frag,n||(n={}),n.value=n.value||0,n.minValue=void 0===n.minValue?-100:n.minValue,n.maxValue=void 0===n.maxValue?100:n.maxValue,n.maxVelocity=n.maxVelocity||5,n.acceleration=void 0===n.acceleration?.25:n.acceleration,n.deceleration=void 0===n.deceleration?1:n.deceleration;const i={analogAction:t,config:n,name:r,inverted:!1},a={__private:i,value:n.value,minValue:n.minValue,maxValue:n.maxValue,maxVelocity:Math.abs(n.maxVelocity),velocity:0,analogAction:function(e){i.analogAction=e}};return n.maxValue<n.minValue&&(i.inverted=!0,a.minValue=n.maxValue,a.maxValue=n.minValue),i.change=function(e){if(i.analogAction)if(Array.isArray(i.analogAction))for(let t=0;t<i.analogAction.length;t++)i.analogAction[t](a,e);else i.analogAction(a,e)},i.setValue=function(t,n){n<a.minValue&&(n=a.minValue,a.velocity=0),n>a.maxValue&&(n=a.maxValue,a.velocity=0),Math.abs(a.value-n)>1e-5&&(a.value=n,e.debugInputs&&console.log("Analog state",i.name,"set to",n),i.change(t))},i.increment=function(e){a.velocity+=a.velocity>=0?i.config.acceleration:i.config.deceleration,a.velocity>i.config.maxVelocity&&(a.velocity=i.config.maxVelocity),i.setValue(e,a.value+a.velocity,!1)},i.decrement=function(e){a.velocity-=a.velocity<=0?i.config.acceleration:i.config.deceleration,a.velocity<-i.config.maxVelocity&&(a.velocity=-i.config.maxVelocity),i.setValue(e,a.value+a.velocity,!1)},a.setValue=function(e,t,n){i.inverted&&(t=a.minValue+a.maxValue-t),n&&(a.velocity=t-a.value),i.setValue(e,t)},a.getValue=function(){return i.inverted?a.minValue+a.maxValue-a.value:a.value},a.increment=function(e){i.inverted?i.decrement(e):i.increment(e)},a.decrement=function(e){i.inverted?i.increment(e):i.decrement(e)},a.setVelocity=function(e,t){inverted?a.velocity=-t:a.velocity=t,a.velocity>i.config.maxVelocity&&(a.velocity=i.config.maxVelocity),a.velocity<-i.config.maxVelocity&&(a.velocity=-i.config.maxVelocity),i.setValue(e,a.value+a.velocity)},a}},8853:()=>{window.frag.DigitalAction=function(e,t,n){if(window.frag,n&&n.animation){if(/^animation$/i.test(t))return function(t){e.debugInputs&&console.log("Turning animation",t.isOn?"on":"off"),t.isOn?n.animation.start():n.animation.stop()};if(/^animation-start$/i.test(t))return function(t){t.isOn||(e.debugInputs&&console.log("Starting animation"),n.animation.start())};if(/^animation-stop$/i.test(t))return function(t){t.isOn||(e.debugInputs&&console.log("Stopping animation"),n.animation.stop())}}return n&&n.sceneObject&&/^sceneobject$/i.test(t)?function(t){e.debugInputs&&console.log("Turning scene object",t.isOn?"on":"off"),t.isOn?n.sceneObject.enable():n.sceneObject.disable()}:n&&n.model&&/^model$/i.test(t)?function(t){e.debugInputs&&console.log("Turning",n.model.getName(),"model",t.isOn?"on":"off"),t.isOn?n.model.enable():n.model.disable()}:null}},8562:()=>{window.frag.DigitalInput=function(e,t,n){window.frag;const r={inputName:t,digitalState:n,toggle:!1,inverted:!1,setOn:!1,setOff:!1},i={__private:r,dispose:function(){i.disable()}},a=t.split("-"),o=function(t,n){r.inverted&&(n=!n),e.debugInputs&&console.log("Digital input",r.inputName,"is",n?"on":"off"),r.toggle?n&&r.digitalState.toggle(t):r.setOn||r.setOff?n&&(r.setOn&&r.digitalState.setIsOn(t,!0),r.setOff&&r.digitalState.setIsOn(t,!1)):r.digitalState.setIsOn(t,n)};if(/mouse/i.test(t)){let t=1;for(let e=0;e<a.length;e++)/^toggle$/i.test(a[e])&&(r.toggle=!0),/^inverted$/i.test(a[e])&&(r.inverted=!0),/^on$/i.test(a[e])&&(r.setOn=!0),/^off$/i.test(a[e])&&(r.setOff=!0),/^left$/i.test(a[e])&&(t=1),/^right$/i.test(a[e])&&(t=2),/^middle$/i.test(a[e])&&(t=4),/^back$/i.test(a[e])&&(t=8),/^forward$/i.test(a[e])&&(t=16),/^eraser$/i.test(a[e])&&(t=32),/^any$/i.test(a[e])&&(t=255);const n=function(e){return o(e,0!=(e.buttons&t)),!0};return i.enable=function(){e.canvas.addEventListener("mousedown",n,!1),e.canvas.addEventListener("mouseup",n,!1)},i.disable=function(){e.canvas.removeEventListener("mousedown",n,!1),e.canvas.removeEventListener("mouseup",n,!1)},i}if(/pointer/i.test(t)){let t=1;for(let e=0;e<a.length;e++)/^toggle$/i.test(a[e])&&(r.toggle=!0),/^inverted$/i.test(a[e])&&(r.inverted=!0),/^on$/i.test(a[e])&&(r.setOn=!0),/^off$/i.test(a[e])&&(r.setOff=!0),/^left$/i.test(a[e])&&(t=1),/^right$/i.test(a[e])&&(t=2),/^middle$/i.test(a[e])&&(t=4),/^back$/i.test(a[e])&&(t=8),/^forward$/i.test(a[e])&&(t=16),/^eraser$/i.test(a[e])&&(t=32),/^any$/i.test(a[e])&&(t=255);const n=function(e){return o(e,0!=(e.buttons&t)),!0};return i.enable=function(){e.canvas.addEventListener("pointerdown",n,!1),e.canvas.addEventListener("pointerup",n,!1)},i.disable=function(){e.canvas.removeEventListener("pointerdown",n,!1),e.canvas.removeEventListener("pointerup",n,!1)},i}if(/key/i.test(t)){let e,t=!1,n=!1,s=!1,c=!1;for(let i=0;i<a.length;i++)/^toggle$/i.test(a[i])?r.toggle=!0:/^inverted$/i.test(a[i])?r.inverted=!0:/^on$/i.test(a[i])?r.setOn=!0:/^off$/i.test(a[i])?r.setOff=!0:/^ctrl$/i.test(a[i])?t=!0:/^shift$/i.test(a[i])?n=!0:/^alt$/i.test(a[i])?s=!0:/^meta$/i.test(a[i])?c=!0:/^key$/i.test(a[i])||(e=a[i]);const l=function(r,i){return r.key!==e||r.altKey!==s||r.ctrlKey!==t||r.shiftKey!==n||r.metaKey!==c||(r.preventDefault(),o(r,i)),!0},u=function(e){return l(e,!0)},f=function(e){return l(e,!1)};return i.enable=function(){document.addEventListener("keydown",u,!1),document.addEventListener("keyup",f,!1)},i.disable=function(){document.removeEventListener("keydown",u,!1),document.removeEventListener("keyup",f,!1)},i}return i}},3235:()=>{window.frag.DigitalState=function(e,t,n,r){window.frag,n||(n={}),n.isOn=!!n.isOn;const i={digitalAction:t,config:n,name:r},a={__private:i,isOn:n.isOn,dispose:function(){}};return i.change=function(e){if(i.digitalAction)if(Array.isArray(i.digitalAction))for(let t=0;t<i.digitalAction.length;t++)i.digitalAction[t](a,e);else i.digitalAction(a,e)},a.setIsOn=function(t,n){n!==a.isOn?(a.isOn=n,e.debugInputs&&console.log("Digital state",i.name,"turned",a.isOn?"on":"off"),i.change(t)):e.debugInputs&&console.log("Digital state",i.name,"is already",a.isOn?"on":"off")},a.toggle=function(t){a.isOn=!a.isOn,e.debugInputs&&console.log("Digital state",i.name,"toggled to",a.isOn?"on":"off"),i.change(t)},a}},7802:()=>{window.frag.InputMethod=function(e){const t={inputs:[],enabled:!1},n={__private:t,dispose:function(){n.disable()},enable:function(){if(!t.enabled){for(var e=0;e<t.inputs.length;e++)t.inputs[e].enable();t.enabled=!0}return n},disable:function(){if(t.enabled){t.enabled=!1;for(var e=0;e<t.inputs.length;e++)t.inputs[e].disable()}return n},add:function(e){return t.inputs.push(e),t.enabled&&e.enable(),n}};return n}},6237:()=>{window.frag.AssetCatalog=function(e,t,n){const r=window.frag,i=e.gl,a=new Uint8Array([127,127,127,255,0,0,255,0,0,0,0,127,127,255]);n||(n={}),n.diffuse||(n.diffuse=r.Texture(e).name("default-diffuse-texture").dataFormat(i.RGBA).fromArrayBuffer(0,a,0,1,1)),n.surface||(n.surface=r.Texture(e).name("default-surface-texture").dataFormat(i.RGBA).fromArrayBuffer(0,a,4,1,1)),n.emmissive||(n.emmissive=r.Texture(e).name("default-emmissive-texture").dataFormat(i.RGB).fromArrayBuffer(0,a,8,1,1)),n.normal||(n.normal=r.Texture(e).name("default-normal-map-texture").dataFormat(i.RGB).fromArrayBuffer(0,a,11,1,1)),t||(t=r.Shader(e).name("Model").verticiesXYZ().matrix3D().diffuseTexture().directionalLightGrey().compile());const o={defaultTextures:n,fonts:{},materials:{},models:{}},s={__private:o,shader:t,dispose:function(){},getFont:function(t){var n=o.fonts[t];return n||(n=r.Font(e).name(t),o.fonts[t]=n),n},getMaterial:function(t){var n=o.materials[t];return n||(n=r.Material(e).name(t).disposeTextures(!1).setTexture("diffuse",o.defaultTextures.diffuse).setTexture("emmissive",o.defaultTextures.emmissive).setTexture("surface",o.defaultTextures.surface).setTexture("normalMap",o.defaultTextures.normal),o.materials[t]=n),n},getModel:function(t,n){var i=n?void 0:o.models[t];return i||(i=r.Model(e,s.shader.is3d).name(t).shader(s.shader),n||(o.models[t]=i)),i}};return s}},956:()=>{window.frag.PackageLoader=function(e){if(e.packageLoader)return e.packageLoader;const t=window.frag,n=new Uint32Array([287454020]),r=68===new Uint8Array(n.buffer)[0],i=function(e){return Math.round(1e4*e)/1e4},a={},o={__private:a,littleEndian:r,dispose:function(){}};return e.packageLoader=o,a.loadFontV1=function(t,n,i){const a=t.header.getUint8(i++);var o="";for(let e=0;e<a;e++)o+=String.fromCharCode(t.header.getUint8(i++));const s=t.assetCatalog.getFont(o);e.debugPackageLoader&&console.log("Object["+n+"] is font "+o);const c=t.header.getUint8(i++);var l="";for(let e=0;e<c;e++)l+=String.fromCharCode(t.header.getUint8(i++));const u=t.header.getUint16(i,r),f=t.header.getUint16(i+2,r),d=t.header.getUint16(i+4,r),m=t.header.getUint16(i+6,r);i+=8,e.debugPackageLoader&&console.log("  "+f+"x"+d+" pixel texture contains "+m+" characters from "+u+"px "+l),s.lineHeight(u);for(let e=0;e<m;e++){const e=t.header.getUint8(i++);var g="";for(let n=0;n<e;n++)g+=String.fromCharCode(t.header.getUint8(i++));const n=t.header.getUint16(i+0,r),a=t.header.getUint16(i+2,r),o=t.header.getUint16(i+4,r),c=t.header.getUint16(i+6,r),l=t.header.getInt16(i+8,r),u=t.header.getInt16(i+10,r),f=t.header.getInt16(i+12,r);i+=14,s.addChar(g,n,a,o,c,l,u,f)}const h=t.header.getUint8(i++);var v="";for(let e=0;e<h;e++)v+=String.fromCharCode(t.header.getUint8(i++));"RGB"===v?s.dataFormat(e.gl.RGB):"RGBA"===v?s.dataFormat(e.gl.RGBA):"L"===v?s.dataFormat(e.gl.LUMINANCE):console.error("Font "+o+" unsupported mode "+v);const p=t.header.getUint16(i+0,r),x=t.header.getUint16(i+2,r);let T=t.header.getUint32(i+4,r)+t.dataOffset;i+=8,p!==f&&console.error("Font "+o+" width does not match image width"),x!==d&&console.error("Font "+o+" height does not match image height");const b=new Uint8Array(t.data,T);return s.fromArrayBuffer(b,T,f,d),s},a.loadMaterialV1=function(n,i,a){const o=n.header.getUint8(a++);var s="";for(let e=0;e<o;e++)s+=String.fromCharCode(n.header.getUint8(a++));const c=n.assetCatalog.getMaterial(s),l=n.header.getUint8(a++);e.debugPackageLoader&&console.log("Object["+i+"] is "+s+" material with "+l+" textures");for(let i=0;i<l;i++){const i=n.header.getUint8(a++);var u="";for(let e=0;e<i;e++)u+=String.fromCharCode(n.header.getUint8(a++));const o=n.header.getUint8(a++);var f="";for(let e=0;e<o;e++)f+=String.fromCharCode(n.header.getUint8(a++));const l=t.Texture(e);"RGB"===f?l.dataFormat(e.gl.RGB):"RGBA"===f?l.dataFormat(e.gl.RGBA):"L"===f?l.dataFormat(e.gl.LUMINANCE):console.error("Texture "+s+" unsupported mode "+f);const d=n.header.getUint16(a+0,r),m=n.header.getUint16(a+2,r),g=n.header.getUint32(a+4,r)+n.dataOffset;a+=8,e.debugPackageLoader&&console.log("  Texture "+u+" is "+d+"x"+m+"px in "+f+" format");const h=new Uint8Array(n.data,g);l.fromArrayBuffer(0,h,g,d,m),c.setTexture(u,l)}return c},a.loadMeshV1=function(n,a,o){const s=t.Mesh(e),c=n.header.getUint16(o,r);o+=2,e.debugPackageLoader&&console.log("Object["+a+"] is a mesh with "+c+" fragments");for(let a=0;a<c;a++){const c=n.header.getUint8(o),u=n.header.getUint8(o+1),f=n.header.getUint8(o+2),d=n.header.getUint8(o+3),m=n.header.getUint8(o+4),g=n.header.getUint8(o+5),h=n.header.getUint8(o+6),v=n.header.getUint32(o+7,r),p=n.header.getUint32(o+11,r);let x=n.header.getUint32(o+15,r)+n.dataOffset;o+=19;const T=1==(1&u),b=2==(2&u);let S=0;if(1===c?S=v/3:2===c?S=v/2:(3===c||4===c)&&(S=v-2),e.debugPackageLoader){let e="  fragment["+a+"] has "+v+" verticies forming ";switch(1===c?e+=S+" triangles":2===c?e+=S/2+" rectangles":3===c?e+="a strip of "+S+"triangles":4===c&&(e+="a fan of "+S+" triangles"),T&&(e+=" indexed"),b||(e+=" in 2D"),f){case 1:e+=" with custom normals";break;case 2:e+=" with indexed normals";break;case 3:e+=" with triangle normals"}switch(d){case 1:e+=" with custom tangents";break;case 2:e+=" with indexed tangents";break;case 3:e+=" with triangle tangents";break;case 4:e+=" with single tangent"}switch(m){case 1:e+=" with bitangents"}switch(g){case 1:e+=" with custom uvs";break;case 2:e+=" with indexed uvs";break;case 3:e+=" with triangle uvs"}switch(h){case 1:e+=" with custom colors";break;case 2:e+=" with custom colors and transparency";break;case 3:e+=" with indexed colors";break;case 4:e+=" with indexed colors and transparency"}console.log(e)}const w=T?[]:void 0;if(T){indexArray=new Int16Array(n.data,x);for(let e=0;e<v;e++)w.push(indexArray[e]);x+=2*v,1==(1&v)&&(x+=2)}const y=[],_=0===f?void 0:[],M=0===d?void 0:[],D=0===m?void 0:[],A=0===g?void 0:[],E=void 0,F=new Float32Array(n.data,x);for(let e=0;e<v;e++){let t=T?w[e]:e,n=Math.trunc(e/3);2===c?n=Math.trunc(e/4):3!==c&&4!==c||(n=e<3?0:e-2);let r=0,i=b?3*t:2*t;switch(y.push(F[i]),y.push(F[i+1]),b?(y.push(F[i+2]),r+=3*p):r+=2*p,f){case 1:i=r+3*e,r+=3*v;break;case 2:i=r+3*t,r+=3*p;break;case 3:i=r+3*n,r+=3*S}0!==f&&(_.push(F[i]),_.push(F[i+1]),_.push(F[i+2]))}if(e.debugPackageLoader&&e.debugMeshes){let e="  vertices[";for(var l=0;l<y.length;l++)l>0&&(e+=", "),e+=i(y[l]);e+="]",console.log(e)}const R=t.VertexData(e);1===c||2===c?b?R.setTriangles({verticies:y,colors:E,uvs:A,normals:_,tangents:M,bitangents:D}):R.setTriangles2D({verticies:y,colors:E,uvs:A,normals:_,tangents:M,bitangents:D}):3===c?R.setTriangleStrip({verticies:y,colors:E,uvs:A,normals:_,tangents:M,bitangents:D}):4===c&&R.setTriangleFan({verticies:y,colors:E,uvs:A,normals:_,tangents:M,bitangents:D}),s.addVertexData(R)}return s},a.loadAnimationV1=function(n,a,o){const s=n.header.getUint8(o++);var c="";for(let e=0;e<s;e++)c+=String.fromCharCode(n.header.getUint8(o++));const l=n.header.getUint8(o),u=n.header.getUint16(o+1,r),f=n.header.getUint16(o+3,r),d=n.header.getUint8(o+5);o+=6;const m=1==(1&l),g=2==(2&l);if(e.debugPackageLoader){let e="Object["+a+"] is '"+c+"' animation which runs for "+u+"x"+f+" ms";m&&(e+=". Repeats until stopped"),g&&(e+=". Plays in reverse after playing forwards"),console.log(e)}const h=t.ModelAnimation(e).name(c).loop(m).frames(u).interval(f/e.gameTickMs);for(let t=0;t<d;t++){const t=n.header.getUint8(o++);var v="";for(let e=0;e<t;e++)v+=String.fromCharCode(n.header.getUint8(o++));const a=n.header.getUint8(o++);var p="";for(let e=0;e<a;e++)p+=String.fromCharCode(n.header.getUint8(o++));e.debugPackageLoader&&e.debugAnimations&&(msg="  Channel "+p+" applies to "+v+" children",console.log(msg));const s={},c=n.header.getUint16(o,r);o+=2;for(let t=0;t<c;t++){const t=n.header.getUint16(o,r),a=n.header.getUint8(o+2),c=n.header.getFloat32(o+3,r);o+=7;var x="step";1===a?x="linear":2===a&&(x="spline"),s[t]={value:c,transition:x},e.debugPackageLoader&&e.debugAnimations&&(msg="    Keyframe["+t+"] = "+i(c)+" "+x,console.log(msg))}h.addChannel({channel:p,pattern:new RegExp(v,"i"),keyframes:s})}return h},a.loadModelV1=function(n,a,o){const s=n.header.getUint8(o++);var c="";for(let e=0;e<s;e++)c+=String.fromCharCode(n.header.getUint8(o++));const l=n.header.getUint8(o),u=n.header.getUint16(o+1,r),f=n.header.getUint16(o+3,r);o+=5;const d=t.Location(e,!0);d.translateX=n.header.getFloat32(o+0,r),d.translateY=n.header.getFloat32(o+4,r),d.translateZ=n.header.getFloat32(o+8,r),d.rotateX=n.header.getFloat32(o+12,r),d.rotateY=n.header.getFloat32(o+16,r),d.rotateZ=n.header.getFloat32(o+20,r),d.scaleX=n.header.getFloat32(o+24,r),d.scaleY=n.header.getFloat32(o+28,r),d.scaleZ=n.header.getFloat32(o+32,r),d.isModified=!0,o+=36;const m=n.header.getUint16(o,r),g=n.header.getUint16(o+2,r);o+=4;const h=1==(1&l),v=2==(2&l),p=4==(4&l);e.debugPackageLoader&&(console.log("Object["+a+"] is "+(h?"root ":"")+"model "+c+" with "+m+" children and "+g+" animations."+(p?" Paint mesh "+f:" No mesh")+(v?" with material "+u:". No material")),console.log("Object["+a+"] at ("+i(d.translateX)+","+i(d.translateY)+","+i(d.translateZ)+").["+i(d.rotateX)+","+i(d.rotateY)+","+i(d.rotateZ)+"]x("+i(d.scaleX)+","+i(d.scaleY)+","+i(d.scaleZ)+")"));const x=n.assetCatalog.getModel(c,!h);x.location=d,v&&x.material(n.materials[u]),p&&x.mesh(n.meshes[f]);for(let e=0;e<m;e++){const e=n.header.getUint16(o,r);o+=2,x.addChild(n.models[e])}if(h){e.debugAnimations&&g>0&&console.log("Model #"+a+" '"+c+"' has "+g+" animations");for(let t=0;t<g;t++){const t=n.header.getUint16(o,r);o+=2;const i=n.animations[t];if(e.debugAnimations){const e=i.getChannelGraphs();console.log("  Animation '"+i.getName()+"' has "+e.length+" channels."+(i.__private.loop?" Loop ":"")+i.__private.frames+"x"+i.__private.interval+" frames");for(let t=0;t<e.length;t++)console.log("    Animates "+e[t].channel+" for children matching "+e[t].pattern)}x.addAnimation(i)}}else g>0&&console.warn("Model #"+a+" '"+c+"' has "+g+" animations but is not a root");return x},o.loadFromBuffer=function(n,i){i||(i=t.AssetCatalog(e));const o=new Uint8Array(n),s=new DataView(n,0,o.length),c=o[0],l=s.getUint32(4,r);var u=8;const f=u+l;e.debugPackageLoader&&console.log("Asset pack V"+c+" is "+o.length+" bytes with "+l+" header bytes");const d={assetCatalog:i,header:s,data:n,dataOffset:f,materials:{},meshes:{},animations:{},models:{},fonts:{}};if(1===c)for(var m=s.getUint16(u,r),g=0;0!==m;){const e=s.getUint16(u+2,r),t=s.getUint8(u+4),n=u+5;if(e!==g++)return void console.error("Object indexes are not consecutive");if(0===t)break;1===t?d.materials[e]=a.loadMaterialV1(d,e,n):2===t?d.meshes[e]=a.loadMeshV1(d,e,n):3===t?d.animations[e]=a.loadAnimationV1(d,e,n):4===t?d.models[e]=a.loadModelV1(d,e,n):5===t?d.fonts[e]=a.loadFontV1(d,e,n):console.error("Unknown object type "+t),u+=m,m=s.getUint16(u,r)}else console.error("Version "+c+" asset packs are not supported");return i},o.loadFromUrl=function(e,t,n){var r=new XMLHttpRequest;return r.responseType="arraybuffer",r.onreadystatechange=function(){4==this.readyState&&200==this.status&&(t=o.loadFromBuffer(this.response,t),n&&n(t))},r.open("GET",e,!0),r.send(),o},o}},2636:()=>{window.frag.Font=function(e,t,n){const r=window.frag,i=e.gl,a=t||{glTexture:null,generated:!1,format:i.RGBA,dataType:i.UNSIGNED_BYTE,valuesPerPixel:4,chars:{},lineHeight:24},o={textColor:[0,0,0,1],backgroundColor:[0,0,0,1],kerning:!1,letterSpacing:0};n&&(o.textColor=n.textColor,o.backgroundColor=n.backgroundColor,o.kerning=n.kerning,o.letterSpacing=n.letterSpacing);const s={__private:a,textureUnit:e.allocateTextureUnit(),dispose:function(){a.glTexture&&(i.deleteTexture(a.glTexture),a.glTexture=null,a.disposed=!0)},clone:function(){return window.frag.Font(e,a,o)},name:function(e){return a.name=e,s},kerning:function(e){return o.kerning=e,s},letterSpacing:function(e){return o.letterSpacing=e,s},textColor:function(e){return o.textColor=e,s},backgroundColor:function(e){return o.backgroundColor=e,s},dataFormat:function(e){return a.format=e,e===i.RGBA?(a.dataType=i.UNSIGNED_BYTE,a.valuesPerPixel=4):e===i.RGB?(a.dataType=i.UNSIGNED_BYTE,a.valuesPerPixel=3):e===i.LUMINANCE_ALPHA?(a.dataType=i.UNSIGNED_BYTE,a.valuesPerPixel=2):e!==i.LUMINANCE&&formaat!==i.ALPHA||(a.dataType=i.UNSIGNED_BYTE,a.valuesPerPixel=1),s}};return a.setup=function(e,t){a.width=e,a.height=t,a.glTexture||(a.glTexture=i.createTexture()),i.bindTexture(i.TEXTURE_2D,a.glTexture),0==(e&e-1)&&0==(t&t-1)||(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),a.generated=!0)},s.lineHeight=function(e){return a.lineHeight=e,s},s.addChar=function(e,t,n,r,i,o,c,l){return a.chars[e]={x:t,y:n,width:r,height:i,originX:o,originY:c,advance:l},s},s.fromArrayBuffer=function(e,t,n,r){const o=n*r*a.valuesPerPixel;let c;return a.dataType!==i.UNSIGNED_BYTE?(console.error("Unsupported data type for font texture buffer"),s):(c=new Uint8Array(e.buffer,t,o),a.setup(n,r),i.pixelStorei(i.UNPACK_ALIGNMENT,1),i.texImage2D(i.TEXTURE_2D,0,a.format,n,r,0,a.format,a.dataType,c),s)},s.fromImage=function(e){const t=function(){a.setup(e.width,e.height),i.texImage2D(i.TEXTURE_2D,0,a.format,a.format,a.dataType,e)};return e.onload?t():e.onload=t,s},s.apply=function(t){const n=e.gl;void 0!==t.uniforms.fgcolor&&n["uniform"+o.textColor.length+"fv"](t.uniforms.fgcolor,o.textColor),void 0!==t.uniforms.bgcolor&&n["uniform"+o.backgroundColor.length+"fv"](t.uniforms.bgcolor,o.backgroundColor);const r=t.uniforms.diffuse;return r&&a.glTexture?(n.activeTexture(n.TEXTURE0+s.textureUnit),n.bindTexture(n.TEXTURE_2D,a.glTexture),a.generated||(n.generateMipmap(n.TEXTURE_2D),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),a.generated=!0),n.uniform1i(r,s.textureUnit),s):s},s.buildTextMesh=function(t){const n=[],i=[],s=[],c=function(e,t){if(dimensions=a.chars[e],!dimensions)return t;const r=t-dimensions.originX,c=r+dimensions.width,l=dimensions.originY;!function(e,t,r,i){n.push(e),n.push(i),n.push(0),n.push(t),n.push(r),n.push(0),n.push(e),n.push(r),n.push(0),n.push(e),n.push(i),n.push(0),n.push(t),n.push(i),n.push(0),n.push(t),n.push(r),n.push(0);for(let e=0;e<6;e++)s.push(0),s.push(0),s.push(-1)}(r,c,l,l-dimensions.height);const u=dimensions.x,f=a.height-dimensions.y;!function(e,t,n,r){e/=a.width,t/=a.width,n/=a.height,r/=a.height,i.push(e),i.push(r),i.push(t),i.push(n),i.push(e),i.push(n),i.push(e),i.push(r),i.push(t),i.push(r),i.push(t),i.push(n)}(u,u+dimensions.width,f,f-dimensions.height);let d=dimensions.advance;return o.kerning||(d=dimensions.width>dimensions.advance?dimensions.width:dimensions.advance),t+d+o.letterSpacing};let l=0;for(let e=0;e<t.length;e++)l=c(t[e],l);const u=r.Mesh(e).shadeFlat().textureFlat();return u.addTriangles({verticies:n,uvs:i,normals:s}),u},s.buildTextModel=function(t){const n=s.buildTextMesh(t);return r.Model(e,!0).shader(r.FontShader(e)).mesh(n).material(s)},s.updateTextModel=function(e,t){const n=e.getMesh();return e.mesh(s.buildTextMesh(t)),n.dispose(),s},s}},4655:()=>{window.frag.Material=function(e){const t={textures:{},disposeTextures:!1},n={__private:t,dispose:function(){if(t.disposeTextures)for(let e in t.textures){const n=t.textures[e];n&&n.dispose()}t.textures={}},disposeTextures:function(e){return t.disposeTextures=e,n},name:function(e){return t.name=e,n},setTexture:function(e,r){if(t.disposeTextures){const n=t.textures[e];n&&n.dispose()}return t.textures[e]=r,n},apply:function(e){for(let n in t.textures){const r=t.textures[n];r&&r.apply(n,e)}return n}};return n}},8394:()=>{window.frag.Texture=function(e){const t=e.gl,n={glTexture:null,generated:!1,format:t.RGBA,dataType:t.UNSIGNED_BYTE,valuesPerPixel:4},r={__private:n,textureUnit:e.allocateTextureUnit(),dispose:function(){n.glTexture&&(t.deleteTexture(n.glTexture),n.glTexture=null,n.disposed=!0)},name:function(e){return n.name=e,r},dataFormat:function(e){return n.format=e,e===t.RGBA?(n.dataType=t.UNSIGNED_BYTE,n.valuesPerPixel=4):e===t.RGB?(n.dataType=t.UNSIGNED_BYTE,n.valuesPerPixel=3):e===t.LUMINANCE_ALPHA?(n.dataType=t.UNSIGNED_BYTE,n.valuesPerPixel=2):e!==t.LUMINANCE&&formaat!==t.ALPHA||(n.dataType=t.UNSIGNED_BYTE,n.valuesPerPixel=1),r}};return n.setup=function(e,r){n.width=e,n.height=r,n.glTexture||(n.glTexture=t.createTexture()),t.bindTexture(t.TEXTURE_2D,n.glTexture),0==(e&e-1)&&0==(r&r-1)||(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),n.generated=!0)},r.fromArrayBuffer=function(e,i,a,o,s){const c=o*s*n.valuesPerPixel;let l;return n.dataType!==t.UNSIGNED_BYTE?(console.error("Unsupported data type for texture buffer"),r):(l=new Uint8Array(i.buffer,a,c),n.setup(o,s),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,e,n.format,o,s,0,n.format,n.dataType,l),r)},r.fromImage=function(e,i){const a=function(){n.setup(i.width,i.height),t.texImage2D(t.TEXTURE_2D,e,n.format,n.format,n.dataType,i)};return i.onload?a():i.onload=a,r},r.fromUrl=function(e,t,n){const i=new Image;return r.fromImage(e,i),void 0!==n&&(i.crossOrigin=n),i.src=t,r},r.update=function(i,a,o){return n.scene?(void 0!==i&&void 0!==a&&(i===n.width&&a===n.height||r.fromScene(n.scene,i,a)),t.bindFramebuffer(t.FRAMEBUFFER,n.frameBuffer),t.viewport(0,0,n.width,n.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),n.scene.adjustToViewport(),n.scene.draw(frag.DrawContext(e).forRender(o)),r):r},r.fromScene=function(e,i,a){return n.setup(i,a),t.texImage2D(t.TEXTURE_2D,0,n.format,i,a,0,n.format,n.dataType,null),n.scene=e,n.frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,n.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n.glTexture,0),n.depthBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,n.depthBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,i,a),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,n.depthBuffer),r.update(i,a)},r.apply=function(t,i){const a=i.uniforms[t];if(!a||!n.glTexture)return r;const o=e.gl;return o.activeTexture(o.TEXTURE0+r.textureUnit),o.bindTexture(o.TEXTURE_2D,n.glTexture),n.generated||(o.generateMipmap(o.TEXTURE_2D),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR_MIPMAP_NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),n.generated=!0),o.uniform1i(a,r.textureUnit),r},r}},7996:()=>{window.frag=window.frag||{},window.frag.Matrix={m3Identity:function(){return[1,0,0,0,1,0,0,0,1]},m3Invert:function(e){return e},m3Transpose:function(e){return[e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]]},m3Xm3:function(e,t){const n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=e[8],f=t[0],d=t[1],m=t[2],g=t[3],h=t[4],v=t[5],p=t[6],x=t[7],T=t[8];return[f*n+d*a+m*c,f*r+d*o+m*l,f*i+d*s+m*u,g*n+h*a+v*c,g*r+h*o+v*l,g*i+h*s+v*u,p*n+x*a+T*c,p*r+x*o+T*l,p*i+x*s+T*u]},m3Xv3:function(e,t){const n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=e[8],f=t[0],d=t[1],m=t[2];return[f*n+d*a+m*c,f*r+d*o+m*l,f*i+d*s+m*u]},m4Identity:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},m4Invert:function(e){e=window.frag.Matrix.m4Transpose(e);const t=[];t[0]=e[5]*e[10]*e[15]-e[5]*e[14]*e[11]-e[6]*e[9]*e[15]+e[6]*e[13]*e[11]+e[7]*e[9]*e[14]-e[7]*e[13]*e[10],t[1]=-e[4]*e[10]*e[15]+e[4]*e[14]*e[11]+e[6]*e[8]*e[15]-e[6]*e[12]*e[11]-e[7]*e[8]*e[14]+e[7]*e[12]*e[10],t[2]=e[4]*e[9]*e[15]-e[4]*e[13]*e[11]-e[5]*e[8]*e[15]+e[5]*e[12]*e[11]+e[7]*e[8]*e[13]-e[7]*e[12]*e[9],t[3]=-e[4]*e[9]*e[14]+e[4]*e[13]*e[10]+e[5]*e[8]*e[14]-e[5]*e[12]*e[10]-e[6]*e[8]*e[13]+e[6]*e[12]*e[9],t[4]=-e[1]*e[10]*e[15]+e[1]*e[14]*e[11]+e[2]*e[9]*e[15]-e[2]*e[13]*e[11]-e[3]*e[9]*e[14]+e[3]*e[13]*e[10],t[5]=e[0]*e[10]*e[15]-e[0]*e[14]*e[11]-e[2]*e[8]*e[15]+e[2]*e[12]*e[11]+e[3]*e[8]*e[14]-e[3]*e[12]*e[10],t[6]=-e[0]*e[9]*e[15]+e[0]*e[13]*e[11]+e[1]*e[8]*e[15]-e[1]*e[12]*e[11]-e[3]*e[8]*e[13]+e[3]*e[12]*e[9],t[7]=e[0]*e[9]*e[14]-e[0]*e[13]*e[10]-e[1]*e[8]*e[14]+e[1]*e[12]*e[10]+e[2]*e[8]*e[13]-e[2]*e[12]*e[9],t[8]=e[1]*e[6]*e[15]-e[1]*e[14]*e[7]-e[2]*e[5]*e[15]+e[2]*e[13]*e[7]+e[3]*e[5]*e[14]-e[3]*e[13]*e[6],t[9]=-e[0]*e[6]*e[15]+e[0]*e[14]*e[7]+e[2]*e[4]*e[15]-e[2]*e[12]*e[7]-e[3]*e[4]*e[14]+e[3]*e[12]*e[6],t[10]=e[0]*e[5]*e[15]-e[0]*e[13]*e[7]-e[1]*e[4]*e[15]+e[1]*e[12]*e[7]+e[3]*e[4]*e[13]-e[3]*e[12]*e[5],t[11]=-e[0]*e[5]*e[14]+e[0]*e[13]*e[6]+e[1]*e[4]*e[14]-e[1]*e[12]*e[6]-e[2]*e[4]*e[13]+e[2]*e[12]*e[5],t[12]=-e[1]*e[6]*e[11]+e[1]*e[10]*e[7]+e[2]*e[5]*e[11]-e[2]*e[9]*e[7]-e[3]*e[5]*e[10]+e[3]*e[9]*e[6],t[13]=e[0]*e[6]*e[11]-e[0]*e[10]*e[7]-e[2]*e[4]*e[11]+e[2]*e[8]*e[7]+e[3]*e[4]*e[10]-e[3]*e[8]*e[6],t[14]=-e[0]*e[5]*e[11]+e[0]*e[9]*e[7]+e[1]*e[4]*e[11]-e[1]*e[8]*e[7]-e[3]*e[4]*e[9]+e[3]*e[8]*e[5],t[15]=e[0]*e[5]*e[10]-e[0]*e[9]*e[6]-e[1]*e[4]*e[10]+e[1]*e[8]*e[6]+e[2]*e[4]*e[9]-e[2]*e[8]*e[5];var n=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3];0===n&&console.error("Matrix can not be inverted");for(var r=0;r<16;r++)t[r]/=n;return t},m4Transpose:function(e){return[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]]},m4Xm4:function(e,t){const n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=e[8],f=e[9],d=e[10],m=e[11],g=e[12],h=e[13],v=e[14],p=e[15],x=t[0],T=t[1],b=t[2],S=t[3],w=t[4],y=t[5],_=t[6],M=t[7],D=t[8],A=t[9],E=t[10],F=t[11],R=t[12],V=t[13],C=t[14],O=t[15];return[x*n+T*o+b*u+S*g,x*r+T*s+b*f+S*h,x*i+T*c+b*d+S*v,x*a+T*l+b*m+S*p,w*n+y*o+_*u+M*g,w*r+y*s+_*f+M*h,w*i+y*c+_*d+M*v,w*a+y*l+_*m+M*p,D*n+A*o+E*u+F*g,D*r+A*s+E*f+F*h,D*i+A*c+E*d+F*v,D*a+A*l+E*m+F*p,R*n+V*o+C*u+O*g,R*r+V*s+C*f+O*h,R*i+V*c+C*d+O*v,R*a+V*l+C*m+O*p]},m4Xv4:function(e,t){const n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=e[8],f=e[9],d=e[10],m=e[11],g=e[12],h=e[13],v=e[14],p=e[15],x=t[0],T=t[1],b=t[2],S=t[3];return[x*n+T*o+b*u+S*g,x*r+T*s+b*f+S*h,x*i+T*c+b*d+S*v,x*a+T*l+b*m+S*p]},mult:function(e,t){if(9===e.length){if(Array.isArray(t)){if(9===t.length)return frag.Matrix.m3xm3(e,t);if(3===t.length)return frag.Matrix.m3Xv3(e,t)}console.error("Invalid M3 matrix multiplication operation",e,t)}else if(16===e.length){if(Array.isArray(t)){if(16===t.length)return frag.Matrix.m4Xm4(e,t);if(4===t.length)return frag.Matrix.m4Xv4(e,t)}console.error("Invalid M4 matrix multiplication operation",e,t)}else console.error("Invalid matrix multiplication operation",e,t)},perspective:function(e,t,n,r){var i=Math.tan(e)*n,a=i*t;return window.frag.Matrix.frustum(-a,a,-i,i,n,r)},frustum:function(e,t,n,r,i,a){const o=[];return o[0]=2*i/(t-e),o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*i/(r-n),o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=(a+i)/(a-i),o[11]=1,o[12]=-i*(t+e)/(t-e),o[13]=-i*(r+n)/(r-n),o[14]=2*a*i/(i-a),o[15]=0,o},orthographic:function(e,t,n,r,i,a){const o=[];return o[0]=2/(t-e),o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/(r-n),o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2/(a-i),o[11]=0,o[12]=-(t+e)/(t-e),o[13]=-(r+n)/(r-n),o[14]=-(a+i)/(a-i),o[15]=1,o}}},9041:()=>{window.frag=window.frag||{},window.frag.Quaternion={rotationX:function(e){return[Math.sin(e/2),0,0,Math.cos(e/2)]},rotationY:function(e){return[0,Math.sin(e/2),0,Math.cos(e/2)]},rotationZ:function(e){return[0,0,Math.sin(e/2),Math.cos(e/2)]},axisRotation:function(e,t){var n=1/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=Math.sin(t/2),i=Math.cos(t/2);return[r*e[0]*n,r*e[1]*n,r*e[2]*n,i]},normalize:function(e){var t=1/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]);return[e[0]*t,e[1]*t,e[2]*t,e[3]*t]},toMatrix:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=i*i,o=i*t,s=i*n,c=i*r,l=t*t,u=t*n,f=t*r,d=n*n,m=n*r,g=r*r,h=a+l+d+g;return[[(a+l-d-g)/h,2*(c+u)/h,2*(f-s)/h,0],[2*(u-c)/h,(a-l+d-g)/h,2*(o+m)/h,0],[2*(s+f)/h,2*(m-o)/h,(a-l-d+g)/h,0],[0,0,0,1]]}}},8197:()=>{window.frag=window.frag||{},window.frag.Triangle={makeTriangleFromVectors:function(e,t,n){return{a:e,b:t,c:n}},makeTriangleFromArray2D:function(e,t,n,r){return e?{a:[e[t],e[t+1]],b:[e[n],e[n+1]],c:[e[r],e[r+1]]}:null},makeTriangleFromArray3D:function(e,t,n,r){return e?{a:[e[t],e[t+1],e[t+2]],b:[e[n],e[n+1],e[n+2]],c:[e[r],e[r+1],e[r+2]]}:null},normal:function(e){const t=window.frag.Vector,n=t.sub(e.a,e.b),r=t.sub(e.c,e.b);return t.normalize(t.cross(n,r))}}},6601:()=>{window.frag=window.frag||{},window.frag.Vector={extract2D:function(e,t){return e?[e[t=t||0],e[t+1]]:null},extract3D:function(e,t){return e?[e[t=t||0],e[t+1],e[t+2]]:null},zero:function(e){const t=[0,0,0,0,0];return t.length=e,t},add:function(e,t){const n=[];if(Array.isArray(t))for(let r=0;r<e.length;r++)n.push(e[r]+t[r]);else for(let r=0;r<e.length;r++)n.push(e[r]+t);return n},sub:function(e,t){const n=[];if(Array.isArray(t))for(let r=0;r<e.length;r++)n.push(e[r]-t[r]);else for(let r=0;r<e.length;r++)n.push(e[r]-t);return n},mult:function(e,t){const n=[];if(Array.isArray(t))for(let r=0;r<e.length;r++)n.push(e[r]*t[r]);else for(let r=0;r<e.length;r++)n.push(e[r]*t);return n},div:function(e,t){const n=[];if(Array.isArray(t))for(let r=0;r<e.length;r++)n.push(e[r]/t[r]);else for(let r=0;r<e.length;r++)n.push(e[r]/t);return n},length:function(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n]*e[n];return Math.sqrt(t)},average:function(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(.5*(e[r]+t[r]));return n},cross:function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},dot:function(e,t){let n=0;for(let r=0;r<e.length;r++)n+=e[r]*t[r];return n},normalize:function(e){const t=window.frag.Vector.length(e);if(t<1e-5)return e;const n=[];for(let r=0;r<e.length;r++)n.push(e[r]/t);return n},append:function(e,t){for(let n=0;n<t.length;n++)e.push(t[n])},heading:function(e,t){const n=window.frag.Vector;t||(t=[0,1,0]);const r=n.normalize(e),i=n.normalize(t),a=Math.asin(r[1]),o=Math.atan2(r[0],r[2]),s=[-r[2],0,r[0]],c=n.cross(s,r);return[Math.atan2(n.dot(s,i),n.dot(c,i)),o,a]},quaternion:function(e){return window.frag.Vector.quaternionXYZ(e[0],e[1],e[2])},quaternionXYZ:function(e,t,n){const r=Math.cos(.5*e),i=Math.sin(.5*e),a=Math.cos(.5*t),o=Math.sin(.5*t),s=Math.cos(.5*n),c=Math.sin(.5*n);return[i*a*s-r*o*c,r*o*s+i*a*c,r*a*c-i*o*s,r*a*s+i*o*c]},euler:function(e){return window.frag.Vector.eulerXYZW(e[0],e[1],e[2],e[3])},eulerXYZW:function(e,t,n,r){const i=2*(r*e+t*n),a=1-2*(e*e+t*t),o=2*(r*t-n*e),s=2*(r*n+e*t),c=1-2*(t*t+n*n);return[Math.atan2(i,a),Math.abs(o)>=1?Math.PI*(o>0?.5:-.5):Math.asin(o),Math.atan2(s,c)]}}},5858:()=>{window.frag.CustomParticleEmitter=function(e){const t={name:"Custom",birthRange:10,birthMiddle:30,lifetimeRange:10,lifetimeMiddle:30,xPositionRange:0,xPositionMiddle:0,yPositionRange:0,yPositionMiddle:0,zPositionRange:0,zPositionMiddle:0,xVelocityRange:10,xVelocityMiddle:5,yVelocityRange:10,yVelocityMiddle:5,zVelocityRange:10,zVelocityMiddle:5,xAccelerationRange:0,xAccelerationMiddle:0,yAccelerationRange:0,yAccelerationMiddle:0,zAccelerationRange:0,zAccelerationMiddle:0,xOrientationRange:0,xOrientationMiddle:0,yOrientationRange:0,yOrientationMiddle:0,zOrientationRange:0,zOrientationMiddle:0,wOrientationRange:0,wOrientationMiddle:0,redRange:1,redMiddle:.5,greenRange:1,greenMiddle:.5,blueRange:1,blueMiddle:.5,alphaRange:.25,alphaMiddle:.25,startSizeRange:.25,startSizeMiddle:.5,sizeIncreaseRange:.5,sizeIncreaseMiddle:.25,frameStartRange:0,frameStartMiddle:0,spinStartRange:0,spinStartMiddle:0,spinSpeedRange:0,spinSpeedMiddle:0},n={__private:t,dispose:function(){},name:function(e){return t.name=e,n}};return t.random=Math.random,n.random=function(e){return t.random=e,n},n.randomValue=function(e,n,r){return t.distribution(t.random(),e,n,r)},t.distribution=function(e,t,n,r){return(n=n||0)+t*(e-.5)},n.distribution=function(e){return t.distribution=e,n},t.lifetime=function(){return n.randomValue(t.lifetimeRange,t.lifetimeMiddle,"lifetime")},n.lifetime=function(e){return t.lifetime=e,n},n.lifetimeRange=function(e,r){return t.lifetimeRange=r-e,t.lifetimeMiddle=.5*(r+e),n},t.position=function(){return[n.randomValue(t.xPositionRange,t.xPositionMiddle,"position"),n.randomValue(t.yPositionRange,t.yPositionMiddle,"position"),n.randomValue(t.zPositionRange,t.zPositionMiddle,"position")]},n.position=function(e){return t.position=e,n},n.positionRange=function(e,r){return t.xPositionRange=r[0]-e[0],t.xPositionMiddle=.5*(r[0]+e[0]),t.yPositionRange=r[1]-e[1],t.yPositionMiddle=.5*(r[1]+e[1]),t.zPositionRange=r[2]-e[2],t.zPositionMiddle=.5*(r[2]+e[2]),n},t.velocity=function(){return[n.randomValue(t.xVelocityRange,t.xVelocityMiddle,"velocity"),n.randomValue(t.yVelocityRange,t.yVelocityMiddle,"velocity"),n.randomValue(t.zVelocityRange,t.zVelocityMiddle,"velocity")]},n.velocity=function(e){return t.velocity=e,n},n.velocityRange=function(e,r){return t.xVelocityRange=r[0]-e[0],t.xVelocityMiddle=.5*(r[0]+e[0]),t.yVelocityRange=r[1]-e[1],t.yVelocityMiddle=.5*(r[1]+e[1]),t.zVelocityRange=r[2]-e[2],t.zVelocityMiddle=.5*(r[2]+e[2]),n},t.acceleration=function(){return[n.randomValue(t.xAccelerationRange,t.xAccelerationMiddle,"acceleration"),n.randomValue(t.yAccelerationRange,t.yAccelerationMiddle,"acceleration"),n.randomValue(t.zAccelerationRange,t.zAccelerationMiddle,"acceleration")]},n.acceleration=function(e){return t.acceleration=e,n},n.accelerationRange=function(e,r){return t.xAccelerationRange=r[0]-e[0],t.xAccelerationMiddle=.5*(r[0]+e[0]),t.yAccelerationRange=r[1]-e[1],t.yAccelerationMiddle=.5*(r[1]+e[1]),t.zAccelerationRange=r[2]-e[2],t.zAccelerationMiddle=.5*(r[2]+e[2]),n},t.orientation=function(){return[n.randomValue(t.xOrientationRange,t.xOrientationMiddle,"orientation"),n.randomValue(t.yOrientationRange,t.yOrientationMiddle,"orientation"),n.randomValue(t.zOrientationRange,t.zOrientationMiddle,"orientation"),n.randomValue(t.wOrientationRange,t.wOrientationMiddle,"orientation")]},n.orientation=function(e){return t.orientation=e,n},n.orientationRange=function(e,r){return t.xOrientationRange=r[0]-e[0],t.xOrientationMiddle=.5*(r[0]+e[0]),t.yOrientationRange=r[1]-e[1],t.yOrientationMiddle=.5*(r[1]+e[1]),t.zOrientationRange=r[2]-e[2],t.zOrientationMiddle=.5*(r[2]+e[2]),t.wOrientationRange=r[3]-e[3],t.wOrientationMiddle=.5*(r[3]+e[3]),n},t.color=function(){const e=n.randomValue(t.redRange,t.redMiddle,"color"),r=n.randomValue(t.greenRange,t.greenMiddle,"color"),i=n.randomValue(t.blueRange,t.blueMiddle,"color");let a=1/e;return r>e&&(a=1/r),i>e&&i>r&&(a=1/i),[e*a,r*a,i*a,n.randomValue(t.alphaRange,t.alphaMiddle,"aplha")]},n.color=function(e){return t.color=e,n},n.colorRange=function(e,r){return t.redRange=r[0]-e[0],t.redMiddle=.5*(r[0]+e[0]),t.greenRange=r[1]-e[1],t.greenMiddle=.5*(r[1]+e[1]),t.blueRange=r[2]-e[2],t.blueMiddle=.5*(r[2]+e[2]),t.alphaRange=r[3]-e[3],t.alphaMiddle=.5*(r[3]+e[3]),n},t.startSize=function(){return n.randomValue(t.startSizeRange,t.startSizeMiddle,"size")},t.endSize=function(e){return e+n.randomValue(t.sizeIncreaseRange,t.sizeIncreaseMiddle,"size")},n.startSize=function(e){return t.startSize=e,n},n.startSizeRange=function(e,r){return t.startSizeRange=r-e,t.startSizeMiddle=.5*(r+e),n},n.endSize=function(e){return t.endSize=e,n},n.sizeRange=function(e,r,i,a){return t.startSizeRange=r-e,t.startSizeMiddle=.5*(r+e),t.sizeIncreaseRange=a-i,t.sizeIncreaseMiddle=.5*(a+i),n},t.frameStart=function(){return Math.floor(n.randomValue(t.lifetimeRange,t.lifetimeMiddle,"frame"))},n.frameStart=function(e){return t.frameStart=e,n},n.frameStartRange=function(e,r){return t.frameStartRange=r-e,t.frameStartMiddle=.5*(r+e),n},t.spinStart=function(){return n.randomValue(t.spinStartRange,t.spinStartMiddle,"spin")},n.spinStart=function(e){return t.spinStart=e,n},n.spinStartRange=function(e,r){return t.spinStartRange=r-e,t.spinStartMiddle=.5*(r+e),n},t.spinSpeed=function(){return n.randomValue(t.spinSpeedRange,t.spinSpeedMiddle,"spin")},n.spinSpeed=function(e){return t.spinSpeed=e,n},n.spinSpeedRange=function(e,r){return t.spinSpeedRange=r-e,t.spinSpeedMiddle=.5*(r+e),n},t.adjust=null,n.adjust=function(e){return t.adjust=e,n},n.createParticle=function(){const e={lifetime:t.lifetime(),position:t.position(),velocity:t.velocity(),acceleration:t.acceleration(),orientation:t.orientation(),color:t.color(),startSize:t.startSize(),frameStart:t.frameStart(),spinStart:t.spinStart(),spinSpeed:t.spinSpeed()};return e.endSize=t.endSize(e.startSize),t.adjust&&t.adjust(e),e},t.birthParticle=n.createParticle,n.birthParticle=function(e){return t.birthParticle=e,particle},n.birthRate=function(e,r){return t.birthRange=r-e,t.birthMiddle=.5*(r+e),n},n.birthParticles=function(){const e=[],r=Math.floor(n.randomValue(t.birthRange,t.birthMiddle,"rate"));for(let n=0;n<r;n++)e.push(t.birthParticle());return e},n}},4924:()=>{window.frag.CustomParticleSystem=function(e,t,n){void 0!==n&&(t=n.is3d),void 0===t&&(t=!0);const r=window.frag,i=e.gl,a=16384,o={name:"Custom",shader:n||(t?r.ParticleShader3D(e):r.ParticleShader2D(e)),location:window.frag.Location(e,t),lifetimeGameTickInterval:10,nextLifetimeGameTick:0,emitters:{},particles:[],enabled:!0,rampTexture:null,colorTexture:null,particleBuffer:i.createBuffer(),indexBuffer:i.createBuffer(),aliveCount:0,bufferedIndexCount:0,bufferedParticleCount:0,nextEmitterId:0,velocity:[0,0,0],acceleration:[0,0,0],timeRange:99999999,timeOffset:0,numFrames:4,frameDuration:1},s={__private:o,parent:null},c=[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]];return o.rampTexture=r.Texture(e).name("particle-ramp-texture").dataFormat(i.RGBA).fromArrayBuffer(0,new Uint8Array([255,255,255,255,255,255,255,0]),0,2,1),o.colorTexture=r.Texture(e).name("particle-color-texture").dataFormat(i.RGBA).fromArrayBuffer(0,new Uint8Array([255,255,255,255]),0,1,1),o.checkError=function(e){const t=i.getError();0!==t&&console.error(o.name,"error",t,"in",e)},o.populateParticleBuffer=function(e,t,n){let r=n,i=n+1,a=n+2,o=n+3;if(e)for(let n=0;n<4;n++)t[r+0]=c[n][0],t[i+0]=c[n][1],t[a+0]=e.lifetime,t[o+0]=e.frameStart,t[r+4]=e.position[0],t[i+4]=e.position[1],t[a+4]=e.position[2],t[o+4]=e.startTime,t[r+8]=e.velocity[0],t[i+8]=e.velocity[1],t[a+8]=e.velocity[2],t[o+8]=e.startSize,t[r+16]=e.spinStart,t[i+16]=e.spinSpeed,t[a+16]=0,t[o+16]=0,t[r+12]=e.acceleration[0],t[i+12]=e.acceleration[1],t[a+12]=e.acceleration[2],t[o+12]=e.endSize,t[r+20]=e.orientation[0],t[i+20]=e.orientation[1],t[a+20]=e.orientation[2],t[o+20]=e.orientation[3],t[r+24]=e.color[0],t[i+24]=e.color[1],t[a+24]=e.color[2],t[o+24]=e.color[3],r+=28,i+=28,a+=28,o+=28;else t.fill(0,n,n+112-1)},o.bufferParticleRange=function(t,n){if(t>=o.aliveCount)return;t+n>o.aliveCount&&(n=o.aliveCount-t-1);const r=new Float32Array(112*n);let a=0;for(let e=t;e<t+n;e++)o.populateParticleBuffer(o.particles[e],r,a),a+=112;i.bindBuffer(i.ARRAY_BUFFER,o.particleBuffer),i.bufferSubData(i.ARRAY_BUFFER,r.particleFloatCount*r.BYTES_PER_ELEMENT*t,r),o.checkError("bufferSubData"),e.debugParticles&&console.log(o.name,"copied particles",t,"-",t+n-1,"to the GPU")},o.bufferSpecificParticles=function(e){let t=0,n=0;for(let r=0;r<e.length;r++){const i=e[r];if(r>0){const a=e[r-1];if(a===i)continue;a!==i+1&&n>0&&(o.bufferParticleRange(t,n),n=0)}t=i,n++}n>0&&o.bufferParticleRange(t,n)},o.bufferAllParticles=function(){const t=o.aliveCount+500;for(;o.particles.length<t;)o.particles.push(null);const n=new Float32Array(112*t);let r=0;for(let e=0;e<t;e++)o.populateParticleBuffer(o.particles[e],n,r),r+=112;i.bindBuffer(i.ARRAY_BUFFER,o.particleBuffer),i.bufferData(i.ARRAY_BUFFER,n,i.DYNAMIC_DRAW),o.checkError("bufferData for particle buffer"),o.bufferedParticleCount=t,e.debugParticles&&console.log(o.name,"initialized GPU particle buffer with",t,"particles")},o.bufferIndexes=function(){let t=o.particles.length;if(t>a&&(t=a),!(o.bufferedIndexCount>=t)){var n=new Uint16Array(6*t),r=0,s=0;for(let e=0;e<t;e++)n[r++]=s+0,n[r++]=s+1,n[r++]=s+2,n[r++]=s+0,n[r++]=s+2,n[r++]=s+3,s+=4;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,o.indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,n,i.STATIC_DRAW),o.checkError("bufferData for index buffer"),o.bufferedIndexCount=t,e.debugParticles&&console.log(o.name,"initialized GPU index buffer with",t,"particle index")}},s.dispose=function(){s.disable(),s.parent&&s.parent.removeObject(s),o.particleBuffer&&(i.deleteBuffer(o.particleBuffer),o.particleBuffer=null),o.indexBuffer&&(i.deleteBuffer(o.indexBuffer),o.indexBuffer=null),o.rampTexture&&(o.rampTexture.dispose(),o.rampTexture=null),o.colorTexture&&(o.colorTexture.dispose(),o.colorTexture=null)},s.name=function(e){return o.name=e,s},s.getName=function(){return o.name},s.getLocation=function(){return o.location},s.getPosition=function(){return o.position||(o.position=r.ScenePosition(e,o.location)),o.position},s.enable=function(){return o.enabled=!0,s},s.disable=function(){return o.enabled=!1,s},s.rampTexture=function(e){return o.rampTexture&&o.rampTexture.dispose(),o.rampTexture=e,s},s.colorTexture=function(e){return o.colorTexture&&o.colorTexture.dispose(),o.colorTexture=e,s},s.lifetimeGameTickInterval=function(e){return o.lifetimeGameTickInterval=e,s},s.velocity=function(e){return o.velocity=e,s},s.acceleration=function(e){return o.acceleration=e,s},s.timeRange=function(e){return o.timeRange=e,s},s.timeOffset=function(e){return o.timeOffset=e,s},s.numFrames=function(e){return o.numFrames=e,s},s.frameDuration=function(e){return o.frameDuration=e,s},s.addEmitter=function(e){return e.id=o.nextEmitterId++,o.emitters[e.id]=e,s},s.removeEmitter=function(e){return!!o.emitters[e.id]&&(delete o.emitters[e.id],!0)},o.draw=function(t){const n=o.shader;n.bind(),o.rampTexture.apply("rampSampler",n),o.colorTexture.apply("colorSampler",n),void 0!==n.uniforms.clipMatrix&&r.Transform(e,t.state.modelToClipMatrix).apply(n.uniforms.clipMatrix),void 0!==n.uniforms.modelMatrix&&r.Transform(e,t.state.modelToWorldMatrix).apply(n.uniforms.modelMatrix),void 0!==n.uniforms.clipMatrixInverse&&r.Transform(e,r.Matrix.m4Invert(t.state.modelToClipMatrix)).apply(n.uniforms.clipMatrixInverse),void 0!==n.time&&n.time(e.getElapsedSeconds()),void 0!==n.velocity&&n.velocity(o.velocity),void 0!==n.acceleration&&n.acceleration(o.acceleration),void 0!==n.timeRange&&n.timeRange(o.timeRange),void 0!==n.timeOffset&&n.timeOffset(o.timeOffset),void 0!==n.numFrames&&n.numFrames(o.numFrames),void 0!==n.frameDuration&&n.frameDuration(o.frameDuration);const s=function(e,t,n){e>=0&&(i.vertexAttribPointer(e,4,i.FLOAT,!1,112,4*t),o.checkError("vertexAttribPointer"),i.enableVertexAttribArray(e),o.checkError("enableVertexAttribArray"),n.push((function(){i.disableVertexAttribArray(e)})))};i.bindBuffer(i.ARRAY_BUFFER,o.particleBuffer),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,o.indexBuffer);const c=[];s(n.attributes.uvLifeTimeFrameStart,0,c),s(n.attributes.positionStartTime,4,c),s(n.attributes.velocityStartSize,8,c),s(n.attributes.accelerationEndSize,12,c),s(n.attributes.spinStartSpinSpeed,16,c),s(n.attributes.orientation,20,c),s(n.attributes.colorMult,24,c);let l=o.aliveCount;l>a&&(l=a),i.drawElements(i.TRIANGLES,6*l,i.UNSIGNED_SHORT,0),o.checkError("drawElements");for(let e=0;e<c.length;e++)c[e]()},o.addAndRemoveParticles=function(t){const n=e.getElapsedSeconds(),r=[];for(let e=0;e<o.particles.length;e++){const t=o.particles[e];if(t)if(n>t.startTime+t.lifetime)r.push(e);else{const n=o.emitters[t.id];n&&n.isDead&&n.isDead(t)&&r.push(e)}}if(r.length){r.sort((function(e,t){return t-e}));for(let e=0;e<r.length;e++){const t=r[e];o.aliveCount--,o.particles[t]=o.particles[o.aliveCount],o.particles[o.aliveCount]=null}}for(var i in o.aliveCount,o.emitters){const e=o.emitters[i].birthParticles(s,n);if(e)for(let t=0;t<e.length;t++){const r=e[t];r.id=i,r.startTime=n,void 0===r.lifetime&&(r.lifetime=5),void 0===r.frameStart&&(r.frameStart=0),void 0===r.spinStart&&(r.spinStart=0),void 0===r.spinSpeed&&(r.spinSpeed=0),void 0===r.startSize&&(r.startSize=1),void 0===r.endSize&&(r.endSize=r.startSize),void 0===r.position&&(r.position=[0,0,0]),void 0===r.velocity&&(r.velocity=[0,1,0]),void 0===r.acceleration&&(r.acceleration=[0,0,0]),void 0===r.orientation&&(r.orientation=[0,0,0,0]),void 0===r.color&&(r.color=[1,1,1,1]),o.particles.length>o.aliveCount?o.particles[o.aliveCount]=r:o.particles.push(r),o.aliveCount++,o.aliveCount>a&&console.error(o.name,"has too many particles")}}e.debugParticles&&console.log(o.name,"alive="+o.aliveCount+"/"+o.particles.length,", GPU particles="+o.bufferedParticleCount,", GPU index="+o.bufferedIndexCount);const c=o.aliveCount+500;o.particles.length>c&&(o.particles.length=c),o.bufferAllParticles(),e.debugParticles&&console.log(o.name,"copied all",o.aliveCount,"alive particles to the GPU"),o.bufferIndexes(),e.debugParticles&&console.log("")},s.draw=function(e){return e.isHitTest?s:(e.gameTick>=o.nextLifetimeGameTick&&(o.addAndRemoveParticles(e),o.nextLifetimeGameTick=e.gameTick+o.lifetimeGameTickInterval),o.enabled?(e.beginSceneObject(s),o.draw(e),e.endSceneObject(),s):s)},s}},2412:()=>{window.frag.MineExplosionEmitter=function(e,t,n){const r=window.frag.CustomParticleEmitter(e).name("Mine").birthRate(100,100).lifetime((function(){return 2})).position((function(){return t})).velocityRange([-.1*n,.8*n,-.1*n],[.1*n,1.2*n,.1*n]).acceleration((function(){return[0,0,0]})).startSize((function(){return.5})).endSize((function(){return.5})).frameStart((function(){return 0})).spinStart((function(){return 0})).spinSpeed((function(){return 0})).adjust((function(e){e.acceleration=[1.2*e.velocity[0],0,1.2*e.velocity[2]]}));return r.fire=function(e,t){t=t||500,e.addEmitter(r),setTimeout((function(){e.removeEmitter(r)}),t)},r}},3957:()=>{window.frag.RainEmitter=function(e,t,n,r,i,a,o){const s=.05*window.frag.Vector.length(a),c=window.frag.CustomParticleEmitter(e).name("Rain").birthRate(.05*o,o).lifetime((function(){return i})).position((function(){return window.frag.Vector.add(t,[c.randomValue(n),0,c.randomValue(r)])})).velocity((function(){return window.frag.Vector.mult(a,c.randomValue(s,1))})).startSize((function(){return 1.5})).endSize((function(){return 1.5})).color((function(){return[.5,.5,.5,.1]}));return c.stop=function(){c.particleSystem.removeEmitter(c)},c.start=function(e,t){c.particleSystem=e,e.addEmitter(c),t&&setTimeout(c.stop,t)},c}},7818:()=>{window.frag.SphericalExplosionEmitter=function(e,t,n){const r=window.frag.CustomParticleEmitter(e).name("Spherical").lifetime((function(){return 3})).position((function(){return t})).acceleration((function(){return[0,0,0]})).startSize((function(){return.5})).endSize((function(){return.5})).frameStart((function(){return 0})).spinStart((function(){return 0})).spinSpeed((function(){return 0}));return r.birthParticles=function(){const e=[],t=Math.PI/15;for(let i=0;i<=15;i++){const a=Math.PI*(2*i/15-1),o=i<=7.5?2*(i+1):2*(15-i);for(let i=0;i<=o;i++){particle=r.createParticle(),e.push(particle);const s=r.randomValue(t,Math.PI*(2*i/o-1)),c=r.randomValue(t,a);vx=Math.cos(s)*Math.sin(c)*n,vy=Math.cos(c)*n,vz=Math.sin(s)*Math.sin(c)*n,particle.velocity=[vx,vy,vz]}}return e},r.fire=function(e,t){t=t||150,e.addEmitter(r),setTimeout((function(){e.removeEmitter(r)}),t)},r}},3884:()=>{window.frag.SprayEmitter=function(e,t,n,r){const i=window.frag.CustomParticleEmitter(e).name("Spray").birthRate(25,25).lifetime((function(){return 6})).position((function(){return t})).velocity((function(){const e=Array.from(n);for(var t=0;t<3;t++)0===n[t]?e[t]+=i.randomValue(r):e[t]*=i.randomValue(.5,1.5);return e})).startSize((function(){return.5})).endSize((function(){return 1}));return i.stop=function(){i.particleSystem.removeEmitter(i)},i.start=function(e,t){i.particleSystem=e,e.addEmitter(i),t&&setTimeout(i.stop,t)},i}},3533:()=>{window.frag.DrawContext=function(e){const t={stack:[],matriciesChanged:!1,activeShader:null,overrideShader:null},n={__private:t,isHitTest:!1,sceneObjects:null,fragments:null,worldToClipTransform:null,gameTick:0,state:{animationMap:null,childMap:null,modelToWorldMatrix:null,modelToClipMatrix:null,shader:null}};return t.setShader=function(e){e!==t.activeShader&&(t.activeShader&&t.activeShader.unbind(),t.activeShader=e,e&&e.bind())},t.pushState=function(){t.stack.push(n.state),n.state=Object.assign({},n.state)},t.popState=function(){n.state=t.stack.pop(),t.matriciesChanged=!0,t.overrideShader||t.setShader(n.state.shader)},n.forHitTest=function(e){return t.overrideShader=e,n.sceneObjects=[],n.fragments=[],n.isHitTest=!0,n},n.forRender=function(e){return n.gameTick=e,n},n.shader=function(e){return t.overrideShader||(n.state.shader=e,t.setShader(e)),n},n.getShader=function(){return t.activeShader},n.beginScene=function(e){return t.setShader(t.overrideShader),n.worldToClipTransform=e.getCamera().worldToClipTransform,n},n.endScene=function(){return t.setShader(null),n},n.beginSceneObject=function(e){if(t.pushState(),n.sceneObjects&&n.sceneObjects.push(e),e.getShader&&n.shader(e.getShader()),e.getLocation){const r=e.getLocation().getMatrix();if(n.state.animationMap=e.getAnimationMap?e.getAnimationMap():null,n.state.childMap=e.getChildMap?e.getChildMap():null,n.state.modelToWorldMatrix){const e=frag.Matrix;n.worldToClipTransform.is3d?(n.state.modelToWorldMatrix=e.m4Xm4(n.state.modelToWorldMatrix,r),n.state.modelToClipMatrix=e.m4Xm4(n.state.modelToClipMatrix,r)):(n.state.modelToWorldMatrix=e.m3Xm3(n.state.modelToWorldMatrix,r),n.state.modelToClipMatrix=e.m3Xm3(n.state.modelToClipMatrix,r))}else{const e=n.worldToClipTransform.getMatrix();n.state.modelToWorldMatrix=r,n.state.modelToClipMatrix=n.worldToClipTransform.is3d?frag.Matrix.m4Xm4(e,r):frag.Matrix.m3Xm3(e,r)}t.matriciesChanged=!0}return n},n.endSceneObject=function(){return t.popState(),n},n.beginMesh=function(e){t.pushState(),e.getShader&&n.shader(e.getShader());const r=e.getName?e.getName():null,i=n.state.animationMap;let a=e.getLocation();const o=i&&r?i[r]:null;o&&(a=a.clone().add(o.location));const s=a.getMatrix(),c=frag.Matrix;n.worldToClipTransform.is3d?(n.state.modelToWorldMatrix=c.m4Xm4(n.state.modelToWorldMatrix,s),n.state.modelToClipMatrix=c.m4Xm4(n.state.modelToClipMatrix,s)):(n.state.modelToWorldMatrix=c.m3Xm3(n.state.modelToWorldMatrix,s),n.state.modelToClipMatrix=c.m3Xm3(n.state.modelToClipMatrix,s)),t.matriciesChanged=!0},n.endMesh=function(){return t.popState(),n},n.beginFragment=function(r){const i=t.activeShader;if(r&&void 0!==i.uniforms.color&&n.isHitTest){n.fragments.push(r);const t=n.sceneObjects.length-1,a=n.fragments.length-1,o=t>>4,s=(15&t)<<4|(983040&a)>>16,c=(65280&a)>>8,l=255&a;e.gl.uniform4f(i.uniforms.color,o/255,s/255,c/255,l/255)}return t.matriciesChanged&&(void 0!==i.uniforms.clipMatrix&&window.frag.Transform(e,n.state.modelToClipMatrix).apply(i.uniforms.clipMatrix),void 0!==i.uniforms.modelMatrix&&frag.Transform(e,n.state.modelToWorldMatrix).apply(i.uniforms.modelMatrix),t.matriciesChanged=!1),n},n.endFragment=function(){return n},n}},9521:()=>{window.frag.Mesh=function(e){const t=window.frag,n=e.gl,r={glBuffer:n.createBuffer(),meshFragments:[],debugFragments:[],finalized:!1,fromBuffer:!1,smoothShading:!0,smoothTexture:!1,wireframe:!1,normalLength:0,normalColor:[0,0,255]},i={__private:r,calcNormals:!0,calcTangents:!0,calcBitangents:!1,dispose:function(){r.glBuffer&&(n.deleteBuffer(r.glBuffer),r.glBuffer=null)},name:function(e){return r.name=e,i},clear:function(){return r.meshFragments.length=0,r.finalized=!1,i},fragmentsUpdated:function(){r.fromBuffer||(r.finalized=!1)},shadeSmooth:function(){return r.smoothShading=!0,r.finalized=!1,i},shadeFlat:function(){return r.smoothShading=!1,r.finalized=!1,i},textureSmooth:function(){return r.smoothTexture=!0,r.finalized=!1,i},textureFlat:function(){return r.smoothTexture=!1,r.finalized=!1,i},wireframe:function(e){return r.wireframe=!!e,r.finalized=!1,i},drawNormals:function(e,t){return r.normalLength=e,void 0!==t&&(r.normalColor=t),r.finalized=!1,i}};return r.Fragment=function(e,t,n){return{vertexData:e,renderData:null,material:t,uniforms:n,vertexDataOffset:void 0,colorDataOffset:void 0,uvDataOffset:void 0,normalDataOffset:void 0,tangentDataOffset:void 0,bitangentDataOffset:void 0}},r.addFragment=function(e,t,n){const i=r.Fragment(e,t,n);return r.meshFragments.push(i),r.finalized=!1,i},i.addVertexData=function(e,t,n){return r.addFragment(e,t,n)},i.addTriangles2D=function(n){const i=t.VertexData(e).setTriangles2D(n);return r.addFragment(i,n.material,n.uniforms)},i.addTriangles=function(n){const i=t.VertexData(e).setTriangles(n);return r.addFragment(i,n.material,n.uniforms)},i.addTriangleStrip=function(n){const i=t.VertexData(e).setTriangleStrip(n);return r.addFragment(i,n.material,n.uniforms)},i.addTriangleFan=function(n){const i=t.VertexData(e).setTriangleFan(n);return r.addFragment(i,n.material,n.uniforms)},i.fromBuffer=function(i){const a=t.VertexData(e);a.vertexDimensions=i.size,a.vertexCount=i.count,a.primitiveType=i.primitiveType,a.extractTriangles=function(){};const o=r.addFragment(a);return o.renderData=a,o.vertexDataOffset=i.vertexDataOffset,o.colorDataOffset=i.colorDataOffset,o.uvDataOffset=i.uvDataOffset,o.normalDataOffset=i.normalDataOffset,o.tangentDataOffset=i.tangentDataOffset,o.bitangentDataOffset=i.bitangentDataOffset,o.material=i.material,o.uniforms=i.uniforms,n.bindBuffer(n.ARRAY_BUFFER,r.glBuffer),n.bufferData(n.ARRAY_BUFFER,i.buffer,n.STATIC_DRAW),r.finalized=!0,r.fromBuffer=!0,o},r.addFragmentDebugInfo=function(n){if(!r.wireframe&&0==r.normalLength)return;let i=n;r.wireframe||(i=r.Fragment(n.vertexData),r.debugFragments.push(i));const a=[],o=[],s=[],c=[],l=function(e){const t=n.renderData.getVertexVector(e),i=n.renderData.getColor(e),l=n.renderData.getUvVector(e),u=n.renderData.getNormalVector(e);t&&t.forEach((e=>a.push(e))),i?i.forEach((e=>o.push(e))):r.normalColor.forEach((()=>o.push(0))),l&&l.forEach((e=>s.push(e))),u&&u.forEach((e=>c.push(e)))},u=function(e){const t=n.renderData.getVertexVector(e),i=n.renderData.getUvVector(e),l=n.renderData.getNormalVector(e);if(t){for(let e=0;e<t.length;e++)a.push(t[e]);for(let e=0;e<t.length;e++)a.push(t[e]+l[e]*r.normalLength)}r.normalColor.forEach((e=>o.push(e))),r.normalColor.forEach((e=>o.push(e))),i&&(i.forEach((e=>s.push(e))),i.forEach((e=>s.push(e)))),l&&(l.forEach((e=>c.push(e))),l.forEach((e=>c.push(e))))};n.vertexData.extractTriangles((function(e,t,n){r.wireframe&&(l(e),l(t),l(t),l(n),l(n),l(e)),r.normalLength>0&&(u(e),u(t),u(t))})),2==n.vertexData.vertexDimensions?i.renderData=t.VertexData(e).setLines2D({verticies:a,colors:o,uvs:s,normals:c}):i.renderData=t.VertexData(e).setLines({verticies:a,colors:o,uvs:s,normals:c})},r.finalize=function(){r.finalized=!0;const a=t.MeshOptimizer(e).setFragments(r.meshFragments).initialize(r.smoothShading,r.smoothTexture);i.calcTangents&&a.calcTangentsFromUvs(),i.calcBitangents&&a.calcBitangentsFromUvs(),i.calcNormals&&a.calcNormalsFromCross(),i.calcNormals&&a.calcNormalsFromGeometry(),i.calcBitangents&&a.calcBitangentsFromCross(),r.debugFragments=[],r.meshFragments.forEach((e=>{r.addFragmentDebugInfo(e)}));let o=0;const s=function(e){o+=e.renderData.verticies.length,e.renderData.colors&&(o+=e.renderData.colors.length),e.renderData.uvs&&(o+=e.renderData.uvs.length),e.renderData.normals&&(o+=e.renderData.normals.length),e.renderData.tangents&&(o+=e.renderData.tangents.length),e.renderData.bitangents&&(o+=e.renderData.bitangents.length)};r.meshFragments.forEach(s),r.debugFragments.forEach(s);const c=new Float32Array(o);let l=0;const u=function(e){if(!e)return;for(let t=0;t<e.length;t++)c[l+t]=e[t];const t=l;return l+=e.length,t*Float32Array.BYTES_PER_ELEMENT},f=function(e){e.vertexDataOffset=u(e.renderData.verticies),e.colorDataOffset=u(e.renderData.colors),e.uvDataOffset=u(e.renderData.uvs),e.normalDataOffset=u(e.renderData.normals),e.tangentDataOffset=u(e.renderData.tangents),e.bitangentDataOffset=u(e.renderData.bitangents)};return r.meshFragments.forEach(f),r.debugFragments.forEach(f),n.bindBuffer(n.ARRAY_BUFFER,r.glBuffer),n.bufferData(n.ARRAY_BUFFER,c,n.STATIC_DRAW),i},r.bindFragmentPosition=function(e,t,r){e.attributes.position>=0&&null!=t.vertexDataOffset&&(n.vertexAttribPointer(e.attributes.position,t.renderData.vertexDimensions,n.FLOAT,!1,0,t.vertexDataOffset),n.enableVertexAttribArray(e.attributes.position),r.push((function(){n.disableVertexAttribArray(e.attributes.position)})))},r.bindFragmentColor=function(e,t,r){e.attributes.color>=0&&null!=t.colorDataOffset&&(n.vertexAttribPointer(e.attributes.color,t.renderData.colorDimensions,n.FLOAT,!1,0,t.colorDataOffset),n.enableVertexAttribArray(e.attributes.color),r.push((function(){n.disableVertexAttribArray(e.attributes.color)})))},r.bindFragmentTexture=function(e,t,r){e.attributes.texcoord>=0&&null!=t.uvDataOffset&&(n.vertexAttribPointer(e.attributes.texcoord,t.renderData.uvDimensions,n.FLOAT,!1,0,t.uvDataOffset),n.enableVertexAttribArray(e.attributes.texcoord),r.push((function(){n.disableVertexAttribArray(e.attributes.texcoord)})))},r.bindFragmentNormals=function(e,t,r){e.attributes.normal>=0&&null!=t.normalDataOffset&&(n.vertexAttribPointer(e.attributes.normal,t.renderData.normalDimensions,n.FLOAT,!0,0,t.normalDataOffset),n.enableVertexAttribArray(e.attributes.normal),r.push((function(){n.disableVertexAttribArray(e.attributes.normal)})))},r.bindFragmentTangents=function(e,t,r){e.attributes.tangent>=0&&null!=t.tangentDataOffset&&(n.vertexAttribPointer(e.attributes.tangent,t.renderData.normalDimensions,n.FLOAT,!0,0,t.tangentDataOffset),n.enableVertexAttribArray(e.attributes.tangent),r.push((function(){n.disableVertexAttribArray(e.attributes.tangent)})))},r.bindFragmentBitangents=function(e,t,r){e.attributes.bitangent>=0&&null!=t.bitangentDataOffset&&(n.vertexAttribPointer(e.attributes.bitangent,t.renderData.normalDimensions,n.FLOAT,!0,0,t.bitangentDataOffset),n.enableVertexAttribArray(e.attributes.bitangent),r.push((function(){n.disableVertexAttribArray(e.attributes.bitangent)})))},r.drawFragment=function(e,t){const i=[];if(t.material&&t.material.apply(e),t.uniforms)for(let r=0;r<t.uniforms.length;r++){const a=t.uniforms[r],o=e.uniforms[a.name];if(void 0!==o){const t=a.name[0].toUpperCase()+a.name.substring(1),r=e["override"+t];r?r(a.value):a.type?n["uniform"+a.type](o,a.value):console.error("To override a uniform on a mesh fragment you must specify the type either in the override or in the uniform definition on the shader");const s=e["restore"+t];s&&i.push(s)}}r.bindFragmentPosition(e,t,i),r.bindFragmentColor(e,t,i),r.bindFragmentTexture(e,t,i),r.bindFragmentNormals(e,t,i),r.bindFragmentTangents(e,t,i),r.bindFragmentBitangents(e,t,i),n.drawArrays(t.renderData.primitiveType,0,t.renderData.vertexCount);for(let e=0;e<i.length;e++)i[e]()},i.draw=function(t,n){const a=t.getShader();if(!a)return i;r.finalized||r.fromBuffer||r.finalize();const o=e.gl;o.bindBuffer(o.ARRAY_BUFFER,r.glBuffer);for(let e=0;e<r.meshFragments.length;e++){const i=r.meshFragments[e];t.beginFragment(n(i,e)),r.drawFragment(a,i),t.endFragment()}if(!t.isHitTest)for(let e=0;e<r.debugFragments.length;e++){const t=r.debugFragments[e];r.drawFragment(a,t)}return i},i}},1003:()=>{window.frag.MeshOptimizer=function(e){const t=window.frag,n={meshFragments:null,smoothShading:!0,smoothTexture:!1,fragmentTriangles:null,groups:null,groupIndecies:null},r={__private:n,dispose:function(){}};return n.ensureTriangles=function(){n.fragmentTriangles||(n.fragmentTriangles=[],n.meshFragments.forEach((e=>{const r=e.vertexData,i={triangles:[],vertexTriangleIndecies:[]};i.vertexTriangleIndecies.length=r.vertexCount,r.verticies&&r.extractTriangles((function(e,n,a){const o=r.getVertexVector(e),s=r.getVertexVector(n),c=r.getVertexVector(a),l={triangle:t.Triangle.makeTriangleFromVectors(o,s,c),normal:null,tangent:null,bitangent:null};if(l.normal=t.Triangle.normal(l.triangle),r.uvs){const i=r.getUvVector(e),u=r.getUvVector(n),f=r.getUvVector(a),d=t.Vector,m=d.sub(s,o),g=d.sub(c,o),h=d.sub(u,i),v=d.sub(f,i),p=h[0]*v[1]-h[1]*v[0];if(0===p)l.tangent=d.zero(r.normalDimensions),l.bitangent=d.zero(r.normalDimensions);else{const e=1/p;l.tangent=d.normalize(d.mult(d.sub(d.mult(m,v[1]),d.mult(g,h[1])),e)),l.bitangent=d.normalize(d.mult(d.sub(d.mult(g,h[0]),d.mult(m,v[0])),e))}}i.triangles.push(l);const u=i.triangles.length-1;i.vertexTriangleIndecies[e]=u,i.vertexTriangleIndecies[n]=u,i.vertexTriangleIndecies[a]=u})),n.fragmentTriangles.push(i)})))},n.ensureGroups=function(){if(n.groups)return;n.groups=[],n.groupIndecies={};const e=function(e,t,n){if(e.vertexDimensions!==n.length)return!1;const r=e.vertexIndex(t);for(var i=0;i<n.length;i++)if(Math.abs(e.verticies[r+i]-n[i])>1e-5)return!1;return!0};for(let i=0;i<n.meshFragments.length;i++){const a=n.meshFragments[i],o=n.groupIndecies[i]||[];if(n.groupIndecies[i]=o,a.vertexData.verticies)for(let s=0;s<a.vertexData.vertexCount;s++){let c=!1;for(var r=0;!c&&r<n.groups.length;r++){const t=n.groups[r];e(a.vertexData,s,t.vertex)&&(t.fragmentIndecies[i]=t.fragmentIndecies[i]||[],t.fragmentIndecies[i].push(s),o.push(r),c=!0)}if(!c){o.push(n.groups.length);const e={vertex:a.vertexData.getVertexVector(s),fragmentIndecies:{},normal:t.Vector.zero(a.vertexData.normalDimensions),uv:t.Vector.zero(a.vertexData.uvDimensions)};e.fragmentIndecies[i]=[s],n.groups.push(e)}}}},n.calcGroupNormals=function(){n.ensureGroups();for(let e=0;e<n.groups.length;e++){const r=n.groups[e];r.normal=t.Vector.zero(n.meshFragments[0].renderData.normalDimensions);for(const e in r.fragmentIndecies){const i=n.meshFragments[e],a=i.renderData?i.renderData:i.vertexData;if(a&&a.normals){const n=r.fragmentIndecies[e];for(let e=0;e<n.length;e++){const i=n[e],o=a.getNormalVector(i);r.normal=t.Vector.add(r.normal,o)}}}r.normal=t.Vector.normalize(r.normal)}},n.calcGroupUvs=function(){n.ensureGroups();for(let e=0;e<n.groups.length;e++){const t=n.groups[e];for(const e in t.fragmentIndecies){const r=n.meshFragments[e],i=r.renderData?r.renderData:r.vertexData;if(i){const n=t.fragmentIndecies[e];if(n.length>0){const e=n[0];t.uv=i.getUvVector(e)}}}}},n.calcSmoothShading=function(){for(let e=0;e<n.meshFragments.length;e++)if(!n.meshFragments[e].renderData.normals)return;n.calcGroupNormals();for(let r=0;r<n.meshFragments.length;r++){const i=n.meshFragments[r].renderData,a=n.groupIndecies[r];if(a.length){i.normals=[];for(var e=0;e<i.vertexCount;e++){const r=n.groups[a[e]];for(var t=0;t<i.normalDimensions;t++)i.normals.push(r.normal[t])}}}},n.calcSmoothTexture=function(){n.calcGroupUvs();for(let r=0;r<n.meshFragments.length;r++){const i=n.meshFragments[r].renderData,a=n.groupIndecies[r];if(a.length){i.uvs=[];for(var e=0;e<i.vertexCount;e++){const r=n.groups[a[e]];for(var t=0;t<i.uvDimensions;t++)i.uvs.push(r.uv[t])}}}},r.setFragments=function(e){return n.meshFragments=e,r},r.initialize=function(e,t){return n.smoothShading=e,n.smoothTexture=t,n.meshFragments.forEach((e=>{e.renderData=e.vertexData.clone()})),t&&n.calcSmoothTexture(),r},r.calcTangentsFromUvs=function(){for(let t=0;t<n.meshFragments.length;t++){const r=n.meshFragments[t],i=r.renderData,a=r.vertexData;if(!i.tangents)if(a.tangents){i.tangents=[];for(let t=0;t<a.vertexCount;t++)for(var e=0;e<a.normalDimensions;e++)i.tangents.push(a.tangents[a.tangentIndex(t,e)])}else if(i.uvs){n.ensureTriangles();const e=n.fragmentTriangles[t];if(e&&e.triangles){i.tangents=[],i.tangents.length=i.normalDimensions*i.vertexCount;for(let t=0;t<i.vertexCount;t++){const n=e.vertexTriangleIndecies[t],r=e.triangles[n];r&&i.setTangentVector(t,r.tangent)}}}}return r},r.calcBitangentsFromUvs=function(){for(let t=0;t<n.meshFragments.length;t++){const r=n.meshFragments[t],i=r.renderData,a=r.vertexData;if(!i.bitangents)if(a.bitangents){i.bitangents=[];for(let t=0;t<a.vertexCount;t++)for(var e=0;e<a.normalDimensions;e++)i.bitangents.push(a.bitangents[a.bitangentIndex(t,e)])}else if(i.uvs){n.ensureTriangles();const e=n.fragmentTriangles[t];if(e&&e.triangles){i.bitangents=[],i.bitangents.length=i.normalDimensions*i.vertexCount;for(let t=0;t<i.vertexCount;t++){const n=e.vertexTriangleIndecies[t],r=e.triangles[n];r&&i.setBitangentVector(t,r.bitangent)}}}}return r},r.calcNormalsFromCross=function(){for(let r=0;r<n.meshFragments.length;r++){const i=n.meshFragments[r],a=i.renderData,o=i.vertexData;if(!a.normals)if(o.normals){a.normals=[];for(let t=0;t<o.vertexCount;t++)for(var e=0;e<o.normalDimensions;e++)a.normals.push(o.normals[o.normalIndex(t,e)])}else if(a.tangents&&a.bitangents){a.normals=[];for(let n=0;n<o.vertexCount;n++){const r=a.getTangentVector(n),i=a.getBitangentVector(n),o=t.Vector.cross(r,i);for(e=0;e<o.length;e++)a.normals.push(o[e])}}}return n.smoothShading&&n.calcSmoothShading(),r},r.calcNormalsFromGeometry=function(){for(let t=0;t<n.meshFragments.length;t++){const r=n.meshFragments[t],i=r.renderData,a=r.vertexData;if(!i.normals)if(a.normals){i.normals=[];for(let t=0;t<a.vertexCount;t++)for(var e=0;e<a.normalDimensions;e++)i.normals.push(a.normals[a.normalIndex(t,e)])}else{n.ensureTriangles();const e=n.fragmentTriangles[t];if(e&&e.triangles){i.normals=[],i.normals.length=i.normalDimensions*i.vertexCount;for(let t=0;t<i.vertexCount;t++){const n=e.vertexTriangleIndecies[t],r=e.triangles[n];r&&i.setNormalVector(t,r.normal)}}}}return n.smoothShading&&n.calcSmoothShading(),r},r.calcBitangentsFromCross=function(){for(let r=0;r<n.meshFragments.length;r++){const i=n.meshFragments[r],a=i.renderData,o=i.vertexData;if(!a.bitangents)if(o.bitangents){a.bitangents=[];for(let t=0;t<o.vertexCount;t++)for(var e=0;e<o.normalDimensions;e++)a.bitangents.push(o.bitangents[o.bitangentIndex(t,e)])}else if(a.tangents&&a.normals){a.bitangents=[];for(let n=0;n<o.vertexCount;n++){const r=a.getNormalVector(n),i=a.getTangentVector(n),o=t.Vector.cross(r,i);for(e=0;e<o.length;e++)a.bitangents.push(o[e])}}}return r},r}},2816:()=>{window.frag.Model=function(e,t,n){const r=window.frag;void 0===t&&(t=!n||!n.location||n.location.is3d);const i={name:null,parent:n,children:[],mesh:null,shader:null,material:null,enabled:!0},a={__private:i,isModel:!0,location:r.Location(e,t),animations:[],dispose:function(){},addFlattenedChildren:function(e,t){for(let n=0;n<i.children.length;n++){let r=i.children[n];t(r)&&e.push(r),r.addFlattenedChildren(e,t)}},getLocation:function(){return a.location},getPosition:function(){return r.ScenePosition(e,a.location)},name:function(e){return i.name=e,a},getName:function(){return i.name},shader:function(e){if(e.is3d!==a.location.is3d){const e=a.location.is3d?"3D":"2D";console.error("Model '"+i.name+"' has a "+e+" location and must use a "+e+" shader")}return i.shader=e,a},getShader:function(){return i.shader?i.shader:i.parent?i.parent.getShader():void 0},mesh:function(e){return i.mesh=e,a},getMesh:function(){return i.mesh},material:function(e){return i.material=e,a},enable:function(){i.enabled=!0},disable:function(){i.enabled=!1},getMaterial:function(){return i.material?i.material:i.parent?i.parent.getMaterial():void 0},addChild:function(t){return t?t.__private.parent=a:t=window.frag.Model(e,void 0,a),i.children.push(t),t},shadeSmooth:function(e){return void 0===e&&(e=-1),i.mesh&&i.mesh.shadeSmooth(),0===e||i.children.forEach((t=>{t.shadeSmooth(e-1)})),a},shadeFlat:function(e){return void 0===e&&(e=-1),i.mesh&&i.mesh.shadeFlat(),0===e||i.children.forEach((t=>{t.shadeFlat(e-1)})),a},textureSmooth:function(e){return void 0===e&&(e=-1),i.mesh&&i.mesh.textureSmooth(),0===e||i.children.forEach((t=>{t.textureSmooth(e-1)})),a},textureFlat:function(e){return void 0===e&&(e=-1),i.mesh&&i.mesh.textureFlat(),0===e||i.children.forEach((t=>{t.textureFlat(e-1)})),a},wireframe:function(e,t){return void 0===t&&(t=-1),i.mesh&&i.mesh.wireframe(e),0===t||i.children.forEach((n=>{n.wireframe(e,t-1)})),a},drawNormals:function(e,t,n){return void 0===n&&(n=-1),i.mesh&&i.mesh.drawNormals(e,t),0===n||i.children.forEach((r=>{r.drawNormals(e,t,n-1)})),a},addAnimation:function(e){const t=[];a.addFlattenedChildren(t,(function(e){return e.getName()}));const n=[],r=e.getChannelGraphs();for(let e=0;e<t.length;e++){const i=t[e],a=i.getName();for(let e=0;e<r.length;e++){const t=r[e];t.pattern.test(a)&&n.push({graph:t,model:i})}}return n.length>0&&a.animations.push({modelAnimation:e,childAnimations:n}),a},draw:function(e){if(!a.location)return a;e.beginMesh(a);const t=e.getShader();if(t&&i.mesh&&i.enabled){var r=a.getMaterial();r&&r.apply(t),i.mesh.draw(e,(function(e,t){return 0===t?a:null}))}for(let t=0;t<i.children.length;t++)i.children[t].draw(e);const o=e.state.childMap,s=n?o&&i.name?o[i.name]:void 0:o?o["."]:void 0;if(s)for(let t=0;t<s.length;t++)s[t].draw(e);return e.endMesh(),a}};return a}},5123:()=>{window.frag.PositionLink=function(e){const t={source:null,dest:null,locationOffset:null,scaleOffset:null,rotationOffset:null,lookAtOffset:null},n={__private:t,dispose:function(){t.source&&t.source.observableLocation.unsubscribe(t.sourceChanged)}};return t.sourceChanged=function(e){if(t.dest){if(t.locationOffset&&(void 0!==t.locationOffset[0]&&void 0!==t.locationOffset[1]&&void 0!==t.locationOffset[2]?t.dest.locationXYZ(e.translateX+t.locationOffset[0],e.translateY+t.locationOffset[1],e.translateZ+t.locationOffset[2]):(void 0!==t.locationOffset[0]&&t.dest.locationX(e.translateX+t.locationOffset[0]),void 0!==t.locationOffset[1]&&t.dest.locationY(e.translateY+t.locationOffset[1]),void 0!==t.locationOffset[2]&&t.dest.locationZ(e.translateZ+t.locationOffset[2]))),t.scaleOffset&&(void 0!==t.scaleOffset[0]&&void 0!==t.scaleOffset[1]&&void 0!==t.scaleOffset[2]?t.dest.scaleXYZ(e.scaleX+t.scaleOffset[0],e.scaleY+t.scaleOffset[1],e.scaleZ+t.scaleOffset[2]):(void 0!==t.scaleOffset[0]&&t.dest.scaleX(e.scaleX*t.scaleOffset[0]),void 0!==t.scaleOffset[1]&&t.dest.scaleY(e.scaleY*t.scaleOffset[1]),void 0!==t.scaleOffset[2]&&t.dest.scaleZ(e.scaleZ*t.scaleOffset[2]))),t.lookAtOffset){const e=t.source.getLocation(),n=t.dest.getLocation(),r=window.frag.Vector.heading(window.frag.Vector.sub(e,n));void 0!==t.lookAtOffset[0]&&void 0!==t.lookAtOffset[1]&&void 0!==t.lookAtOffset[2]?t.dest.rotateXYZ(r[0]+t.lookAtOffset[0],r[1]+t.lookAtOffset[1],r[2]+t.lookAtOffset[2]):(void 0!==t.lookAtOffset[0]&&t.dest.rotateX(r[0]+t.lookAtOffset[0]),void 0!==t.lookAtOffset[1]&&t.dest.rotateY(r[1]+t.lookAtOffset[1]),void 0!==t.lookAtOffset[2]&&t.dest.rotateZ(r[2]+t.lookAtOffset[2]))}t.rotationOffset&&(void 0!==t.rotationOffset[0]&&void 0!==t.rotationOffset[1]&&void 0!==t.rotationOffset[2]?t.dest.rotateXYZ(e.rotateX+t.rotationOffset[0],e.rotateY+t.rotationOffset[1],e.rotateZ+t.rotationOffset[2]):(void 0!==t.rotationOffset[0]&&t.dest.rotateX(e.rotateX+t.rotationOffset[0]),void 0!==t.rotationOffset[1]&&t.dest.rotateY(e.rotateY+t.rotationOffset[1]),void 0!==t.rotationOffset[2]&&t.dest.rotateZ(e.rotateZ+t.rotationOffset[2])))}},n.source=function(e){return t.source&&t.source.observableLocation.unsubscribe(t.sourceChanged),e&&e.getPosition&&(e=e.getPosition()),t.source=e,e&&e.observableLocation.subscribe(t.sourceChanged),n},n.dest=function(e){return e&&e.getPosition&&(e=e.getPosition()),t.dest=e,n},n.locationOffset=function(e){return t.locationOffset=e,n},n.scaleOffset=function(e){return t.scaleOffset=e,n},n.rotationOffset=function(e){return t.rotationOffset=e,n},n.lookAtOffset=function(e){return t.lookAtOffset=e,n},n}},5312:()=>{window.frag.Scene=function(e){const t={sceneObjects:[],camera:null},n={__private:t,dispose:function(){},addObject:function(e){return e.parent&&e.parent.removeObject(e),e.parent=n,t.sceneObjects.push(e),n},removeObject:function(e){for(let n=0;n<t.sceneObjects.length;n++)if(t.sceneObjects[n]===e)return t.sceneObjects.splice(n,1),e.parent=null,!0;return!1},camera:function(e){return t.camera=e,n},getCamera:function(){return t.camera},setViewport:function(){return t.camera&&t.camera.setViewport(),n},adjustToViewport:function(){return t.camera&&t.camera.adjustToViewport(),n},draw:function(e){if(!t.camera||!t.sceneObjects)return n;e.beginScene(n);for(let n=0;n<t.sceneObjects.length;n++)t.sceneObjects[n].draw(e);return e.endScene(),n}};return n}},8390:()=>{window.frag.SceneObject=function(e,t){const n=window.frag,r={model:t,enabled:!0,location:null,position:null,animationPosition:null,animationMap:{},childMap:{}},i={__private:r,isSceneObject:!0,animations:{},parent:null};if(t)for(let n=0;n<t.animations.length;n++){const a=t.animations[n];for(let n=0;n<a.childAnimations.length;n++){const i=a.childAnimations[n].model.getName();if(!r.animationMap[i]){const n=window.frag.ObjectAnimationState(e);e.debugAnimations&&(n.__private.modelName=t.getName(),n.__private.childModelName=i),r.animationMap[i]=n}}const o=window.frag.SceneObjectAnimation(e,a,r.animationMap);i.animations[a.modelAnimation.getName()]=o}return i.addObject=function(e,t){return e.parent&&e.parent.removeObject(e),e.parent=i,t||(t="."),r.childMap[t]||(r.childMap[t]=[]),r.childMap[t].push(e),i},i.removeObject=function(e){for(let t in r.childMap){const n=r.childMap[t];for(let t=0;t<n.length;t++)if(n[t]===e)return n.splice(t,1),e.parent=null,!0}return!1},i.getChildMap=function(){return r.childMap},i.getAnimationMap=function(){return r.animationMap},i.getLocation=function(){if(r.location)return r.location;if(r.model){if(!r.model.location)return null;r.location=n.Location(e,r.model.location.is3d)}else r.location=n.Location(e,!0);return r.location},i.getPosition=function(){const t=i.getLocation();return t?(r.position||(r.position=n.ScenePosition(e,t)),r.position):null},i.getAnimationPosition=function(){const t=r.getAnimationLocation();return t?(r.animationPosition||(r.animationPosition=n.ScenePosition(e,t)),r.animationPosition):null},i.enable=function(){return r.enabled=!0,i},i.disable=function(){return r.enabled=!1,i},i.dispose=function(){i.disable(),i.parent&&i.parent.removeObject(i);for(let e in i.animations)i.animations[e].dispose()},i.draw=function(e){return r.enabled&&r.model?(e.beginSceneObject(i),r.model.draw(e),e.endSceneObject(),i):i},i}},7266:()=>{window.frag.ScenePosition=function(e,t,n){const r={location:null},i={__private:r,observableLocation:window.frag.Observable(e,(e=>{e(r.location)})),dispose:function(){}};return r.modified=function(){r.location.isModified=!0,i.observableLocation.notify()},i.setLocation=function(t){return r.location=t||window.frag.Location(e,void 0===n||n),i},i.setLocation(t),i.getMatrix=function(){return r.location.getMatrix()},i.getScale=function(){return[r.location.scaleX,r.location.scaleY,r.location.scaleZ]},i.getScaleX=function(){return r.location.scaleX},i.getScaleY=function(){return r.location.scaleY},i.getScaleZ=function(){return r.location.scaleZ},i.scale=function(e){return r.location.scaleX=e,r.location.scaleY=e,r.location.scaleZ=e,r.modified(),i},i.scaleXYZ=function(e,t,n){return r.location.scaleX=e,r.location.scaleY=t,r.location.scaleZ=n,r.modified(),i},i.scaleX=function(e){return r.location.scaleX=e,r.modified(),i},i.scaleY=function(e){return r.location.scaleY=e,r.modified(),i},i.scaleZ=function(e){return r.location.scaleZ=e,r.modified(),i},i.scaleBy=function(e){return i.scaleXYZ(r.location.scaleX*e[0],r.location.scaleY*e[1],r.location.scaleZ*e[2])},i.scaleByXYZ=function(e,t,n){return i.scaleXYZ(r.location.scaleX*e,r.location.scaleY*t,r.location.scaleZ*n)},i.getRotate=function(){return[r.location.rotateX,r.location.rotateY,r.location.rotateZ]},i.getQuaternion=function(){return window.frag.Vector.quaternion(i.getRotate())},i.getRotateX=function(){return r.location.rotateX},i.getRotateY=function(){return r.location.rotateY},i.getRotateZ=function(){return r.location.rotateZ},i.getRotate=function(){return r.location.is3d?[r.location.rotateX,r.location.rotateY,r.location.rotateZ]:[r.location.rotateX,r.location.rotateY]},i.rotate=function(e){return 4===e.length&&(e=window.frag.Vector.euler(e)),r.location.rotateX=e[0],e.length>1&&(r.location.rotateY=e[1]),e.length>2&&(r.location.rotateZ=e[2]),r.modified(),i},i.rotateXYZ=function(e,t,n){return r.location.rotateX=e,r.location.rotateY=t,r.location.rotateZ=n,r.modified(),i},i.rotateX=function(e){return r.location.rotateX=e,r.modified(),i},i.rotateY=function(e){return r.location.rotateY=e,r.modified(),i},i.rotateZ=function(e){return r.location.rotateZ=e,r.modified(),i},i.rotateBy=function(e){return i.rotateXYZ(r.location.rotateX+e[0],r.location.rotateY+e[1],r.location.rotateZ+e[2])},i.rotateByXYZ=function(e,t,n){return i.rotateXYZ(r.location.rotateX+e,r.location.rotateY+t,r.location.rotateZ+n)},i.getLocationX=function(){return r.location.translateX},i.getLocationY=function(){return r.location.translateY},i.getLocationZ=function(){return r.location.translateZ},i.getLocation=function(){return r.location.is3d?[r.location.translateX,r.location.translateY,r.location.translateZ]:[r.location.translateX,r.location.translateY]},i.location=function(e){return r.location.translateX=e[0],e.length>1&&(r.location.translateY=e[1]),e.length>2&&(r.location.translateZ=e[2]),r.modified(),i},i.locationXYZ=function(e,t,n){return r.location.translateX=e,r.location.translateY=t,r.location.translateZ=n,r.modified(),i},i.locationX=function(e){return r.location.translateX=e,r.modified(),i},i.locationY=function(e){return r.location.translateY=e,r.modified(),i},i.locationZ=function(e){return r.location.translateZ=e,r.modified(),i},i.moveBy=function(e){return i.locationXYZ(r.location.translateX+e[0],r.location.translateY+e[1],r.location.translateZ+e[2])},i.moveByXYZ=function(e,t,n){return i.locationXYZ(r.location.translateX+e,r.location.translateY+t,r.location.translateZ+n)},i}},9288:()=>{window.frag.VertexData=function(e){const t=window.frag,n=e.gl,r={},a={__private:r,primitiveType:n.TRIANGLES,vertexCount:0,verticies:void 0,vertexDimensions:3,colors:void 0,colorDimensions:3,uvs:void 0,uvDimensions:2,normals:void 0,normalDimensions:3,tangents:void 0,bitangents:void 0,dispose:function(){},clone:function(){const n=t.VertexData(e);return n.primitiveType=a.primitiveType,n.vertexCount=a.vertexCount,n.vertexDimensions=a.vertexDimensions,n.colorDimensions=a.colorDimensions,n.uvDimensions=a.uvDimensions,n.normalDimensions=a.normalDimensions,n.verticies=a.verticies,a.colors&&(n.colors=Array.from(a.colors)),a.uvs&&(n.uvs=Array.from(a.uvs)),a.normals&&(n.normals=Array.from(a.normals)),a.tangents&&(n.tangents=Array.from(a.tangents)),a.bitangents&&(n.bitangents=Array.from(a.bitangents)),n},vertexIndex:function(e,t){return e*a.vertexDimensions+(t||0)},colorIndex:function(e,t){return e*a.colorDimensions+(t||0)},uvIndex:function(e,t){return e*a.uvDimensions+(t||0)},normalIndex:function(e,t){return e*a.normalDimensions+(t||0)},tangentIndex:function(e,t){return e*a.normalDimensions+(t||0)},bitangentIndex:function(e,t){return e*a.normalDimensions+(t||0)}};return r.getVector=function(e,n,r){return 2===r?t.Vector.extract2D(e,n):t.Vector.extract3D(e,n)},r.setVector=function(e,t,n){for(i=0;i<n.length;i++)e[t+i]=n[i]},a.getVertexVector=function(e){return r.getVector(a.verticies,a.vertexIndex(e),a.vertexDimensions)},a.setVertexVector=function(e,t){return r.setVector(a.verticies,a.vertexIndex(e),t)},a.getColor=function(e){return r.getVector(a.colors,a.colorIndex(e),a.colorDimensions)},a.setColor=function(e,t){return r.setVector(a.colors,a.colorIndex(e),t)},a.getUvVector=function(e){return r.getVector(a.uvs,a.uvIndex(e),a.uvDimensions)},a.setUvVector=function(e,t){return r.setVector(a.uvs,a.uvIndex(e),t)},a.getNormalVector=function(e){return r.getVector(a.normals,a.normalIndex(e),a.normalDimensions)},a.setNormalVector=function(e,t){return r.setVector(a.normals,a.normalIndex(e),t)},a.getTangentVector=function(e){return r.getVector(a.tangents,a.tangentIndex(e),a.normalDimensions)},a.setTangentVector=function(e,t){return r.setVector(a.tangents,a.tangentIndex(e),t)},a.getBitangentVector=function(e){return r.getVector(a.bitangents,a.bitangentIndex(e),a.normalDimensions)},a.setBitangentVector=function(e,t){return r.setVector(a.bitangents,a.bitangentIndex(e),t)},a.setTriangles2D=function(e){return a.primitiveType=n.TRIANGLES,a.vertexDimensions=2,a.verticies=e.verticies,a.vertexCount=e.verticies.length/a.vertexDimensions,a.colorDimensions=3,a.colors=e.colors,a.uvDimensions=2,a.uvs=e.uvs,a.normalDimensions=3,a.normals=e.normals,a.tangents=e.tangents,a.bitangents=e.bitangents,a.extractTriangles=function(e){for(let t=0;t<a.vertexCount;t+=3)e(t,t+1,t+2)},a},a.setTriangles=function(e){return a.primitiveType=n.TRIANGLES,a.vertexDimensions=3,a.verticies=e.verticies,a.vertexCount=e.verticies.length/a.vertexDimensions,a.colorDimensions=3,a.colors=e.colors,a.uvDimensions=2,a.uvs=e.uvs,a.normalDimensions=3,a.normals=e.normals,a.tangents=e.tangents,a.bitangents=e.bitangents,a.extractTriangles=function(e){for(let t=0;t<a.vertexCount;t+=3)e(t,t+1,t+2)},a},a.setTriangleStrip=function(e){return a.primitiveType=n.TRIANGLE_STRIP,a.vertexDimensions=3,a.verticies=e.verticies,a.vertexCount=e.verticies.length/a.vertexDimensions,a.colorDimensions=3,a.colors=e.colors,a.uvDimensions=2,a.uvs=e.uvs,a.normalDimensions=3,a.normals=e.normals,a.tangents=e.tangents,a.bitangents=e.bitangents,a.extractTriangles=function(e){const t=a.vertexCount-2;for(let n=0;n<t;n++)0==(1&n)?e(n,n+1,n+2):e(n+2,n+1,n)},a},a.setTriangleFan=function(e){return a.primitiveType=n.TRIANGLE_FAN,a.vertexDimensions=3,a.verticies=e.verticies,a.vertexCount=e.verticies.length/a.vertexDimensions,a.colorDimensions=3,a.colors=e.colors,a.uvDimensions=2,a.uvs=e.uvs,a.normalDimensions=3,a.normals=e.normals,a.tangents=e.tangents,a.bitangents=e.bitangents,a.extractTriangles=function(e){const t=a.vertexCount-2;for(let n=0;n<t;n++)e(0,n+1,n+2)},a},a.setLines2D=function(){return a.primitiveType=n.LINES,a.vertexDimensions=2,a.verticies=data.verticies,a.vertexCount=data.verticies.length/a.vertexDimensions,a.colorDimensions=3,a.colors=data.colors,a.uvDimensions=2,a.uvs=data.uvs,a.normalDimensions=3,a.normals=data.normals,a.tangents=null,a.bitangents=null,a.extractTriangles=function(){},a},a.setLines=function(e){return a.primitiveType=n.LINES,a.vertexDimensions=3,a.verticies=e.verticies,a.vertexCount=e.verticies.length/a.vertexDimensions,a.colorDimensions=3,a.colors=e.colors,a.uvDimensions=2,a.uvs=e.uvs,a.normalDimensions=3,a.normals=e.normals,a.tangents=null,a.bitangents=null,a.extractTriangles=function(){},a},a.setLineStrip=function(e){return a.primitiveType=n.LINE_STRIP,a.vertexDimensions=3,a.verticies=e.verticies,a.vertexCount=e.verticies.length/a.vertexDimensions,a.colorDimensions=3,a.colors=e.colors,a.uvDimensions=2,a.uvs=e.uvs,a.normalDimensions=3,a.normals=e.normals,a.tangents=null,a.bitangents=null,a.extractTriangles=function(){},a},a}},3798:()=>{window.frag.createShader=function(e,t,n,r){const i=e.gl;e.debugShaderBuilder&&console.log("\n// "+t+" "+(n===i.VERTEX_SHADER?"vertex":"fragment")+" shader\n"+r);var a=i.createShader(n);if(i.shaderSource(a,r),i.compileShader(a),i.getShaderParameter(a,i.COMPILE_STATUS))return a;console.error("Failed to compile shader "+t),console.log(i.getShaderInfoLog(a)),i.deleteShader(a)},window.frag.createProgram=function(e,t,n,r){const i=e.gl;var a=i.createProgram();if(i.attachShader(a,n),i.attachShader(a,r),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS))return a;console.error("Failed to link shaders into program "+t),console.log(i.getProgramInfoLog(a)),i.deleteProgram(a)},window.frag.CustomShader=function(e,t){const n=window.frag,r=e.gl,i={name:"Custom",vertexShaderSource:null,fragmentShaderSource:null,bindList:[],unbindList:[]},a={__private:i,attributes:{},uniforms:{},is3d:void 0===t||t,dispose:function(){r.deleteProgram(a.program)},name:function(e){return i.name=e,a},getName:function(){return i.name},source:function(t,o){i.vertexShaderSource=t,i.fragmentShaderSource=o;const s=n.createShader(e,i.name,r.VERTEX_SHADER,t),c=n.createShader(e,i.name,r.FRAGMENT_SHADER,o);return a.program=n.createProgram(e,i.name,s,c),a},onBind:function(e){return i.bindList.push(e),a},onUnbind:function(e){return i.unbindList.push(e),a},attribute:function(e){if(!a.program)return console.error("You must set the "+i.name+" shader source before defining attributes"),a;const t=r.getAttribLocation(a.program,"a_"+e);return void 0===t?(console.error("Shader program "+i.name+" does not have attribute a_"+e),a):(a.attributes[e]=t,a)},uniform:function(e,t,n){if(!a.program)return console.error("You must set the "+i.name+" shader source before defining uniforms"),a;const o=r.getUniformLocation(a.program,"u_"+e);if(!o)return console.error("Shader program "+i.name+" does not have uniform u_"+e),a;if(a.uniforms[e]=o,t){i[e]=n,a[e]=function(t){return i[e]=t,a};const s=e[0].toUpperCase()+e.substring(1);a["override"+s]=function(e){r["uniform"+t](o,e)},a["restore"+s]=function(){r["uniform"+t](o,i[e])},i.bindList.push((function(n){void 0!==i[e]&&n["uniform"+t](o,i[e])}))}return a},bind:function(){const t=e.gl;return t.useProgram(a.program),i.bindList.forEach((e=>e(t))),a},unbind:function(){const t=e.gl;return i.unbindList.forEach((e=>e(t))),a}};return a}},7218:()=>{window.frag.FontShader=function(e){return e.fontShader||(e.fontShader=frag.CustomShader(e).name("Font").source("attribute vec4 a_position;\nattribute vec2 a_texcoord;\nuniform mat4 u_clipMatrix;\nvarying vec2 v_texcoord;\nvoid main() {\n  gl_Position = u_clipMatrix * a_position;\n  v_texcoord = a_texcoord;\n}","precision mediump float;\nuniform sampler2D u_diffuse;\nuniform vec4 u_fgcolor;\nuniform vec4 u_bgcolor;\nvarying vec2 v_texcoord;\nvoid main() {\n  vec4 texture = texture2D(u_diffuse, vec2(v_texcoord.x, 1.0 - v_texcoord.y));\n  gl_FragColor = mix(u_bgcolor, u_fgcolor, length(texture.rgb));\n}\n").attribute("position").attribute("texcoord").uniform("clipMatrix").uniform("bgcolor","4fv",[1,1,1,1]).uniform("fgcolor","4fv",[0,0,0,1]).uniform("diffuse")),e.fontShader}},9523:()=>{window.frag.ParticleShader2D=function(e){return e.particleShader2D||(e.particleShader2D=frag.CustomShader(e).name("Particle 2D").source("uniform mat4 u_clipMatrix;\nuniform mat4 u_modelMatrix;\nuniform mat4 u_clipMatrixInverse;\nuniform vec3 u_velocity;\nuniform vec3 u_acceleration;\nuniform float u_timeRange;\nuniform float u_time;\nuniform float u_timeOffset;\nuniform float u_frameDuration;\nuniform float u_numFrames;\n\nattribute vec4 a_uvLifeTimeFrameStart; // uv, lifeTime, frameStart\nattribute vec4 a_positionStartTime;    // position.xyz, startTime\nattribute vec4 a_velocityStartSize;    // velocity.xyz, startSize\nattribute vec4 a_accelerationEndSize;  // acceleration.xyz, endSize\nattribute vec4 a_spinStartSpinSpeed;   // spinStart.x, spinSpeed.y\nattribute vec4 a_orientation;          // a_orientation quaternion\nattribute vec4 a_colorMult;            // multiplies color and ramp textures\n\nvarying vec2 v_texcoord;\nvarying float v_percentLife;\nvarying vec4 v_colorMult;\n\nvoid main() {\n  vec2 uv = a_uvLifeTimeFrameStart.xy;\n  float lifeTime = a_uvLifeTimeFrameStart.z;\n  float frameStart = a_uvLifeTimeFrameStart.w;\n  vec3 position = a_positionStartTime.xyz;\n  float startTime = a_positionStartTime.w;\n  vec3 velocity = (u_modelMatrix * vec4(a_velocityStartSize.xyz, 0.)).xyz + u_velocity;\n  float startSize = a_velocityStartSize.w;\n  vec3 acceleration = (u_modelMatrix * vec4(a_accelerationEndSize.xyz, 0)).xyz + u_acceleration;\n  float endSize = a_accelerationEndSize.w;\n  float spinStart = a_spinStartSpinSpeed.x;\n  float spinSpeed = a_spinStartSpinSpeed.y;\n\n  float localTime = mod((u_time - u_timeOffset - startTime), u_timeRange);\n  float percentLife = clamp(localTime / lifeTime, 0., 1.);\n\n  float frame = mod(floor(localTime / u_frameDuration + frameStart), u_numFrames);\n  float uOffset = frame / u_numFrames;\n  float u = uOffset + (uv.x + 0.5) * (1. / u_numFrames);\n\n  v_texcoord = vec2(u, uv.y + 0.5);\n  v_colorMult = a_colorMult;\n\n  vec3 basisX = u_clipMatrixInverse[0].xyz;\n  vec3 basisZ = u_clipMatrixInverse[1].xyz;\n\n  float size = mix(startSize, endSize, percentLife);\n  float s = sin(spinStart + spinSpeed * localTime);\n  float c = cos(spinStart + spinSpeed * localTime);\n\n  vec4 rotatedPoint = vec2(uv.x * c + uv.y * s, -uv.x * s + uv.y * c);\n  vec3 localPosition = vec3(basisX * rotatedPoint.x + basisZ * rotatedPoint.y) * size +\n    velocity * localTime + acceleration * localTime * localTime + position;\n\n  v_percentLife = percentLife;\n  gl_Position = u_clipMatrix * vec4(localPosition + u_modelMatrix[3].xyz, 1.);\n}\n","precision mediump float;\nuniform sampler2D u_rampSampler;\nuniform sampler2D u_colorSampler;\n\nvarying vec2 v_texcoord;\nvarying float v_percentLife;\nvarying vec4 v_colorMult;\n\nvoid main() {\n  vec4 colorMult = texture2D(u_rampSampler, vec2(v_percentLife, 0.5)) * v_colorMult;\n  gl_FragColor = texture2D(u_colorSampler, v_texcoord) * colorMult;\n}\n").attribute("uvLifeTimeFrameStart").attribute("positionStartTime").attribute("velocityStartSize").attribute("accelerationEndSize").attribute("spinStartSpinSpeed").attribute("orientation").attribute("colorMult").uniform("clipMatrix").uniform("clipMatrixInverse").uniform("modelMatrix").uniform("rampSampler").uniform("colorSampler").uniform("velocity","3fv",[0,100,0]).uniform("acceleration","3fv",[0,-9.8,0]).uniform("timeRange","1f",500).uniform("time","1f",0).uniform("timeOffset","1f",0).uniform("frameDuration","1f",0).uniform("numFrames","1f",50)),e.particleShader2D}},8462:()=>{window.frag.ParticleShader3D=function(e){return e.particleShader3D||(e.particleShader3D=frag.CustomShader(e).name("Particle 3D").source("uniform mat4 u_clipMatrix;\nuniform mat4 u_modelMatrix;\nuniform vec3 u_velocity;\nuniform vec3 u_acceleration;\nuniform float u_timeRange;\nuniform float u_time;\nuniform float u_timeOffset;\nuniform float u_frameDuration;\nuniform float u_numFrames;\n\nattribute vec4 a_uvLifeTimeFrameStart; // uv, lifeTime, frameStart\nattribute vec4 a_positionStartTime;    // position.xyz, startTime\nattribute vec4 a_velocityStartSize;    // velocity.xyz, startSize\nattribute vec4 a_accelerationEndSize;  // acceleration.xyz, endSize\nattribute vec4 a_spinStartSpinSpeed;   // spinStart.x, spinSpeed.y\nattribute vec4 a_orientation;          // a_orientation quaternion\nattribute vec4 a_colorMult;            // multiplies color and ramp textures\n\nvarying vec2 v_texcoord;\nvarying float v_percentLife;\nvarying vec4 v_colorMult;\n\nvoid main() {\n  vec2 uv = a_uvLifeTimeFrameStart.xy;\n  float lifeTime = a_uvLifeTimeFrameStart.z;\n  float frameStart = a_uvLifeTimeFrameStart.w;\n  vec3 position = a_positionStartTime.xyz;\n  float startTime = a_positionStartTime.w;\n  vec3 velocity = (u_modelMatrix * vec4(a_velocityStartSize.xyz, 0.)).xyz + u_velocity;\n  float startSize = a_velocityStartSize.w;\n  vec3 acceleration = (u_modelMatrix * vec4(a_accelerationEndSize.xyz, 0)).xyz + u_acceleration;\n  float endSize = a_accelerationEndSize.w;\n  float spinStart = a_spinStartSpinSpeed.x;\n  float spinSpeed = a_spinStartSpinSpeed.y;\n\n  float localTime = mod((u_time - u_timeOffset - startTime), u_timeRange);\n  float percentLife = clamp(localTime / lifeTime, 0., 1.);\n\n  float frame = mod(floor(localTime / u_frameDuration + frameStart), u_numFrames);\n  float uOffset = frame / u_numFrames;\n  float u = uOffset + (uv.x + 0.5) / u_numFrames;\n\n  v_texcoord = vec2(u, uv.y + 0.5);\n  v_colorMult = a_colorMult;\n\n  float size = mix(startSize, endSize, percentLife);\n  float s = sin(spinStart + spinSpeed * localTime);\n  float c = cos(spinStart + spinSpeed * localTime);\n\n  vec4 rotatedPoint = vec4((uv.x * c + uv.y * s) * size, (uv.x * s + uv.y * c) * size, 0., 1.);\n  vec3 center = velocity * localTime + acceleration * localTime * localTime + position;\n\n  vec4 q2 = a_orientation + a_orientation;\n  vec4 qx = a_orientation.xxxw * q2.xyzx;\n  vec4 qy = a_orientation.xyyw * q2.xyzy;\n  vec4 qz = a_orientation.xxzw * q2.xxzz;\n\n  mat4 localMatrix = mat4(\n    (1.0 - qy.y) - qz.z, qx.y + qz.w, qx.z - qy.w, 0,\n    qx.y - qz.w, (1.0 - qx.x) - qz.z, qy.z + qx.w, 0,\n    qx.z + qy.w, qy.z - qx.w, (1.0 - qx.x) - qy.y, 0,\n    center.x, center.y, center.z, 1);\n  rotatedPoint = localMatrix * rotatedPoint;\n  v_percentLife = percentLife;\n  gl_Position = u_clipMatrix * rotatedPoint;\n}\n","precision mediump float;\nuniform sampler2D u_rampSampler;\nuniform sampler2D u_colorSampler;\n\nvarying vec2 v_texcoord;\nvarying float v_percentLife;\nvarying vec4 v_colorMult;\n\nvoid main() {\n  vec4 colorMult = texture2D(u_rampSampler, vec2(v_percentLife, 0.5)) * v_colorMult;\n  gl_FragColor = texture2D(u_colorSampler, v_texcoord) * colorMult;\n}\n").attribute("uvLifeTimeFrameStart").attribute("positionStartTime").attribute("velocityStartSize").attribute("accelerationEndSize").attribute("spinStartSpinSpeed").attribute("orientation").attribute("colorMult").uniform("clipMatrix").uniform("modelMatrix").uniform("rampSampler").uniform("colorSampler").uniform("velocity","3fv",[0,100,0]).uniform("acceleration","3fv",[0,-9.8,0]).uniform("timeRange","1f",500).uniform("time","1f",0).uniform("timeOffset","1f",0).uniform("frameDuration","1f",0).uniform("numFrames","1f",50)),e.particleShader3D}},3570:()=>{window.frag.ParticleShaderDebug=function(e){return e.particleShaderDebug||(e.particleShaderDebug=frag.CustomShader(e).name("Particle debug").source("uniform mat4 u_clipMatrix;\nuniform mat4 u_modelMatrix;\nuniform vec3 u_velocity;\nuniform vec3 u_acceleration;\nuniform float u_timeRange;\nuniform float u_time;\nuniform float u_timeOffset;\nuniform float u_frameDuration;\nuniform float u_numFrames;\n\nattribute vec4 a_uvLifeTimeFrameStart; // uv, lifeTime, frameStart\nattribute vec4 a_positionStartTime;    // position.xyz, startTime\nattribute vec4 a_velocityStartSize;    // velocity.xyz, startSize\nattribute vec4 a_accelerationEndSize;  // acceleration.xyz, endSize\nattribute vec4 a_spinStartSpinSpeed;   // spinStart.x, spinSpeed.y\nattribute vec4 a_orientation;          // a_orientation quaternion\n\nvoid main() {\n  vec2 uv = a_uvLifeTimeFrameStart.xy;\n  float lifeTime = a_uvLifeTimeFrameStart.z;\n  float frameStart = a_uvLifeTimeFrameStart.w;\n  vec3 position = a_positionStartTime.xyz;\n  float startTime = a_positionStartTime.w;\n  vec3 velocity = (u_modelMatrix * vec4(a_velocityStartSize.xyz, 0.)).xyz + u_velocity;\n  float startSize = a_velocityStartSize.w;\n  vec3 acceleration = (u_modelMatrix * vec4(a_accelerationEndSize.xyz, 0)).xyz + u_acceleration;\n  float endSize = a_accelerationEndSize.w;\n  float spinStart = a_spinStartSpinSpeed.x;\n  float spinSpeed = a_spinStartSpinSpeed.y;\n\n  float localTime = mod((u_time - u_timeOffset - startTime), u_timeRange);\n  float percentLife = clamp(localTime / lifeTime, 0., 1.);\n\n  float frame = mod(floor(localTime / u_frameDuration + frameStart), u_numFrames);\n  float uOffset = frame / u_numFrames;\n  float u = uOffset + (uv.x + 0.5) * (1. / u_numFrames);\n\n  float size = mix(startSize, endSize, percentLife);\n  float s = sin(spinStart + spinSpeed * localTime);\n  float c = cos(spinStart + spinSpeed * localTime);\n\n  vec4 rotatedPoint = vec4((uv.x * c + uv.y * s) * size, (uv.x * s + uv.y * c) * size, 0., 1.);\n  vec3 center = velocity * localTime + acceleration * localTime * localTime + position;\n\n  vec4 q2 = a_orientation + a_orientation;\n  vec4 qx = a_orientation.xxxw * q2.xyzx;\n  vec4 qy = a_orientation.xyyw * q2.xyzy;\n  vec4 qz = a_orientation.xxzw * q2.xxzz;\n\n  mat4 localMatrix = mat4(\n    (1.0 - qy.y) - qz.z, qx.y + qz.w, qx.z - qy.w, 0,\n    qx.y - qz.w, (1.0 - qx.x) - qz.z, qy.z + qx.w, 0,\n    qx.z + qy.w, qy.z - qx.w, (1.0 - qx.x) - qy.y, 0,\n    center.x, center.y, center.z, 1);\n  rotatedPoint = localMatrix * rotatedPoint;\n  gl_Position = u_clipMatrix * rotatedPoint;\n}\n","precision mediump float;\nvoid main() {\n  gl_FragColor = vec4(1, 0, 0, 1);\n}\n").attribute("uvLifeTimeFrameStart").attribute("positionStartTime").attribute("velocityStartSize").attribute("accelerationEndSize").attribute("spinStartSpinSpeed").attribute("orientation").uniform("clipMatrix").uniform("modelMatrix").uniform("velocity","3fv").uniform("acceleration","3fv").uniform("timeRange","1f").uniform("time","1f").uniform("timeOffset","1f").uniform("frameDuration","1f").uniform("numFrames","1f")),e.particleShaderDebug}},2198:()=>{window.frag.Shader=function(e){const t=window.frag,n=(e.gl,"None"),r={name:"Custom",verticies:"XYZ",x:0,y:0,z:0,colors:n,matrix:"mat4",textureCoords:n,diffuseTexture:n,emmissiveTexture:n,displacementTexture:n,normalMap:n,roughnessTexture:n,shininessTexture:n,metalinessTexture:n,normals:n,tangents:n,bitangents:n,directionalLight:n,ambientLight:n},i={__private:r,name:function(e){return r.name=e,i},verticiesXY:function(e){return r.verticies="XY",r.z=e,i},verticiesXZ:function(e){return r.verticies="XZ",r.y=e,i},verticiesYZ:function(e){return r.verticies="YZ",r.x=e,i},verticiesXYZ:function(){return r.verticies="XYZ",i},verticiesNone:function(){return r.verticies=n,i},matrix2D:function(){return r.matrix="mat3",i},matrix3D:function(){return r.matrix="mat4",i},matrixNone:function(){return r.matrix=n,i},normals:function(){return r.normals="vec3",i},colorsRGB:function(){return r.colors="vec3",i},colorsRGBA:function(){return r.colors="vec4",i},colorsNone:function(){return r.colors=n,i},diffuseTexture:function(){return r.diffuseTexture="RGB",r.colors=n,r.textureCoords===n&&(r.textureCoords="vec2"),i},emmissiveTexture:function(){return r.emmissiveTexture="RGB",r.textureCoords===n&&(r.textureCoords="vec2"),i},normalMapStandard:function(){return r.normalMap="Standard",r.textureCoords===n&&(r.textureCoords="vec2"),r.normals===n&&(r.normals="vec3"),r.tangents===n&&(r.tangents="vec3"),i},normalMapOpenGL:function(){return r.normalMap="OpenGL",r.textureCoords===n&&(r.textureCoords="vec2"),r.normals===n&&(r.normals="vec3"),r.tangents===n&&(r.tangents="vec3"),i},displacementTextureRaised:function(){return r.displacementTexture="Raised",r.textureCoords===n&&(r.textureCoords="vec2"),r.normals===n&&(r.normals="vec3"),i},displacementTextureSunken:function(){return r.displacementTexture="Sunken",r.textureCoords===n&&(r.textureCoords="vec2"),r.normals===n&&(r.normals="vec3"),i},displacementTextureSigned:function(){return r.displacementTexture="Signed",r.textureCoords===n&&(r.textureCoords="vec2"),r.normals===n&&(r.normals="vec3"),i},tangents:function(){return r.tangents="vec3",r.normals===n&&(r.normals="vec3"),i},bitangents:function(){return r.bitangents="vec3",r.normals===n&&(r.normals="vec3"),i},directionalLightColor:function(){return i.matrix3D(),r.directionalLight="Color",r.ambientLight===n&&(r.ambientLight="Balanced"),r.normals===n&&(r.normals="vec3"),i},directionalLightWhite:function(){return i.matrix3D(),r.directionalLight="White",r.ambientLight===n&&(r.ambientLight=n),r.normals===n&&(r.normals="vec3"),i},directionalLightGrey:function(){return i.matrix3D(),r.directionalLight="Grey",r.ambientLight===n&&(r.ambientLight="Balanced"),r.normals===n&&(r.normals="vec3"),i},directionalLightNone:function(){return r.directionalLight=n,i},ambientLightBalanced:function(){return r.ambientLight="Balanced",i},ambientLightNone:function(){return r.ambientLight=n,i},ambientLightFixed:function(){return r.ambientLight="Fixed",i},ambientTexture:function(){return r.ambientLight="Texture",i}};return r.addAttributeDeclarations=function(e){"XYZ"===r.verticies?e.vectorShader+="attribute vec4 a_position;\n":r.verticies!==n&&(e.vectorShader+="attribute vec2 a_position;\n"),r.colors!==n&&(e.vectorShader+="attribute "+r.colors+" a_color;\n"),r.textureCoords!==n&&(e.vectorShader+="attribute "+r.textureCoords+" a_texcoord;\n"),r.normals!==n&&(e.vectorShader+="attribute "+r.normals+" a_normal;\n"),r.tangents!==n&&(e.vectorShader+="attribute "+r.tangents+" a_tangent;\n"),r.bitangents!==n&&(e.vectorShader+="attribute "+r.bitangents+" a_bitangent;\n")},r.addUniformDeclarations=function(e){r.matrix!==n&&(r.directionalLight!==n&&(e.vectorShader+="uniform "+r.matrix+" u_modelMatrix;\n"),e.vectorShader+="uniform "+r.matrix+" u_clipMatrix;\n"),r.directionalLight!==n&&(e.vectorShader+="uniform vec3 u_lightDirection;\n"),"Color"===r.directionalLight&&(e.vectorShader+="uniform vec3 u_lightColor;\n"),r.displacementTexture!==n&&(e.vectorShader+="uniform sampler2D u_height;\n",e.vectorShader+="uniform float u_displacementScale;\n"),r.roughnessTexture!==n&&(e.vectorShader+="uniform sampler2D u_roughness;\n"),r.shininessTexture!==n&&(e.vectorShader+="uniform sampler2D u_glossiness;\n"),"Texture"===r.ambientLight&&(e.vectorShader+="uniform sampler2D u_ambient;\n"),r.normalMap!==n&&(e.fragmentShader+="uniform sampler2D u_normal;\n"),r.textureCoords!==n&&(r.diffuseTexture!==n&&(e.fragmentShader+="uniform sampler2D u_diffuse;\n"),r.emmissiveTexture!==n&&(e.fragmentShader+="uniform sampler2D u_emmissive;\n")),r.ambientLight!==n&&(e.fragmentShader+="uniform float u_ambientLight;\n")},r.addVaryingDeclarations=function(e){const t=function(t,n){const r="varying "+t+" "+n+";\n";e.vectorShader+=r,e.fragmentShader+=r};r.textureCoords!==n&&t(r.textureCoords,"v_texcoord"),r.colors!==n&&t(r.colors,"v_color"),r.directionalLight!==n&&(t("vec3","v_lightDirection"),"Color"===r.directionalLight&&t("vec3","v_lightColor"),r.normalMap===n&&t(r.normals,"v_normal"))},r.addLogic=function(e){"XYZ"===r.verticies?e.vectorShader+="  vec4 position = a_position;\n":r.verticies!==n&&(e.vectorShader+="  vec2 position = a_position;\n"),r.roughnessTexture!==n&&(e.vectorShader+="  vec4 roughness = texture2D(u_roughness, vec2(a_texcoord.x, 1.0 - a_texcoord.y));\n"),r.shininessTexture!=n&&(e.vectorShader+="  vec4 glossiness = texture2D(u_glossiness, vec2(a_texcoord.x, 1.0 - a_texcoord.y));\n"),r.displacementTexture!==n&&(e.vectorShader+="  vec4 height = texture2D(u_height, vec2(a_texcoord.x, 1.0 - a_texcoord.y));\n","XYZ"===r.verticies&&"vec3"===r.normals&&("Sunken"===r.displacementTexture?e.vectorShader+="  float displacement = -height.r;\n":"Signed"===r.displacementTexture?e.vectorShader+="  float displacement = height.r * 2.0 - 1.0;\n":"Raised"===r.displacementTexture&&(e.vectorShader+="  float displacement = height.r;\n"),e.vectorShader+="  position = vec4(position.xyz + (a_normal * displacement * u_displacementScale), position.w);\n")),"XYZ"===r.verticies?e.vectorShader+="  position = u_clipMatrix * position;\n":r.verticies!==n&&(e.vectorShader+="  position = (u_clipMatrix * vec3(position, 1)).xy;\n"),"XYZ"===r.verticies?e.vectorShader+="  gl_Position = position;\n":"XY"===r.verticies?e.vectorShader+="  gl_Position = vec4(position, "+r.z+", 1);\n":"XZ"===r.verticies?e.vectorShader+="  gl_Position = vec4(position.x, "+r.y+", position.y, 1);\n":"YZ"===r.verticies&&(e.vectorShader+="  gl_Position = vec4("+r.x+", position, 1);\n"),r.textureCoords!==n&&(e.vectorShader+="  v_texcoord = a_texcoord;\n"),r.directionalLight!==n?(r.normalMap!==n?(e.vectorShader+="  vec3 T = normalize(vec3(u_modelMatrix * vec4(a_tangent, 0.0)));\n",r.bitangents!==n?e.vectorShader+="  vec3 B = normalize(vec3(u_modelMatrix * vec4(a_bitangent, 0.0)));\n":e.vectorShader+="  vec3 B = normalize(vec3(u_modelMatrix * vec4(cross(a_normal, a_tangent), 0.0)));\n",e.vectorShader+="  vec3 N = normalize(vec3(u_modelMatrix * vec4(a_normal, 0.0)));\n",e.vectorShader+="  mat3 TBN = transpose(mat3(T, B, N));\n",e.vectorShader+="  v_lightDirection = TBN * u_lightDirection;\n",e.fragmentShader+="  vec3 normal = texture2D(u_normal, vec2(v_texcoord.x, 1.0 - v_texcoord.y)).rgb * 2.0 - 1.0;\n"):(e.vectorShader+="  v_normal = (u_modelMatrix * vec4(a_normal, 0)).xyz;\n",e.vectorShader+="  v_lightDirection = u_lightDirection;\n",e.fragmentShader+="  vec3 normal = normalize(v_normal);\n"),e.fragmentShader+="  vec3 lightDirection = v_lightDirection;\n",e.fragmentShader+="  float light = max(dot(normal, lightDirection), 0.0);\n",r.ambientLight!==n&&(e.fragmentShader+="  light += u_ambientLight;\n")):r.ambientLight!==n&&(e.fragmentShader+="  float light = u_ambientLight;\n"),"Color"===r.directionalLight&&(e.vectorShader+="  v_lightColor = u_lightColor;\n"),r.colors===n?e.fragmentShader+="  gl_FragColor = vec4(0, 0, 0, 1.0);\n":"vec4"===r.colors?(e.vectorShader+="  v_color = a_color;\n",e.fragmentShader+="  gl_FragColor = v_color;\n"):(e.vectorShader+="  v_color = a_color;\n",e.fragmentShader+="  gl_FragColor = vec4(v_color, 1.0);\n"),"vec2"===r.textureCoords&&"RGB"===r.diffuseTexture&&(e.fragmentShader+="  gl_FragColor += texture2D(u_diffuse, vec2(v_texcoord.x, 1.0 - v_texcoord.y));\n"),r.ambientLight===n&&r.directionalLight===n||(e.fragmentShader+="  gl_FragColor.rgb *= light;\n"),"vec2"===r.textureCoords&&"RGB"===r.emmissiveTexture&&(e.fragmentShader+="  gl_FragColor.rgb += texture2D(u_emmissive, vec2(v_texcoord.x, 1.0 - v_texcoord.y)).rgb;\n")},i.compile=function(){const i=t.CustomShader(e,"mat4"===r.matrix).name(r.name),a={vectorShader:"",fragmentShader:"precision mediump float;\n"};if(r.addAttributeDeclarations(a),r.addUniformDeclarations(a),r.addVaryingDeclarations(a),r.directionalLight!==n&&r.normalMap!==n&&(a.vectorShader+="highp mat3 transpose(in highp mat3 inMatrix) {\n",a.vectorShader+="    highp vec3 i0 = inMatrix[0];\n",a.vectorShader+="    highp vec3 i1 = inMatrix[1];\n",a.vectorShader+="    highp vec3 i2 = inMatrix[2];\n",a.vectorShader+="    highp mat3 outMatrix = mat3(\n",a.vectorShader+="        vec3(i0.x, i1.x, i2.x),\n",a.vectorShader+="        vec3(i0.y, i1.y, i2.y),\n",a.vectorShader+="        vec3(i0.z, i1.z, i2.z)\n",a.vectorShader+="    );\n",a.vectorShader+="    return outMatrix;\n",a.vectorShader+="}\n"),a.vectorShader+="void main() {\n",a.fragmentShader+="void main() {\n",r.addLogic(a),a.vectorShader+="}\n",a.fragmentShader+="}\n",i.source(a.vectorShader,a.fragmentShader),r.verticies!==n&&i.attribute("position"),r.colors!==n&&i.attribute("color"),r.textureCoords!==n&&i.attribute("texcoord"),r.normals!==n&&i.attribute("normal"),r.tangents!==n&&i.attribute("tangent"),r.bitangents!==n&&i.attribute("bitangent"),r.diffuseTexture!==n&&i.uniform("diffuse"),r.emmissiveTexture!==n&&i.uniform("emmissive"),r.normalMap!==n&&i.uniform("normal"),r.roughnessTexture!==n&&i.uniform("roughness"),r.shininessTexture!=n&&i.uniform("glossiness"),r.ambientLight!==n&&("Texture"===r.ambientLight?i.uniform("ambient"):i.uniform("ambientLight","1f",.5)),r.displacementTexture!==n&&(i.uniform("height"),i.uniform("displacementScale","1f",.2)),r.matrix!==n&&(r.directionalLight!==n&&i.uniform("modelMatrix"),i.uniform("clipMatrix")),r.directionalLight!==n){i.uniform("lightDirection","3fv"),"Color"===r.directionalLight&&i.uniform("lightColor","3fv");const e="Balanced"===r.ambientLight&&i.ambientLight,n=i.lightDirection;i.lightDirection=function(r){const a=t.Vector.length(r);return a>1?(n([-r[0]/a,-r[1]/a,-r[2]/a]),e&&i.ambientLight(0)):(n([-r[0],-r[1],-r[2]]),e&&i.ambientLight(1-a)),i},"White"===r.directionalLight?i.lightDirection([.8,-.2,.8]):"Grey"===r.directionalLight&&i.lightDirection([.5,-.1,.5])}return i},i}},3743:()=>{window.frag.UiShader=function(e){return e.uiShader||(e.uiShader=window.frag.Shader(e).name("UI").verticiesXY(-1).matrix2D().diffuseTexture().compile()),e.uiShader}},9914:()=>{window.frag.Cube=function(e,t,n){let r,i=t,a=t,o=t,s=t,c=t,l=!1,u=!1;n&&(void 0!==n.frontFacets&&(t=n.frontFacets),void 0!==n.backFacets&&(i=n.backFacets),void 0!==n.topFacets&&(a=n.topFacets),void 0!==n.bottomFacets&&(o=n.bottomFacets),void 0!==n.leftFacets&&(s=n.leftFacets),void 0!==n.rightFacets&&(c=n.rightFacets),void 0!==n.color&&(r=n.color),void 0!==n.duplicateTexture&&(l=n.duplicateTexture),void 0!==n.skyBox&&(u=n.skyBox));let f=1/4,d=.5,m=1/3,g=2/3;const h=[[-1,-1,-1],[1,-1,-1],[1,1,-1],[-1,1,-1],[1,-1,1],[-1,-1,1],[-1,1,1],[1,1,1],[-1,1,-1],[1,1,-1],[-1,1,-1],[-1,1,1],[1,1,-1],[1,1,1]],v=[[f,g],[f,m],[0,m],[0,g],[d,m],[d,g],[.75,g],[.75,m],[1,g],[1,m],[f,1],[d,1],[f,0],[d,0]],p=[],x=[],T=r?[]:void 0,b=function(e){p.push(e[0]),p.push(e[1]),p.push(e[2]),r&&r.forEach((e=>{T.push(e)}))},S=function(e){x.push(e[0]),x.push(e[1])},w=function(e,t,n,r){u?(b(t),b(n),b(r),b(n),b(t),b(e)):(b(e),b(t),b(n),b(r),b(n),b(t))},y=function(e,t,n,r){u?(S(t),S(n),S(r),S(n),S(t),S(e)):(S(e),S(t),S(n),S(r),S(n),S(t))},_=function(e,t,n,r){const i=window.frag.Vector;vOrigin=h[n],tOrigin=l?[0,0]:v[n];const a=i.sub(h[r],h[n]),o=i.sub(h[t],h[n]),s=l?[0,1]:i.sub(v[r],v[n]),c=l?[1,0]:i.sub(v[t],v[n]);for(var u=0;u<e;u++){const t=u/e,n=(u+1)/e;for(hFacet=0;hFacet<e;hFacet++){const r=hFacet/e,l=(hFacet+1)/e,u=i.add(i.add(vOrigin,i.mult(o,r)),i.mult(a,t)),f=i.add(i.add(vOrigin,i.mult(o,l)),i.mult(a,t)),d=i.add(i.add(vOrigin,i.mult(o,r)),i.mult(a,n)),m=i.add(i.add(vOrigin,i.mult(o,l)),i.mult(a,n));w(f,m,u,d);const g=i.add(i.add(tOrigin,i.mult(c,r)),i.mult(s,t)),h=i.add(i.add(tOrigin,i.mult(c,l)),i.mult(s,t)),v=i.add(i.add(tOrigin,i.mult(c,r)),i.mult(s,n)),p=i.add(i.add(tOrigin,i.mult(c,l)),i.mult(s,n));y(h,p,g,v)}}};t&&_(t,1,0,3),o&&_(o,4,5,0),s&&_(s,0,5,11),c&&_(c,4,1,12),i&&_(i,5,4,7),a&&_(a,6,7,9);const M=window.frag.Mesh(e);return M.addTriangles({verticies:p,colors:T,uvs:x}),u&&M.shadeSmooth(),M}},6499:()=>{window.frag.Cylinder=function(e,t,n){t=t||16;let r,i=1,a=1,o=1,s=!0,c=!0;n&&(void 0!==n.sideFacets&&(i=n.sideFacets),void 0!==n.color&&(r=n.color),void 0!==n.topRadius&&(a=n.topRadius),void 0!==n.bottomRadius&&(o=n.bottomRadius),void 0!==n.drawTop&&(s=n.drawTop),void 0!==n.drawBottom&&(c=n.drawBottom)),t<3&&(t=3),0===a&&(s=!1),0===o&&(c=!1);const l=2*Math.PI/t,u=window.frag.Mesh(e);if(i){const e=[],n=r?[]:void 0,s=[],c=a-o,f=function(t,i,a){e.push(t),e.push(i),e.push(a),r&&r.forEach((e=>n.push(e))),s.push(.5*(t+1)),s.push(.5*(i+1))};for(let r=0;r<i;r++){const a=r/i,d=(r+1)/i,m=1-2*a,g=1-2*d,h=c*a+o,v=c*d+o;for(let e=0;e<=t;e++){const t=e*l,n=Math.sin(t),r=Math.cos(t);f(n*h,r*h,m),f(n*v,r*v,g)}f(0,v,g),u.addTriangleStrip({verticies:e,colors:n,uvs:s})}}if(s){const e=[0,0,-1],n=[.5,.5],i=[0,0,-1],o=r?Array.from(r):void 0;for(let s=0;s<=t;s++){const t=-s*l,c=Math.sin(t),u=Math.cos(t);e.push(c*a),e.push(u*a),e.push(-1),r&&r.forEach((e=>o.push(e))),n.push(.5*(c+1)),n.push(.5*(u+1)),i.push(c),i.push(u),i.push(-1)}u.addTriangleFan({verticies:e,colors:o,uvs:n,normals:i})}if(c){const e=[0,0,1],n=[.5,.5],i=[0,0,1],a=r?Array.from(r):void 0;for(let s=0;s<=t;s++){const t=s*l,c=Math.sin(t),u=Math.cos(t);e.push(c*o),e.push(u*o),e.push(1),r&&r.forEach((e=>a.push(e))),n.push(.5*(c+1)),n.push(.5*(u+1)),i.push(c),i.push(u),i.push(1)}u.addTriangleFan({verticies:e,colors:a,uvs:n,normals:i})}return u}},9022:()=>{window.frag.Disc=function(e,t,n){let r;t=t||32,n&&void 0!==n.color&&(r=n.color);const i=[0,0,0],a=[.5,.5],o=[0,0,-1],s=r?Array.from(r):void 0,c=2*Math.PI/t;for(var l=0;l<=t;l++){const e=-l*c,t=Math.sin(e),n=Math.cos(e);i.push(t),i.push(n),i.push(0),r&&r.forEach((e=>s.push(e))),o.push(0),o.push(0),o.push(-1),a.push(.5*(t+1)),a.push(.5*(n+1))}const u=window.frag.Mesh(e);return u.addTriangleFan({verticies:i,colors:s,uvs:a,normals:o}),u}},1950:()=>{window.frag.Plane=function(e,t,n){if(n=n||{},1===(t=t||1)){const t=n.color||[0,0,0],r=new Float32Array([1,-1,0,1,1,0,-1,-1,0,-1,1,0,t[0],t[1],t[2],t[0],t[1],t[2],t[0],t[1],t[2],t[0],t[1],t[2],1,0,1,1,0,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0]),i=window.frag.Mesh(e);return i.fromBuffer({buffer:r.buffer,size:3,count:4,primitiveType:e.gl.TRIANGLE_STRIP,vertexDataOffset:0*Float32Array.BYTES_PER_ELEMENT,colorDataOffset:12*Float32Array.BYTES_PER_ELEMENT,uvDataOffset:24*Float32Array.BYTES_PER_ELEMENT,normalDataOffset:32*Float32Array.BYTES_PER_ELEMENT,tangentDataOffset:44*Float32Array.BYTES_PER_ELEMENT,bitangentDataOffset:56*Float32Array.BYTES_PER_ELEMENT}),i}const r=[],i=[],a=[],o=n.color?[]:void 0,s=function(e,t){r.push(2*e-1),r.push(2*t-1),r.push(0),n.color&&n.color.forEach((e=>o.push(e))),i.push(e),i.push(t),a.push(0),a.push(0),a.push(-1)};for(let e=0;e<t;e++){const n=e/t,r=(e+1)/t;for(let e=0;e<t;e++){const i=e/t,a=(e+1)/t;s(i,n),s(a,n),s(a,r),s(i,n),s(a,r),s(i,r)}}const c=window.frag.Mesh(e);return c.addTriangles({verticies:r,colors:o,uvs:i,normals:a}),c}},3614:()=>{window.frag.Sphere=function(e,t,n){void 0===t&&(t=12);let r,i=2*t,a=0,o=Math.PI,s=0,c=2*Math.PI,l=!1;n&&(void 0!==n.latitudeStart&&(a=n.latitudeStart),void 0!==n.latitudeLength&&(o=n.latitudeLength),void 0!==n.latitudeFacets&&(t=n.latitudeFacets),void 0!==n.longitudeStart&&(s=n.longitudeStart),void 0!==n.longitudeLength&&(c=n.longitudeLength),void 0!==n.longitudeFacets&&(i=n.longitudeFacets),void 0!==n.color&&(r=n.color),void 0!==n.skyBox&&n.skyBox),t<2&&(t=2),i<3&&(i=3),a<0&&(a=0),a+o>Math.PI&&(o=Math.PI-a),c>2*Math.PI&&(c=2*Math.PI);const u=[],f=[];for(let e=0;e<=t;e++){const n=e/t;for(ix=0;ix<=i;ix++){const e=ix/i;vertex={x:Math.cos(s+e*c)*Math.sin(a+n*o),y:Math.cos(a+n*o),z:Math.sin(s+e*c)*Math.sin(a+n*o)},u.push(vertex),f.push({u:e,v:n})}}const d=[],m=r?[]:void 0,g=[],h=function(e){const t=u[e];d.push(t.x),d.push(t.y),d.push(t.z);const n=f[e];g.push(n.u),g.push(n.v),r&&r.forEach((e=>{m.push(e)}))},v=function(e,t,n){h(e),h(t),h(n)};for(let e=0;e<t;e++){const n=e*(i+1),r=(e+1)*(i+1);for(let s=0;s<i;s++)(0!==e||a>0)&&v(n+s+1,n+s,r+s+1),(e!==t-1||a+o<Math.PI)&&v(n+s,r+s,r+s+1)}const p=window.frag.Mesh(e);return p.addTriangles({verticies:d,colors:m,uvs:g}),p}},8756:()=>{!function(){window._frag={};for(let e=0;e<window.frag.classes.length;e++){const t=window.frag.classes[e];window._frag[t]=window.frag[t],window.frag[t]=function(e){if(e&&e.isEngine)return e.isRendering||e.debugConstructors&&!["Transform","Transform3D","Transform2D","Location","Observable"].includes(t)&&console.log(t,arguments),window._frag[t].apply(null,arguments);console.error("You must pass the Frag engine as the first parameter to window.frag."+t,arguments)}}}()}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r(6601),r(8197),r(7996),r(9041),r(2174),r(9607),r(5363),r(1346),r(9670),r(7008),r(1821),r(3163),r(3798),r(2198),r(3743),r(7218),r(8462),r(9523),r(8394),r(2636),r(4655),r(9288),r(9521),r(1003),r(2816),r(7266),r(8390),r(5312),r(3533),r(5123),r(6611),r(3270),r(3014),r(3906),r(2588),r(6627),r(9023),r(4544),r(3890),r(9889),r(4600),r(9622),r(666),r(2201),r(9914),r(6499),r(9022),r(1950),r(3614),r(6237),r(956),r(7802),r(3235),r(6784),r(8562),r(280),r(8853),r(5217),r(4924),r(5858),r(2412),r(7818),r(3884),r(3957),r(1264),r(5854),r(922),r(4765)})();
//# sourceMappingURL=frag.min.js.map