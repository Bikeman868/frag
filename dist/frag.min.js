(()=>{var t={6627:()=>{window.frag.Animation=function(e,t){const n={stopAfter:0,isRunning:!1},r=e||{};r.__private=n;const a=100;return r.getIsRunning=function(){return n.isRunning},r.setDuration=function(e){return r.duration=e,r},r.setInterval=function(e){return r.interval=e,r},r.action=function(e,t,o){if(void 0!==n.stopAfter&&(n.stopAt=t+n.stopAfter,delete n.stopAfter),void 0!==n.stopAt&&t>=n.stopAt){if(n.sequence){let e=n.sequence[n.sequenceIndex];e.stop&&e.stop(r,t)}return window.frag.deactivateAnimation(r),n.disposeOnStop&&r.dispose(),void(n.isRunning=!1)}if(n.sequence){let e=n.sequence[n.sequenceIndex];n.nextStepTick?t>=n.nextStepTick&&(e.stop&&e.stop(r,t),n.sequenceIndex++,n.sequenceIndex===n.sequence.length?n.autoRestart?(n.sequenceIndex=0,e=n.sequence[n.sequenceIndex],e.start&&e.start(r,t),n.nextStepTick=t+(e.duration||a)):n.stopAt=t:(e=n.sequence[n.sequenceIndex],e.start&&e.start(r,t),r.interval=e.interval,n.nextStepTick=t+(e.duration||a))):(n.nextStepTick=t+(e.duration||a),e.start&&e.start(r,t)),n.action=e.action,r.nextGameTick=t+(e.interval||5)}else void 0!==n.frameRepeat?r.nextFrameTick=o+n.frameRepeat:void 0!==n.tickRepeat&&(r.nextGameTick=t+n.tickRepeat);n.action&&n.action(r,t,o)},r.sequence=function(e,t){Array.isArray(e)?n.sequence=e:n.sequence=[e],n.sequenceIndex=0,n.autoRestart=t;let o=0;for(let e=0;e<n.sequence.length;e++){const t=n.sequence[e];void 0!==t.duration?o+=t.duration:o+=a}return r.duration=o,r},r.perform=function(e,t){return r.sequence(e,t)},r.start=function(){return delete n.nextStepTick,delete n.stopAfter,delete n.stopAt,window.frag.activateAnimation(r),n.isRunning=!0,r},r.stop=function(){return n.stopAfter=0,r},r.repeatTicks=function(e,t){return delete n.autoRestart,delete n.frameRepeat,delete n.sequence,n.tickRepeat=t||e.interval||20,n.action=e,r},r.repeatFrames=function(e,t){return delete n.autoRestart,delete n.tickRepeat,delete n.sequence,n.frameRepeat=t||1,n.action=e,r},r.stopAfter=function(e){return n.stopAfter=e,delete n.stopAt,r},r.disposeOnStop=function(e){n.disposeOnStop=e},t||window.frag.addAnimation(r),r.dispose=function(){window.frag.removeAnimation(r)},r}},4600:()=>{window.frag.KeyframeAnimationAction=function(){const e={startTick:void 0,currentFrame:void 0,keyframes:{}},t={__private:e,interval:10,frames:100,start:function(n,r){return e.startTick=r,e.currentFrame=-1,t},action:function(n,r){let a=Math.floor((r-e.startTick)/t.interval);for(;e.currentFrame<a;){e.currentFrame++;const t=e.keyframes[e.currentFrame];if(t)for(let n=0;n<t.length;n++)t[n].action(e.currentFrame,t[n].data,r)}return t},setFrames:function(e,n){return t.interval=e,t.frames=n||t.frames,t.duration=t.interval*t.frames,t},add:function(n,r,a){let o=e.keyframes[n];return o||(o=[],e.keyframes[n]=o),o.push({action:r,data:a}),t}};return t}},5363:()=>{window.frag.ModelAnimation=function(){const e={loop:!1,interval:10,frames:50,channelGraphs:[],name:""},t={__private:e,getChannelGraphs:function(){return e.channelGraphs},name:function(n){return e.name=n,t},getName:function(){return e.name},loop:function(n){return e.loop=n,t},getLoop:function(){return e.loop},interval:function(n){return e.interval=n,t},getInterval:function(){return e.interval},frames:function(n){return e.frames=n,t},getFrames:function(){return e.frames}},n=function(t){const n=[];let r;n.length=e.frames;let a=0;for(let o=0;o<e.frames;o++){const e=t[o];if(void 0!==e){if(r=e.value,"linear"===e.transition){const e=n[a],t=(r-e)/(o-a);for(let r=a+1;r<o;r++)n[r]=e+(r-a)*t}a=o}n[o]=r}return n};return t.addChannel=function(t){e.channelGraphs.push({pattern:t.pattern,channel:t.channel,frameValues:n(t.keyframes)})},t}},9023:()=>{window.frag.ObjectAnimationState=function(){const e={__private:{},location:window.frag.Location(),getMatrix:function(){return e.location.getMatrix()},getUpdateFunction:function(t){switch(t){case"translate-x":return function(t){e.location.translateX=t,e.location.isModified=!0};case"translate-y":return function(t){e.location.translateY=t,e.location.isModified=!0};case"translate-z":return function(t){e.location.translateZ=t,e.location.isModified=!0};case"scale-x":return function(t){e.location.scaleX=t,e.location.isModified=!0};case"scale-y":return function(t){e.location.scaleY=t,e.location.isModified=!0};case"scale-z":return function(t){e.location.scaleZ=t,e.location.isModified=!0};case"rotate-x":return function(t){e.location.rotateX=t,e.location.isModified=!0};case"rotate-y":return function(t){e.location.rotateY=t,e.location.isModified=!0};case"rotate-z":return function(t){e.location.rotateZ=t,e.location.isModified=!0}}return console.warn("Unsupported animation channel "+t),function(){}}};return e}},9622:()=>{window.frag.ParallelAnimationAction=function([e]){const t={actions:e},n={__private:t,duration:30,interval:5,setDuration:function(e){return n.duration=e,n},setInterval:function(e){return n.interval=e,n},start:function(e,r){return t.actions.forEach((t=>{t.start&&t.start(e,r)})),n},action:function(e,r){return t.actions.forEach((t=>{t.action&&t.action(e,r)})),n},stop:function(e,n){t.actions.forEach((t=>{t.stop&&t.stop(e,n)}))}};return n}},2201:()=>{window.frag.PositionAnimationAction=function(e,t,n){const r=window.frag.Vector,a={scenePosition:e,invLinearVelocity:t,invAngularVelocity:n,startLocation:void 0,startRotate:void 0,moveBy:void 0,rotateBy:void 0,moveTo:void 0,rotateTo:void 0},o={__private:a,setInterval:function(e){return o.interval=e,o},moveBy:function(e,t){t=t||a.invLinearVelocity||1;let n=r.length(e);return o.duration=Math.floor(t*n+1),a.moveBy=e,o},moveTo:function(e,t){return t&&(a.invAngularVelocity=void 0),a.invLinearVelocity=t||a.invLinearVelocity||1,a.moveTo=e,o},rotateBy:function(e,t){t=t||a.invAngularVelocity||10;let n=r.length(e);return o.duration=Math.floor(t*n+1),a.rotateBy=e,o},rotateTo:function(e,t){return t&&(a.invLinearVelocity=void 0),a.invAngularVelocity=t||a.invAngularVelocity||10,a.rotateTo=e,o},moveByXYZ:function(e,t,n,r){return o.moveBy([e,t,n],r)},moveByXY:function(e,t,n){return o.moveBy([e,t,0],n)},moveToXYZ:function(e,t,n,r){return o.moveTo([e,t,n],r)},moveToXY:function(e,t,n){return o.moveTo([e,t,0],n)},rotateByXYZ:function(e,t,n,r){return o.rotateBy([e,t,n],r)},rotateByXY:function(e,t,n){return o.rotateBy([e,t,0],n)},rotateToXYZ:function(e,t,n,r){return o.rotateTo([e,t,n],r)},rotateToXY:function(e,t,n){return o.rotateTo([e,t,0],n)},onStart:function(e){return a.onStart=e,o},onStop:function(e){return a.onStop=e,o},start:function(e,t){if(a.startLocation=a.scenePosition.getLocation(),a.startRotate=a.scenePosition.getRotate(),a.rotateTo&&a.invAngularVelocity){a.rotateDelta=function(e,t){const n=r.sub(e,t);for(let e=0;e<n.length;e++){for(;n[e]<-Math.PI;)n[e]+=2*Math.PI;for(;n[e]>Math.PI;)n[e]-=2*Math.PI}return n}(a.rotateTo,a.startRotate);const e=r.length(a.rotateDelta);o.duration=Math.floor(a.invAngularVelocity*e+1)}if(a.moveTo&&a.invLinearVelocity){a.moveDelta=(n=a.moveTo,i=a.startLocation,r.sub(n,i));const e=r.length(a.moveDelta);o.duration=Math.floor(a.invLinearVelocity*e+1)}var n,i;return a.startTick=t,a.endTick=t+o.duration,a.onStart&&a.onStart(e,o,t),o},action:function(e,t){const n=(t-a.startTick)/o.duration;let i=a.moveBy,s=a.rotateBy;return a.moveDelta&&(i=a.moveDelta),a.rotateDelta&&(s=a.rotateDelta),i&&a.scenePosition.location(r.add(a.startLocation,r.mult(i,n))),s&&a.scenePosition.rotate(r.add(a.startRotate,r.mult(s,n))),o},stop:function(e,t){return a.onStop&&a.onStop(e,o,t),o}};return o}},666:()=>{window.frag.RepeatAnimationAction=function(e,t){return{duration:e.duration*t,interval:e.interval,start:e.start,stop:e.stop,action:e.action}}},3890:()=>{window.frag.SceneObjectAnimation=function(e,t){const n=e.modelAnimation,r=e.childAnimations,a=[];for(let e=0;e<r.length;e++){const n=r[e],o=n.model.getName();if(animationState=t[o],animationState){const e=n.graph,t=animationState.getUpdateFunction(e.channel);a.push((function(n){t(e.frameValues[n])}))}}const o=function(e){for(let t=0;t<a.length;t++)a[t](e)},i=window.frag.KeyframeAnimationAction().setFrames(n.getInterval(),n.getFrames());for(let e=0;e<n.getFrames();e++)i.add(e,o);return window.frag.Animation().perform(i,n.getLoop())}},9889:()=>{window.frag.ValueAnimationAction=function(){const e={},t={__private:e,duration:30,interval:5,setDuration:function(e){return t.duration=e,t},setInterval:function(e){return t.interval=e,t},onStart:function(n){return e.onStart=n,t},onStop:function(n){return e.onStop=n,t},onStep:function(n){return e.onStep=n,t},start:function(n,r){return e.startTick=r,e.endTick=r+t.duration,e.onStart&&e.onStart(n,t,r),t},action:function(n,r){if(e.onStep){const a=(r-e.startTick)/t.duration;e.onStep(n,a,t,r)}return t},stop:function(n,r){return e.onStop&&e.onStop(n,t,r),t}};return t}},3014:()=>{window.frag.OrthographicCamera=function(){const e={x:0,y:0,z:-200,fov:35*Math.PI/180,zNear:-100,zFar:100,xScale:100,aspectRatio:1},t={__private:e,worldToClipTransform:window.frag.Transform()},n=function(){const n=1/e.xScale,r=e.aspectRatio/e.xScale,a=2/(e.zFar-e.zNear),o=1-e.zFar*a;t.worldToClipTransform.identity().translateZ(o).scaleXYZ(n,r,a).translateXY(-e.x,-e.y)};return t.moveToXY=function(r,a){return e.x=r,e.y=a,n(),t},t.moveToXYZ=function(r,a,o){return e.x=r,e.y=a,e.z=o,n(),t},t.moveToX=function(r){return e.x=r,n(),t},t.moveToY=function(r){return e.y=r,n(),t},t.moveToZ=function(r){return e.z=r,n(),t},t.frustrum=function(r,a,o){return e.fov=r,e.zNear=a,e.zFar=o,n(),t},t.scaleX=function(r){return e.xScale=r,n(),t},t.setViewport=function(e){return e.viewport(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.canvas.width=e.canvas.clientWidth,e.canvas.height=e.canvas.clientHeight,t.adjustToViewport(e)},t.adjustToViewport=function(n){const r=n.drawingBufferWidth/n.drawingBufferHeight;if(r!=e.aspectRatio){e.aspectRatio=r;const n=t.worldToClipTransform.getMatrix();n[5]=n[0]*r,t.worldToClipTransform.setMatrix(n)}return t},t}},3906:()=>{window.frag.PerspectiveCamera=function(){const e=window.frag,t={locationTransform:window.frag.Transform(),worldTransform:window.frag.Transform(),perspectiveTransform:window.frag.Transform(),x:0,y:0,z:-200,xRot:0,yRot:0,zRot:0,fov:45*Math.PI/180,zNear:-100,zFar:100,xScale:100,aspectRatio:1,transformChanged:!0},n={__private:t,worldToClipTransform:window.frag.Transform()};return t.computeCameraTransforms=function(){t.locationTransform.identity().translateXYZ(t.x,t.y,t.z).rotateXYZ(t.xRot,t.yRot,t.zRot),t.worldTransform.identity().rotateXYZ(-t.xRot,-t.yRot,-t.zRot).scaleXYZ(1/t.xScale,t.aspectRatio/t.xScale,2/(t.zFar-t.zNear)).translateXYZ(-t.x,-t.y,-t.z),t.transformChanged=!0},t.computePerspectiveTransform=function(){const e=-2*(t.zNear-t.z)/(t.zFar-t.zNear)-1;t.perspectiveTransform.setMatrix([1,0,0,0,0,1,0,0,0,0,1,.5,0,0,e,.7]),t.transformChanged=!0},t.computeTransform=function(){const r=e.Matrix.m4Xm4(t.perspectiveTransform.getMatrix(),t.worldTransform.getMatrix());n.worldToClipTransform.setMatrix(r)},t.computeCameraTransforms(),t.computePerspectiveTransform(),n.moveToXY=function(e,r){return t.x=e,t.y=r,t.computeCameraTransforms(),n},n.moveToX=function(e){return t.x=e,t.computeCameraTransforms(),n},n.moveToY=function(e){return t.y=e,t.computeCameraTransforms(),n},n.moveToZ=function(e){return t.z=e,t.computeCameraTransforms(),t.computePerspectiveTransform(),n},n.moveToXYZ=function(e,r,a){return t.x=e,t.y=r,t.z=a,t.computeCameraTransforms(),t.computePerspectiveTransform(),n},n.frustrum=function(e,r,a){return t.fov=e,t.zNear=r,t.zFar=a,t.computePerspectiveTransform(),n},n.scaleX=function(e){return t.xScale=e,t.computeCameraTransforms(),n},n.setViewport=function(e){return e.viewport(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.canvas.width=e.canvas.clientWidth,e.canvas.height=e.canvas.clientHeight,n.adjustToViewport(e)},n.adjustToViewport=function(e){const r=e.drawingBufferWidth/e.drawingBufferHeight;return r!=t.aspectRatio&&(t.aspectRatio=r,t.computeCameraTransforms()),t.transformChanged&&(t.computeTransform(),t.transformChanged=!1),n},n}},3270:()=>{window.frag.UiCamera=function(){const e={aspectRatio:1},t={worldToClipTransform:window.frag.Transform2D().identity(),scaleX:function(n){var r=t.worldToClipTransform.getMatrix();return r[0]=1/n,t.worldToClipTransform.setMatrix(r),e.aspectRatio=-1,t},setViewport:function(e){return e.viewport(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.canvas.width=e.canvas.clientWidth,e.canvas.height=e.canvas.clientHeight,t.adjustToViewport(e)},adjustToViewport:function(n){const r=n.drawingBufferWidth/n.drawingBufferHeight;if(e.aspectRatio!=r){const n=t.worldToClipTransform.getMatrix();n[4]=n[0]*r,t.worldToClipTransform.setMatrix(n),e.aspectRatio=r}return t}};return t}},6437:()=>{!function(){const e=window.frag,t=[],n={},r={};let a=performance.now(),o=0,i=0,s=null,c=0,l=0,u=[],f=0,d=0;e.correctClock=function(t){let n=t-o;n>0?a+=e.gameTickMs:n<0&&(a-=e.gameTickMs)},e.mainScene=function(t){return s&&s.dispose(),s=t,e},e.getMainScene=function(){return s},e.addScene=function(n){return t.push(n),e},e.removeScene=function(e){for(let n=0;n<t.length;n++)if(t[n]===e)return t.splice(n,1),!0;return!1},e.activateAnimation=function(e){n[e.id]=e,delete r[e.id]},e.deactivateAnimation=function(e){r[e.id]=e,delete n[e.id]},e.addAnimation=function(t){return t.id=c++,r[t.id]=t,e},e.removeAnimation=function(t){return delete r[t.id],delete n[t.id],e};const m=function(){if(s){const r=e.gl,c=performance.now();o=Math.floor((c-a)/window.frag.gameTickMs),i++,function(e,t){for(let r in n){let a=n[r];void 0!==a.nextFrameTick?t>=a.nextFrameTick&&(a.nextFrameTick=t+10,a.action(null,e,t)):null!=a.nextGameTick?e>=a.nextGameTick&&(a.nextGameTick=e+5,a.action(null,e,t)):a.nextGameTick=e+5}}(o,i),r.bindFramebuffer(r.FRAMEBUFFER,null),s.setViewport(r),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);const m={gl:r};s.draw(m);for(let e=0;e<t.length;e++)t[e].adjustToViewport(r),t[e].draw(m);const g=performance.now();l++,g>d&&(d=g+100,f+=l,u.push(l),l=0,u.length>20&&(f-=u.shift()),e.fps=10*f/u.length)}setTimeout(m,e.renderInterval)};window.frag.startFunctions.push(m)}()},7904:()=>{window.frag=window.frag||{},window.frag.startFunctions=[],window.frag.init=function(){const e=window.frag;if(e.canvas=e.canvas||document.getElementById("scene"),!e.canvas)return console.error('No canvas with id of "scene" in the page'),null;const t=e.canvas.getContext("webgl");if(!t)return alert("WebGL is not available"),null;e.gl=t,e.canvas.addEventListener("contextmenu",(e=>e.preventDefault())),t.clearColor(1,1,1,1),t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),e.renderInterval=15,e.gameTickMs=10,e.debugPackageLoader=!1,e.debugShaderBuilder=!1,e.debugAnimations=!1,e.debugMeshes=!1,e.debugInputs=!1,e.transparency=!1,e.maxTextureUnits=e.gl.getParameter(e.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),e.nextTextureUnit=0,e.allocateTextureUnit=function(){const t=e.nextTextureUnit;return e.nextTextureUnit=(e.nextTextureUnit+1)%e.maxTextureUnits,t},e.config&&e.config(e),e.transparency&&(e.gl.enable(e.gl.BLEND),e.gl.blendFunc(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA));for(var n=0;n<e.startFunctions.length;n++)e.startFunctions[n](e);return e}},1821:()=>{window.frag.Location=function(e){const t={is3d:e,isModified:!1,matrix:null,translateX:0,translateY:0,translateZ:0,scaleX:1,scaleY:1,scaleZ:1,rotateX:0,rotateY:0,rotateZ:0,clone:function(){const e=window.frag.Location(t.is3d);return e.isModified=t.isModified,e.matrix=t.matrix,e.translateX=t.translateX,e.translateY=t.translateY,e.translateZ=t.translateZ,e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.scaleZ=t.scaleZ,e.rotateX=t.rotateX,e.rotateY=t.rotateY,e.rotateZ=t.rotateZ,e},add:function(e){return t.translateX+=e.translateX,t.translateY+=e.translateY,t.translateZ+=e.translateZ,t.scaleX*=e.scaleX,t.scaleY*=e.scaleY,t.scaleZ*=e.scaleZ,t.rotateX+=e.rotateX,t.rotateY+=e.rotateY,t.rotateZ+=e.rotateZ,t.isModified=!0,t},getMatrix:function(){if(t.matrix&&!t.isModified)return t.matrix;let e;return e=t.is3d?window.frag.Transform().translateXYZ(t.translateX,t.translateY,t.translateZ).rotateXYZ(t.rotateX,t.rotateY,t.rotateZ).scaleXYZ(t.scaleX,t.scaleY,t.scaleZ):window.frag.Transform2D().translateXY(t.translateX,t.translateY).rotate(t.rotateZ).scaleXY(t.scaleX,t.scaleY),t.matrix=e.getMatrix(),t.isModified=!1,t.matrix}};return t}},9607:()=>{window.frag.Observable=function(e){const t={notify:e,observers:[]};return{__private:t,subscribe:function(e){t.observers.push(e),t.notify(e)},unsubscribe:function(e){for(let n=0;n<t.observers.length;n++)if(t.observers[n]===e)return t.observers.splice(n,1),!0;return!1},notify:function(e){e=e||t.notify||function(e){e()};for(let n=0;n<t.observers.length;n++)e(t.observers[n])}}},window.frag.ObservableValue=function(){let e=null;const t=frag.Observable((t=>{t(e)}));return{get:function(){return e},set:function(n){e=n,t.notify()},subscribe:function(e){return t.subscribe(e)},unsubscribe:function(e){return t.unsubscribe(e)}}}},1346:()=>{window.frag.Transform=function(e){const t=window.frag,n={matrix:e},r={__private:n,observableMatrix:window.frag.Observable((e=>{e(n.matrix)})),is3d:!0,clone:function(e){return window.frag.Transform(e||n.matrix)},getMatrix:function(){return n.matrix},setMatrix:function(e){return n.matrix=e,r.observableMatrix.notify(),r}};return n.transform=function(e){return n.matrix?r.setMatrix(t.Matrix.m4Xm4(n.matrix,e)):r.setMatrix(e)},r.identity=function(){return r.setMatrix([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},r.scale=function(e){return n.transform([e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])},r.scaleX=function(e){return n.transform([e,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},r.scaleY=function(e){return n.transform([1,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])},r.scaleZ=function(e){return n.transform([1,0,0,0,0,1,0,0,0,0,e,0,0,0,0,1])},r.scaleXY=function(e,t){return n.transform([e,0,0,0,0,t,0,0,0,0,1,0,0,0,0,1])},r.scaleXYZ=function(e,t,r){return n.transform([e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1])},r.translateX=function(e){return n.transform([1,0,0,0,0,1,0,0,0,0,1,0,e,0,0,1])},r.translateY=function(e){return n.transform([1,0,0,0,0,1,0,0,0,0,1,0,0,e,0,1])},r.translateZ=function(e){return n.transform([1,0,0,0,0,1,0,0,0,0,1,0,0,0,e,1])},r.translateXY=function(e,t){return n.transform([1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1])},r.translateXYZ=function(e,t,r){return n.transform([1,0,0,0,0,1,0,0,0,0,1,0,e,t,r,1])},r.rotateX=function(e){var t=Math.cos(e),r=Math.sin(e);return n.transform([1,0,0,0,0,t,r,0,0,-r,t,0,0,0,0,1])},r.rotateY=function(e){var t=Math.cos(e),r=Math.sin(e);return n.transform([t,0,-r,0,0,1,0,0,r,0,t,0,0,0,0,1])},r.rotateZ=function(e){var t=Math.cos(e),r=Math.sin(e);return n.transform([t,r,0,0,-r,t,0,0,0,0,1,0,0,0,0,1])},r.rotateXYZ=function(e,t,n){return e&&r.rotateX(e),t&&r.rotateY(t),n&&r.rotateZ(n),r},r.apply=function(e,t){return void 0!==t&&e.uniformMatrix4fv(t,!1,r.getMatrix()),r},r}},9670:()=>{window.frag.Transform2D=function(e){const t=window.frag,n={matrix:e},r={__private:n,observableMatrix:window.frag.Observable((e=>{e(n.matrix)})),is3d:!1,clone:function(e){return window.frag.Transform2D(e||n.matrix)},getMatrix:function(){return n.matrix},setMatrix:function(e){return n.matrix=e,r.observableMatrix.notify(),r}};return n.transform=function(e){return n.matrix?r.setMatrix(t.Matrix.m3Xm3(n.matrix,e)):r.setMatrix(e)},r.identity=function(){return r.setMatrix([1,0,0,0,1,0,0,0,1])},r.scale=function(e){return n.transform([e,0,0,0,e,0,0,0,1])},r.scaleXY=function(e,t){return n.transform([e,0,0,0,t,0,0,0,1])},r.translateX=function(e){return n.transform([1,0,0,0,1,0,e,0,1])},r.translateY=function(e){return n.transform([1,0,0,0,1,0,0,e,1])},r.translateXY=function(e,t){return n.transform([1,0,0,0,1,0,e,t,1])},r.rotate=function(e){var t=Math.cos(e),r=Math.sin(e);return n.transform([t,-r,0,r,t,0,0,0,1])},r.apply=function(e,t){return void 0!==t&&e.uniformMatrix3fv(t,!1,r.getMatrix()),r},r}},5217:()=>{window.frag.AnalogAction=function(e,t){const n=e.split("-");let r="move",a="z";for(let e=0;e<n.length;e++)/^move$/i.test(n[e])&&(r="move"),/^rotate$/i.test(n[e])&&(r="rotate"),/^scale$/i.test(n[e])&&(r="scale"),/^x$/i.test(n[e])&&(a="x"),/^y$/i.test(n[e])&&(a="y"),/^z$/i.test(n[e])&&(a="z"),/^right$/i.test(n[e])&&(a="right"),/^up$/i.test(n[e])&&(a="up"),/^forward$/i.test(n[e])&&(a="forward");if(/camera/i.test(e)&&"move"===r){if("x"===a)return function(e){frag.getMainScene().getCamera().moveToX(e.value)};if("y"===a)return function(e){frag.getMainScene().getCamera().moveToY(e.value)};if("z"===a)return function(e){frag.getMainScene().getCamera().moveToZ(e.value)}}return t&&t.sceneObject&&/sceneobject/i.test(e)?function(e){}:null}},280:()=>{window.frag.AnalogInput=function(t,n){const r=window.frag,a={inputName:t,analogState:n},o={__private:a},i=t.split("-");if(/mouse/i.test(t)){let e,t,n=0,s=!1,c=!1,l=!1;for(let e=0;e<i.length;e++)/^horizontal$/.test(i[e])&&(s=!1),/^vertical$/.test(i[e])&&(s=!0),/^inverted$/.test(i[e])&&(c=!0),/^wheel$/.test(i[e])&&(l=!0),/^left$/.test(i[e])&&(n=1),/^right$/.test(i[e])&&(n=2),/^middle$/.test(i[e])&&(n=4),/^back$/.test(i[e])&&(n=8),/^forward$/.test(i[e])&&(n=16),/^any$/.test(i[e])&&(n=255);const u=function(o){if(0===n){let e=s?(r.canvas.clientHeight-o.clientY)/r.canvas.clientHeight:o.clientX/r.canvas.clientWidth;c&&(e=1-e);const t=(a.analogState.maxValue-a.analogState.minValue)*e+a.analogState.minValue;r.debugInputs&&console.log("Analog input",a.inputName,"=",t),a.analogState.setValue(o,t,!0)}else if(0!=(o.buttons&n)){let n=s?(c?o.clientY-e:e-o.clientY)/r.canvas.clientHeight:(c?e-o.clientX:o.clientX-e)/r.canvas.clientWidth;const i=t+(a.analogState.maxValue-a.analogState.minValue)*n;r.debugInputs&&console.log("Analog input",a.inputName,"=",i),a.analogState.setValue(o,i,!0)}return!0},f=function(r){0!=(r.buttons&n)&&(e=s?r.clientY:r.clientX,t=a.analogState.value)},d=function(e){return r.debugInputs&&console.log("Analog input",a.inputName,"delta",e.deltaY),c?e.deltaY>0?a.analogState.decrement(e):a.analogState.increment(e):e.deltaY<0?a.analogState.decrement(e):a.analogState.increment(e),e.preventDefault(),!0};return o.enable=function(){l?r.canvas.addEventListener("wheel",d,!1):(r.canvas.addEventListener("mousemove",u,!1),0!==n&&r.canvas.addEventListener("mousedown",f,!1))},o.disable=function(){l?r.canvas.removeEventListener("wheel",d,!1):(r.canvas.removeEventListener("mousemove",u,!1),0!==n&&r.canvas.removeEventListener("mousedown",f,!1))},o}if(/keys/i.test(i[0])){let e="ArrowLeft",t="ArrowRight";i.length>1&&(e=i[1]),i.length>2&&(t=i[2]);const n=function(n){return n.key===e?(r.debugInputs&&console.log("Analog input",a.inputName,"decrement"),a.analogState.decrement(n),n.preventDefault()):n.key===t&&(r.debugInputs&&console.log("Analog input",a.inputName,"increment"),a.analogState.increment(n),n.preventDefault()),!0};return o.enable=function(){document.addEventListener("keydown",n,!1)},o.disable=function(){document.removeEventListener("keydown",n,!1)},o}if(/touch/i.test(t)){let e,t,n,s,c="horizontal",l=!1,u=!1,f=0;for(let e=0;e<i.length;e++)/^horizontal$/.test(i[e])&&(c="horizontal"),/^vertical$/.test(i[e])&&(c="vertical"),/^pinch$/.test(i[e])&&(c="pinch"),/^rotate$/.test(i[e])&&(c="rotate"),/^inverted$/.test(i[e])&&(l=!0),/^plus$/.test(i[e])&&(u=!0),/^1$/.test(i[e])&&(f=0),/^2$/.test(i[e])&&(f=1),/^3$/.test(i[e])&&(f=2);let d=null,m=null;if("horizontal"===c&&(d=function(o){if(u&&o.touches.length>f||o.touches.length===f+1){const i=o.touches.item(f);let c=(l?e-i.clientX:i.clientX-e)/n;const u=t+s*c;r.debugInputs&&console.log("Analog input",a.inputName,"=",u),a.analogState.setValue(o,u,!0)}return!0},m=function(o){if(o.touches.length===f+1){const i=o.touches.item(f);e=i.clientX,t=a.analogState.value,s=a.analogState.maxValue-a.analogState.minValue,n=r.canvas.clientWidth}return!0}),"vertical"===c&&(d=function(o){if(u&&o.touches.length>f||o.touches.length===f+1){const i=o.touches.item(f);let c=(l?i.clientY-e:e-i.clientY)/n;const u=t+s*c;r.debugInputs&&console.log("Analog input",a.inputName,"=",u),a.analogState.setValue(o,u,!0)}return!0},m=function(o){if(o.touches.length===f+1){const i=o.touches.item(f);e=i.clientY,t=a.analogState.value,s=a.analogState.maxValue-a.analogState.minValue,n=r.canvas.clientHeight}return!0}),"pinch"===c){const o=function(e){const t=e.touches.item(0),n=e.touches.item(1),r=n.clientX-t.clientX,a=n.clientY-t.clientY;return Math.sqrt(r*r+a*a)};d=function(i){if(u&&i.touches.length>1||2===i.touches.length){let c=(o(i)-e)/n;l&&(c=-c);const u=t+s*c;r.debugInputs&&console.log("Analog input",a.inputName,"=",u),a.analogState.setValue(i,u,!0)}return!0},m=function(i){return 2===i.touches.length&&(e=o(i),t=a.analogState.value,s=a.analogState.maxValue-a.analogState.minValue,n=.5*Math.sqrt(r.canvas.clientHeight*r.canvas.clientHeight+r.canvas.clientWidth*r.canvas.clientWidth)),!0}}if("rotate"===c){const o=function(e){const t=e.touches.item(0),n=e.touches.item(1),r=n.clientX-t.clientX,a=n.clientY-t.clientY;return Math.atan2(a,r)};d=function(i){if(u&&i.touches.length>1||2===i.touches.length){let c=(o(i)-e)/n;l&&(c=-c);const u=t+s*c;r.debugInputs&&console.log("Analog input",a.inputName,"=",u),a.analogState.setValue(i,u,!0)}return!0},m=function(r){return 2===r.touches.length&&(e=o(r),t=a.analogState.value,s=a.analogState.maxValue-a.analogState.minValue,n=.5*Math.PI),!0}}return o.enable=function(){d&&r.canvas.addEventListener("touchmove",d,!1),m&&r.canvas.addEventListener("touchstart",m,!1)},o.disable=function(){d&&r.canvas.removeEventListener("touchmove",d,!1),m&&r.canvas.removeEventListener("touchstart",m,!1)},o}if(/pointer/i.test(t)){let e,t,n=0,s=!1,c=!1;for(let e=0;e<i.length;e++)/^horizontal$/.test(i[e])&&(s=!1),/^vertical$/.test(i[e])&&(s=!0),/^inverted$/.test(i[e])&&(c=!0),/^left$/.test(i[e])&&(n=1),/^right$/.test(i[e])&&(n=2),/^middle$/.test(i[e])&&(n=4),/^back$/.test(i[e])&&(n=8),/^forward$/.test(i[e])&&(n=16),/^eraser$/.test(i[e])&&(n=32),/^any$/.test(i[e])&&(n=255);const l=function(o){if(0===n){let e=s?o.clientY/r.canvas.clientHeight:o.clientX/r.canvas.clientWidth;c&&(e=1-e);const t=(a.analogState.maxValue-a.analogState.minValue)*e+a.analogState.minValue;r.debugInputs&&console.log("Analog input",a.inputName,"=",t),a.analogState.setValue(o,t,!0)}else if(0!=(o.buttons&n)){let n=s?(c?e-o.clientY:o.clientY-e)/r.canvas.clientHeight:(c?e-o.clientX:o.clientX-e)/r.canvas.clientWidth;const i=t+(a.analogState.maxValue-a.analogState.minValue)*n;r.debugInputs&&console.log("Analog input",a.inputName,"=",i),a.analogState.setValue(o,i,!0)}return!0},u=function(r){0!=(r.buttons&n)&&(e=s?r.clientY:r.clientX,t=a.analogState.value)};return o.enable=function(){r.canvas.addEventListener("pointermove",l,!1),0!==n&&r.canvas.addEventListener("pointerdown",u,!1)},o.disable=function(){r.canvas.removeEventListener("pointermove",l,!1),0!==n&&r.canvas.removeEventListener("pointerdown",u,!1)},o}if(/gamepad/i.test(t)){let t,n=0,s=0,c=0,l=null,u=!1;for(let e=0;e<i.length;e++)/^horizontal$/.test(i[e])&&(c=0),/^vertical$/.test(i[e])&&(c=1),/^inverted$/.test(i[e])&&(u=!0),/^player1$/.test(i[e])&&(n=0),/^player2$/.test(i[e])&&(n=1),/^player3$/.test(i[e])&&(n=2),/^player4$/.test(i[e])&&(n=3),/^stick1$/.test(i[e])&&(s=0),/^stick2$/.test(i[e])&&(s=1),/^stick3$/.test(i[e])&&(s=2),/^stick4$/.test(i[e])&&(s=3);const f=2*s+c,d=function(e){if(l){const t=l.axes[f];u&&(t=-t),a.analogState.setVelocity(e,t*a.analogState.maxVelocity)}},m=function(a){r.debugInputs&&console.log("Gamepad",a.gamepad.index,"connected","id:"+a.gamepad.id,"with",e.gamepad.axes.length,"axes"),a.gamepad.index===n&&l.axes.length>f&&(l=a.gamepad,t=setInterval(d,50))},g=function(e){r.debugInputs&&console.log("Gamepad",e.gamepad.index,"disconnected","id:"+e.gamepad.id),e.gamepad.id===l.id&&(clearInterval(t),l=null)};return o.enable=function(){window.addEventListener("gamepadconnected",m,!1),window.addEventListener("gamepaddisconnected",g,!1)},o.disable=function(){window.removeEventListener("gamepadconnected",m,!1),window.removeEventListener("gamepaddisconnected",g,!1)},o}return/orientation/i.test(t),o}},6784:()=>{window.frag.AnalogState=function(e,t,n){const r=window.frag;t||(t={}),t.value=t.value||0,t.minValue=void 0===t.minValue?-100:t.minValue,t.maxValue=void 0===t.maxValue?100:t.maxValue,t.maxVelocity=t.maxVelocity||5,t.acceleration=void 0===t.acceleration?.25:t.acceleration,t.deceleration=void 0===t.deceleration?1:t.deceleration;const a={analogAction:e,config:t,name:n,inverted:!1},o={__private:a,value:t.value,minValue:t.minValue,maxValue:t.maxValue,maxVelocity:Math.abs(t.maxVelocity),velocity:0};return t.maxValue<t.minValue&&(a.inverted=!0,o.minValue=t.maxValue,o.maxValue=t.minValue),a.change=function(e){if(a.analogAction)if(Array.isArray(a.analogAction))for(let t=0;t<a.analogAction.length;t++)a.analogAction[t](o,e);else a.analogAction(o,e)},a.setValue=function(e,t){t<o.minValue&&(t=o.minValue,o.velocity=0),t>o.maxValue&&(t=o.maxValue,o.velocity=0),Math.abs(o.value-t)>1e-5&&(o.value=t,r.debugInputs&&console.log("Analog state",a.name,"set to",t),a.change(e))},a.increment=function(e){o.velocity+=o.velocity>=0?a.config.acceleration:a.config.deceleration,o.velocity>a.config.maxVelocity&&(o.velocity=a.config.maxVelocity),a.setValue(e,o.value+o.velocity,!1)},a.decrement=function(e){o.velocity-=o.velocity<=0?a.config.acceleration:a.config.deceleration,o.velocity<-a.config.maxVelocity&&(o.velocity=-a.config.maxVelocity),a.setValue(e,o.value+o.velocity,!1)},o.setValue=function(e,t,n){a.inverted&&(t=o.minValue+o.maxValue-t),n&&(o.velocity=t-o.value),a.setValue(e,t)},o.increment=function(e){a.inverted?a.decrement(e):a.increment(e)},o.decrement=function(e){a.inverted?a.increment(e):a.decrement(e)},o.setVelocity=function(e,t){inverted?o.velocity=-t:o.velocity=t,o.velocity>a.config.maxVelocity&&(o.velocity=a.config.maxVelocity),o.velocity<-a.config.maxVelocity&&(o.velocity=-a.config.maxVelocity),a.setValue(e,o.value+o.velocity)},o}},8853:()=>{window.frag.DigitalAction=function(e,t){const n=window.frag;if(t&&t.animation){if(/^animation$/i.test(e))return function(e){n.debugInputs&&console.log("Turning animation",e.isOn?"on":"off"),e.isOn?t.animation.start():t.animation.stop()};if(/^animation-start$/i.test(e))return function(e){e.isOn||(n.debugInputs&&console.log("Starting animation"),t.animation.start())};if(/^animation-stop$/i.test(e))return function(e){e.isOn||(n.debugInputs&&console.log("Stopping animation"),t.animation.stop())}}return t&&t.sceneObject&&/^sceneobject$/i.test(e)?function(e){n.debugInputs&&console.log("Turning scene object",e.isOn?"on":"off"),e.isOn?t.sceneObject.enable():t.sceneObject.disable()}:t&&t.model&&/^model$/i.test(e)?function(e){n.debugInputs&&console.log("Turning",t.model.getName(),"model",e.isOn?"on":"off"),e.isOn?t.model.enable():t.model.disable()}:null}},8562:()=>{window.frag.DigitalInput=function(e,t){const n=window.frag,r={inputName:e,digitalState:t,toggle:!1,inverted:!1,setOn:!1,setOff:!1},a={__private:r},o=e.split("-"),i=function(e,t){r.inverted&&(t=!t),n.debugInputs&&console.log("Digital input",r.inputName,"is",t?"on":"off"),r.toggle?t&&r.digitalState.toggle(e):r.setOn||r.setOff?t&&(r.setOn&&r.digitalState.setIsOn(e,!0),r.setOff&&r.digitalState.setIsOn(e,!1)):r.digitalState.setIsOn(e,t)};if(/mouse/i.test(e)){let e=1;for(let t=0;t<o.length;t++)/^toggle$/i.test(o[t])&&(r.toggle=!0),/^inverted$/i.test(o[t])&&(r.inverted=!0),/^on$/i.test(o[t])&&(r.setOn=!0),/^off$/i.test(o[t])&&(r.setOff=!0),/^left$/i.test(o[t])&&(e=1),/^right$/i.test(o[t])&&(e=2),/^middle$/i.test(o[t])&&(e=4),/^back$/i.test(o[t])&&(e=8),/^forward$/i.test(o[t])&&(e=16),/^eraser$/i.test(o[t])&&(e=32),/^any$/i.test(o[t])&&(e=255);const t=function(t){return i(t,0!=(t.buttons&e)),!0};return a.enable=function(){n.canvas.addEventListener("mousedown",t,!1),n.canvas.addEventListener("mouseup",t,!1)},a.disable=function(){n.canvas.removeEventListener("mousedown",t,!1),n.canvas.removeEventListener("mouseup",t,!1)},a}if(/pointer/i.test(e)){let e=1;for(let t=0;t<o.length;t++)/^toggle$/i.test(o[t])&&(r.toggle=!0),/^inverted$/i.test(o[t])&&(r.inverted=!0),/^on$/i.test(o[t])&&(r.setOn=!0),/^off$/i.test(o[t])&&(r.setOff=!0),/^left$/i.test(o[t])&&(e=1),/^right$/i.test(o[t])&&(e=2),/^middle$/i.test(o[t])&&(e=4),/^back$/i.test(o[t])&&(e=8),/^forward$/i.test(o[t])&&(e=16),/^eraser$/i.test(o[t])&&(e=32),/^any$/i.test(o[t])&&(e=255);const t=function(t){return i(t,0!=(t.buttons&e)),!0};return a.enable=function(){n.canvas.addEventListener("pointerdown",t,!1),n.canvas.addEventListener("pointerup",t,!1)},a.disable=function(){n.canvas.removeEventListener("pointerdown",t,!1),n.canvas.removeEventListener("pointerup",t,!1)},a}if(/key/i.test(e)){let e,t=!1,n=!1,s=!1,c=!1;for(let a=0;a<o.length;a++)/^toggle$/i.test(o[a])?r.toggle=!0:/^inverted$/i.test(o[a])?r.inverted=!0:/^on$/i.test(o[a])?r.setOn=!0:/^off$/i.test(o[a])?r.setOff=!0:/^ctrl$/i.test(o[a])?t=!0:/^shift$/i.test(o[a])?n=!0:/^alt$/i.test(o[a])?s=!0:/^meta$/i.test(o[a])?c=!0:/^key$/i.test(o[a])||(e=o[a]);const l=function(r,a){return r.key!==e||r.altKey!==s||r.ctrlKey!==t||r.shiftKey!==n||r.metaKey!==c||(r.preventDefault(),i(r,a)),!0},u=function(e){return l(e,!0)},f=function(e){return l(e,!1)};return a.enable=function(){document.addEventListener("keydown",u,!1),document.addEventListener("keyup",f,!1)},a.disable=function(){document.removeEventListener("keydown",u,!1),document.removeEventListener("keyup",f,!1)},a}return a}},3235:()=>{window.frag.DigitalState=function(e,t,n){const r=window.frag;t||(t={}),t.isOn=!!t.isOn;const a={digitalAction:e,config:t,name:n},o={__private:a,isOn:t.isOn};return a.change=function(e){if(a.digitalAction)if(Array.isArray(a.digitalAction))for(let t=0;t<a.digitalAction.length;t++)a.digitalAction[t](o,e);else a.digitalAction(o,e)},o.setIsOn=function(e,t){t!==o.isOn?(o.isOn=t,r.debugInputs&&console.log("Digital state",a.name,"turned",o.isOn?"on":"off"),a.change(e)):r.debugInputs&&console.log("Digital state",a.name,"is already",o.isOn?"on":"off")},o.toggle=function(e){o.isOn=!o.isOn,r.debugInputs&&console.log("Digital state",a.name,"toggled to",o.isOn?"on":"off"),a.change(e)},o}},9810:()=>{!function(){let e;window.frag.hitTest=function(t,n,r,a,o){const i=window.frag,s=i.gl;if(r=r||i.canvas.clientWidth,a=a||i.canvas.clientHeight,o=o||i.getMainScene(),!e){e={name:"HitTest",attributes:{},uniforms:{},is3d:!0};const t="attribute vec4 a_position;\nuniform mat4 u_clipMatrix;\nvoid main() {;\n  gl_Position = u_clipMatrix * a_position;\n}",n="precision mediump float;\nuniform vec4 u_color;\nvoid main() {;\n  gl_FragColor = u_color;\n}",r=i.createShader(e.name,s.VERTEX_SHADER,t),a=i.createShader(e.name,s.FRAGMENT_SHADER,n);e.program=i.createProgram(e.name,r,a),e.attributes.position=s.getAttribLocation(e.program,"a_position"),e.uniforms.clipMatrix=s.getUniformLocation(e.program,"u_clipMatrix"),e.uniforms.color=s.getUniformLocation(e.program,"u_color"),e.bind=function(t){t.useProgram(e.program)},e.unbind=function(){}}const c=s.createTexture();s.bindTexture(s.TEXTURE_2D,c),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,r,a,0,s.RGBA,s.UNSIGNED_BYTE,null);const l=s.createFramebuffer();s.bindFramebuffer(s.FRAMEBUFFER,l),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,c,0);const u=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,u),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,r,a),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,u),s.viewport(0,0,r,a),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);const f={gl:s,shader:e,isHitTest:!0,sceneObjects:[],models:[]};if(s.disable(s.BLEND),Array.isArray(o))for(let e=0;e<o.length;e++)o[e].adjustToViewport(s),o[e].draw(f);else o.adjustToViewport(s),o.draw(f);const d=new Uint8Array(4);s.readPixels(t,a-n,1,1,s.RGBA,s.UNSIGNED_BYTE,d),s.bindFramebuffer(s.FRAMEBUFFER,null),i.transparency&&s.enable(s.BLEND);const m=d[0],g=d[1],h=d[2],v=d[3]|h<<8|(15&g)<<16,p=(240&g)>>4|m<<4;return v<f.models.length&&p<f.sceneObjects.length?{sceneObject:f.sceneObjects[p],model:f.models[v]}:null}}()},7802:()=>{window.frag.InputMethod=function(){const e={inputs:[],enabled:!1},t={__private:e,enable:function(){if(!e.enabled){for(var n=0;n<e.inputs.length;n++)e.inputs[n].enable();e.enabled=!0}return t},disable:function(){if(e.enabled){e.enabled=!1;for(var n=0;n<e.inputs.length;n++)e.inputs[n].disable()}return t},add:function(n){return e.inputs.push(n),e.enabled&&n.enable(),t}};return t}},6237:()=>{window.frag.AssetCatalog=function(e,t){const n=window.frag,r=new Uint8Array([127,127,127,255,0,0,255,0,0,0,0,127,127,255]);t||(t={}),t.diffuse||(t.diffuse=n.Texture().name("default-diffuse-texture").dataFormat(n.gl.RGBA).fromArrayBuffer(0,r.buffer,0,1,1)),t.surface||(t.surface=n.Texture().name("default-surface-texture").dataFormat(n.gl.RGBA).fromArrayBuffer(0,r.buffer,4,1,1)),t.emmissive||(t.emmissive=n.Texture().name("default-emmissive-texture").dataFormat(n.gl.RGB).fromArrayBuffer(0,r.buffer,8,1,1)),t.normal||(t.normal=n.Texture().name("default-normal-map-texture").dataFormat(n.gl.RGB).fromArrayBuffer(0,r.buffer,11,1,1)),e||(e=n.Shader().name("Model").verticiesXYZ().matrix3D().diffuseTexture().directionalLightGrey().compile());const a={defaultTextures:t,fonts:{},materials:{},models:{}},o={__private:a,shader:e,getFont:function(e){var t=a.fonts[e];return t||(t=n.Font().name(e),a.fonts[e]=t),t},getMaterial:function(e){var t=a.materials[e];return t||(t=n.Material().name(e).disposeTextures(!1).setTexture("diffuse",a.defaultTextures.diffuse).setTexture("emmissive",a.defaultTextures.emmissive).setTexture("surface",a.defaultTextures.surface).setTexture("normalMap",a.defaultTextures.normal),a.materials[e]=t),t},getModel:function(e,t){var r=t?void 0:a.models[e];return r||(r=n.Model(o.shader.is3d).name(e).shader(o.shader),t||(a.models[e]=r)),r}};return o}},4583:()=>{window.frag.MaterialLoader=function(){const e=window.frag,t=new Uint32Array([287454020]),n=68===new Uint8Array(t.buffer)[0],r={},a={__private:r,littleEndian:n};return r.loadMipV1=function(t,r,a,o,i,s,c,l){const u=t.getUint8(r++),f=t.getUint32(r,n);e.debugMaterialLoader&&console.log("Color data at "+f),r+=4;const d=e.Texture().dataFormat(1==(1&u)?e.gl.RGBA:e.gl.RGB).fromArrayBuffer(s,a,o+f,c,l);if(i.setTexture("diffuse",d),2==(2&u)){const u=t.getUint32(r,n);e.debugMaterialLoader&&console.log("Surface data at "+u),r+=4;const f=e.Texture().dataFormat(e.gl.RGBA).fromArrayBuffer(s,a,o+u,c,l);i.setTexture("surface",f)}if(4==(4&u)){const u=t.getUint32(r,n);e.debugMaterialLoader&&console.log("Normal map at "+u),r+=4;const f=e.Texture().dataFormat(e.gl.RGB).fromArrayBuffer(s,a,o+u,c,l);i.setTexture("normalMap",f)}if(8==(8&u)){const u=t.getUint32(r,n);e.debugMaterialLoader&&console.log("PBR data at "+u),r+=4;const f=e.Texture().dataFormat(e.gl.RGBA).fromArrayBuffer(s,a,o+u,c,l);i.setTexture("pbr",f)}return r},r.loadMaterialV1=function(t,n,a,o,i){const s=n.getUint8(a++);var c="";for(let e=0;e<s;e++)c+=String.fromCharCode(n.getUint8(a++));const l=t.getMaterial(c);e.debugMaterialLoader&&(console.log(""),console.log("Loading "+c+" material textures"));var u,f=1<<n.getUint8(a++),d=f,m=0;do{u=n.getUint8(a++),e.debugMaterialLoader&&console.log("Loading MIP level "+u+" at "+f+" x "+d+" pixels"),u!==m&&console.error("Mip levels are wrong for "+c+" texture"),a=r.loadMipV1(n,a,o,i,l,u,f,d),m++,f>>>=1,d>>>=1}while(0!==u)},a.loadMaterialsFromBuffer=function(t,a){a||(a=e.AssetCatalog());const o=new Uint8Array(t),i=new DataView(t,0,o.length),s=o[0],c=i.getUint16(2,n);var l=4;const u=l+c;if(e.debugMaterialLoader&&console.log("Material pack V"+s+" is "+o.length+" bytes with "+c+" header bytes"),1===s)for(var f=i.getUint16(l,n);0!==f;)r.loadMaterialV1(a,i,l+2,t,u),l+=f,f=i.getUint16(l,n);else console.error("Version "+s+" texture packs are not supported");return a},a.loadMaterialsFromUrl=function(e,t,n){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=function(){4==this.readyState&&200==this.status&&(t=a.loadMaterialsFromBuffer(this.response,t),n&&n(t))},r.open("GET",e,!0),r.send()},a}()},956:()=>{window.frag.PackageLoader=function(){const e=window.frag,t=new Uint32Array([287454020]),n=68===new Uint8Array(t.buffer)[0],r=function(e){return Math.round(1e4*e)/1e4},a={},o={__private:a,littleEndian:n};return a.loadFontV1=function(t,r,a){const o=t.header.getUint8(a++);var i="";for(let e=0;e<o;e++)i+=String.fromCharCode(t.header.getUint8(a++));const s=t.assetCatalog.getFont(i);e.debugPackageLoader&&console.log("Object["+r+"] is font "+i);const c=t.header.getUint8(a++);var l="";for(let e=0;e<c;e++)l+=String.fromCharCode(t.header.getUint8(a++));const u=t.header.getUint16(a,n),f=t.header.getUint16(a+2,n),d=t.header.getUint16(a+4,n),m=t.header.getUint16(a+6,n);a+=8,e.debugPackageLoader&&console.log("  "+f+"x"+d+" pixel texture contains "+m+" characters from "+u+"px "+l),s.lineHeight(u);for(let e=0;e<m;e++){const e=t.header.getUint8(a++);var g="";for(let n=0;n<e;n++)g+=String.fromCharCode(t.header.getUint8(a++));const r=t.header.getUint16(a+0,n),o=t.header.getUint16(a+2,n),i=t.header.getUint16(a+4,n),c=t.header.getUint16(a+6,n),l=t.header.getInt16(a+8,n),u=t.header.getInt16(a+10,n),f=t.header.getInt16(a+12,n);a+=14,s.addChar(g,r,o,i,c,l,u,f)}const h=t.header.getUint8(a++);var v="";for(let e=0;e<h;e++)v+=String.fromCharCode(t.header.getUint8(a++));"RGB"===v?s.dataFormat(e.gl.RGB):"RGBA"===v?s.dataFormat(e.gl.RGBA):"L"===v?s.dataFormat(e.gl.LUMINANCE):console.error("Font "+i+" unsupported mode "+v);const p=t.header.getUint16(a+0,n),x=t.header.getUint16(a+2,n);let T=t.header.getUint32(a+4,n)+t.dataOffset;a+=8,p!==f&&console.error("Font "+i+" width does not match image width"),x!==d&&console.error("Font "+i+" height does not match image height");const b=new Uint8Array(t.data,T);return s.fromArrayBuffer(b,0,f,d),s},a.loadMaterialV1=function(t,n,r){const a=t.header.getUint8(r++);var o="";for(let e=0;e<a;e++)o+=String.fromCharCode(t.header.getUint8(r++));const i=t.assetCatalog.getMaterial(o);return e.debugPackageLoader&&console.log("Object["+n+"] is material "+o),i},a.loadMeshV1=function(t,a,o){const i=e.MeshData(),s=t.header.getUint16(o,n);o+=2,e.debugPackageLoader&&console.log("Object["+a+"] is a mesh with "+s+" fragments");for(let a=0;a<s;a++){const s=t.header.getUint8(o),l=t.header.getUint8(o+1),u=t.header.getUint8(o+2),f=t.header.getUint8(o+3),d=t.header.getUint8(o+4),m=t.header.getUint8(o+5),g=t.header.getUint8(o+6),h=t.header.getUint32(o+7,n),v=t.header.getUint32(o+11,n);let p=t.header.getUint32(o+15,n)+t.dataOffset;o+=19;const x=1==(1&l),T=2==(2&l);let b=0;if(1===s?b=h/3:2===s?b=h/2:(3===s||4===s)&&(b=h-2),e.debugPackageLoader){let e="  fragment["+a+"] has "+h+" verticies forming ";switch(1===s?e+=b+" triangles":2===s?e+=b/2+" rectangles":3===s?e+="a strip of "+b+"triangles":4===s&&(e+="a fan of "+b+" triangles"),x&&(e+=" indexed"),T||(e+=" in 2D"),u){case 1:e+=" with custom normals";break;case 2:e+=" with indexed normals";break;case 3:e+=" with triangle normals"}switch(f){case 1:e+=" with custom tangents";break;case 2:e+=" with indexed tangents";break;case 3:e+=" with triangle tangents";break;case 4:e+=" with single tangent"}switch(d){case 1:e+=" with bitangents"}switch(m){case 1:e+=" with custom uvs";break;case 2:e+=" with indexed uvs";break;case 3:e+=" with triangle uvs"}switch(g){case 1:e+=" with custom colors";break;case 2:e+=" with custom colors and transparency";break;case 3:e+=" with indexed colors";break;case 4:e+=" with indexed colors and transparency"}console.log(e)}const w=x?[]:void 0;if(x){indexArray=new Int16Array(t.data,p);for(let e=0;e<h;e++)w.push(indexArray[e]);p+=2*h,1==(1&h)&&(p+=2)}const D=[],E=0===u?void 0:[],S=0===f?void 0:[],_=0===d?void 0:[],A=0===m?void 0:[],F=void 0,y=new Float32Array(t.data,p);for(let e=0;e<h;e++){let t=x?w[e]:e,n=Math.trunc(e/3);2===s?n=Math.trunc(e/4):3!==s&&4!==s||(n=e<3?0:e-2);let r=0,a=T?3*t:2*t;switch(D.push(y[a]),D.push(y[a+1]),T?(D.push(y[a+2]),r+=3*v):r+=2*v,u){case 1:a=r+3*e,r+=3*h;break;case 2:a=r+3*t,r+=3*v;break;case 3:a=r+3*n,r+=3*b}0!==u&&(E.push(y[a]),E.push(y[a+1]),E.push(y[a+2]))}if(e.debugPackageLoader&&e.debugMeshes){let e="  vertices[";for(var c=0;c<D.length;c++)c>0&&(e+=", "),e+=r(D[c]);e+="]",console.log(e)}const M=e.VertexData();1===s||2===s?T?M.setTriangles(D,F,A,E,S,_):M.setTriangles2D(D,F,A,E,S,_):3===s?M.setTriangleStrip(D,F,A,E,S,_):4===s&&M.setTriangleFan(D,F,A,E,S,_),i.addVertexData(M)}return i},a.loadAnimationV1=function(t,a,o){const i=t.header.getUint8(o++);var s="";for(let e=0;e<i;e++)s+=String.fromCharCode(t.header.getUint8(o++));const c=t.header.getUint8(o),l=t.header.getUint16(o+1,n),u=t.header.getUint16(o+3,n),f=t.header.getUint8(o+5);o+=6;const d=1==(1&c),m=2==(2&c);if(e.debugPackageLoader){let e="Object["+a+"] is '"+s+"' animation which runs for "+l+"x"+u+" ms";d&&(e+=". Repeats until stopped"),m&&(e+=". Plays in reverse after playing forwards"),console.log(e)}const g=e.ModelAnimation().name(s).loop(d).frames(l).interval(u/window.frag.gameTickMs);for(let a=0;a<f;a++){const a=t.header.getUint8(o++);var h="";for(let e=0;e<a;e++)h+=String.fromCharCode(t.header.getUint8(o++));const i=t.header.getUint8(o++);var v="";for(let e=0;e<i;e++)v+=String.fromCharCode(t.header.getUint8(o++));e.debugPackageLoader&&e.debugAnimations&&(msg="  Channel "+v+" applies to "+h+" children",console.log(msg));const s={},c=t.header.getUint16(o,n);o+=2;for(let a=0;a<c;a++){const a=t.header.getUint16(o,n),i=t.header.getUint8(o+2),c=t.header.getFloat32(o+3,n);o+=7;var p="step";1===i?p="linear":2===i&&(p="spline"),s[a]={value:c,transition:p},e.debugPackageLoader&&e.debugAnimations&&(msg="    Keyframe["+a+"] = "+r(c)+" "+p,console.log(msg))}g.addChannel({channel:v,pattern:new RegExp(h,"i"),keyframes:s})}return g},a.loadModelV1=function(t,a,o){const i=t.header.getUint8(o++);var s="";for(let e=0;e<i;e++)s+=String.fromCharCode(t.header.getUint8(o++));const c=t.header.getUint8(o),l=t.header.getUint16(o+1,n),u=t.header.getUint16(o+3,n);o+=5;const f=e.Location(!0);f.translateX=t.header.getFloat32(o+0,n),f.translateY=t.header.getFloat32(o+4,n),f.translateZ=t.header.getFloat32(o+8,n),f.rotateX=t.header.getFloat32(o+12,n),f.rotateY=t.header.getFloat32(o+16,n),f.rotateZ=t.header.getFloat32(o+20,n),f.scaleX=t.header.getFloat32(o+24,n),f.scaleY=t.header.getFloat32(o+28,n),f.scaleZ=t.header.getFloat32(o+32,n),f.isModified=!0,o+=36;const d=t.header.getUint16(o,n),m=t.header.getUint16(o+2,n);o+=4;const g=1==(1&c),h=2==(2&c),v=4==(4&c);e.debugPackageLoader&&(console.log("Object["+a+"] is "+(g?"root ":"")+"model "+s+" with "+d+" children and "+m+" animations."+(v?" Paint mesh "+u:" No mesh")+(h?" with material "+l:". No material")),console.log("Object["+a+"] at ("+r(f.translateX)+","+r(f.translateY)+","+r(f.translateZ)+").["+r(f.rotateX)+","+r(f.rotateY)+","+r(f.rotateZ)+"]x("+r(f.scaleX)+","+r(f.scaleY)+","+r(f.scaleZ)+")"));const p=t.assetCatalog.getModel(s,!g);p.location=f,h&&p.material(t.materials[l]),v&&p.mesh(t.meshes[u]);for(let e=0;e<d;e++){const e=t.header.getUint16(o,n);o+=2,p.addChild(t.models[e])}if(g){e.debugAnimations&&m>0&&console.log("Model #"+a+" '"+s+"' has "+m+" animations");for(let r=0;r<m;r++){const r=t.header.getUint16(o,n);o+=2;const a=t.animations[r];if(e.debugAnimations){const e=a.getChannelGraphs();console.log("  Animation '"+a.getName()+"' has "+e.length+" channels."+(a.__private.loop?" Loop ":"")+a.__private.frames+"x"+a.__private.interval+" frames");for(let t=0;t<e.length;t++)console.log("    Animates "+e[t].channel+" for children matching "+e[t].pattern)}p.addAnimation(a)}}else m>0&&console.warn("Model #"+a+" '"+s+"' has "+m+" animations but is not a root");return p},o.loadFromBuffer=function(t,r){r||(r=e.AssetCatalog());const o=new Uint8Array(t),i=new DataView(t,0,o.length),s=o[0],c=i.getUint32(4,n);var l=8;const u=l+c;e.debugPackageLoader&&console.log("Asset pack V"+s+" is "+o.length+" bytes with "+c+" header bytes");const f={assetCatalog:r,header:i,data:t,dataOffset:u,materials:{},meshes:{},animations:{},models:{},fonts:{}};if(1===s)for(var d=i.getUint16(l,n),m=0;0!==d;){const e=i.getUint16(l+2,n),t=i.getUint8(l+4),r=l+5;if(e!==m++)return void console.error("Object indexes are not consecutive");if(0===t)break;1===t?f.materials[e]=a.loadMaterialV1(f,e,r):2===t?f.meshes[e]=a.loadMeshV1(f,e,r):3===t?f.animations[e]=a.loadAnimationV1(f,e,r):4===t?f.models[e]=a.loadModelV1(f,e,r):5===t?f.fonts[e]=a.loadFontV1(f,e,r):console.error("Unknown object type "+t),l+=d,d=i.getUint16(l,n)}else console.error("Version "+s+" asset packs are not supported");return r},o.loadFromUrl=function(e,t,n){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=function(){4==this.readyState&&200==this.status&&(t=o.loadFromBuffer(this.response,t),n&&n(t))},r.open("GET",e,!0),r.send()},o}()},2636:()=>{window.frag.Font=function(e,t){const n=window.frag,r=n.gl,a=e||{glTexture:null,generated:!1,internalFormat:r.RGBA,format:r.RGBA,dataType:r.UNSIGNED_BYTE,valuesPerPixel:4,chars:{},lineHeight:24},o={textColor:[0,0,0,1],backgroundColor:[0,0,0,1],kerning:!1,letterSpacing:0};t&&(o.textColor=t.textColor,o.backgroundColor=t.backgroundColor,o.kerning=t.kerning,o.letterSpacing=t.letterSpacing);const i={__private:a,textureUnit:window.frag.allocateTextureUnit(),dispose:function(){a.glTexture&&(r.deleteTexture(a.glTexture),a.glTexture=null,a.disposed=!0)},clone:function(){return window.frag.Font(a,o)},name:function(e){return a.name=e,i},kerning:function(e){return o.kerning=e,i},letterSpacing:function(e){return o.letterSpacing=e,i},textColor:function(e){return o.textColor=e,i},backgroundColor:function(e){return o.backgroundColor=e,i},dataFormat:function(e){return a.internalFormat=e,a.format=e,e===r.RGBA?(a.dataType=r.UNSIGNED_BYTE,a.valuesPerPixel=4):e===r.RGB?(a.dataType=r.UNSIGNED_BYTE,a.valuesPerPixel=3):e===r.LUMINANCE_ALPHA?(a.dataType=r.UNSIGNED_BYTE,a.valuesPerPixel=2):e!==r.LUMINANCE&&formaat!==r.ALPHA||(a.dataType=r.UNSIGNED_BYTE,a.valuesPerPixel=1),i}};return a.setup=function(e,t){a.width=e,a.height=t,a.glTexture||(a.glTexture=r.createTexture()),r.bindTexture(r.TEXTURE_2D,a.glTexture),0==(e&e-1)&&0==(t&t-1)||(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),a.generated=!0)},i.lineHeight=function(e){return a.lineHeight=e,i},i.addChar=function(e,t,n,r,o,s,c,l){return a.chars[e]={x:t,y:n,width:r,height:o,originX:s,originY:c,advance:l},i},i.fromArrayBuffer=function(e,t,n,o){let s;return a.dataType===r.UNSIGNED_BYTE&&(s=new Uint8Array(e,t,n*o*a.valuesPerPixel)),a.setup(n,o),r.texImage2D(r.TEXTURE_2D,0,a.internalFormat,n,o,0,a.format,a.dataType,s),i},i.fromImage=function(e){const t=function(){a.setup(e.width,e.height),r.texImage2D(r.TEXTURE_2D,0,a.internalFormat,a.format,a.dataType,e)};return e.onload?t():e.onload=t,i},i.apply=function(e,t){void 0!==t.uniforms.fgcolor&&e["uniform"+o.textColor.length+"fv"](t.uniforms.fgcolor,o.textColor),void 0!==t.uniforms.bgcolor&&e["uniform"+o.backgroundColor.length+"fv"](t.uniforms.bgcolor,o.backgroundColor);const n=t.uniforms.diffuse;return n&&a.glTexture?(e.activeTexture(e.TEXTURE0+i.textureUnit),e.bindTexture(e.TEXTURE_2D,a.glTexture),a.generated||(e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),a.generated=!0),e.uniform1i(n,i.textureUnit),i):i},i.buildTextMesh=function(e){const t=[],r=[],i=[],s=function(e,n){if(dimensions=a.chars[e],!dimensions)return n;const s=n-dimensions.originX,c=s+dimensions.width,l=dimensions.originY;!function(e,n,r,a){t.push(e),t.push(a),t.push(0),t.push(n),t.push(r),t.push(0),t.push(e),t.push(r),t.push(0),t.push(e),t.push(a),t.push(0),t.push(n),t.push(a),t.push(0),t.push(n),t.push(r),t.push(0);for(let e=0;e<6;e++)i.push(0),i.push(0),i.push(-1)}(s,c,l,l-dimensions.height);const u=dimensions.x,f=a.height-dimensions.y;!function(e,t,n,o){e/=a.width,t/=a.width,n/=a.height,o/=a.height,r.push(e),r.push(o),r.push(t),r.push(n),r.push(e),r.push(n),r.push(e),r.push(o),r.push(t),r.push(o),r.push(t),r.push(n)}(u,u+dimensions.width,f,f-dimensions.height);let d=dimensions.advance;return o.kerning||(d=dimensions.width>dimensions.advance?dimensions.width:dimensions.advance),n+d+o.letterSpacing};let c=0;for(let t=0;t<e.length;t++)c=s(e[t],c);return n.MeshData().addTriangles(t,void 0,r,i).shadeFlat().textureFlat()},i.buildTextModel=function(e){const t=i.buildTextMesh(e);return n.Model(!0).shader(n.fontShader).mesh(t).material(i)},i.updateTextModel=function(e,t){const n=e.getMesh();return e.mesh(i.buildTextMesh(t)),n.dispose(),i},i}},4655:()=>{window.frag.Material=function(){const e={textures:{},disposeTextures:!1},t={__private:e,dispose:function(){if(e.disposeTextures)for(let t in e.textures){const n=e.textures[t];n&&n.dispose()}e.textures={}},disposeTextures:function(n){return e.disposeTextures=n,t},name:function(n){return e.name=n,t},setTexture:function(n,r){if(e.disposeTextures){const t=e.textures[n];t&&t.dispose()}return e.textures[n]=r,t},apply:function(n,r){for(let t in e.textures){const a=e.textures[t];a&&a.apply(t,n,r)}return t}};return t}},8394:()=>{window.frag.Texture=function(){const e=window.frag.gl,t={glTexture:null,generated:!1,internalFormat:e.RGBA,format:e.RGBA,dataType:e.UNSIGNED_BYTE,valuesPerPixel:4},n={__private:t,textureUnit:window.frag.allocateTextureUnit(),dispose:function(){t.glTexture&&(e.deleteTexture(t.glTexture),t.glTexture=null,t.disposed=!0)},name:function(e){return t.name=e,n},dataFormat:function(r){return t.internalFormat=r,t.format=r,r===e.RGBA?(t.dataType=e.UNSIGNED_BYTE,t.valuesPerPixel=4):r===e.RGB?(t.dataType=e.UNSIGNED_BYTE,t.valuesPerPixel=3):r===e.LUMINANCE_ALPHA?(t.dataType=e.UNSIGNED_BYTE,t.valuesPerPixel=2):r!==e.LUMINANCE&&formaat!==e.ALPHA||(t.dataType=e.UNSIGNED_BYTE,t.valuesPerPixel=1),n}};return t.setup=function(n,r){t.width=n,t.height=r,t.glTexture||(t.glTexture=e.createTexture()),e.bindTexture(e.TEXTURE_2D,t.glTexture),0==(n&n-1)&&0==(r&r-1)||(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),t.generated=!0)},n.fromArrayBuffer=function(r,a,o,i,s){let c;return t.dataType===e.UNSIGNED_BYTE&&(c=new Uint8Array(a,o,i*s*t.valuesPerPixel)),t.setup(i,s),e.texImage2D(e.TEXTURE_2D,r,t.internalFormat,i,s,0,t.format,t.dataType,c),n},n.fromImage=function(r,a){const o=function(){t.setup(a.width,a.height),e.texImage2D(e.TEXTURE_2D,r,t.internalFormat,t.format,t.dataType,a)};return a.onload?o():a.onload=o,n},n.fromUrl=function(e,t,r){const a=new Image;return n.fromImage(e,a),void 0!==r&&(a.crossOrigin=r),a.src=t,n},n.update=function(e,r){const a=window.frag.gl;return t.scene&&(void 0!==e&&void 0!==r&&(e===t.width&&r===t.height||n.fromScene(t.scene,e,r)),a.bindFramebuffer(a.FRAMEBUFFER,t.frameBuffer),a.viewport(0,0,t.width,t.height),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),t.scene.adjustToViewport(a),t.scene.draw({gl:a})),n},n.fromScene=function(e,r,a){const o=window.frag.gl;return t.setup(r,a),o.texImage2D(o.TEXTURE_2D,0,t.internalFormat,r,a,0,t.format,t.dataType,null),t.scene=e,t.frameBuffer=o.createFramebuffer(),o.bindFramebuffer(o.FRAMEBUFFER,t.frameBuffer),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t.glTexture,0),t.depthBuffer=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,t.depthBuffer),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,r,a),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,t.depthBuffer),n.update(r,a)},n.apply=function(e,r,a){const o=a.uniforms[e];return o&&t.glTexture?(r.activeTexture(r.TEXTURE0+n.textureUnit),r.bindTexture(r.TEXTURE_2D,t.glTexture),t.generated||(r.generateMipmap(r.TEXTURE_2D),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),t.generated=!0),r.uniform1i(o,n.textureUnit),n):n},n}},7996:()=>{window.frag=window.frag||{},window.frag.Matrix={m3Identity:function(){return[1,0,0,0,1,0,0,0,1]},m3Invert:function(e){return e},m3Transpose:function(e){return[e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]]},m3Xm3:function(e,t){const n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],c=e[6],l=e[7],u=e[8],f=t[0],d=t[1],m=t[2],g=t[3],h=t[4],v=t[5],p=t[6],x=t[7],T=t[8];return[f*n+d*o+m*c,f*r+d*i+m*l,f*a+d*s+m*u,g*n+h*o+v*c,g*r+h*i+v*l,g*a+h*s+v*u,p*n+x*o+T*c,p*r+x*i+T*l,p*a+x*s+T*u]},m3Xv3:function(e,t){const n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],c=e[6],l=e[7],u=e[8],f=t[0],d=t[1],m=t[2];return[f*n+d*o+m*c,f*r+d*i+m*l,f*a+d*s+m*u]},m4Identity:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},m4Invert:function(e){return[e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10],e[3],e[7],e[11]]},m4Transpose:function(e){return[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]]},m4Xm4:function(e,t){const n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],c=e[6],l=e[7],u=e[8],f=e[9],d=e[10],m=e[11],g=e[12],h=e[13],v=e[14],p=e[15],x=t[0],T=t[1],b=t[2],w=t[3],D=t[4],E=t[5],S=t[6],_=t[7],A=t[8],F=t[9],y=t[10],M=t[11],L=t[12],R=t[13],V=t[14],C=t[15];return[x*n+T*i+b*u+w*g,x*r+T*s+b*f+w*h,x*a+T*c+b*d+w*v,x*o+T*l+b*m+w*p,D*n+E*i+S*u+_*g,D*r+E*s+S*f+_*h,D*a+E*c+S*d+_*v,D*o+E*l+S*m+_*p,A*n+F*i+y*u+M*g,A*r+F*s+y*f+M*h,A*a+F*c+y*d+M*v,A*o+F*l+y*m+M*p,L*n+R*i+V*u+C*g,L*r+R*s+V*f+C*h,L*a+R*c+V*d+C*v,L*o+R*l+V*m+C*p]},m4Xv4:function(e,t){const n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],c=e[6],l=e[7],u=e[8],f=e[9],d=e[10],m=e[11],g=e[12],h=e[13],v=e[14],p=e[15],x=t[0],T=t[1],b=t[2],w=t[3];return[x*n+T*i+b*u+w*g,x*r+T*s+b*f+w*h,x*a+T*c+b*d+w*v,x*o+T*l+b*m+w*p]}}},8197:()=>{window.frag=window.frag||{},window.frag.Triangle={makeTriangleFromVectors:function(e,t,n){return{a:e,b:t,c:n}},makeTriangleFromArray2D:function(e,t,n,r){return e?{a:[e[t],e[t+1]],b:[e[n],e[n+1]],c:[e[r],e[r+1]]}:null},makeTriangleFromArray3D:function(e,t,n,r){return e?{a:[e[t],e[t+1],e[t+2]],b:[e[n],e[n+1],e[n+2]],c:[e[r],e[r+1],e[r+2]]}:null},normal:function(e){const t=window.frag.Vector,n=t.sub(e.a,e.b),r=t.sub(e.c,e.b);return t.normalize(t.cross(n,r))}}},6601:()=>{window.frag=window.frag||{},window.frag.Vector={extract2D:function(e,t){return e?[e[t],e[t+1]]:null},extract3D:function(e,t){return e?[e[t],e[t+1],e[t+2]]:null},zero:function(e){const t=[0,0,0,0,0];return t.length=e,t},add:function(e,t){const n=[];if(Array.isArray(t))for(let r=0;r<e.length;r++)n.push(e[r]+t[r]);else for(let r=0;r<e.length;r++)n.push(e[r]+t);return n},sub:function(e,t){const n=[];if(Array.isArray(t))for(let r=0;r<e.length;r++)n.push(e[r]-t[r]);else for(let r=0;r<e.length;r++)n.push(e[r]-t);return n},mult:function(e,t){const n=[];if(Array.isArray(t))for(let r=0;r<e.length;r++)n.push(e[r]*t[r]);else for(let r=0;r<e.length;r++)n.push(e[r]*t);return n},div:function(e,t){const n=[];if(Array.isArray(t))for(let r=0;r<e.length;r++)n.push(e[r]/t[r]);else for(let r=0;r<e.length;r++)n.push(e[r]/t);return n},length:function(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n]*e[n];return Math.sqrt(t)},average:function(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(.5*(e[r]+t[r]));return n},cross:function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},dot:function(e,t){let n=0;for(let r=0;r<e.length;r++)n+=e[r]*t[r];return n},normalize:function(e){const t=window.frag.Vector.length(e);if(t<1e-5)return e;const n=[];for(let r=0;r<e.length;r++)n.push(e[r]/t);return n},append:function(e,t){for(let n=0;n<t.length;n++)e.push(t[n])},eulerAngles:function(e,t){const n=window.frag.Vector;t||(t=[0,1,0]);const r=n.normalize(e),a=n.normalize(t),o=Math.asin(r[1]),i=Math.atan2(r[0],r[2]),s=[-r[2],0,r[0]],c=n.cross(s,r);return[Math.atan2(n.dot(s,a),n.dot(c,a)),i,o]}}},1175:()=>{window.frag.MeshData=function(){const e=window.frag,t=e.gl,n={glBuffer:t.createBuffer(),meshFragments:[],debugFragments:[],finalized:!1,fromBuffer:!1,smoothShading:!0,smoothTexture:!1,wireframe:!1,normalLength:0,normalColor:[0,0,255]},r={__private:n,calcNormals:!0,calcTangents:!0,calcBitangents:!1,dispose:function(){n.glBuffer&&(t.deleteBuffer(n.glBuffer),n.glBuffer=null)},name:function(e){return n.name=e,r},clear:function(){return n.meshFragments.length=0,n.finalized=!1,r},shadeSmooth:function(){return n.smoothShading=!0,n.finalized=!1,r},shadeFlat:function(){return n.smoothShading=!1,n.finalized=!1,r},textureSmooth:function(){return n.smoothTexture=!0,n.finalized=!1,r},textureFlat:function(){return n.smoothTexture=!1,n.finalized=!1,r},wireframe:function(e){return n.wireframe=!!e,n.finalized=!1,r},drawNormals:function(e,t){return n.normalLength=e,void 0!==t&&(n.normalColor=t),n.finalized=!1,r}};return n.Fragment=function(e){return{vertexData:e,renderData:null,vertexDataOffset:void 0,colorDataOffset:void 0,uvDataOffset:void 0,normalDataOffset:void 0,tangentDataOffset:void 0,bitangentDataOffset:void 0}},n.addFragment=function(e){return n.meshFragments.push(n.Fragment(e)),n.finalized=!1,r},r.addVertexData=function(e){return n.addFragment(e)},r.addTriangles2D=function(t,r,a,o,i,s){const c=e.VertexData().setTriangles2D(t,r,a,o,i,s);return n.addFragment(c)},r.addTriangles=function(t,r,a,o,i,s){const c=e.VertexData().setTriangles(t,r,a,o,i,s);return n.addFragment(c)},r.addTriangleStrip=function(t,r,a,o,i,s){const c=e.VertexData().setTriangleStrip(t,r,a,o,i,s);return n.addFragment(c)},r.addTriangleFan=function(t,r,a,o,i,s){const c=e.VertexData().setTriangleFan(t,r,a,o,i,s);return n.addFragment(c)},r.fromBuffer=function(a,o,i,s,c,l,u,f,d,m){const g=e.VertexData();g.vertexDimensions=o,g.vertexCount=i,g.primitiveType=s,g.extractTriangles=function(){},n.addFragment(g);const h=n.meshFragments[n.meshFragments.length-1];return h.renderData=g,h.vertexDataOffset=c,h.colorDataOffset=l,h.uvDataOffset=u,h.normalDataOffset=f,h.tangentDataOffset=d,h.bitangentDataOffset=m,t.bindBuffer(t.ARRAY_BUFFER,n.glBuffer),t.bufferData(t.ARRAY_BUFFER,a,t.STATIC_DRAW),n.finalized=!0,n.fromBuffer=!0,r},n.addFragmentDebugInfo=function(t){if(!n.wireframe&&0==n.normalLength)return;let r=t;n.wireframe||(r=n.Fragment(t.vertexData),n.debugFragments.push(r));const a=[],o=[],i=[],s=[],c=function(e){const r=t.renderData.getVertexVector(e),c=t.renderData.getColor(e),l=t.renderData.getUvVector(e),u=t.renderData.getNormalVector(e);r&&r.forEach((e=>a.push(e))),c?c.forEach((e=>o.push(e))):n.normalColor.forEach((()=>o.push(0))),l&&l.forEach((e=>i.push(e))),u&&u.forEach((e=>s.push(e)))},l=function(e){const r=t.renderData.getVertexVector(e),c=t.renderData.getUvVector(e),l=t.renderData.getNormalVector(e);if(r){for(let e=0;e<r.length;e++)a.push(r[e]);for(let e=0;e<r.length;e++)a.push(r[e]+l[e]*n.normalLength)}n.normalColor.forEach((e=>o.push(e))),n.normalColor.forEach((e=>o.push(e))),c&&(c.forEach((e=>i.push(e))),c.forEach((e=>i.push(e)))),l&&(l.forEach((e=>s.push(e))),l.forEach((e=>s.push(e))))};t.vertexData.extractTriangles((function(e,t,r){n.wireframe&&(c(e),c(t),c(t),c(r),c(r),c(e)),n.normalLength>0&&(l(e),l(t),l(t))})),2==t.vertexData.vertexDimensions?r.renderData=e.VertexData().setLines2D(a,o,i,s):r.renderData=e.VertexData().setLines(a,o,i,s)},n.finalize=function(){n.finalized=!0;const a=e.MeshOptimizer().setFragments(n.meshFragments).initialize(n.smoothShading,n.smoothTexture);r.calcTangents&&a.calcTangentsFromUvs(),r.calcBitangents&&a.calcBitangentsFromUvs(),r.calcNormals&&a.calcNormalsFromCross(),r.calcNormals&&a.calcNormalsFromGeometry(),r.calcBitangents&&a.calcBitangentsFromCross(),n.debugFragments=[],n.meshFragments.forEach((e=>{n.addFragmentDebugInfo(e)}));let o=0;const i=function(e){o+=e.renderData.verticies.length,e.renderData.colors&&(o+=e.renderData.colors.length),e.renderData.uvs&&(o+=e.renderData.uvs.length),e.renderData.normals&&(o+=e.renderData.normals.length),e.renderData.tangents&&(o+=e.renderData.tangents.length),e.renderData.bitangents&&(o+=e.renderData.bitangents.length)};n.meshFragments.forEach(i),n.debugFragments.forEach(i);const s=new Float32Array(o);let c=0;const l=function(e){if(!e)return;for(let t=0;t<e.length;t++)s[c+t]=e[t];const t=c;return c+=e.length,t*Float32Array.BYTES_PER_ELEMENT},u=function(e){e.vertexDataOffset=l(e.renderData.verticies),e.colorDataOffset=l(e.renderData.colors),e.uvDataOffset=l(e.renderData.uvs),e.normalDataOffset=l(e.renderData.normals),e.tangentDataOffset=l(e.renderData.tangents),e.bitangentDataOffset=l(e.renderData.bitangents)};return n.meshFragments.forEach(u),n.debugFragments.forEach(u),t.bindBuffer(t.ARRAY_BUFFER,n.glBuffer),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW),r},n.drawFragmentPosition=function(e,n){e.attributes.position>=0&&(null!=n.vertexDataOffset?(t.enableVertexAttribArray(e.attributes.position),t.vertexAttribPointer(e.attributes.position,n.renderData.vertexDimensions,t.FLOAT,!1,0,n.vertexDataOffset)):t.disableVertexAttribArray(e.attributes.position))},n.drawFragmentColor=function(e,n){e.attributes.color>=0&&(null!=n.colorDataOffset?(t.enableVertexAttribArray(e.attributes.color),t.vertexAttribPointer(e.attributes.color,n.renderData.colorDimensions,t.FLOAT,!1,0,n.colorDataOffset)):t.disableVertexAttribArray(e.attributes.color))},n.drawFragmentTexture=function(e,n){e.attributes.texcoord>=0&&(null!=n.uvDataOffset?(t.enableVertexAttribArray(e.attributes.texcoord),t.vertexAttribPointer(e.attributes.texcoord,n.renderData.uvDimensions,t.FLOAT,!1,0,n.uvDataOffset)):t.disableVertexAttribArray(e.attributes.texcoord))},n.drawFragmentNormals=function(e,n){e.attributes.normal>=0&&(null!=n.normalDataOffset?(t.enableVertexAttribArray(e.attributes.normal),t.vertexAttribPointer(e.attributes.normal,n.renderData.normalDimensions,t.FLOAT,!0,0,n.normalDataOffset)):t.disableVertexAttribArray(e.attributes.normal))},n.drawFragmentTangents=function(e,n){e.attributes.tangent>=0&&(null!=n.tangentDataOffset?(t.enableVertexAttribArray(e.attributes.tangent),t.vertexAttribPointer(e.attributes.tangent,n.renderData.normalDimensions,t.FLOAT,!0,0,n.tangentDataOffset)):t.disableVertexAttribArray(e.attributes.tangent))},n.drawFragmentBitangents=function(e,n){e.attributes.bitangent>=0&&(null!=n.bitangentDataOffset?(t.enableVertexAttribArray(e.attributes.bitangent),t.vertexAttribPointer(e.attributes.bitangent,n.renderData.normalDimensions,t.FLOAT,!0,0,n.bitangentDataOffset)):t.disableVertexAttribArray(e.attributes.bitangent))},n.drawFragment=function(e,r){n.drawFragmentPosition(e,r),n.drawFragmentColor(e,r),n.drawFragmentTexture(e,r),n.drawFragmentNormals(e,r),n.drawFragmentTangents(e,r),n.drawFragmentBitangents(e,r),t.drawArrays(r.renderData.primitiveType,0,r.renderData.vertexCount)},r.draw=function(e,t){n.finalized||n.fromBuffer||n.finalize(),e.bindBuffer(e.ARRAY_BUFFER,n.glBuffer);for(let e=0;e<n.meshFragments.length;e++){const r=n.meshFragments[e];n.drawFragment(t,r)}for(let e=0;e<n.debugFragments.length;e++){const r=n.debugFragments[e];n.drawFragment(t,r)}return r},r}},1003:()=>{window.frag.MeshOptimizer=function(){const e=window.frag,t={meshFragments:null,smoothShading:!0,smoothTexture:!1,fragmentTriangles:null,groups:null,groupIndecies:null},n={__private:t};return t.ensureTriangles=function(){t.fragmentTriangles||(t.fragmentTriangles=[],t.meshFragments.forEach((n=>{const r=n.vertexData,a={triangles:[],vertexTriangleIndecies:[]};a.vertexTriangleIndecies.length=r.vertexCount,r.verticies&&r.extractTriangles((function(t,n,o){const i=r.getVertexVector(t),s=r.getVertexVector(n),c=r.getVertexVector(o),l={triangle:e.Triangle.makeTriangleFromVectors(i,s,c),normal:null,tangent:null,bitangent:null};if(l.normal=e.Triangle.normal(l.triangle),r.uvs){const a=r.getUvVector(t),u=r.getUvVector(n),f=r.getUvVector(o),d=e.Vector.sub(s,i),m=e.Vector.sub(c,i),g=e.Vector.sub(u,a),h=e.Vector.sub(f,a),v=g[0]*h[1]-g[1]*h[0];if(0===v)l.tangent=e.Vector.zero(r.normalDimensions),l.bitangent=e.Vector.zero(r.normalDimensions);else{const t=1/v;l.tangent=e.Vector.normalize(e.Vector.mult(e.Vector.sub(e.Vector.mult(d,h[1]),e.Vector.mult(m,g[1])),t)),l.bitangent=e.Vector.normalize(e.Vector.mult(e.Vector.sub(e.Vector.mult(m,g[0]),e.Vector.mult(d,h[0])),t))}}a.triangles.push(l);const u=a.triangles.length-1;a.vertexTriangleIndecies[t]=u,a.vertexTriangleIndecies[n]=u,a.vertexTriangleIndecies[o]=u})),t.fragmentTriangles.push(a)})))},t.ensureGroups=function(){if(t.groups)return;t.groups=[],t.groupIndecies={};const n=function(e,t,n){if(e.vertexDimensions!==n.length)return!1;const r=e.vertexIndex(t);for(var a=0;a<n.length;a++)if(Math.abs(e.verticies[r+a]-n[a])>1e-5)return!1;return!0};for(let a=0;a<t.meshFragments.length;a++){const o=t.meshFragments[a],i=t.groupIndecies[a]||[];if(t.groupIndecies[a]=i,o.vertexData.verticies)for(let s=0;s<o.vertexData.vertexCount;s++){let c=!1;for(var r=0;!c&&r<t.groups.length;r++){const e=t.groups[r];n(o.vertexData,s,e.vertex)&&(e.fragmentIndecies[a]=e.fragmentIndecies[a]||[],e.fragmentIndecies[a].push(s),i.push(r),c=!0)}if(!c){i.push(t.groups.length);const n={vertex:o.vertexData.getVertexVector(s),fragmentIndecies:{},normal:e.Vector.zero(o.vertexData.normalDimensions),uv:e.Vector.zero(o.vertexData.uvDimensions)};n.fragmentIndecies[a]=[s],t.groups.push(n)}}}},t.calcGroupNormals=function(){t.ensureGroups();for(let n=0;n<t.groups.length;n++){const r=t.groups[n];r.normal=e.Vector.zero(t.meshFragments[0].renderData.normalDimensions);for(const n in r.fragmentIndecies){const a=t.meshFragments[n],o=a.renderData?a.renderData:a.vertexData;if(o&&o.normals){const t=r.fragmentIndecies[n];for(let n=0;n<t.length;n++){const a=t[n],i=o.getNormalVector(a);r.normal=e.Vector.add(r.normal,i)}}}r.normal=e.Vector.normalize(r.normal)}},t.calcGroupUvs=function(){t.ensureGroups();for(let e=0;e<t.groups.length;e++){const n=t.groups[e];for(const e in n.fragmentIndecies){const r=t.meshFragments[e],a=r.renderData?r.renderData:r.vertexData;if(a){const t=n.fragmentIndecies[e];if(t.length>0){const e=t[0];n.uv=a.getUvVector(e)}}}}},t.calcSmoothShading=function(){for(let e=0;e<t.meshFragments.length;e++)if(!t.meshFragments[e].renderData.normals)return;t.calcGroupNormals();for(let r=0;r<t.meshFragments.length;r++){const a=t.meshFragments[r].renderData,o=t.groupIndecies[r];if(o.length){a.normals=[];for(var e=0;e<a.vertexCount;e++){const r=t.groups[o[e]];for(var n=0;n<a.normalDimensions;n++)a.normals.push(r.normal[n])}}}},t.calcSmoothTexture=function(){t.calcGroupUvs();for(let r=0;r<t.meshFragments.length;r++){const a=t.meshFragments[r].renderData,o=t.groupIndecies[r];if(o.length){a.uvs=[];for(var e=0;e<a.vertexCount;e++){const r=t.groups[o[e]];for(var n=0;n<a.uvDimensions;n++)a.uvs.push(r.uv[n])}}}},n.setFragments=function(e){return t.meshFragments=e,n},n.initialize=function(e,r){return t.smoothShading=e,t.smoothTexture=r,t.meshFragments.forEach((e=>{e.renderData=e.vertexData.clone()})),r&&t.calcSmoothTexture(),n},n.calcTangentsFromUvs=function(){for(let n=0;n<t.meshFragments.length;n++){const r=t.meshFragments[n],a=r.renderData,o=r.vertexData;if(!a.tangents)if(o.tangents){a.tangents=[];for(let t=0;t<o.vertexCount;t++)for(var e=0;e<o.normalDimensions;e++)a.tangents.push(o.tangents[o.tangentIndex(t,e)])}else if(a.uvs){t.ensureTriangles();const e=t.fragmentTriangles[n];if(e&&e.triangles){a.tangents=[],a.tangents.length=a.normalDimensions*a.vertexCount;for(let t=0;t<a.vertexCount;t++){const n=e.vertexTriangleIndecies[t],r=e.triangles[n];r&&a.setTangentVector(t,r.tangent)}}}}return n},n.calcBitangentsFromUvs=function(){for(let n=0;n<t.meshFragments.length;n++){const r=t.meshFragments[n],a=r.renderData,o=r.vertexData;if(!a.bitangents)if(o.bitangents){a.bitangents=[];for(let t=0;t<o.vertexCount;t++)for(var e=0;e<o.normalDimensions;e++)a.bitangents.push(o.bitangents[o.bitangentIndex(t,e)])}else if(a.uvs){t.ensureTriangles();const e=t.fragmentTriangles[n];if(e&&e.triangles){a.bitangents=[],a.bitangents.length=a.normalDimensions*a.vertexCount;for(let t=0;t<a.vertexCount;t++){const n=e.vertexTriangleIndecies[t],r=e.triangles[n];r&&a.setBitangentVector(t,r.bitangent)}}}}return n},n.calcNormalsFromCross=function(){for(let n=0;n<t.meshFragments.length;n++){const a=t.meshFragments[n],o=a.renderData,i=a.vertexData;if(!o.normals)if(i.normals){o.normals=[];for(let e=0;e<i.vertexCount;e++)for(var r=0;r<i.normalDimensions;r++)o.normals.push(i.normals[i.normalIndex(e,r)])}else if(o.tangents&&o.bitangents){o.normals=[];for(let t=0;t<i.vertexCount;t++){const n=o.getTangentVector(t),a=o.getBitangentVector(t),i=e.Vector.cross(n,a);for(r=0;r<i.length;r++)o.normals.push(i[r])}}}return t.smoothShading&&t.calcSmoothShading(),n},n.calcNormalsFromGeometry=function(){for(let n=0;n<t.meshFragments.length;n++){const r=t.meshFragments[n],a=r.renderData,o=r.vertexData;if(!a.normals)if(o.normals){a.normals=[];for(let t=0;t<o.vertexCount;t++)for(var e=0;e<o.normalDimensions;e++)a.normals.push(o.normals[o.normalIndex(t,e)])}else{t.ensureTriangles();const e=t.fragmentTriangles[n];if(e&&e.triangles){a.normals=[],a.normals.length=a.normalDimensions*a.vertexCount;for(let t=0;t<a.vertexCount;t++){const n=e.vertexTriangleIndecies[t],r=e.triangles[n];r&&a.setNormalVector(t,r.normal)}}}}return t.smoothShading&&t.calcSmoothShading(),n},n.calcBitangentsFromCross=function(){for(let n=0;n<t.meshFragments.length;n++){const a=t.meshFragments[n],o=a.renderData,i=a.vertexData;if(!o.bitangents)if(i.bitangents){o.bitangents=[];for(let e=0;e<i.vertexCount;e++)for(var r=0;r<i.normalDimensions;r++)o.bitangents.push(i.bitangents[i.bitangentIndex(e,r)])}else if(o.tangents&&o.normals){o.bitangents=[];for(let t=0;t<i.vertexCount;t++){const n=o.getNormalVector(t),a=o.getTangentVector(t),i=e.Vector.cross(n,a);for(r=0;r<i.length;r++)o.bitangents.push(i[r])}}}return n},n}},2816:()=>{window.frag.Model=function(e,t){const n=window.frag;void 0===e&&(e=!t||!t.location||t.location.is3d);const r={name:null,parent:t,children:[],meshData:null,shader:null,material:null,enabled:!0},a={__private:r,location:n.Location(e),animations:[],dispose:function(){},addFlattenedChildren:function(e,t){for(let n=0;n<r.children.length;n++){let a=r.children[n];t(a)&&e.push(a),a.addFlattenedChildren(e,t)}},getPosition:function(){return n.ScenePosition(a.location)},name:function(e){return r.name=e,a},getName:function(){return r.name},shader:function(e){if(e.is3d!==a.location.is3d){const e=a.location.is3d?"3D":"2D";console.error("Model '"+r.name+"' has a "+e+" location and must use a "+e+" shader")}return r.shader=e,a},getShader:function(){return r.shader?r.shader:r.parent?r.parent.getShader():void 0},mesh:function(e){return r.meshData=e,a},getMesh:function(){return r.meshData},material:function(e){return r.material=e,a},enable:function(){r.enabled=!0},disable:function(){r.enabled=!1},getMaterial:function(){return r.material?r.material:r.parent?r.parent.getMaterial():void 0},addChild:function(e){return e?e.__private.parent=a:e=window.frag.Model(void 0,a),r.children.push(e),e},shadeSmooth:function(e){return void 0===e&&(e=-1),r.meshData&&r.meshData.shadeSmooth(),0===e||r.children.forEach((t=>{t.shadeSmooth(e-1)})),a},shadeFlat:function(e){return void 0===e&&(e=-1),r.meshData&&r.meshData.shadeFlat(),0===e||r.children.forEach((t=>{t.shadeFlat(e-1)})),a},textureSmooth:function(e){return void 0===e&&(e=-1),r.meshData&&r.meshData.textureSmooth(),0===e||r.children.forEach((t=>{t.textureSmooth(e-1)})),a},textureFlat:function(e){return void 0===e&&(e=-1),r.meshData&&r.meshData.textureFlat(),0===e||r.children.forEach((t=>{t.textureFlat(e-1)})),a},wireframe:function(e,t){return void 0===t&&(t=-1),r.meshData&&r.meshData.wireframe(e),0===t||r.children.forEach((n=>{n.wireframe(e,t-1)})),a},drawNormals:function(e,t,n){return void 0===n&&(n=-1),r.meshData&&r.meshData.drawNormals(e,t),0===n||r.children.forEach((r=>{r.drawNormals(e,t,n-1)})),a},addAnimation:function(e){const t=[];a.addFlattenedChildren(t,(function(e){return e.getName()}));const n=[],r=e.getChannelGraphs();for(let e=0;e<t.length;e++){const a=t[e],o=a.getName();for(let e=0;e<r.length;e++){const t=r[e];t.pattern.test(o)&&n.push({graph:t,model:a})}}return n.length>0&&a.animations.push({modelAnimation:e,childAnimations:n}),a},draw:function(e,t,o,i){if(!a.location)return a;const s=i&&r.name?i[r.name]:null,c=s?a.location.clone().add(s.location):a.location,l=c.getMatrix();c.is3d?(t=n.Matrix.m4Xm4(t,l),o=n.Matrix.m4Xm4(o,l)):(t=n.Matrix.m3Xm3(t,l),o=n.Matrix.m3Xm3(o,l));const u=e.shader||a.getShader();if(void 0!==u&&r.meshData&&r.enabled){if(u.bind(e.gl),e.isHitTest&&void 0!==u.uniforms.color){const t=e.sceneObjects.length-1,n=e.models.length;e.models.push(a);const r=t>>4,o=(15&t)<<4|(983040&n)>>16,i=(65280&n)>>8,s=255&n;e.gl.uniform4f(u.uniforms.color,r/255,o/255,i/255,s/255)}var f=a.getMaterial();f&&f.apply(e.gl,u),void 0!==u.uniforms.clipMatrix&&(c.is3d?n.Transform(o):n.Transform2D(o)).apply(e.gl,u.uniforms.clipMatrix),void 0!==u.uniforms.modelMatrix&&(c.is3d?n.Transform(t):n.Transform2D(t)).apply(e.gl,u.uniforms.modelMatrix),r.meshData.draw(e.gl,u),u.unbind(e.gl)}for(let n=0;n<r.children.length;n++)r.children[n].draw(e,t,o,i);return a}};return a}},5312:()=>{window.frag.Scene=function(){const e={sceneObjects:[],activeCamera:null,cameraUpdated:function(){}},t={__private:e,dispose:function(){e.activeCamera&&e.activeCamera.worldToClipTransform.observableMatrix.unsubscribe(e.cameraUpdated)},addObject:function(n){return e.sceneObjects.push(n),t},removeObject:function(t){for(let n=0;n<e.sceneObjects.length;n++)if(e.sceneObjects[n]===t)return e.sceneObjects.splice(n,1),!0;return!1},camera:function(n){return e.activeCamera&&e.activeCamera.worldToClipTransform.observableMatrix.unsubscribe(e.cameraUpdated),e.activeCamera=n,n&&n.worldToClipTransform.observableMatrix.subscribe(e.cameraUpdated),t},getCamera:function(){return e.activeCamera},setViewport:function(n){return e.activeCamera&&e.activeCamera.setViewport(n),t},adjustToViewport:function(n){return e.activeCamera&&e.activeCamera.adjustToViewport(n),t},draw:function(t){if(e.activeCamera){t.worldToClipTransform=e.activeCamera.worldToClipTransform;for(let n=0;n<e.sceneObjects.length;n++)e.sceneObjects[n].draw(t)}}};return t}},8390:()=>{window.frag.SceneObject=function(e){const t=window.frag,n={model:e,enabled:!0,location:null,animationLocation:null,animationMap:{}},r={__private:n,animations:{}};for(let t=0;t<e.animations.length;t++){const a=e.animations[t];for(let t=0;t<a.childAnimations.length;t++){const r=a.childAnimations[t].model.getName();if(!n.animationMap[r]){const t=window.frag.ObjectAnimationState();window.frag.debugAnimations&&(t.__private.modelName=e.getName(),t.__private.childModelName=r),n.animationMap[r]=t}}const o=window.frag.SceneObjectAnimation(a,n.animationMap);r.animations[a.modelAnimation.getName()]=o}return n.getLocation=function(){return n.location?n.location:n.model.location?(n.location=t.Location(n.model.location.is3d),n.location):null},n.getAnimationLocation=function(){return n.animationLocation?n.animationLocation:n.model.location?(n.animationLocation=t.Location(n.model.location.is3d),n.animationLocation):null},r.getPosition=function(){const e=n.getLocation();return e?t.ScenePosition(e):null},r.getAnimationPosition=function(){const e=n.getAnimationLocation();return e?t.ScenePosition(e):null},r.clearAnimationPosition=function(){return n.animationLocation=null,r},r.enable=function(){return n.enabled=!0,r},r.disable=function(){return n.enabled=!1,r},r.dispose=function(){r.disable();for(let e in r.animations)r.animations[e].dispose();return r},r.draw=function(e){if(!n.enabled)return r;let a=n.getLocation();if(!a)return r;n.animationLocation&&(a=a.clone().add(n.animationLocation));const o=e.worldToClipTransform.getMatrix(),i=a.getMatrix(),s=e.worldToClipTransform.is3d?t.Matrix.m4Xm4(o,i):t.Matrix.m3Xm3(o,i);return e.isHitTest&&e.sceneObjects.push(r),n.model.draw(e,i,s,n.animationMap),r},r}},7266:()=>{window.frag.ScenePosition=function(e){const t={location:null},n={__private:t,setLocation:function(e){return t.location=e||window.frag.Location(),n}};return n.setLocation(e),n.getMatrix=function(){return t.location.getMatrix()},n.getScaleX=function(){return t.location.scaleX},n.getScaleY=function(){return t.location.scaleY},n.getScaleZ=function(){return t.location.scaleZ},n.scale=function(e){return t.location.scaleX=e,t.location.scaleY=e,t.location.scaleZ=e,t.location.isModified=!0,n},n.scaleXYZ=function(e,r,a){return t.location.scaleX=e,t.location.scaleY=r,t.location.scaleZ=a,t.location.isModified=!0,n},n.scaleX=function(e){return t.location.scaleX=e,t.location.isModified=!0,n},n.scaleY=function(e){return t.location.scaleY=e,t.location.isModified=!0,n},n.scaleZ=function(e){return t.location.scaleZ=e,t.location.isModified=!0,n},n.scaleBy=function(e){n.scaleXYZ(t.location.scaleX*e[0],t.location.scaleY*e[1],t.location.scaleZ*e[2])},n.scaleByXYZ=function(e,r,a){n.scaleXYZ(t.location.scaleX*e,t.location.scaleY*r,t.location.scaleZ*a)},n.getRotateX=function(){return t.location.rotateX},n.getRotateY=function(){return t.location.rotateY},n.getRotateZ=function(){return t.location.rotateZ},n.getRotate=function(){return t.location.is3d?[t.location.rotateX,t.location.rotateY,t.location.rotateZ]:[t.location.rotateX,t.location.rotateY]},n.rotate=function(e){return t.location.rotateX=e[0],e.length>1&&(t.location.rotateY=e[1]),e.length>2&&(t.location.rotateZ=e[2]),t.location.isModified=!0,n},n.rotateXYZ=function(e,r,a){return t.location.rotateX=e,t.location.rotateY=r,t.location.rotateZ=a,t.location.isModified=!0,n},n.rotateX=function(e){return t.location.rotateX=e,t.location.isModified=!0,n},n.rotateY=function(e){return t.location.rotateY=e,t.location.isModified=!0,n},n.rotateZ=function(e){return t.location.rotateZ=e,t.location.isModified=!0,n},n.rotateBy=function(e){n.rotateXYZ(t.location.rotateX+e[0],t.location.rotateY+e[1],t.location.rotateZ+e[2])},n.rotateByXYZ=function(e,r,a){n.rotateXYZ(t.location.rotateX+e,t.location.rotateY+r,t.location.rotateZ+a)},n.getLocationX=function(){return t.location.translateX},n.getLocationY=function(){return t.location.translateY},n.getLocationZ=function(){return t.location.translateZ},n.getLocation=function(){return t.location.is3d?[t.location.translateX,t.location.translateY,t.location.translateZ]:[t.location.translateX,t.location.translateY]},n.location=function(e){return t.location.translateX=e[0],e.length>1&&(t.location.translateY=e[1]),e.length>2&&(t.location.translateZ=e[2]),t.location.isModified=!0,n},n.locationXYZ=function(e,r,a){return t.location.translateX=e,t.location.translateY=r,t.location.translateZ=a,t.location.isModified=!0,n},n.locationX=function(e){return t.location.translateX=e,t.location.isModified=!0,n},n.locationY=function(e){return t.location.translateY=e,t.location.isModified=!0,n},n.locationZ=function(e){return t.location.translateZ=e,t.location.isModified=!0,n},n.moveBy=function(e){n.locationXYZ(t.location.translateX+e[0],t.location.translateY+e[1],t.location.translateZ+e[2])},n.moveByXYZ=function(e,r,a){n.locationXYZ(t.location.translateX+e,t.location.translateY+r,t.location.translateZ+a)},n}},9288:()=>{window.frag.VertexData=function(){const e=window.frag,t=e.gl,n={},r={__private:n,primitiveType:t.TRIANGLES,vertexCount:0,verticies:void 0,vertexDimensions:3,colors:void 0,colorDimensions:3,uvs:void 0,uvDimensions:2,normals:void 0,normalDimensions:3,tangents:void 0,bitangents:void 0,clone:function(){const t=e.VertexData();return t.primitiveType=r.primitiveType,t.vertexCount=r.vertexCount,t.vertexDimensions=r.vertexDimensions,t.colorDimensions=r.colorDimensions,t.uvDimensions=r.uvDimensions,t.normalDimensions=r.normalDimensions,t.verticies=r.verticies,r.colors&&(t.colors=Array.from(r.colors)),r.uvs&&(t.uvs=Array.from(r.uvs)),r.normals&&(t.normals=Array.from(r.normals)),r.tangents&&(t.tangents=Array.from(r.tangents)),r.bitangents&&(t.bitangents=Array.from(r.bitangents)),t},vertexIndex:function(e,t){return e*r.vertexDimensions+(t||0)},colorIndex:function(e,t){return e*r.colorDimensions+(t||0)},uvIndex:function(e,t){return e*r.uvDimensions+(t||0)},normalIndex:function(e,t){return e*r.normalDimensions+(t||0)},tangentIndex:function(e,t){return e*r.normalDimensions+(t||0)},bitangentIndex:function(e,t){return e*r.normalDimensions+(t||0)}};return n.getVector=function(t,n,r){return 2===r?e.Vector.extract2D(t,n):e.Vector.extract3D(t,n)},n.setVector=function(e,t,n){for(i=0;i<n.length;i++)e[t+i]=n[i]},r.getVertexVector=function(e){return n.getVector(r.verticies,r.vertexIndex(e),r.vertexDimensions)},r.setVertexVector=function(e,t){return n.setVector(r.verticies,r.vertexIndex(e),t)},r.getColor=function(e){return n.getVector(r.colors,r.colorIndex(e),r.colorDimensions)},r.setColor=function(e,t){return n.setVector(r.colors,r.colorIndex(e),t)},r.getUvVector=function(e){return n.getVector(r.uvs,r.uvIndex(e),r.uvDimensions)},r.setUvVector=function(e,t){return n.setVector(r.uvs,r.uvIndex(e),t)},r.getNormalVector=function(e){return n.getVector(r.normals,r.normalIndex(e),r.normalDimensions)},r.setNormalVector=function(e,t){return n.setVector(r.normals,r.normalIndex(e),t)},r.getTangentVector=function(e){return n.getVector(r.tangents,r.tangentIndex(e),r.normalDimensions)},r.setTangentVector=function(e,t){return n.setVector(r.tangents,r.tangentIndex(e),t)},r.getBitangentVector=function(e){return n.getVector(r.bitangents,r.bitangentIndex(e),r.normalDimensions)},r.setBitangentVector=function(e,t){return n.setVector(r.bitangents,r.bitangentIndex(e),t)},r.setTriangles2D=function(e,n,a,o,i,s){return r.primitiveType=t.TRIANGLES,r.vertexDimensions=2,r.verticies=e,r.vertexCount=e.length/r.vertexDimensions,r.colorDimensions=3,r.colors=n,r.uvDimensions=2,r.uvs=a,r.normalDimensions=3,r.normals=o,r.tangents=i,r.bitangents=s,r.extractTriangles=function(e){for(let t=0;t<r.vertexCount;t+=3)e(t,t+1,t+2)},r},r.setTriangles=function(e,n,a,o,i,s){return r.primitiveType=t.TRIANGLES,r.vertexDimensions=3,r.verticies=e,r.vertexCount=e.length/r.vertexDimensions,r.colorDimensions=3,r.colors=n,r.uvDimensions=2,r.uvs=a,r.normalDimensions=3,r.normals=o,r.tangents=i,r.bitangents=s,r.extractTriangles=function(e){for(let t=0;t<r.vertexCount;t+=3)e(t,t+1,t+2)},r},r.setTriangleStrip=function(e,n,a,o,i,s){return r.primitiveType=t.TRIANGLE_STRIP,r.vertexDimensions=3,r.verticies=e,r.vertexCount=e.length/r.vertexDimensions,r.colorDimensions=3,r.colors=n,r.uvDimensions=2,r.uvs=a,r.normalDimensions=3,r.normals=o,r.tangents=i,r.bitangents=s,r.extractTriangles=function(e){const t=r.vertexCount-2;for(let n=0;n<t;n++)0==(1&n)?e(n,n+1,n+2):e(n+2,n+1,n)},r},r.setTriangleFan=function(e,n,a,o,i,s){return r.primitiveType=t.TRIANGLE_FAN,r.vertexDimensions=3,r.verticies=e,r.vertexCount=e.length/r.vertexDimensions,r.colorDimensions=3,r.colors=n,r.uvDimensions=2,r.uvs=a,r.normalDimensions=3,r.normals=o,r.tangents=i,r.bitangents=s,r.extractTriangles=function(e){const t=r.vertexCount-2;for(let n=0;n<t;n++)e(0,n+1,n+2)},r},r.setLines2D=function(e,n,a,o){return r.primitiveType=t.LINES,r.vertexDimensions=2,r.verticies=e,r.vertexCount=e.length/r.vertexDimensions,r.colorDimensions=3,r.colors=n,r.uvDimensions=2,r.uvs=a,r.normalDimensions=3,r.normals=o,r.tangents=null,r.bitangents=null,r.extractTriangles=function(){},r},r.setLines=function(e,n,a,o){return r.primitiveType=t.LINES,r.vertexDimensions=3,r.verticies=e,r.vertexCount=e.length/r.vertexDimensions,r.colorDimensions=3,r.colors=n,r.uvDimensions=2,r.uvs=a,r.normalDimensions=3,r.normals=o,r.tangents=null,r.bitangents=null,r.extractTriangles=function(){},r},r.setLineStrip=function(e,n,a,o){return r.primitiveType=t.LINE_STRIP,r.vertexDimensions=3,r.verticies=e,r.vertexCount=e.length/r.vertexDimensions,r.colorDimensions=3,r.colors=n,r.uvDimensions=2,r.uvs=a,r.normalDimensions=3,r.normals=o,r.tangents=null,r.bitangents=null,r.extractTriangles=function(){},r},r}},3798:()=>{window.frag.createShader=function(e,t,n){const r=window.frag.gl;console.log("\n// "+e+" "+(t===r.VERTEX_SHADER?"vertex":"fragment")+" shader\n"+n);var a=r.createShader(t);if(r.shaderSource(a,n),r.compileShader(a),r.getShaderParameter(a,r.COMPILE_STATUS))return a;console.error("Failed to compile shader "+e),console.log(r.getShaderInfoLog(a)),r.deleteShader(a)},window.frag.createProgram=function(e,t,n){const r=window.frag,a=r.gl;var o=a.createProgram();if(a.attachShader(o,t),a.attachShader(o,n),a.linkProgram(o),a.getProgramParameter(o,a.LINK_STATUS))return o;console.error("Failed to link shaders into program "+e),console.log(r.gl.getProgramInfoLog(o)),a.deleteProgram(o)},window.frag.CustomShader=function(e){const t={name:"Custom",vSource:null,fSource:null,bindList:[],unbindList:[]},n={__private:t,attributes:{},uniforms:{},is3d:void 0===e||e,name:function(e){return t.name=e,n},getName:function(){return t.name},source:function(e,r){t.vSource=e,t.fSource=r;const a=frag.createShader(t.name,frag.gl.VERTEX_SHADER,e),o=frag.createShader(t.name,frag.gl.FRAGMENT_SHADER,r);return n.program=frag.createProgram(t.name,a,o),n},onBind:function(e){return t.bindList.push(e),n},onUnbind:function(e){return t.unbindList.push(e),n},attribute:function(e){if(!n.program)return console.error("You must set the "+t.name+" shader source before defining attributes"),n;const r=frag.gl.getAttribLocation(n.program,"a_"+e);return void 0===r?(console.error("Shader program "+t.name+" does not have attribute a_"+e),n):(n.attributes[e]=r,n)},uniform:function(e,r,a){if(!n.program)return console.error("You must set the "+t.name+" shader source before defining uniforms"),n;const o=frag.gl.getUniformLocation(n.program,"u_"+e);return o?(n.uniforms[e]=o,r&&(t[e]=a,n[e]=function(r){return t[e]=r,n},t.bindList.push((function(n){void 0!==t[e]&&n["uniform"+r](o,t[e])}))),n):(console.error("Shader program "+t.name+" does not have uniform u_"+e),n)},bind:function(e){return e.useProgram(n.program),t.bindList.forEach((t=>t(e))),n},unbind:function(e){return t.unbindList.forEach((t=>t(e))),n}};return n}},7218:()=>{window.frag.startFunctions.push((function(e){e.fontShader=e.CustomShader().name("Font").source("attribute vec4 a_position;\nattribute vec2 a_texcoord;\nuniform mat4 u_clipMatrix;\nvarying vec2 v_texcoord;\nvoid main() {\n  gl_Position = u_clipMatrix * a_position;\n  v_texcoord = a_texcoord;\n}","precision mediump float;\nuniform sampler2D u_diffuse;\nuniform vec4 u_fgcolor;\nuniform vec4 u_bgcolor;\nvarying vec2 v_texcoord;\nvoid main() {\n  vec4 texture = texture2D(u_diffuse, vec2(v_texcoord.x, 1.0 - v_texcoord.y));\n  gl_FragColor = mix(u_bgcolor, u_fgcolor, length(texture.rgb));\n}\n").attribute("position").attribute("texcoord").uniform("clipMatrix").uniform("bgcolor","4fv",[1,1,1,1]).uniform("fgcolor","4fv",[0,0,0,1]).uniform("diffuse")}))},2198:()=>{window.frag.Shader=function(){const e="None",t={name:"Custom",verticies:"XYZ",x:0,y:0,z:0,colors:e,matrix:"mat4",textureCoords:e,diffuseTexture:e,emmissiveTexture:e,displacementTexture:e,normalMap:e,roughnessTexture:e,shininessTexture:e,metalinessTexture:e,normals:e,tangents:e,bitangents:e,directionalLight:e,ambientLight:e},n={__private:t,name:function(e){return t.name=e,n},verticiesXY:function(e){return t.verticies="XY",t.z=e,n},verticiesXZ:function(e){return t.verticies="XZ",t.y=e,n},verticiesYZ:function(e){return t.verticies="YZ",t.x=e,n},verticiesXYZ:function(){return t.verticies="XYZ",n},verticiesNone:function(){return t.verticies=e,n},matrix2D:function(){return t.matrix="mat3",n},matrix3D:function(){return t.matrix="mat4",n},matrixNone:function(){return t.matrix=e,n},normals:function(){return t.normals="vec3",n},colorsRGB:function(){return t.colors="vec3",n},colorsRGBA:function(){return t.colors="vec4",n},colorsNone:function(){return t.colors=e,n},diffuseTexture:function(){return t.diffuseTexture="RGB",t.colors=e,t.textureCoords===e&&(t.textureCoords="vec2"),n},emmissiveTexture:function(){return t.emmissiveTexture="RGB",t.textureCoords===e&&(t.textureCoords="vec2"),n},normalMapStandard:function(){return t.normalMap="Standard",t.textureCoords===e&&(t.textureCoords="vec2"),t.normals===e&&(t.normals="vec3"),t.tangents===e&&(t.tangents="vec3"),n},normalMapOpenGL:function(){return t.normalMap="OpenGL",t.textureCoords===e&&(t.textureCoords="vec2"),t.normals===e&&(t.normals="vec3"),t.tangents===e&&(t.tangents="vec3"),n},displacementTextureRaised:function(){return t.displacementTexture="Raised",t.textureCoords===e&&(t.textureCoords="vec2"),t.normals===e&&(t.normals="vec3"),n},displacementTextureSunken:function(){return t.displacementTexture="Sunken",t.textureCoords===e&&(t.textureCoords="vec2"),t.normals===e&&(t.normals="vec3"),n},displacementTextureSigned:function(){return t.displacementTexture="Signed",t.textureCoords===e&&(t.textureCoords="vec2"),t.normals===e&&(t.normals="vec3"),n},tangents:function(){return t.tangents="vec3",t.normals===e&&(t.normals="vec3"),n},bitangents:function(){return t.bitangents="vec3",t.normals===e&&(t.normals="vec3"),n},directionalLightColor:function(){return n.matrix3D(),t.directionalLight="Color",t.ambientLight===e&&(t.ambientLight="Balanced"),t.normals===e&&(t.normals="vec3"),n},directionalLightWhite:function(){return n.matrix3D(),t.directionalLight="White",t.ambientLight===e&&(t.ambientLight=e),t.normals===e&&(t.normals="vec3"),n},directionalLightGrey:function(){return n.matrix3D(),t.directionalLight="Grey",t.ambientLight===e&&(t.ambientLight="Balanced"),t.normals===e&&(t.normals="vec3"),n},directionalLightNone:function(){return t.directionalLight=e,n},ambientLightBalanced:function(){return t.ambientLight="Balanced",n},ambientLightNone:function(){return t.ambientLight=e,n},ambientLightFixed:function(){return t.ambientLight="Fixed",n}};return t.addAttributeDeclarations=function(n){"XYZ"===t.verticies?n.vectorShader+="attribute vec4 a_position;\n":t.verticies!==e&&(n.vectorShader+="attribute vec2 a_position;\n"),t.colors!==e&&(n.vectorShader+="attribute "+t.colors+" a_color;\n"),t.textureCoords!==e&&(n.vectorShader+="attribute "+t.textureCoords+" a_texcoord;\n"),t.normals!==e&&(n.vectorShader+="attribute "+t.normals+" a_normal;\n"),t.tangents!==e&&(n.vectorShader+="attribute "+t.tangents+" a_tangent;\n"),t.bitangents!==e&&(n.vectorShader+="attribute "+t.bitangents+" a_bitangent;\n")},t.addUniformDeclarations=function(n){t.matrix!==e&&(t.directionalLight!==e&&(n.vectorShader+="uniform "+t.matrix+" u_modelMatrix;\n"),n.vectorShader+="uniform "+t.matrix+" u_clipMatrix;\n"),t.directionalLight!==e&&(n.vectorShader+="uniform vec3 u_lightDirection;\n"),"Color"===t.directionalLight&&(n.vectorShader+="uniform vec3 u_lightColor;\n"),t.displacementTexture!==e&&(n.vectorShader+="uniform float u_displacementScale;\n"),t.displacementTexture===e&&t.roughnessTexture===e&&t.shininessTexture==e||(n.vectorShader+="uniform sampler2D u_surface;\n"),t.normalMap!==e&&(n.fragmentShader+="uniform sampler2D u_normalMap;\n"),t.textureCoords!==e&&(t.diffuseTexture!==e&&(n.fragmentShader+="uniform sampler2D u_diffuse;\n"),t.emmissiveTexture!==e&&(n.fragmentShader+="uniform sampler2D u_emmissive;\n")),t.ambientLight!==e&&(n.fragmentShader+="uniform float u_ambientLight;\n")},t.addVaryingDeclarations=function(n){const r=function(e,t){const r="varying "+e+" "+t+";\n";n.vectorShader+=r,n.fragmentShader+=r};t.textureCoords!==e&&r(t.textureCoords,"v_texcoord"),t.colors!==e&&r(t.colors,"v_color"),t.directionalLight!==e&&(r("vec3","v_lightDirection"),"Color"===t.directionalLight&&r("vec3","v_lightColor"),t.normalMap===e&&r(t.normals,"v_normal"))},t.addLogic=function(n){"XYZ"===t.verticies?n.vectorShader+="  vec4 position = a_position;\n":t.verticies!==e&&(n.vectorShader+="  vec2 position = a_position;\n"),t.displacementTexture===e&&t.roughnessTexture===e&&t.shininessTexture==e||(n.vectorShader+="  vec4 surface = texture2D(u_surface, vec2(a_texcoord.x, 1.0 - a_texcoord.y));\n"),t.displacementTexture!==e&&"XYZ"===t.verticies&&"vec3"===t.normals&&("Sunken"===t.displacementTexture?n.vectorShader+="  float displacement = -surface.r;\n":"Signed"===t.displacementTexture?n.vectorShader+="  float displacement = surface.r * 2.0 - 1.0;\n":"Raised"===t.displacementTexture&&(n.vectorShader+="  float displacement = surface.r;\n"),n.vectorShader+="  position = vec4(position.xyz + (a_normal * displacement * u_displacementScale), position.w);\n"),"XYZ"===t.verticies?n.vectorShader+="  position = u_clipMatrix * position;\n":t.verticies!==e&&(n.vectorShader+="  position = (u_clipMatrix * vec3(position, 1)).xy;\n"),"XYZ"===t.verticies?n.vectorShader+="  gl_Position = position;\n":"XY"===t.verticies?n.vectorShader+="  gl_Position = vec4(position, "+t.z+", 1);\n":"XZ"===t.verticies?n.vectorShader+="  gl_Position = vec4(position.x, "+t.y+", position.y, 1);\n":"YZ"===t.verticies&&(n.vectorShader+="  gl_Position = vec4("+t.x+", position, 1);\n"),t.textureCoords!==e&&(n.vectorShader+="  v_texcoord = a_texcoord;\n"),t.directionalLight!==e?(t.normalMap!==e?(n.vectorShader+="  vec3 T = normalize(vec3(u_modelMatrix * vec4(a_tangent, 0.0)));\n",t.bitangents!==e?n.vectorShader+="  vec3 B = normalize(vec3(u_modelMatrix * vec4(a_bitangent, 0.0)));\n":n.vectorShader+="  vec3 B = normalize(vec3(u_modelMatrix * vec4(cross(a_normal, a_tangent), 0.0)));\n",n.vectorShader+="  vec3 N = normalize(vec3(u_modelMatrix * vec4(a_normal, 0.0)));\n",n.vectorShader+="  mat3 TBN = transpose(mat3(T, B, N));\n",n.vectorShader+="  v_lightDirection = TBN * u_lightDirection;\n",n.fragmentShader+="  vec3 normal = texture2D(u_normalMap, vec2(v_texcoord.x, 1.0 - v_texcoord.y)).rgb * 2.0 - 1.0;\n"):(n.vectorShader+="  v_normal = (u_modelMatrix * vec4(a_normal, 0)).xyz;\n",n.vectorShader+="  v_lightDirection = u_lightDirection;\n",n.fragmentShader+="  vec3 normal = normalize(v_normal);\n"),n.fragmentShader+="  vec3 lightDirection = v_lightDirection;\n",n.fragmentShader+="  float light = max(dot(normal, lightDirection), 0.0);\n",t.ambientLight!==e&&(n.fragmentShader+="  light += u_ambientLight;\n")):t.ambientLight!==e&&(n.fragmentShader+="  float light = u_ambientLight;\n"),"Color"===t.directionalLight&&(n.vectorShader+="  v_lightColor = u_lightColor;\n"),t.colors===e?n.fragmentShader+="  gl_FragColor = vec4(0, 0, 0, 1.0);\n":"vec4"===t.colors?(n.vectorShader+="  v_color = a_color;\n",n.fragmentShader+="  gl_FragColor = v_color;\n"):(n.vectorShader+="  v_color = a_color;\n",n.fragmentShader+="  gl_FragColor = vec4(v_color, 1.0);\n"),"vec2"===t.textureCoords&&"RGB"===t.diffuseTexture&&(n.fragmentShader+="  gl_FragColor += texture2D(u_diffuse, vec2(v_texcoord.x, 1.0 - v_texcoord.y));\n"),t.ambientLight===e&&t.directionalLight===e||(n.fragmentShader+="  gl_FragColor.rgb *= light;\n"),"vec2"===t.textureCoords&&"RGB"===t.emmissiveTexture&&(n.fragmentShader+="  gl_FragColor.rgb += texture2D(u_emmissive, vec2(v_texcoord.x, 1.0 - v_texcoord.y)).rgb;\n")},n.compile=function(){const n=window.frag.CustomShader("mat4"===t.matrix).name(t.name),r={vectorShader:"",fragmentShader:"precision mediump float;\n"};if(t.addAttributeDeclarations(r),t.addUniformDeclarations(r),t.addVaryingDeclarations(r),t.directionalLight!==e&&(r.vectorShader+="highp mat3 transpose(in highp mat3 inMatrix) {\n",r.vectorShader+="    highp vec3 i0 = inMatrix[0];\n",r.vectorShader+="    highp vec3 i1 = inMatrix[1];\n",r.vectorShader+="    highp vec3 i2 = inMatrix[2];\n",r.vectorShader+="    highp mat3 outMatrix = mat3(\n",r.vectorShader+="        vec3(i0.x, i1.x, i2.x),\n",r.vectorShader+="        vec3(i0.y, i1.y, i2.y),\n",r.vectorShader+="        vec3(i0.z, i1.z, i2.z)\n",r.vectorShader+="    );\n",r.vectorShader+="    return outMatrix;\n",r.vectorShader+="}\n"),r.vectorShader+="void main() {\n",r.fragmentShader+="void main() {\n",t.addLogic(r),r.vectorShader+="}\n",r.fragmentShader+="}\n",n.source(r.vectorShader,r.fragmentShader),t.verticies!==e&&n.attribute("position"),t.colors!==e&&n.attribute("color"),t.textureCoords!==e&&n.attribute("texcoord"),t.normals!==e&&n.attribute("normal"),t.tangents!==e&&n.attribute("tangent"),t.bitangents!==e&&n.attribute("bitangent"),t.diffuseTexture!==e&&n.uniform("diffuse"),t.emmissiveTexture!==e&&n.uniform("emmissive"),t.normalMap!==e&&n.uniform("normalMap"),t.displacementTexture!==e&&n.uniform("displacementScale","1f",.2),t.ambientLight!==e&&n.uniform("ambientLight","1f",.5),t.displacementTexture===e&&t.roughnessTexture===e&&t.shininessTexture==e||n.uniform("surface"),t.matrix!==e&&(t.directionalLight!==e&&n.uniform("modelMatrix"),n.uniform("clipMatrix")),t.directionalLight!==e){n.uniform("lightDirection","3fv"),"Color"===t.directionalLight&&n.uniform("lightColor","3fv");const e="Balanced"===t.ambientLight&&n.ambientLight,r=n.lightDirection;n.lightDirection=function(t){const a=window.frag.Vector.length(t);return a>1?(r([-t[0]/a,-t[1]/a,-t[2]/a]),e&&n.ambientLight(0)):(r([-t[0],-t[1],-t[2]]),e&&n.ambientLight(1-a)),n},"White"===t.directionalLight?n.lightDirection([.8,-.2,.8]):"Grey"===t.directionalLight&&n.lightDirection([.5,-.1,.5])}return n},n}},3743:()=>{window.frag.startFunctions.push((function(e){e.uiShader=e.Shader().name("UI").verticiesXY(-1).matrix2D().diffuseTexture().compile()}))},9914:()=>{window.frag.Cube=function(e,t){void 0===(t=t||{}).drawFront&&(t.drawFront=!0),void 0===t.drawBack&&(t.drawBack=!0),void 0===t.drawTop&&(t.drawTop=!0),void 0===t.drawBottom&&(t.drawBottom=!0),void 0===t.drawLeft&&(t.drawLeft=!0),void 0===t.drawRight&&(t.drawRight=!0);let n=1/4,r=.5,a=1/3,o=2/3;const i=[[-1,-1,-1],[1,-1,-1],[1,1,-1],[-1,1,-1],[1,-1,1],[-1,-1,1],[-1,1,1],[1,1,1]],s=[],c=[],l=t.color?[]:void 0,u=function(e){s.push(e[0]),s.push(e[1]),s.push(e[2]),t.color&&t.color.forEach((e=>{l.push(e)}))},f=function(e,t){c.push(e),c.push(t)},d=function(e,t,n,r){u(e),u(t),u(n),u(r),u(n),u(t)},m=function(e,t,n,r){f(n,t),f(n,r),f(e,t),f(e,r),f(e,t),f(n,r)},g=function(t,n,r,a,o,s,c){for(var l=0;l<e;l++){const u=l/e,f=(l+1)/e,g=(c-o)*u+o,h=(c-o)*f+o;for(hFacet=0;hFacet<e;hFacet++){const o=hFacet/e,c=(hFacet+1)/e,l=window.frag.Vector,v=l.sub(i[r],i[n]),p=l.sub(i[t],i[n]),x=l.add(l.add(i[n],l.mult(p,o)),l.mult(v,u)),T=l.add(l.add(i[n],l.mult(p,c)),l.mult(v,u)),b=l.add(l.add(i[n],l.mult(p,o)),l.mult(v,f)),w=l.add(l.add(i[n],l.mult(p,c)),l.mult(v,f));d(T,w,x,b),m((s-a)*o+a,g,(s-a)*c+a,h)}}};return t.duplicateTexture?(t.drawFront&&g(1,0,3,1,1,0,0),t.drawBottom&&g(4,5,0,1,1,0,0),t.drawLeft&&g(0,5,6,1,1,0,0),t.drawRight&&g(4,1,2,1,1,0,0),t.drawBack&&g(5,4,7,1,1,0,0),t.drawTop&&g(6,7,2,1,1,0,0)):(t.drawFront&&g(1,0,3,n,o,0,a),t.drawBottom&&g(4,5,0,r,o,n,a),t.drawLeft&&g(0,5,6,r,o,n,1),t.drawRight&&g(4,1,2,n,a,r,0),t.drawBack&&g(5,4,7,r,a,.75,o),t.drawTop&&g(6,7,2,.75,a,1,o)),window.frag.MeshData().addTriangles(s,l,c)}},6499:()=>{window.frag.Cylinder=function(e,t){e=e||32;const n=[0,0,-1],r=[.5,.5],a=[0,0,-1],o=(t=t||{}).color?Array.from(t.color):void 0,i=[0,0,1],s=[.5,.5],c=[0,0,1],l=t.color?Array.from(t.color):void 0,u=[],f=t.color?[]:void 0,d=[],m=[],g=2*Math.PI/e;for(var h=0;h<=e;h++){const e=-h*g,i=Math.sin(e),s=Math.cos(e);n.push(i),n.push(s),n.push(-1),t.color&&t.color.forEach((e=>o.push(e))),r.push(.5*(i+1)),r.push(.5*(s+1)),a.push(i),a.push(s),a.push(-1),u.push(i),u.push(s),u.push(-1),u.push(i),u.push(s),u.push(1),t.color&&(t.color.forEach((e=>f.push(e))),t.color.forEach((e=>f.push(e)))),d.push(.5*(i+1)),d.push(.5*(s+1)),d.push(.5*(i+1)),d.push(.5*(s+1)),m.push(i),m.push(s),m.push(0),m.push(i),m.push(s),m.push(0)}for(h=0;h<=e;h++){const e=h*g,n=Math.sin(e),r=Math.cos(e);i.push(n),i.push(r),i.push(1),t.color&&t.color.forEach((e=>l.push(e))),s.push(.5*(n+1)),s.push(.5*(r+1)),c.push(n),c.push(r),c.push(1)}return u.push(0),u.push(1),u.push(1),t.color&&t.color.forEach((e=>f.push(e))),d.push(.5),d.push(1),m.push(0),m.push(1),m.push(0),window.frag.MeshData().addTriangleFan(n,o,r,a).addTriangleFan(i,l,s,c).addTriangleStrip(u,f,d,m)}},9022:()=>{window.frag.Disc=function(e,t){e=e||32,t=t||{};const n=[0,0,0],r=[.5,.5],a=[0,0,-1],o=2*Math.PI/e;for(var i=0;i<=e;i++){const e=-i*o,t=Math.sin(e),s=Math.cos(e);n.push(t),n.push(s),n.push(0),a.push(0),a.push(0),a.push(-1),r.push(.5*(t+1)),r.push(.5*(s+1))}return window.frag.MeshData().addTriangleFan(n,r,a)}},1950:()=>{window.frag.Plane=function(e,t){if(t=t||{},1===(e=e||1)){const e=t.color||[0,0,0],n=new Float32Array([1,-1,0,1,1,0,-1,-1,0,-1,1,0,e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],1,0,1,1,0,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0]);return window.frag.MeshData().fromBuffer(n.buffer,3,4,window.frag.gl.TRIANGLE_STRIP,0*Float32Array.BYTES_PER_ELEMENT,12*Float32Array.BYTES_PER_ELEMENT,24*Float32Array.BYTES_PER_ELEMENT,32*Float32Array.BYTES_PER_ELEMENT,44*Float32Array.BYTES_PER_ELEMENT,56*Float32Array.BYTES_PER_ELEMENT)}const n=[],r=[],a=[],o=t.color?[]:void 0,i=function(e,i){n.push(e),n.push(i),n.push(0),t.color&&t.color.forEach((e=>o.push(e))),r.push(.5*(e+1)),r.push(.5*(i+1)),a.push(0),a.push(0),a.push(-1)};for(var s=0;s<e;s++){const t=2*(e-s-1)/e-1,n=2*(e-s)/e-1;if(0==(1&s)){i(1,t);for(var c=0;c<e;c++){const r=2*(e-c-1)/e-1;i(2*(e-c)/e-1,n),i(r,t)}i(-1,n)}else{for(i(-1,n),c=0;c<e;c++){const r=2*(c+1)/e-1;i(2*c/e-1,t),i(r,n)}i(1,t)}}return window.frag.MeshData().addTriangleStrip(n,o,r,a)}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,r),o.exports}r(6601),r(8197),r(7996),r(7904),r(9607),r(1346),r(9670),r(1821),r(6437),r(3798),r(2198),r(3743),r(7218),r(8394),r(2636),r(4655),r(9288),r(1175),r(1003),r(2816),r(7266),r(8390),r(5312),r(3270),r(3014),r(3906),r(6627),r(9023),r(5363),r(3890),r(9889),r(4600),r(9622),r(666),r(2201),r(9914),r(6499),r(9022),r(1950),r(6237),r(4583),r(956),r(9810),r(7802),r(3235),r(6784),r(8562),r(280),r(8853),r(5217)})();
//# sourceMappingURL=frag.min.js.map