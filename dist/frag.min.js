(()=>{var t={6627:()=>{window.frag.Animation=function(t,e){const n={stopAfter:0,isRunning:!1},r=t||{};r.__private=n;const o=100;return r.getIsRunning=function(){return n.isRunning},r.setDuration=function(t){return r.duration=t,r},r.setInterval=function(t){return r.interval=t,r},r.action=function(t,e,a){if(void 0!==n.stopAfter&&(n.stopAt=e+n.stopAfter,delete n.stopAfter),void 0!==n.stopAt&&e>=n.stopAt){if(n.sequence){let t=n.sequence[n.sequenceIndex];t.stop&&t.stop(r,e)}return window.frag.deactivateAnimation(r),n.disposeOnStop&&r.dispose(),void(n.isRunning=!1)}if(n.sequence){let t=n.sequence[n.sequenceIndex];n.nextStepTick?e>=n.nextStepTick&&(t.stop&&t.stop(r,e),n.sequenceIndex++,n.sequenceIndex===n.sequence.length?n.autoRestart?(n.sequenceIndex=0,t=n.sequence[n.sequenceIndex],t.start&&t.start(r,e),n.nextStepTick=e+(t.duration||o)):n.stopAt=e:(t=n.sequence[n.sequenceIndex],t.start&&t.start(r,e),r.interval=t.interval,n.nextStepTick=e+(t.duration||o))):(n.nextStepTick=e+(t.duration||o),t.start&&t.start(r,e)),n.action=t.action,r.nextGameTick=e+(t.interval||5)}else void 0!==n.frameRepeat?r.nextFrameTick=a+n.frameRepeat:void 0!==n.tickRepeat&&(r.nextGameTick=e+n.tickRepeat);n.action&&n.action(r,e,a)},r.sequence=function(t,e){Array.isArray(t)?n.sequence=t:n.sequence=[t],n.sequenceIndex=0,n.autoRestart=e;let a=0;for(let t=0;t<n.sequence.length;t++){const e=n.sequence[t];void 0!==e.duration?a+=e.duration:a+=o}return r.duration=a,r},r.perform=function(t,e){return r.sequence(t,e)},r.start=function(){return delete n.nextStepTick,delete n.stopAfter,delete n.stopAt,window.frag.activateAnimation(r),n.isRunning=!0,r},r.stop=function(){return n.stopAfter=0,r},r.repeatTicks=function(t,e){return delete n.autoRestart,delete n.frameRepeat,delete n.sequence,n.tickRepeat=e||t.interval||20,n.action=t,r},r.repeatFrames=function(t,e){return delete n.autoRestart,delete n.tickRepeat,delete n.sequence,n.frameRepeat=e||1,n.action=t,r},r.stopAfter=function(t){return n.stopAfter=t,delete n.stopAt,r},r.disposeOnStop=function(t){n.disposeOnStop=t},e||window.frag.addAnimation(r),r.dispose=function(){window.frag.removeAnimation(r)},r}},4600:()=>{window.frag.KeyframeAnimationAction=function(){const t={startTick:void 0,currentFrame:void 0,keyframes:{}},e={__private:t,interval:10,frames:100,start:function(n,r){return t.startTick=r,t.currentFrame=-1,e},action:function(n,r){let o=Math.floor((r-t.startTick)/e.interval);for(;t.currentFrame<o;){t.currentFrame++;const e=t.keyframes[t.currentFrame];if(e)for(let n=0;n<e.length;n++)e[n].action(t.currentFrame,e[n].data,r)}return e},setFrames:function(t,n){return e.interval=t,e.frames=n||e.frames,e.duration=e.interval*e.frames,e},add:function(n,r,o){let a=t.keyframes[n];return a||(a=[],t.keyframes[n]=a),a.push({action:r,data:o}),e}};return e}},5363:()=>{window.frag.ModelAnimation=function(){const t={loop:!1,interval:10,frames:50,channelGraphs:[],name:""},e={__private:t,getChannelGraphs:function(){return t.channelGraphs},name:function(n){return t.name=n,e},getName:function(){return t.name},loop:function(n){return t.loop=n,e},getLoop:function(){return t.loop},interval:function(n){return t.interval=n,e},getInterval:function(){return t.interval},frames:function(n){return t.frames=n,e},getFrames:function(){return t.frames}},n=function(e){const n=[];let r;n.length=t.frames;let o=0;for(let a=0;a<t.frames;a++){const t=e[a];if(void 0!==t){if(r=t.value,"linear"===t.transition){const t=n[o],e=(r-t)/(a-o);for(let r=o+1;r<a;r++)n[r]=t+(r-o)*e}o=a}n[a]=r}return n};return e.addChannel=function(e){t.channelGraphs.push({pattern:e.pattern,channel:e.channel,frameValues:n(e.keyframes)})},e}},9023:()=>{window.frag.ObjectAnimationState=function(){const t={__private:{},location:window.frag.Location(),getMatrix:function(){return t.location.getMatrix()},getUpdateFunction:function(e){switch(e){case"translate-x":return function(e){t.location.translateX=e,t.location.isModified=!0};case"translate-y":return function(e){t.location.translateY=e,t.location.isModified=!0};case"translate-z":return function(e){t.location.translateZ=e,t.location.isModified=!0};case"scale-x":return function(e){t.location.scaleX=e,t.location.isModified=!0};case"scale-y":return function(e){t.location.scaleY=e,t.location.isModified=!0};case"scale-z":return function(e){t.location.scaleZ=e,t.location.isModified=!0};case"rotate-x":return function(e){t.location.rotateX=e,t.location.isModified=!0};case"rotate-y":return function(e){t.location.rotateY=e,t.location.isModified=!0};case"rotate-z":return function(e){t.location.rotateZ=e,t.location.isModified=!0}}return console.warn("Unsupported animation channel "+e),function(){}}};return t}},9622:()=>{window.frag.ParallelAnimationAction=function([t]){const e={actions:t},n={__private:e,duration:30,interval:5,setDuration:function(t){return n.duration=t,n},setInterval:function(t){return n.interval=t,n},start:function(t,r){return e.actions.forEach((e=>{e.start&&e.start(t,r)})),n},action:function(t,r){return e.actions.forEach((e=>{e.action&&e.action(t,r)})),n},stop:function(t,n){e.actions.forEach((e=>{e.stop&&e.stop(t,n)}))}};return n}},2201:()=>{window.frag.PositionAnimationAction=function(t,e,n){const r=window.frag.Vector,o={scenePosition:t,invLinearVelocity:e,invAngularVelocity:n,startLocation:void 0,startRotate:void 0,moveBy:void 0,rotateBy:void 0,moveTo:void 0,rotateTo:void 0},a={__private:o,setInterval:function(t){return a.interval=t,a},moveBy:function(t,e){e=e||o.invLinearVelocity||1;let n=r.length(t);return a.duration=Math.floor(e*n+1),o.moveBy=t,a},moveTo:function(t,e){return e&&(o.invAngularVelocity=void 0),o.invLinearVelocity=e||o.invLinearVelocity||1,o.moveTo=t,a},rotateBy:function(t,e){e=e||o.invAngularVelocity||10;let n=r.length(t);return a.duration=Math.floor(e*n+1),o.rotateBy=t,a},rotateTo:function(t,e){return e&&(o.invLinearVelocity=void 0),o.invAngularVelocity=e||o.invAngularVelocity||10,o.rotateTo=t,a},moveByXYZ:function(t,e,n,r){return a.moveBy([t,e,n],r)},moveByXY:function(t,e,n){return a.moveBy([t,e,0],n)},moveToXYZ:function(t,e,n,r){return a.moveTo([t,e,n],r)},moveToXY:function(t,e,n){return a.moveTo([t,e,0],n)},rotateByXYZ:function(t,e,n,r){return a.rotateBy([t,e,n],r)},rotateByXY:function(t,e,n){return a.rotateBy([t,e,0],n)},rotateToXYZ:function(t,e,n,r){return a.rotateTo([t,e,n],r)},rotateToXY:function(t,e,n){return a.rotateTo([t,e,0],n)},onStart:function(t){return o.onStart=t,a},onStop:function(t){return o.onStop=t,a},start:function(t,e){if(o.startLocation=o.scenePosition.getLocation(),o.startRotate=o.scenePosition.getRotate(),o.rotateTo&&o.invAngularVelocity){o.rotateDelta=function(t,e){const n=r.sub(t,e);for(let t=0;t<n.length;t++){for(;n[t]<-Math.PI;)n[t]+=2*Math.PI;for(;n[t]>Math.PI;)n[t]-=2*Math.PI}return n}(o.rotateTo,o.startRotate);const t=r.length(o.rotateDelta);a.duration=Math.floor(o.invAngularVelocity*t+1)}if(o.moveTo&&o.invLinearVelocity){o.moveDelta=(n=o.moveTo,i=o.startLocation,r.sub(n,i));const t=r.length(o.moveDelta);a.duration=Math.floor(o.invLinearVelocity*t+1)}var n,i;return o.startTick=e,o.endTick=e+a.duration,o.onStart&&o.onStart(t,a,e),a},action:function(t,e){const n=(e-o.startTick)/a.duration;let i=o.moveBy,s=o.rotateBy;return o.moveDelta&&(i=o.moveDelta),o.rotateDelta&&(s=o.rotateDelta),i&&o.scenePosition.location(r.add(o.startLocation,r.mult(i,n))),s&&o.scenePosition.rotate(r.add(o.startRotate,r.mult(s,n))),a},stop:function(t,e){return o.onStop&&o.onStop(t,a,e),a}};return a}},666:()=>{window.frag.RepeatAnimationAction=function(t,e){return{duration:t.duration*e,interval:t.interval,start:t.start,stop:t.stop,action:t.action}}},3890:()=>{window.frag.SceneObjectAnimation=function(t,e){const n=t.modelAnimation,r=t.childAnimations,o=[];for(let t=0;t<r.length;t++){const n=r[t],a=n.model.getName();if(animationState=e[a],animationState){const t=n.graph,e=animationState.getUpdateFunction(t.channel);o.push((function(n){e(t.frameValues[n])}))}}const a=function(t){for(let e=0;e<o.length;e++)o[e](t)},i=window.frag.KeyframeAnimationAction().setFrames(n.getInterval(),n.getFrames());for(let t=0;t<n.getFrames();t++)i.add(t,a);return window.frag.Animation().perform(i,n.getLoop())}},9889:()=>{window.frag.ValueAnimationAction=function(){const t={},e={__private:t,duration:30,interval:5,setDuration:function(t){return e.duration=t,e},setInterval:function(t){return e.interval=t,e},onStart:function(n){return t.onStart=n,e},onStop:function(n){return t.onStop=n,e},onStep:function(n){return t.onStep=n,e},start:function(n,r){return t.startTick=r,t.endTick=r+e.duration,t.onStart&&t.onStart(n,e,r),e},action:function(n,r){if(t.onStep){const o=(r-t.startTick)/e.duration;t.onStep(n,o,e,r)}return e},stop:function(n,r){return t.onStop&&t.onStop(n,e,r),e}};return e}},3014:()=>{window.frag.OrthographicCamera=function(){const t={x:0,y:0,z:-200,fov:35*Math.PI/180,zNear:-100,zFar:100,xScale:100,aspectRatio:1},e={__private:t,worldToClipTransform:window.frag.Transform()},n=function(){const n=1/t.xScale,r=t.aspectRatio/t.xScale,o=2/(t.zFar-t.zNear),a=1-t.zFar*o;e.worldToClipTransform.identity().translateZ(a).scaleXYZ(n,r,o).translateXY(-t.x,-t.y)};return e.moveToXY=function(r,o){return t.x=r,t.y=o,n(),e},e.moveToXYZ=function(r,o,a){return t.x=r,t.y=o,t.z=a,n(),e},e.moveToX=function(r){return t.x=r,n(),e},e.moveToY=function(r){return t.y=r,n(),e},e.moveToZ=function(r){return t.z=r,n(),e},e.frustrum=function(r,o,a){return t.fov=r,t.zNear=o,t.zFar=a,n(),e},e.scaleX=function(r){return t.xScale=r,n(),e},e.setViewport=function(t){return t.viewport(0,0,t.canvas.clientWidth,t.canvas.clientHeight),t.canvas.width=t.canvas.clientWidth,t.canvas.height=t.canvas.clientHeight,e.adjustToViewport(t)},e.adjustToViewport=function(n){const r=n.drawingBufferWidth/n.drawingBufferHeight;if(r!=t.aspectRatio){t.aspectRatio=r;const n=e.worldToClipTransform.getMatrix();n[5]=n[0]*r,e.worldToClipTransform.setMatrix(n)}return e},e}},3906:()=>{window.frag.PerspectiveCamera=function(){const t=window.frag,e={locationTransform:window.frag.Transform(),worldTransform:window.frag.Transform(),perspectiveTransform:window.frag.Transform(),x:0,y:0,z:-200,xRot:0,yRot:0,zRot:0,fov:45*Math.PI/180,zNear:-100,zFar:100,xScale:100,aspectRatio:1,transformChanged:!0},n={__private:e,worldToClipTransform:window.frag.Transform()};return e.computeCameraTransforms=function(){e.locationTransform.identity().translateXYZ(e.x,e.y,e.z).rotateXYZ(e.xRot,e.yRot,e.zRot),e.worldTransform.identity().rotateXYZ(-e.xRot,-e.yRot,-e.zRot).scaleXYZ(1/e.xScale,e.aspectRatio/e.xScale,2/(e.zFar-e.zNear)).translateXYZ(-e.x,-e.y,-e.z),e.transformChanged=!0},e.computePerspectiveTransform=function(){const t=-2*(e.zNear-e.z)/(e.zFar-e.zNear)-1;e.perspectiveTransform.setMatrix([1,0,0,0,0,1,0,0,0,0,1,.5,0,0,t,.7]),e.transformChanged=!0},e.computeTransform=function(){const r=t.Matrix.m4Xm4(e.perspectiveTransform.getMatrix(),e.worldTransform.getMatrix());n.worldToClipTransform.setMatrix(r)},e.computeCameraTransforms(),e.computePerspectiveTransform(),n.moveToXY=function(t,r){return e.x=t,e.y=r,e.computeCameraTransforms(),n},n.moveToX=function(t){return e.x=t,e.computeCameraTransforms(),n},n.moveToY=function(t){return e.y=t,e.computeCameraTransforms(),n},n.moveToZ=function(t){return e.z=t,e.computeCameraTransforms(),e.computePerspectiveTransform(),n},n.moveToXYZ=function(t,r,o){return e.x=t,e.y=r,e.z=o,e.computeCameraTransforms(),e.computePerspectiveTransform(),n},n.frustrum=function(t,r,o){return e.fov=t,e.zNear=r,e.zFar=o,e.computePerspectiveTransform(),n},n.scaleX=function(t){return e.xScale=t,e.computeCameraTransforms(),n},n.setViewport=function(t){return t.viewport(0,0,t.canvas.clientWidth,t.canvas.clientHeight),t.canvas.width=t.canvas.clientWidth,t.canvas.height=t.canvas.clientHeight,n.adjustToViewport(t)},n.adjustToViewport=function(t){const r=t.drawingBufferWidth/t.drawingBufferHeight;return r!=e.aspectRatio&&(e.aspectRatio=r,e.computeCameraTransforms()),e.transformChanged&&(e.computeTransform(),e.transformChanged=!1),n},n}},3270:()=>{window.frag.UiCamera=function(){const t={aspectRatio:1},e={worldToClipTransform:window.frag.Transform2D().identity(),scaleX:function(n){var r=e.worldToClipTransform.getMatrix();return r[0]=1/n,e.worldToClipTransform.setMatrix(r),t.aspectRatio=-1,e},setViewport:function(t){return t.viewport(0,0,t.canvas.clientWidth,t.canvas.clientHeight),t.canvas.width=t.canvas.clientWidth,t.canvas.height=t.canvas.clientHeight,e.adjustToViewport(t)},adjustToViewport:function(n){const r=n.drawingBufferWidth/n.drawingBufferHeight;if(t.aspectRatio!=r){const n=e.worldToClipTransform.getMatrix();n[4]=n[0]*r,e.worldToClipTransform.setMatrix(n),t.aspectRatio=r}return e}};return e}},6437:()=>{!function(){const t=window.frag,e=[],n={},r={};let o=performance.now(),a=0,i=0,s=null,c=0,l=[],u=0;t.correctClock=function(e){let n=e-a;n>0?o+=t.gameTickMs:n<0&&(o-=t.gameTickMs)},t.mainScene=function(e){return s&&s.dispose(),s=e,t},t.getMainScene=function(){return s},t.addScene=function(n){return e.push(n),t},t.removeScene=function(t){for(let n=0;n<e.length;n++)if(e[n]===t)return e.splice(n,1),!0;return!1},t.activateAnimation=function(t){n[t.id]=t,delete r[t.id]},t.deactivateAnimation=function(t){r[t.id]=t,delete n[t.id]},t.addAnimation=function(e){return e.id=c++,r[e.id]=e,t},t.removeAnimation=function(e){return delete r[e.id],delete n[e.id],t};const f=function(){if(s){const r=t.gl,c=performance.now();a=Math.floor((c-o)/window.frag.gameTickMs),i++,function(t,e){for(let r in n){let o=n[r];void 0!==o.nextFrameTick?e>=o.nextFrameTick&&(o.nextFrameTick=e+10,o.action(null,t,e)):null!=o.nextGameTick?t>=o.nextGameTick&&(o.nextGameTick=t+5,o.action(null,t,e)):o.nextGameTick=t+5}}(a,i),r.bindFramebuffer(r.FRAMEBUFFER,null),s.setViewport(r),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);const f={gl:r};s.draw(f);for(let t=0;t<e.length;t++)e[t].adjustToViewport(r),e[t].draw(f);const m=performance.now()-o;l.push(m),u+=m,l.length>100&&(u-=l.shift()),t.fps=1e3*l.length/u}setTimeout(f,t.renderInterval)};window.frag.startFunctions.push(f)}()},7904:()=>{window.frag=window.frag||{},window.frag.startFunctions=[],window.frag.init=function(){const t=window.frag;if(t.canvas=t.canvas||document.getElementById("scene"),!t.canvas)return console.error('No canvas with id of "scene" in the page'),null;const e=t.canvas.getContext("webgl");if(!e)return alert("WebGL is not available"),null;t.gl=e,t.canvas.addEventListener("contextmenu",(t=>t.preventDefault())),e.clearColor(1,1,1,1),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),t.renderInterval=15,t.gameTickMs=10,t.debugPackageLoader=!1,t.debugShaderBuilder=!1,t.debugAnimations=!1,t.debugMeshes=!1,t.debugInputs=!1,t.maxTextureUnits=t.gl.getParameter(t.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),t.nextTextureUnit=0,t.allocateTextureUnit=function(){const e=t.nextTextureUnit;return t.nextTextureUnit=(t.nextTextureUnit+1)%t.maxTextureUnits,e},t.config&&t.config(t);for(var n=0;n<t.startFunctions.length;n++)t.startFunctions[n](t);return t}},1821:()=>{window.frag.Location=function(t){const e={is3d:t,isModified:!1,matrix:null,translateX:0,translateY:0,translateZ:0,scaleX:1,scaleY:1,scaleZ:1,rotateX:0,rotateY:0,rotateZ:0,clone:function(){const t=window.frag.Location(e.is3d);return t.isModified=e.isModified,t.matrix=e.matrix,t.translateX=e.translateX,t.translateY=e.translateY,t.translateZ=e.translateZ,t.scaleX=e.scaleX,t.scaleY=e.scaleY,t.scaleZ=e.scaleZ,t.rotateX=e.rotateX,t.rotateY=e.rotateY,t.rotateZ=e.rotateZ,t},add:function(t){return e.translateX+=t.translateX,e.translateY+=t.translateY,e.translateZ+=t.translateZ,e.scaleX*=t.scaleX,e.scaleY*=t.scaleY,e.scaleZ*=t.scaleZ,e.rotateX+=t.rotateX,e.rotateY+=t.rotateY,e.rotateZ+=t.rotateZ,e.isModified=!0,e},getMatrix:function(){if(e.matrix&&!e.isModified)return e.matrix;let t;return t=e.is3d?window.frag.Transform().translateXYZ(e.translateX,e.translateY,e.translateZ).rotateXYZ(e.rotateX,e.rotateY,e.rotateZ).scaleXYZ(e.scaleX,e.scaleY,e.scaleZ):window.frag.Transform2D().translateXY(e.translateX,e.translateY).rotate(e.rotateZ).scaleXY(e.scaleX,e.scaleY),e.matrix=t.getMatrix(),e.isModified=!1,e.matrix}};return e}},9607:()=>{window.frag.Observable=function(t){const e={notify:t,observers:[]};return{__private:e,subscribe:function(t){e.observers.push(t),e.notify(t)},unsubscribe:function(t){for(let n=0;n<e.observers.length;n++)if(e.observers[n]===t)return e.observers.splice(n,1),!0;return!1},notify:function(t){t=t||e.notify||function(t){t()};for(let n=0;n<e.observers.length;n++)t(e.observers[n])}}},window.frag.ObservableValue=function(){let t=null;const e=frag.Observable((e=>{e(t)}));return{get:function(){return t},set:function(n){t=n,e.notify()},subscribe:function(t){return e.subscribe(t)},unsubscribe:function(t){return e.unsubscribe(t)}}}},1346:()=>{window.frag.Transform=function(t){const e=window.frag,n={matrix:t},r={__private:n,observableMatrix:window.frag.Observable((t=>{t(n.matrix)})),is3d:!0,clone:function(t){return window.frag.Transform(t||n.matrix)},getMatrix:function(){return n.matrix},setMatrix:function(t){return n.matrix=t,r.observableMatrix.notify(),r}};return n.transform=function(t){return n.matrix?r.setMatrix(e.Matrix.m4Xm4(n.matrix,t)):r.setMatrix(t)},r.identity=function(){return r.setMatrix([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},r.scale=function(t){return n.transform([t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1])},r.scaleX=function(t){return n.transform([t,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},r.scaleY=function(t){return n.transform([1,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1])},r.scaleZ=function(t){return n.transform([1,0,0,0,0,1,0,0,0,0,t,0,0,0,0,1])},r.scaleXY=function(t,e){return n.transform([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1])},r.scaleXYZ=function(t,e,r){return n.transform([t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1])},r.translateX=function(t){return n.transform([1,0,0,0,0,1,0,0,0,0,1,0,t,0,0,1])},r.translateY=function(t){return n.transform([1,0,0,0,0,1,0,0,0,0,1,0,0,t,0,1])},r.translateZ=function(t){return n.transform([1,0,0,0,0,1,0,0,0,0,1,0,0,0,t,1])},r.translateXY=function(t,e){return n.transform([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1])},r.translateXYZ=function(t,e,r){return n.transform([1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1])},r.rotateX=function(t){var e=Math.cos(t),r=Math.sin(t);return n.transform([1,0,0,0,0,e,r,0,0,-r,e,0,0,0,0,1])},r.rotateY=function(t){var e=Math.cos(t),r=Math.sin(t);return n.transform([e,0,-r,0,0,1,0,0,r,0,e,0,0,0,0,1])},r.rotateZ=function(t){var e=Math.cos(t),r=Math.sin(t);return n.transform([e,r,0,0,-r,e,0,0,0,0,1,0,0,0,0,1])},r.rotateXYZ=function(t,e,n){return t&&r.rotateX(t),e&&r.rotateY(e),n&&r.rotateZ(n),r},r.apply=function(t,e){return void 0!==e&&t.uniformMatrix4fv(e,!1,r.getMatrix()),r},r}},9670:()=>{window.frag.Transform2D=function(t){const e=window.frag,n={matrix:t},r={__private:n,observableMatrix:window.frag.Observable((t=>{t(n.matrix)})),is3d:!1,clone:function(t){return window.frag.Transform2D(t||n.matrix)},getMatrix:function(){return n.matrix},setMatrix:function(t){return n.matrix=t,r.observableMatrix.notify(),r}};return n.transform=function(t){return n.matrix?r.setMatrix(e.Matrix.m3Xm3(n.matrix,t)):r.setMatrix(t)},r.identity=function(){return r.setMatrix([1,0,0,0,1,0,0,0,1])},r.scale=function(t){return n.transform([t,0,0,0,t,0,0,0,1])},r.scaleXY=function(t,e){return n.transform([t,0,0,0,e,0,0,0,1])},r.translateX=function(t){return n.transform([1,0,0,0,1,0,t,0,1])},r.translateY=function(t){return n.transform([1,0,0,0,1,0,0,t,1])},r.translateXY=function(t,e){return n.transform([1,0,0,0,1,0,t,e,1])},r.rotate=function(t){var e=Math.cos(t),r=Math.sin(t);return n.transform([e,-r,0,r,e,0,0,0,1])},r.apply=function(t,e){return void 0!==e&&t.uniformMatrix3fv(e,!1,r.getMatrix()),r},r}},5217:()=>{window.frag.AnalogAction=function(t,e){const n=t.split("-");let r="move",o="z";for(let t=0;t<n.length;t++)/^move$/i.test(n[t])&&(r="move"),/^rotate$/i.test(n[t])&&(r="rotate"),/^scale$/i.test(n[t])&&(r="scale"),/^x$/i.test(n[t])&&(o="x"),/^y$/i.test(n[t])&&(o="y"),/^z$/i.test(n[t])&&(o="z"),/^right$/i.test(n[t])&&(o="right"),/^up$/i.test(n[t])&&(o="up"),/^forward$/i.test(n[t])&&(o="forward");if(/camera/i.test(t)&&"move"===r){if("x"===o)return function(t){frag.getMainScene().getCamera().moveToX(t.value)};if("y"===o)return function(t){frag.getMainScene().getCamera().moveToY(t.value)};if("z"===o)return function(t){frag.getMainScene().getCamera().moveToZ(t.value)}}return e&&e.sceneObject&&/sceneobject/i.test(t)?function(t){}:null}},280:()=>{window.frag.AnalogInput=function(t,n){const r=window.frag,o={inputName:t,analogState:n},a={__private:o},i=t.split("-");if(/mouse/i.test(t)){let t,e,n=0,s=!1,c=!1,l=!1;for(let t=0;t<i.length;t++)/^horizontal$/.test(i[t])&&(s=!1),/^vertical$/.test(i[t])&&(s=!0),/^inverted$/.test(i[t])&&(c=!0),/^wheel$/.test(i[t])&&(l=!0),/^left$/.test(i[t])&&(n=1),/^right$/.test(i[t])&&(n=2),/^middle$/.test(i[t])&&(n=4),/^back$/.test(i[t])&&(n=8),/^forward$/.test(i[t])&&(n=16),/^any$/.test(i[t])&&(n=255);const u=function(a){if(0===n){let t=s?(r.canvas.clientHeight-a.clientY)/r.canvas.clientHeight:a.clientX/r.canvas.clientWidth;c&&(t=1-t);const e=(o.analogState.maxValue-o.analogState.minValue)*t+o.analogState.minValue;r.debugInputs&&console.log("Analog input",o.inputName,"=",e),o.analogState.setValue(a,e,!0)}else if(0!=(a.buttons&n)){let n=s?(c?a.clientY-t:t-a.clientY)/r.canvas.clientHeight:(c?t-a.clientX:a.clientX-t)/r.canvas.clientWidth;const i=e+(o.analogState.maxValue-o.analogState.minValue)*n;r.debugInputs&&console.log("Analog input",o.inputName,"=",i),o.analogState.setValue(a,i,!0)}return!0},f=function(r){0!=(r.buttons&n)&&(t=s?r.clientY:r.clientX,e=o.analogState.value)},m=function(t){return r.debugInputs&&console.log("Analog input",o.inputName,"delta",t.deltaY),c?t.deltaY>0?o.analogState.decrement(t):o.analogState.increment(t):t.deltaY<0?o.analogState.decrement(t):o.analogState.increment(t),t.preventDefault(),!0};return a.enable=function(){l?r.canvas.addEventListener("wheel",m,!1):(r.canvas.addEventListener("mousemove",u,!1),0!==n&&r.canvas.addEventListener("mousedown",f,!1))},a.disable=function(){l?r.canvas.removeEventListener("wheel",m,!1):(r.canvas.removeEventListener("mousemove",u,!1),0!==n&&r.canvas.removeEventListener("mousedown",f,!1))},a}if(/keys/i.test(i[0])){let t="ArrowLeft",e="ArrowRight";i.length>1&&(t=i[1]),i.length>2&&(e=i[2]);const n=function(n){return n.key===t?(r.debugInputs&&console.log("Analog input",o.inputName,"decrement"),o.analogState.decrement(n),n.preventDefault()):n.key===e&&(r.debugInputs&&console.log("Analog input",o.inputName,"increment"),o.analogState.increment(n),n.preventDefault()),!0};return a.enable=function(){document.addEventListener("keydown",n,!1)},a.disable=function(){document.removeEventListener("keydown",n,!1)},a}if(/touch/i.test(t)){let t,e,n,s,c="horizontal",l=!1,u=!1,f=0;for(let t=0;t<i.length;t++)/^horizontal$/.test(i[t])&&(c="horizontal"),/^vertical$/.test(i[t])&&(c="vertical"),/^pinch$/.test(i[t])&&(c="pinch"),/^rotate$/.test(i[t])&&(c="rotate"),/^inverted$/.test(i[t])&&(l=!0),/^plus$/.test(i[t])&&(u=!0),/^1$/.test(i[t])&&(f=0),/^2$/.test(i[t])&&(f=1),/^3$/.test(i[t])&&(f=2);let m=null,d=null;if("horizontal"===c&&(m=function(a){if(u&&a.touches.length>f||a.touches.length===f+1){const i=a.touches.item(f);let c=(l?t-i.clientX:i.clientX-t)/n;const u=e+s*c;r.debugInputs&&console.log("Analog input",o.inputName,"=",u),o.analogState.setValue(a,u,!0)}return!0},d=function(a){if(a.touches.length===f+1){const i=a.touches.item(f);t=i.clientX,e=o.analogState.value,s=o.analogState.maxValue-o.analogState.minValue,n=r.canvas.clientWidth}return!0}),"vertical"===c&&(m=function(a){if(u&&a.touches.length>f||a.touches.length===f+1){const i=a.touches.item(f);let c=(l?i.clientY-t:t-i.clientY)/n;const u=e+s*c;r.debugInputs&&console.log("Analog input",o.inputName,"=",u),o.analogState.setValue(a,u,!0)}return!0},d=function(a){if(a.touches.length===f+1){const i=a.touches.item(f);t=i.clientY,e=o.analogState.value,s=o.analogState.maxValue-o.analogState.minValue,n=r.canvas.clientHeight}return!0}),"pinch"===c){const a=function(t){const e=t.touches.item(0),n=t.touches.item(1),r=n.clientX-e.clientX,o=n.clientY-e.clientY;return Math.sqrt(r*r+o*o)};m=function(i){if(u&&i.touches.length>1||2===i.touches.length){let c=(a(i)-t)/n;l&&(c=-c);const u=e+s*c;r.debugInputs&&console.log("Analog input",o.inputName,"=",u),o.analogState.setValue(i,u,!0)}return!0},d=function(i){return 2===i.touches.length&&(t=a(i),e=o.analogState.value,s=o.analogState.maxValue-o.analogState.minValue,n=.5*Math.sqrt(r.canvas.clientHeight*r.canvas.clientHeight+r.canvas.clientWidth*r.canvas.clientWidth)),!0}}if("rotate"===c){const a=function(t){const e=t.touches.item(0),n=t.touches.item(1),r=n.clientX-e.clientX,o=n.clientY-e.clientY;return Math.atan2(o,r)};m=function(i){if(u&&i.touches.length>1||2===i.touches.length){let c=(a(i)-t)/n;l&&(c=-c);const u=e+s*c;r.debugInputs&&console.log("Analog input",o.inputName,"=",u),o.analogState.setValue(i,u,!0)}return!0},d=function(r){return 2===r.touches.length&&(t=a(r),e=o.analogState.value,s=o.analogState.maxValue-o.analogState.minValue,n=.5*Math.PI),!0}}return a.enable=function(){m&&r.canvas.addEventListener("touchmove",m,!1),d&&r.canvas.addEventListener("touchstart",d,!1)},a.disable=function(){m&&r.canvas.removeEventListener("touchmove",m,!1),d&&r.canvas.removeEventListener("touchstart",d,!1)},a}if(/pointer/i.test(t)){let t,e,n=0,s=!1,c=!1;for(let t=0;t<i.length;t++)/^horizontal$/.test(i[t])&&(s=!1),/^vertical$/.test(i[t])&&(s=!0),/^inverted$/.test(i[t])&&(c=!0),/^left$/.test(i[t])&&(n=1),/^right$/.test(i[t])&&(n=2),/^middle$/.test(i[t])&&(n=4),/^back$/.test(i[t])&&(n=8),/^forward$/.test(i[t])&&(n=16),/^eraser$/.test(i[t])&&(n=32),/^any$/.test(i[t])&&(n=255);const l=function(a){if(0===n){let t=s?a.clientY/r.canvas.clientHeight:a.clientX/r.canvas.clientWidth;c&&(t=1-t);const e=(o.analogState.maxValue-o.analogState.minValue)*t+o.analogState.minValue;r.debugInputs&&console.log("Analog input",o.inputName,"=",e),o.analogState.setValue(a,e,!0)}else if(0!=(a.buttons&n)){let n=s?(c?t-a.clientY:a.clientY-t)/r.canvas.clientHeight:(c?t-a.clientX:a.clientX-t)/r.canvas.clientWidth;const i=e+(o.analogState.maxValue-o.analogState.minValue)*n;r.debugInputs&&console.log("Analog input",o.inputName,"=",i),o.analogState.setValue(a,i,!0)}return!0},u=function(r){0!=(r.buttons&n)&&(t=s?r.clientY:r.clientX,e=o.analogState.value)};return a.enable=function(){r.canvas.addEventListener("pointermove",l,!1),0!==n&&r.canvas.addEventListener("pointerdown",u,!1)},a.disable=function(){r.canvas.removeEventListener("pointermove",l,!1),0!==n&&r.canvas.removeEventListener("pointerdown",u,!1)},a}if(/gamepad/i.test(t)){let t,n=0,s=0,c=0,l=null,u=!1;for(let t=0;t<i.length;t++)/^horizontal$/.test(i[t])&&(c=0),/^vertical$/.test(i[t])&&(c=1),/^inverted$/.test(i[t])&&(u=!0),/^player1$/.test(i[t])&&(n=0),/^player2$/.test(i[t])&&(n=1),/^player3$/.test(i[t])&&(n=2),/^player4$/.test(i[t])&&(n=3),/^stick1$/.test(i[t])&&(s=0),/^stick2$/.test(i[t])&&(s=1),/^stick3$/.test(i[t])&&(s=2),/^stick4$/.test(i[t])&&(s=3);const f=2*s+c,m=function(t){if(l){const e=l.axes[f];u&&(e=-e),o.analogState.setVelocity(t,e*o.analogState.maxVelocity)}},d=function(o){r.debugInputs&&console.log("Gamepad",o.gamepad.index,"connected","id:"+o.gamepad.id,"with",e.gamepad.axes.length,"axes"),o.gamepad.index===n&&l.axes.length>f&&(l=o.gamepad,t=setInterval(m,50))},g=function(e){r.debugInputs&&console.log("Gamepad",e.gamepad.index,"disconnected","id:"+e.gamepad.id),e.gamepad.id===l.id&&(clearInterval(t),l=null)};return a.enable=function(){window.addEventListener("gamepadconnected",d,!1),window.addEventListener("gamepaddisconnected",g,!1)},a.disable=function(){window.removeEventListener("gamepadconnected",d,!1),window.removeEventListener("gamepaddisconnected",g,!1)},a}return/orientation/i.test(t),a}},6784:()=>{window.frag.AnalogState=function(t,e,n){const r=window.frag;e||(e={}),e.value=e.value||0,e.minValue=void 0===e.minValue?-100:e.minValue,e.maxValue=void 0===e.maxValue?100:e.maxValue,e.maxVelocity=e.maxVelocity||5,e.acceleration=void 0===e.acceleration?.25:e.acceleration,e.deceleration=void 0===e.deceleration?1:e.deceleration;const o={analogAction:t,config:e,name:n,inverted:!1},a={__private:o,value:e.value,minValue:e.minValue,maxValue:e.maxValue,maxVelocity:Math.abs(e.maxVelocity),velocity:0};return e.maxValue<e.minValue&&(o.inverted=!0,a.minValue=e.maxValue,a.maxValue=e.minValue),o.change=function(t){if(o.analogAction)if(Array.isArray(o.analogAction))for(let e=0;e<o.analogAction.length;e++)o.analogAction[e](a,t);else o.analogAction(a,t)},o.setValue=function(t,e){e<a.minValue&&(e=a.minValue,a.velocity=0),e>a.maxValue&&(e=a.maxValue,a.velocity=0),Math.abs(a.value-e)>1e-5&&(a.value=e,r.debugInputs&&console.log("Analog state",o.name,"set to",e),o.change(t))},o.increment=function(t){a.velocity+=a.velocity>=0?o.config.acceleration:o.config.deceleration,a.velocity>o.config.maxVelocity&&(a.velocity=o.config.maxVelocity),o.setValue(t,a.value+a.velocity,!1)},o.decrement=function(t){a.velocity-=a.velocity<=0?o.config.acceleration:o.config.deceleration,a.velocity<-o.config.maxVelocity&&(a.velocity=-o.config.maxVelocity),o.setValue(t,a.value+a.velocity,!1)},a.setValue=function(t,e,n){o.inverted&&(e=a.minValue+a.maxValue-e),n&&(a.velocity=e-a.value),o.setValue(t,e)},a.increment=function(t){o.inverted?o.decrement(t):o.increment(t)},a.decrement=function(t){o.inverted?o.increment(t):o.decrement(t)},a.setVelocity=function(t,e){inverted?a.velocity=-e:a.velocity=e,a.velocity>o.config.maxVelocity&&(a.velocity=o.config.maxVelocity),a.velocity<-o.config.maxVelocity&&(a.velocity=-o.config.maxVelocity),o.setValue(t,a.value+a.velocity)},a}},8853:()=>{window.frag.DigitalAction=function(t,e){const n=window.frag;if(e&&e.animation){if(/^animation$/i.test(t))return function(t){n.debugInputs&&console.log("Turning animation",t.isOn?"on":"off"),t.isOn?e.animation.start():e.animation.stop()};if(/^animation-start$/i.test(t))return function(t){t.isOn||(n.debugInputs&&console.log("Starting animation"),e.animation.start())};if(/^animation-stop$/i.test(t))return function(t){t.isOn||(n.debugInputs&&console.log("Stopping animation"),e.animation.stop())}}return e&&e.sceneObject&&/^sceneobject$/i.test(t)?function(t){n.debugInputs&&console.log("Turning scene object",t.isOn?"on":"off"),t.isOn?e.sceneObject.enable():e.sceneObject.disable()}:e&&e.model&&/^model$/i.test(t)?function(t){n.debugInputs&&console.log("Turning",e.model.getName(),"model",t.isOn?"on":"off"),t.isOn?e.model.enable():e.model.disable()}:null}},8562:()=>{window.frag.DigitalInput=function(t,e){const n=window.frag,r={inputName:t,digitalState:e,toggle:!1,inverted:!1,setOn:!1,setOff:!1},o={__private:r},a=t.split("-"),i=function(t,e){r.inverted&&(e=!e),n.debugInputs&&console.log("Digital input",r.inputName,"is",e?"on":"off"),r.toggle?e&&r.digitalState.toggle(t):r.setOn||r.setOff?e&&(r.setOn&&r.digitalState.setIsOn(t,!0),r.setOff&&r.digitalState.setIsOn(t,!1)):r.digitalState.setIsOn(t,e)};if(/mouse/i.test(t)){let t=1;for(let e=0;e<a.length;e++)/^toggle$/i.test(a[e])&&(r.toggle=!0),/^inverted$/i.test(a[e])&&(r.inverted=!0),/^on$/i.test(a[e])&&(r.setOn=!0),/^off$/i.test(a[e])&&(r.setOff=!0),/^left$/i.test(a[e])&&(t=1),/^right$/i.test(a[e])&&(t=2),/^middle$/i.test(a[e])&&(t=4),/^back$/i.test(a[e])&&(t=8),/^forward$/i.test(a[e])&&(t=16),/^eraser$/i.test(a[e])&&(t=32),/^any$/i.test(a[e])&&(t=255);const e=function(e){return i(e,0!=(e.buttons&t)),!0};return o.enable=function(){n.canvas.addEventListener("mousedown",e,!1),n.canvas.addEventListener("mouseup",e,!1)},o.disable=function(){n.canvas.removeEventListener("mousedown",e,!1),n.canvas.removeEventListener("mouseup",e,!1)},o}if(/pointer/i.test(t)){let t=1;for(let e=0;e<a.length;e++)/^toggle$/i.test(a[e])&&(r.toggle=!0),/^inverted$/i.test(a[e])&&(r.inverted=!0),/^on$/i.test(a[e])&&(r.setOn=!0),/^off$/i.test(a[e])&&(r.setOff=!0),/^left$/i.test(a[e])&&(t=1),/^right$/i.test(a[e])&&(t=2),/^middle$/i.test(a[e])&&(t=4),/^back$/i.test(a[e])&&(t=8),/^forward$/i.test(a[e])&&(t=16),/^eraser$/i.test(a[e])&&(t=32),/^any$/i.test(a[e])&&(t=255);const e=function(e){return i(e,0!=(e.buttons&t)),!0};return o.enable=function(){n.canvas.addEventListener("pointerdown",e,!1),n.canvas.addEventListener("pointerup",e,!1)},o.disable=function(){n.canvas.removeEventListener("pointerdown",e,!1),n.canvas.removeEventListener("pointerup",e,!1)},o}if(/key/i.test(t)){let t,e=!1,n=!1,s=!1,c=!1;for(let o=0;o<a.length;o++)/^toggle$/i.test(a[o])?r.toggle=!0:/^inverted$/i.test(a[o])?r.inverted=!0:/^on$/i.test(a[o])?r.setOn=!0:/^off$/i.test(a[o])?r.setOff=!0:/^ctrl$/i.test(a[o])?e=!0:/^shift$/i.test(a[o])?n=!0:/^alt$/i.test(a[o])?s=!0:/^meta$/i.test(a[o])?c=!0:/^key$/i.test(a[o])||(t=a[o]);const l=function(r,o){return r.key!==t||r.altKey!==s||r.ctrlKey!==e||r.shiftKey!==n||r.metaKey!==c||(r.preventDefault(),i(r,o)),!0},u=function(t){return l(t,!0)},f=function(t){return l(t,!1)};return o.enable=function(){document.addEventListener("keydown",u,!1),document.addEventListener("keyup",f,!1)},o.disable=function(){document.removeEventListener("keydown",u,!1),document.removeEventListener("keyup",f,!1)},o}return o}},3235:()=>{window.frag.DigitalState=function(t,e,n){const r=window.frag;e||(e={}),e.isOn=!!e.isOn;const o={digitalAction:t,config:e,name:n},a={__private:o,isOn:e.isOn};return o.change=function(t){if(o.digitalAction)if(Array.isArray(o.digitalAction))for(let e=0;e<o.digitalAction.length;e++)o.digitalAction[e](a,t);else o.digitalAction(a,t)},a.setIsOn=function(t,e){e!==a.isOn?(a.isOn=e,r.debugInputs&&console.log("Digital state",o.name,"turned",a.isOn?"on":"off"),o.change(t)):r.debugInputs&&console.log("Digital state",o.name,"is already",a.isOn?"on":"off")},a.toggle=function(t){a.isOn=!a.isOn,r.debugInputs&&console.log("Digital state",o.name,"toggled to",a.isOn?"on":"off"),o.change(t)},a}},9810:()=>{!function(){let t;window.frag.hitTest=function(e,n,r,o,a){const i=window.frag,s=i.gl;if(r=r||i.canvas.clientWidth,o=o||i.canvas.clientHeight,a=a||i.getMainScene(),!t){t={name:"HitTest",attributes:{},uniforms:{},is3d:!0};const e="attribute vec4 a_position;\nuniform mat4 u_clipMatrix;\nvoid main() {;\n  gl_Position = u_clipMatrix * a_position;\n}",n="precision mediump float;\nuniform vec4 u_color;\nvoid main() {;\n  gl_FragColor = u_color;\n}",r=i.createShader(t.name,s.VERTEX_SHADER,e),o=i.createShader(t.name,s.FRAGMENT_SHADER,n);t.program=i.createProgram(t.name,r,o),t.attributes.position=s.getAttribLocation(t.program,"a_position"),t.uniforms.clipMatrix=s.getUniformLocation(t.program,"u_clipMatrix"),t.uniforms.color=s.getUniformLocation(t.program,"u_color"),t.bind=function(e){e.useProgram(t.program)},t.unbind=function(){}}const c=s.createTexture();s.bindTexture(s.TEXTURE_2D,c),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,r,o,0,s.RGBA,s.UNSIGNED_BYTE,null);const l=s.createFramebuffer();s.bindFramebuffer(s.FRAMEBUFFER,l),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,c,0);const u=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,u),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,r,o),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,u),s.viewport(0,0,r,o),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);const f={gl:s,shader:t,isHitTest:!0,sceneObjects:[],models:[]};if(Array.isArray(a))for(let t=0;t<a.length;t++)a[t].adjustToViewport(s),a[t].draw(f);else a.adjustToViewport(s),a.draw(f);const m=new Uint8Array(4);s.readPixels(e,o-n,1,1,s.RGBA,s.UNSIGNED_BYTE,m),s.bindFramebuffer(s.FRAMEBUFFER,null);const d=m[0],g=m[1],h=m[2],v=m[3]|h<<8|(15&g)<<16,p=(240&g)>>4|d<<4;return v<f.models.length&&p<f.sceneObjects.length?{sceneObject:f.sceneObjects[p],model:f.models[v]}:null}}()},7802:()=>{window.frag.InputMethod=function(){const t={inputs:[],enabled:!1},e={__private:t,enable:function(){if(!t.enabled){for(var n=0;n<t.inputs.length;n++)t.inputs[n].enable();t.enabled=!0}return e},disable:function(){if(t.enabled){t.enabled=!1;for(var n=0;n<t.inputs.length;n++)t.inputs[n].disable()}return e},add:function(n){return t.inputs.push(n),t.enabled&&n.enable(),e}};return e}},6237:()=>{window.frag.AssetCatalog=function(t,e){const n=window.frag,r=new Uint8Array([127,127,127,255,0,0,255,0,0,0,0,127,127,255]);e||(e={}),e.diffuse||(e.diffuse=n.Texture().name("default-diffuse-texture").dataFormat(n.gl.RGBA).fromArrayBuffer(0,r.buffer,0,1,1)),e.surface||(e.surface=n.Texture().name("default-surface-texture").dataFormat(n.gl.RGBA).fromArrayBuffer(0,r.buffer,4,1,1)),e.emmissive||(e.emmissive=n.Texture().name("default-emmissive-texture").dataFormat(n.gl.RGB).fromArrayBuffer(0,r.buffer,8,1,1)),e.normal||(e.normal=n.Texture().name("default-normal-map-texture").dataFormat(n.gl.RGB).fromArrayBuffer(0,r.buffer,11,1,1)),t||(t=n.Shader().name("Model").verticiesXYZ().matrix3D().diffuseTexture().directionalLightGrey().compile());const o={defaultTextures:e,fonts:{},materials:{},models:{}},a={__private:o,shader:t,getFont:function(t){var e=o.fonts[t];return e||(e=n.Font().name(t),o.fonts[t]=e),e},getMaterial:function(t){var e=o.materials[t];return e||(e=n.Material().name(t).disposeTextures(!1).setTexture("diffuse",o.defaultTextures.diffuse).setTexture("emmissive",o.defaultTextures.emmissive).setTexture("surface",o.defaultTextures.surface).setTexture("normalMap",o.defaultTextures.normal),o.materials[t]=e),e},getModel:function(t,e){var r=e?void 0:o.models[t];return r||(r=n.Model(a.shader.is3d).name(t).shader(a.shader),e||(o.models[t]=r)),r}};return a}},4583:()=>{window.frag.MaterialLoader=function(){const t=window.frag,e=new Uint32Array([287454020]),n=68===new Uint8Array(e.buffer)[0],r={},o={__private:r,littleEndian:n};return r.loadMipV1=function(e,r,o,a,i,s,c,l){const u=e.getUint8(r++),f=e.getUint32(r,n);t.debugMaterialLoader&&console.log("Color data at "+f),r+=4;const m=t.Texture().dataFormat(1==(1&u)?t.gl.RGBA:t.gl.RGB).fromArrayBuffer(s,o,a+f,c,l);if(i.setTexture("diffuse",m),2==(2&u)){const u=e.getUint32(r,n);t.debugMaterialLoader&&console.log("Surface data at "+u),r+=4;const f=t.Texture().dataFormat(t.gl.RGBA).fromArrayBuffer(s,o,a+u,c,l);i.setTexture("surface",f)}if(4==(4&u)){const u=e.getUint32(r,n);t.debugMaterialLoader&&console.log("Normal map at "+u),r+=4;const f=t.Texture().dataFormat(t.gl.RGB).fromArrayBuffer(s,o,a+u,c,l);i.setTexture("normalMap",f)}if(8==(8&u)){const u=e.getUint32(r,n);t.debugMaterialLoader&&console.log("PBR data at "+u),r+=4;const f=t.Texture().dataFormat(t.gl.RGBA).fromArrayBuffer(s,o,a+u,c,l);i.setTexture("pbr",f)}return r},r.loadMaterialV1=function(e,n,o,a,i){const s=n.getUint8(o++);var c="";for(let t=0;t<s;t++)c+=String.fromCharCode(n.getUint8(o++));const l=e.getMaterial(c);t.debugMaterialLoader&&(console.log(""),console.log("Loading "+c+" material textures"));var u,f=1<<n.getUint8(o++),m=f,d=0;do{u=n.getUint8(o++),t.debugMaterialLoader&&console.log("Loading MIP level "+u+" at "+f+" x "+m+" pixels"),u!==d&&console.error("Mip levels are wrong for "+c+" texture"),o=r.loadMipV1(n,o,a,i,l,u,f,m),d++,f>>>=1,m>>>=1}while(0!==u)},o.loadMaterialsFromBuffer=function(e,o){o||(o=t.AssetCatalog());const a=new Uint8Array(e),i=new DataView(e,0,a.length),s=a[0],c=i.getUint16(2,n);var l=4;const u=l+c;if(t.debugMaterialLoader&&console.log("Material pack V"+s+" is "+a.length+" bytes with "+c+" header bytes"),1===s)for(var f=i.getUint16(l,n);0!==f;)r.loadMaterialV1(o,i,l+2,e,u),l+=f,f=i.getUint16(l,n);else console.error("Version "+s+" texture packs are not supported");return o},o.loadMaterialsFromUrl=function(t,e,n){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=function(){4==this.readyState&&200==this.status&&(e=o.loadMaterialsFromBuffer(this.response,e),n&&n(e))},r.open("GET",t,!0),r.send()},o}()},956:()=>{window.frag.PackageLoader=function(){const t=window.frag,e=new Uint32Array([287454020]),n=68===new Uint8Array(e.buffer)[0],r=function(t){return Math.round(1e4*t)/1e4},o={},a={__private:o,littleEndian:n};return o.loadFontV1=function(e,r,o){const a=e.header.getUint8(o++);var i="";for(let t=0;t<a;t++)i+=String.fromCharCode(e.header.getUint8(o++));const s=e.assetCatalog.getFont(i);t.debugPackageLoader&&console.log("Object["+r+"] is font "+i);const c=e.header.getUint8(o++);var l="";for(let t=0;t<c;t++)l+=String.fromCharCode(e.header.getUint8(o++));const u=e.header.getUint16(o,n),f=e.header.getUint16(o+2,n),m=e.header.getUint16(o+4,n),d=e.header.getUint16(o+6,n);o+=8,t.debugPackageLoader&&console.log("  "+f+"x"+m+" pixel texture contains "+d+" characters from "+u+"px "+l),s.lineHeight(u);for(let t=0;t<d;t++){const t=e.header.getUint8(o++);var g="";for(let n=0;n<t;n++)g+=String.fromCharCode(e.header.getUint8(o++));const r=e.header.getUint16(o+0,n),a=e.header.getUint16(o+2,n),i=e.header.getUint16(o+4,n),c=e.header.getUint16(o+6,n),l=e.header.getInt16(o+8,n),u=e.header.getInt16(o+10,n),f=e.header.getInt16(o+12,n);o+=14,s.addChar(g,r,a,i,c,l,u,f)}const h=e.header.getUint8(o++);var v="";for(let t=0;t<h;t++)v+=String.fromCharCode(e.header.getUint8(o++));"RGB"===v?s.dataFormat(t.gl.RGB):"RGBA"===v?s.dataFormat(t.gl.RGBA):"L"===v?s.dataFormat(t.gl.LUMINANCE):console.error("Font "+i+" unsupported mode "+v);const p=e.header.getUint16(o+0,n),x=e.header.getUint16(o+2,n);let T=e.header.getUint32(o+4,n)+e.dataOffset;o+=8,p!==f&&console.error("Font "+i+" width does not match image width"),x!==m&&console.error("Font "+i+" height does not match image height");const b=new Uint8Array(e.data,T);return s.fromArrayBuffer(b,0,f,m),s},o.loadMaterialV1=function(e,n,r){const o=e.header.getUint8(r++);var a="";for(let t=0;t<o;t++)a+=String.fromCharCode(e.header.getUint8(r++));const i=e.assetCatalog.getMaterial(a);return t.debugPackageLoader&&console.log("Object["+n+"] is material "+a),i},o.loadMeshV1=function(e,o,a){const i=t.MeshData(),s=e.header.getUint16(a,n);a+=2,t.debugPackageLoader&&console.log("Object["+o+"] is a mesh with "+s+" fragments");for(let o=0;o<s;o++){const s=e.header.getUint8(a),l=e.header.getUint8(a+1),u=e.header.getUint8(a+2),f=e.header.getUint8(a+3),m=e.header.getUint8(a+4),d=e.header.getUint8(a+5),g=e.header.getUint8(a+6),h=e.header.getUint32(a+7,n),v=e.header.getUint32(a+11,n);let p=e.header.getUint32(a+15,n)+e.dataOffset;a+=19;const x=1==(1&l),T=2==(2&l);let b=0;if(1===s?b=h/3:2===s?b=h/2:(3===s||4===s)&&(b=h-2),t.debugPackageLoader){let t="  fragment["+o+"] has "+h+" verticies forming ";switch(1===s?t+=b+" triangles":2===s?t+=b/2+" rectangles":3===s?t+="a strip of "+b+"triangles":4===s&&(t+="a fan of "+b+" triangles"),x&&(t+=" indexed"),T||(t+=" in 2D"),u){case 1:t+=" with custom normals";break;case 2:t+=" with indexed normals";break;case 3:t+=" with triangle normals"}switch(f){case 1:t+=" with custom tangents";break;case 2:t+=" with indexed tangents";break;case 3:t+=" with triangle tangents";break;case 4:t+=" with single tangent"}switch(m){case 1:t+=" with bitangents"}switch(d){case 1:t+=" with custom uvs";break;case 2:t+=" with indexed uvs";break;case 3:t+=" with triangle uvs"}switch(g){case 1:t+=" with custom colors";break;case 2:t+=" with custom colors and transparency";break;case 3:t+=" with indexed colors";break;case 4:t+=" with indexed colors and transparency"}console.log(t)}const w=x?[]:void 0;if(x){indexArray=new Int16Array(e.data,p);for(let t=0;t<h;t++)w.push(indexArray[t]);p+=2*h,1==(1&h)&&(p+=2)}const D=[],_=0===u?void 0:[],E=0===f?void 0:[],S=0===m?void 0:[],A=0===d?void 0:[],y=void 0,F=new Float32Array(e.data,p);for(let t=0;t<h;t++){let e=x?w[t]:t,n=Math.trunc(t/3);2===s?n=Math.trunc(t/4):3!==s&&4!==s||(n=t<3?0:t-2);let r=0,o=T?3*e:2*e;switch(D.push(F[o]),D.push(F[o+1]),T?(D.push(F[o+2]),r+=3*v):r+=2*v,u){case 1:o=r+3*t,r+=3*h;break;case 2:o=r+3*e,r+=3*v;break;case 3:o=r+3*n,r+=3*b}0!==u&&(_.push(F[o]),_.push(F[o+1]),_.push(F[o+2]))}if(t.debugPackageLoader&&t.debugMeshes){let t="  vertices[";for(var c=0;c<D.length;c++)c>0&&(t+=", "),t+=r(D[c]);t+="]",console.log(t)}const M=t.VertexData();1===s||2===s?T?M.setTriangles(D,y,A,_,E,S):M.setTriangles2D(D,y,A,_,E,S):3===s?M.setTriangleStrip(D,y,A,_,E,S):4===s&&M.setTriangleFan(D,y,A,_,E,S),i.addVertexData(M)}return i},o.loadAnimationV1=function(e,o,a){const i=e.header.getUint8(a++);var s="";for(let t=0;t<i;t++)s+=String.fromCharCode(e.header.getUint8(a++));const c=e.header.getUint8(a),l=e.header.getUint16(a+1,n),u=e.header.getUint16(a+3,n),f=e.header.getUint8(a+5);a+=6;const m=1==(1&c),d=2==(2&c);if(t.debugPackageLoader){let t="Object["+o+"] is '"+s+"' animation which runs for "+l+"x"+u+" ms";m&&(t+=". Repeats until stopped"),d&&(t+=". Plays in reverse after playing forwards"),console.log(t)}const g=t.ModelAnimation().name(s).loop(m).frames(l).interval(u/window.frag.gameTickMs);for(let o=0;o<f;o++){const o=e.header.getUint8(a++);var h="";for(let t=0;t<o;t++)h+=String.fromCharCode(e.header.getUint8(a++));const i=e.header.getUint8(a++);var v="";for(let t=0;t<i;t++)v+=String.fromCharCode(e.header.getUint8(a++));t.debugPackageLoader&&t.debugAnimations&&(msg="  Channel "+v+" applies to "+h+" children",console.log(msg));const s={},c=e.header.getUint16(a,n);a+=2;for(let o=0;o<c;o++){const o=e.header.getUint16(a,n),i=e.header.getUint8(a+2),c=e.header.getFloat32(a+3,n);a+=7;var p="step";1===i?p="linear":2===i&&(p="spline"),s[o]={value:c,transition:p},t.debugPackageLoader&&t.debugAnimations&&(msg="    Keyframe["+o+"] = "+r(c)+" "+p,console.log(msg))}g.addChannel({channel:v,pattern:new RegExp(h,"i"),keyframes:s})}return g},o.loadModelV1=function(e,o,a){const i=e.header.getUint8(a++);var s="";for(let t=0;t<i;t++)s+=String.fromCharCode(e.header.getUint8(a++));const c=e.header.getUint8(a),l=e.header.getUint16(a+1,n),u=e.header.getUint16(a+3,n);a+=5;const f=t.Location(!0);f.translateX=e.header.getFloat32(a+0,n),f.translateY=e.header.getFloat32(a+4,n),f.translateZ=e.header.getFloat32(a+8,n),f.rotateX=e.header.getFloat32(a+12,n),f.rotateY=e.header.getFloat32(a+16,n),f.rotateZ=e.header.getFloat32(a+20,n),f.scaleX=e.header.getFloat32(a+24,n),f.scaleY=e.header.getFloat32(a+28,n),f.scaleZ=e.header.getFloat32(a+32,n),f.isModified=!0,a+=36;const m=e.header.getUint16(a,n),d=e.header.getUint16(a+2,n);a+=4;const g=1==(1&c),h=2==(2&c),v=4==(4&c);t.debugPackageLoader&&(console.log("Object["+o+"] is "+(g?"root ":"")+"model "+s+" with "+m+" children and "+d+" animations."+(v?" Paint mesh "+u:" No mesh")+(h?" with material "+l:". No material")),console.log("Object["+o+"] at ("+r(f.translateX)+","+r(f.translateY)+","+r(f.translateZ)+").["+r(f.rotateX)+","+r(f.rotateY)+","+r(f.rotateZ)+"]x("+r(f.scaleX)+","+r(f.scaleY)+","+r(f.scaleZ)+")"));const p=e.assetCatalog.getModel(s,!g);p.location=f,h&&p.material(e.materials[l]),v&&p.mesh(e.meshes[u]);for(let t=0;t<m;t++){const t=e.header.getUint16(a,n);a+=2,p.addChild(e.models[t])}if(g){t.debugAnimations&&d>0&&console.log("Model #"+o+" '"+s+"' has "+d+" animations");for(let r=0;r<d;r++){const r=e.header.getUint16(a,n);a+=2;const o=e.animations[r];if(t.debugAnimations){const t=o.getChannelGraphs();console.log("  Animation '"+o.getName()+"' has "+t.length+" channels."+(o.__private.loop?" Loop ":"")+o.__private.frames+"x"+o.__private.interval+" frames");for(let e=0;e<t.length;e++)console.log("    Animates "+t[e].channel+" for children matching "+t[e].pattern)}p.addAnimation(o)}}else d>0&&console.warn("Model #"+o+" '"+s+"' has "+d+" animations but is not a root");return p},a.loadFromBuffer=function(e,r){r||(r=t.AssetCatalog());const a=new Uint8Array(e),i=new DataView(e,0,a.length),s=a[0],c=i.getUint32(4,n);var l=8;const u=l+c;t.debugPackageLoader&&console.log("Asset pack V"+s+" is "+a.length+" bytes with "+c+" header bytes");const f={assetCatalog:r,header:i,data:e,dataOffset:u,materials:{},meshes:{},animations:{},models:{},fonts:{}};if(1===s)for(var m=i.getUint16(l,n),d=0;0!==m;){const t=i.getUint16(l+2,n),e=i.getUint8(l+4),r=l+5;if(t!==d++)return void console.error("Object indexes are not consecutive");if(0===e)break;1===e?f.materials[t]=o.loadMaterialV1(f,t,r):2===e?f.meshes[t]=o.loadMeshV1(f,t,r):3===e?f.animations[t]=o.loadAnimationV1(f,t,r):4===e?f.models[t]=o.loadModelV1(f,t,r):5===e?f.fonts[t]=o.loadFontV1(f,t,r):console.error("Unknown object type "+e),l+=m,m=i.getUint16(l,n)}else console.error("Version "+s+" asset packs are not supported");return r},a.loadFromUrl=function(t,e,n){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=function(){4==this.readyState&&200==this.status&&(e=a.loadFromBuffer(this.response,e),n&&n(e))},r.open("GET",t,!0),r.send()},a}()},2636:()=>{window.frag.Font=function(){const t=window.frag,e=t.gl,n={glTexture:null,generated:!1,internalFormat:e.RGBA,format:e.RGBA,dataType:e.UNSIGNED_BYTE,valuesPerPixel:4,chars:{},lineHeight:24,color:[0,0,0,1]},r={__private:n,textureUnit:window.frag.allocateTextureUnit(),dispose:function(){n.glTexture&&(e.deleteTexture(n.glTexture),n.glTexture=null,n.disposed=!0)},name:function(t){return n.name=t,r},color:function(t){n.color=t},dataFormat:function(t){return n.internalFormat=t,n.format=t,t===e.RGBA?(n.dataType=e.UNSIGNED_BYTE,n.valuesPerPixel=4):t===e.RGB?(n.dataType=e.UNSIGNED_BYTE,n.valuesPerPixel=3):t===e.LUMINANCE_ALPHA?(n.dataType=e.UNSIGNED_BYTE,n.valuesPerPixel=2):t!==e.LUMINANCE&&formaat!==e.ALPHA||(n.dataType=e.UNSIGNED_BYTE,n.valuesPerPixel=1),r}};return n.setup=function(t,r){n.width=t,n.height=r,n.glTexture||(n.glTexture=e.createTexture()),e.bindTexture(e.TEXTURE_2D,n.glTexture),0==(t&t-1)&&0==(r&r-1)||(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),n.generated=!0)},r.lineHeight=function(t){n.lineHeight=t},r.addChar=function(t,e,r,o,a,i,s,c){n.chars[t]={x:e,y:r,width:o,height:a,originX:i,originY:s,advance:c}},r.fromArrayBuffer=function(t,o,a,i){let s;return n.dataType===e.UNSIGNED_BYTE&&(s=new Uint8Array(t,o,a*i*n.valuesPerPixel)),n.setup(a,i),e.texImage2D(e.TEXTURE_2D,0,n.internalFormat,a,i,0,n.format,n.dataType,s),r},r.fromImage=function(t){const o=function(){n.setup(t.width,t.height),e.texImage2D(e.TEXTURE_2D,0,n.internalFormat,n.format,n.dataType,t)};return t.onload?o():t.onload=o,r},r.apply=function(t,e){void 0!==e.uniforms.color&&t["uniform"+n.color.length+"fv"](e.uniforms.color,n.color);const o=e.uniforms.diffuse;return o&&n.glTexture?(t.activeTexture(t.TEXTURE0+r.textureUnit),t.bindTexture(t.TEXTURE_2D,n.glTexture),n.generated||(t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),n.generated=!0),t.uniform1i(o,r.textureUnit),r):r},r.buildTextMesh=function(e){const r=[],o=[],a=[],i=function(t,e){if(dimensions=n.chars[t],!dimensions)return e;const i=e-dimensions.originX,s=i+dimensions.width,c=dimensions.originY;!function(t,e,n,o){r.push(t),r.push(o),r.push(0),r.push(e),r.push(n),r.push(0),r.push(t),r.push(n),r.push(0),r.push(t),r.push(o),r.push(0),r.push(e),r.push(o),r.push(0),r.push(e),r.push(n),r.push(0);for(let t=0;t<6;t++)a.push(0),a.push(0),a.push(-1)}(i,s,c,c-dimensions.height);const l=dimensions.x,u=n.height-dimensions.y;return function(t,e,r,a){t/=n.width,e/=n.width,r/=n.height,a/=n.height,o.push(t),o.push(a),o.push(e),o.push(r),o.push(t),o.push(r),o.push(t),o.push(a),o.push(e),o.push(a),o.push(e),o.push(r)}(l,l+dimensions.width,u,u-dimensions.height),e+dimensions.advance};let s=0;for(let t=0;t<e.length;t++)s=i(e[t],s);return t.MeshData().addTriangles(r,void 0,o,a).shadeFlat().textureFlat()},r.buildTextModel=function(e){const n=r.buildTextMesh(e);return t.Model(!0).shader(t.fontShader).mesh(n).material(r)},r.updateTextModel=function(t,e){const n=t.getMesh();return t.mesh(r.buildTextMesh(e)),n.dispose(),r},r}},4655:()=>{window.frag.Material=function(){const t={textures:{},disposeTextures:!1},e={__private:t,dispose:function(){if(t.disposeTextures)for(let e in t.textures){const n=t.textures[e];n&&n.dispose()}t.textures={}},disposeTextures:function(n){return t.disposeTextures=n,e},name:function(n){return t.name=n,e},setTexture:function(n,r){if(t.disposeTextures){const e=t.textures[n];e&&e.dispose()}return t.textures[n]=r,e},apply:function(n,r){for(let e in t.textures){const o=t.textures[e];o&&o.apply(e,n,r)}return e}};return e}},8394:()=>{window.frag.Texture=function(){const t=window.frag.gl,e={glTexture:null,generated:!1,internalFormat:t.RGBA,format:t.RGBA,dataType:t.UNSIGNED_BYTE,valuesPerPixel:4},n={__private:e,textureUnit:window.frag.allocateTextureUnit(),dispose:function(){e.glTexture&&(t.deleteTexture(e.glTexture),e.glTexture=null,e.disposed=!0)},name:function(t){return e.name=t,n},dataFormat:function(r){return e.internalFormat=r,e.format=r,r===t.RGBA?(e.dataType=t.UNSIGNED_BYTE,e.valuesPerPixel=4):r===t.RGB?(e.dataType=t.UNSIGNED_BYTE,e.valuesPerPixel=3):r===t.LUMINANCE_ALPHA?(e.dataType=t.UNSIGNED_BYTE,e.valuesPerPixel=2):r!==t.LUMINANCE&&formaat!==t.ALPHA||(e.dataType=t.UNSIGNED_BYTE,e.valuesPerPixel=1),n}};return e.setup=function(n,r){e.width=n,e.height=r,e.glTexture||(e.glTexture=t.createTexture()),t.bindTexture(t.TEXTURE_2D,e.glTexture),0==(n&n-1)&&0==(r&r-1)||(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),e.generated=!0)},n.fromArrayBuffer=function(r,o,a,i,s){let c;return e.dataType===t.UNSIGNED_BYTE&&(c=new Uint8Array(o,a,i*s*e.valuesPerPixel)),e.setup(i,s),t.texImage2D(t.TEXTURE_2D,r,e.internalFormat,i,s,0,e.format,e.dataType,c),n},n.fromImage=function(r,o){const a=function(){e.setup(o.width,o.height),t.texImage2D(t.TEXTURE_2D,r,e.internalFormat,e.format,e.dataType,o)};return o.onload?a():o.onload=a,n},n.fromUrl=function(t,e,r){const o=new Image;return n.fromImage(t,o),void 0!==r&&(o.crossOrigin=r),o.src=e,n},n.update=function(t,r){const o=window.frag.gl;return e.scene&&(void 0!==t&&void 0!==r&&(t===e.width&&r===e.height||n.fromScene(e.scene,t,r)),o.bindFramebuffer(o.FRAMEBUFFER,e.frameBuffer),o.viewport(0,0,e.width,e.height),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),e.scene.adjustToViewport(o),e.scene.draw({gl:o})),n},n.fromScene=function(t,r,o){const a=window.frag.gl;return e.setup(r,o),a.texImage2D(a.TEXTURE_2D,0,e.internalFormat,r,o,0,e.format,e.dataType,null),e.scene=t,e.frameBuffer=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,e.frameBuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e.glTexture,0),e.depthBuffer=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,e.depthBuffer),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,r,o),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e.depthBuffer),n.update(r,o)},n.apply=function(t,r,o){const a=o.uniforms[t];return a&&e.glTexture?(r.activeTexture(r.TEXTURE0+n.textureUnit),r.bindTexture(r.TEXTURE_2D,e.glTexture),e.generated||(r.generateMipmap(r.TEXTURE_2D),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),e.generated=!0),r.uniform1i(a,n.textureUnit),n):n},n}},7996:()=>{window.frag=window.frag||{},window.frag.Matrix={m3Identity:function(){return[1,0,0,0,1,0,0,0,1]},m3Invert:function(t){return t},m3Transpose:function(t){return[t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]]},m3Xm3:function(t,e){const n=t[0],r=t[1],o=t[2],a=t[3],i=t[4],s=t[5],c=t[6],l=t[7],u=t[8],f=e[0],m=e[1],d=e[2],g=e[3],h=e[4],v=e[5],p=e[6],x=e[7],T=e[8];return[f*n+m*a+d*c,f*r+m*i+d*l,f*o+m*s+d*u,g*n+h*a+v*c,g*r+h*i+v*l,g*o+h*s+v*u,p*n+x*a+T*c,p*r+x*i+T*l,p*o+x*s+T*u]},m3Xv3:function(t,e){const n=t[0],r=t[1],o=t[2],a=t[3],i=t[4],s=t[5],c=t[6],l=t[7],u=t[8],f=e[0],m=e[1],d=e[2];return[f*n+m*a+d*c,f*r+m*i+d*l,f*o+m*s+d*u]},m4Identity:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},m4Invert:function(t){return[t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10],t[3],t[7],t[11]]},m4Transpose:function(t){return[t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]},m4Xm4:function(t,e){const n=t[0],r=t[1],o=t[2],a=t[3],i=t[4],s=t[5],c=t[6],l=t[7],u=t[8],f=t[9],m=t[10],d=t[11],g=t[12],h=t[13],v=t[14],p=t[15],x=e[0],T=e[1],b=e[2],w=e[3],D=e[4],_=e[5],E=e[6],S=e[7],A=e[8],y=e[9],F=e[10],M=e[11],L=e[12],R=e[13],V=e[14],U=e[15];return[x*n+T*i+b*u+w*g,x*r+T*s+b*f+w*h,x*o+T*c+b*m+w*v,x*a+T*l+b*d+w*p,D*n+_*i+E*u+S*g,D*r+_*s+E*f+S*h,D*o+_*c+E*m+S*v,D*a+_*l+E*d+S*p,A*n+y*i+F*u+M*g,A*r+y*s+F*f+M*h,A*o+y*c+F*m+M*v,A*a+y*l+F*d+M*p,L*n+R*i+V*u+U*g,L*r+R*s+V*f+U*h,L*o+R*c+V*m+U*v,L*a+R*l+V*d+U*p]},m4Xv4:function(t,e){const n=t[0],r=t[1],o=t[2],a=t[3],i=t[4],s=t[5],c=t[6],l=t[7],u=t[8],f=t[9],m=t[10],d=t[11],g=t[12],h=t[13],v=t[14],p=t[15],x=e[0],T=e[1],b=e[2],w=e[3];return[x*n+T*i+b*u+w*g,x*r+T*s+b*f+w*h,x*o+T*c+b*m+w*v,x*a+T*l+b*d+w*p]}}},8197:()=>{window.frag=window.frag||{},window.frag.Triangle={makeTriangleFromVectors:function(t,e,n){return{a:t,b:e,c:n}},makeTriangleFromArray2D:function(t,e,n,r){return t?{a:[t[e],t[e+1]],b:[t[n],t[n+1]],c:[t[r],t[r+1]]}:null},makeTriangleFromArray3D:function(t,e,n,r){return t?{a:[t[e],t[e+1],t[e+2]],b:[t[n],t[n+1],t[n+2]],c:[t[r],t[r+1],t[r+2]]}:null},normal:function(t){const e=window.frag.Vector,n=e.sub(t.a,t.b),r=e.sub(t.c,t.b);return e.normalize(e.cross(n,r))}}},6601:()=>{window.frag=window.frag||{},window.frag.Vector={extract2D:function(t,e){return t?[t[e],t[e+1]]:null},extract3D:function(t,e){return t?[t[e],t[e+1],t[e+2]]:null},zero:function(t){const e=[0,0,0,0,0];return e.length=t,e},add:function(t,e){const n=[];if(Array.isArray(e))for(let r=0;r<t.length;r++)n.push(t[r]+e[r]);else for(let r=0;r<t.length;r++)n.push(t[r]+e);return n},sub:function(t,e){const n=[];if(Array.isArray(e))for(let r=0;r<t.length;r++)n.push(t[r]-e[r]);else for(let r=0;r<t.length;r++)n.push(t[r]-e);return n},mult:function(t,e){const n=[];if(Array.isArray(e))for(let r=0;r<t.length;r++)n.push(t[r]*e[r]);else for(let r=0;r<t.length;r++)n.push(t[r]*e);return n},div:function(t,e){const n=[];if(Array.isArray(e))for(let r=0;r<t.length;r++)n.push(t[r]/e[r]);else for(let r=0;r<t.length;r++)n.push(t[r]/e);return n},length:function(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n]*t[n];return Math.sqrt(e)},average:function(t,e){const n=[];for(let r=0;r<t.length;r++)n.push(.5*(t[r]+e[r]));return n},cross:function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]},dot:function(t,e){let n=0;for(let r=0;r<t.length;r++)n+=t[r]*e[r];return n},normalize:function(t){const e=window.frag.Vector.length(t);if(e<1e-5)return t;const n=[];for(let r=0;r<t.length;r++)n.push(t[r]/e);return n},append:function(t,e){for(let n=0;n<e.length;n++)t.push(e[n])},eulerAngles:function(t,e){const n=window.frag.Vector;e||(e=[0,1,0]);const r=n.normalize(t),o=n.normalize(e),a=Math.asin(r[1]),i=Math.atan2(r[0],r[2]),s=[-r[2],0,r[0]],c=n.cross(s,r);return[Math.atan2(n.dot(s,o),n.dot(c,o)),i,a]}}},1175:()=>{window.frag.MeshData=function(){const t=window.frag,e=t.gl,n={glBuffer:e.createBuffer(),meshFragments:[],debugFragments:[],finalized:!1,fromBuffer:!1,smoothShading:!0,smoothTexture:!1,wireframe:!1,normalLength:0,normalColor:[0,0,255]},r={__private:n,calcNormals:!0,calcTangents:!0,calcBitangents:!1,dispose:function(){n.glBuffer&&(e.deleteBuffer(n.glBuffer),n.glBuffer=null)},name:function(t){return n.name=t,r},clear:function(){return n.meshFragments.length=0,n.finalized=!1,r},shadeSmooth:function(){return n.smoothShading=!0,n.finalized=!1,r},shadeFlat:function(){return n.smoothShading=!1,n.finalized=!1,r},textureSmooth:function(){return n.smoothTexture=!0,n.finalized=!1,r},textureFlat:function(){return n.smoothTexture=!1,n.finalized=!1,r},wireframe:function(t){return n.wireframe=!!t,n.finalized=!1,r},drawNormals:function(t,e){return n.normalLength=t,void 0!==e&&(n.normalColor=e),n.finalized=!1,r}};return n.Fragment=function(t){return{vertexData:t,renderData:null,vertexDataOffset:void 0,colorDataOffset:void 0,uvDataOffset:void 0,normalDataOffset:void 0,tangentDataOffset:void 0,bitangentDataOffset:void 0}},n.addFragment=function(t){return n.meshFragments.push(n.Fragment(t)),n.finalized=!1,r},r.addVertexData=function(t){return n.addFragment(t)},r.addTriangles2D=function(e,r,o,a,i,s){const c=t.VertexData().setTriangles2D(e,r,o,a,i,s);return n.addFragment(c)},r.addTriangles=function(e,r,o,a,i,s){const c=t.VertexData().setTriangles(e,r,o,a,i,s);return n.addFragment(c)},r.addTriangleStrip=function(e,r,o,a,i,s){const c=t.VertexData().setTriangleStrip(e,r,o,a,i,s);return n.addFragment(c)},r.addTriangleFan=function(e,r,o,a,i,s){const c=t.VertexData().setTriangleFan(e,r,o,a,i,s);return n.addFragment(c)},r.fromBuffer=function(o,a,i,s,c,l,u,f,m,d){const g=t.VertexData();g.vertexDimensions=a,g.vertexCount=i,g.primitiveType=s,g.extractTriangles=function(){},n.addFragment(g);const h=n.meshFragments[n.meshFragments.length-1];return h.renderData=g,h.vertexDataOffset=c,h.colorDataOffset=l,h.uvDataOffset=u,h.normalDataOffset=f,h.tangentDataOffset=m,h.bitangentDataOffset=d,e.bindBuffer(e.ARRAY_BUFFER,n.glBuffer),e.bufferData(e.ARRAY_BUFFER,o,e.STATIC_DRAW),n.finalized=!0,n.fromBuffer=!0,r},n.addFragmentDebugInfo=function(e){if(!n.wireframe&&0==n.normalLength)return;let r=e;n.wireframe||(r=n.Fragment(e.vertexData),n.debugFragments.push(r));const o=[],a=[],i=[],s=[],c=function(t){const r=e.renderData.getVertexVector(t),c=e.renderData.getColor(t),l=e.renderData.getUvVector(t),u=e.renderData.getNormalVector(t);r&&r.forEach((t=>o.push(t))),c?c.forEach((t=>a.push(t))):n.normalColor.forEach((()=>a.push(0))),l&&l.forEach((t=>i.push(t))),u&&u.forEach((t=>s.push(t)))},l=function(t){const r=e.renderData.getVertexVector(t),c=e.renderData.getUvVector(t),l=e.renderData.getNormalVector(t);if(r){for(let t=0;t<r.length;t++)o.push(r[t]);for(let t=0;t<r.length;t++)o.push(r[t]+l[t]*n.normalLength)}n.normalColor.forEach((t=>a.push(t))),n.normalColor.forEach((t=>a.push(t))),c&&(c.forEach((t=>i.push(t))),c.forEach((t=>i.push(t)))),l&&(l.forEach((t=>s.push(t))),l.forEach((t=>s.push(t))))};e.vertexData.extractTriangles((function(t,e,r){n.wireframe&&(c(t),c(e),c(e),c(r),c(r),c(t)),n.normalLength>0&&(l(t),l(e),l(e))})),2==e.vertexData.vertexDimensions?r.renderData=t.VertexData().setLines2D(o,a,i,s):r.renderData=t.VertexData().setLines(o,a,i,s)},n.finalize=function(){n.finalized=!0;const o=t.MeshOptimizer().setFragments(n.meshFragments).initialize(n.smoothShading,n.smoothTexture);r.calcTangents&&o.calcTangentsFromUvs(),r.calcBitangents&&o.calcBitangentsFromUvs(),r.calcNormals&&o.calcNormalsFromCross(),r.calcNormals&&o.calcNormalsFromGeometry(),r.calcBitangents&&o.calcBitangentsFromCross(),n.debugFragments=[],n.meshFragments.forEach((t=>{n.addFragmentDebugInfo(t)}));let a=0;const i=function(t){a+=t.renderData.verticies.length,t.renderData.colors&&(a+=t.renderData.colors.length),t.renderData.uvs&&(a+=t.renderData.uvs.length),t.renderData.normals&&(a+=t.renderData.normals.length),t.renderData.tangents&&(a+=t.renderData.tangents.length),t.renderData.bitangents&&(a+=t.renderData.bitangents.length)};n.meshFragments.forEach(i),n.debugFragments.forEach(i);const s=new Float32Array(a);let c=0;const l=function(t){if(!t)return;for(let e=0;e<t.length;e++)s[c+e]=t[e];const e=c;return c+=t.length,e*Float32Array.BYTES_PER_ELEMENT},u=function(t){t.vertexDataOffset=l(t.renderData.verticies),t.colorDataOffset=l(t.renderData.colors),t.uvDataOffset=l(t.renderData.uvs),t.normalDataOffset=l(t.renderData.normals),t.tangentDataOffset=l(t.renderData.tangents),t.bitangentDataOffset=l(t.renderData.bitangents)};return n.meshFragments.forEach(u),n.debugFragments.forEach(u),e.bindBuffer(e.ARRAY_BUFFER,n.glBuffer),e.bufferData(e.ARRAY_BUFFER,s,e.STATIC_DRAW),r},n.drawFragmentPosition=function(t,n){t.attributes.position>=0&&(null!=n.vertexDataOffset?(e.enableVertexAttribArray(t.attributes.position),e.vertexAttribPointer(t.attributes.position,n.renderData.vertexDimensions,e.FLOAT,!1,0,n.vertexDataOffset)):e.disableVertexAttribArray(t.attributes.position))},n.drawFragmentColor=function(t,n){t.attributes.color>=0&&(null!=n.colorDataOffset?(e.enableVertexAttribArray(t.attributes.color),e.vertexAttribPointer(t.attributes.color,n.renderData.colorDimensions,e.FLOAT,!1,0,n.colorDataOffset)):e.disableVertexAttribArray(t.attributes.color))},n.drawFragmentTexture=function(t,n){t.attributes.texture>=0&&(null!=n.uvDataOffset?(e.enableVertexAttribArray(t.attributes.texture),e.vertexAttribPointer(t.attributes.texture,n.renderData.uvDimensions,e.FLOAT,!1,0,n.uvDataOffset)):e.disableVertexAttribArray(t.attributes.texture))},n.drawFragmentNormals=function(t,n){t.attributes.normal>=0&&(null!=n.normalDataOffset?(e.enableVertexAttribArray(t.attributes.normal),e.vertexAttribPointer(t.attributes.normal,n.renderData.normalDimensions,e.FLOAT,!0,0,n.normalDataOffset)):e.disableVertexAttribArray(t.attributes.normal))},n.drawFragmentTangents=function(t,n){t.attributes.tangent>=0&&(null!=n.tangentDataOffset?(e.enableVertexAttribArray(t.attributes.tangent),e.vertexAttribPointer(t.attributes.tangent,n.renderData.normalDimensions,e.FLOAT,!0,0,n.tangentDataOffset)):e.disableVertexAttribArray(t.attributes.tangent))},n.drawFragmentBitangents=function(t,n){t.attributes.bitangent>=0&&(null!=n.bitangentDataOffset?(e.enableVertexAttribArray(t.attributes.bitangent),e.vertexAttribPointer(t.attributes.bitangent,n.renderData.normalDimensions,e.FLOAT,!0,0,n.bitangentDataOffset)):e.disableVertexAttribArray(t.attributes.bitangent))},n.drawFragment=function(t,r){n.drawFragmentPosition(t,r),n.drawFragmentColor(t,r),n.drawFragmentTexture(t,r),n.drawFragmentNormals(t,r),n.drawFragmentTangents(t,r),n.drawFragmentBitangents(t,r),e.drawArrays(r.renderData.primitiveType,0,r.renderData.vertexCount)},r.draw=function(t,e){n.finalized||n.fromBuffer||n.finalize(),t.bindBuffer(t.ARRAY_BUFFER,n.glBuffer);for(let t=0;t<n.meshFragments.length;t++){const r=n.meshFragments[t];n.drawFragment(e,r)}for(let t=0;t<n.debugFragments.length;t++){const r=n.debugFragments[t];n.drawFragment(e,r)}return r},r}},1003:()=>{window.frag.MeshOptimizer=function(){const t=window.frag,e={meshFragments:null,smoothShading:!0,smoothTexture:!1,fragmentTriangles:null,groups:null,groupIndecies:null},n={__private:e};return e.ensureTriangles=function(){e.fragmentTriangles||(e.fragmentTriangles=[],e.meshFragments.forEach((n=>{const r=n.vertexData,o={triangles:[],vertexTriangleIndecies:[]};o.vertexTriangleIndecies.length=r.vertexCount,r.verticies&&r.extractTriangles((function(e,n,a){const i=r.getVertexVector(e),s=r.getVertexVector(n),c=r.getVertexVector(a),l={triangle:t.Triangle.makeTriangleFromVectors(i,s,c),normal:null,tangent:null,bitangent:null};if(l.normal=t.Triangle.normal(l.triangle),r.uvs){const o=r.getUvVector(e),u=r.getUvVector(n),f=r.getUvVector(a),m=t.Vector.sub(s,i),d=t.Vector.sub(c,i),g=t.Vector.sub(u,o),h=t.Vector.sub(f,o),v=g[0]*h[1]-g[1]*h[0];if(0===v)l.tangent=t.Vector.zero(r.normalDimensions),l.bitangent=t.Vector.zero(r.normalDimensions);else{const e=1/v;l.tangent=t.Vector.normalize(t.Vector.mult(t.Vector.sub(t.Vector.mult(m,h[1]),t.Vector.mult(d,g[1])),e)),l.bitangent=t.Vector.normalize(t.Vector.mult(t.Vector.sub(t.Vector.mult(d,g[0]),t.Vector.mult(m,h[0])),e))}}o.triangles.push(l);const u=o.triangles.length-1;o.vertexTriangleIndecies[e]=u,o.vertexTriangleIndecies[n]=u,o.vertexTriangleIndecies[a]=u})),e.fragmentTriangles.push(o)})))},e.ensureGroups=function(){if(e.groups)return;e.groups=[],e.groupIndecies={};const n=function(t,e,n){if(t.vertexDimensions!==n.length)return!1;const r=t.vertexIndex(e);for(var o=0;o<n.length;o++)if(Math.abs(t.verticies[r+o]-n[o])>1e-5)return!1;return!0};for(let o=0;o<e.meshFragments.length;o++){const a=e.meshFragments[o],i=e.groupIndecies[o]||[];if(e.groupIndecies[o]=i,a.vertexData.verticies)for(let s=0;s<a.vertexData.vertexCount;s++){let c=!1;for(var r=0;!c&&r<e.groups.length;r++){const t=e.groups[r];n(a.vertexData,s,t.vertex)&&(t.fragmentIndecies[o]=t.fragmentIndecies[o]||[],t.fragmentIndecies[o].push(s),i.push(r),c=!0)}if(!c){i.push(e.groups.length);const n={vertex:a.vertexData.getVertexVector(s),fragmentIndecies:{},normal:t.Vector.zero(a.vertexData.normalDimensions),uv:t.Vector.zero(a.vertexData.uvDimensions)};n.fragmentIndecies[o]=[s],e.groups.push(n)}}}},e.calcGroupNormals=function(){e.ensureGroups();for(let n=0;n<e.groups.length;n++){const r=e.groups[n];r.normal=t.Vector.zero(e.meshFragments[0].renderData.normalDimensions);for(const n in r.fragmentIndecies){const o=e.meshFragments[n],a=o.renderData?o.renderData:o.vertexData;if(a&&a.normals){const e=r.fragmentIndecies[n];for(let n=0;n<e.length;n++){const o=e[n],i=a.getNormalVector(o);r.normal=t.Vector.add(r.normal,i)}}}r.normal=t.Vector.normalize(r.normal)}},e.calcGroupUvs=function(){e.ensureGroups();for(let t=0;t<e.groups.length;t++){const n=e.groups[t];for(const t in n.fragmentIndecies){const r=e.meshFragments[t],o=r.renderData?r.renderData:r.vertexData;if(o){const e=n.fragmentIndecies[t];if(e.length>0){const t=e[0];n.uv=o.getUvVector(t)}}}}},e.calcSmoothShading=function(){for(let t=0;t<e.meshFragments.length;t++)if(!e.meshFragments[t].renderData.normals)return;e.calcGroupNormals();for(let r=0;r<e.meshFragments.length;r++){const o=e.meshFragments[r].renderData,a=e.groupIndecies[r];if(a.length){o.normals=[];for(var t=0;t<o.vertexCount;t++){const r=e.groups[a[t]];for(var n=0;n<o.normalDimensions;n++)o.normals.push(r.normal[n])}}}},e.calcSmoothTexture=function(){e.calcGroupUvs();for(let r=0;r<e.meshFragments.length;r++){const o=e.meshFragments[r].renderData,a=e.groupIndecies[r];if(a.length){o.uvs=[];for(var t=0;t<o.vertexCount;t++){const r=e.groups[a[t]];for(var n=0;n<o.uvDimensions;n++)o.uvs.push(r.uv[n])}}}},n.setFragments=function(t){return e.meshFragments=t,n},n.initialize=function(t,r){return e.smoothShading=t,e.smoothTexture=r,e.meshFragments.forEach((t=>{t.renderData=t.vertexData.clone()})),r&&e.calcSmoothTexture(),n},n.calcTangentsFromUvs=function(){for(let n=0;n<e.meshFragments.length;n++){const r=e.meshFragments[n],o=r.renderData,a=r.vertexData;if(!o.tangents)if(a.tangents){o.tangents=[];for(let e=0;e<a.vertexCount;e++)for(var t=0;t<a.normalDimensions;t++)o.tangents.push(a.tangents[a.tangentIndex(e,t)])}else if(o.uvs){e.ensureTriangles();const t=e.fragmentTriangles[n];if(t&&t.triangles){o.tangents=[],o.tangents.length=o.normalDimensions*o.vertexCount;for(let e=0;e<o.vertexCount;e++){const n=t.vertexTriangleIndecies[e],r=t.triangles[n];r&&o.setTangentVector(e,r.tangent)}}}}return n},n.calcBitangentsFromUvs=function(){for(let n=0;n<e.meshFragments.length;n++){const r=e.meshFragments[n],o=r.renderData,a=r.vertexData;if(!o.bitangents)if(a.bitangents){o.bitangents=[];for(let e=0;e<a.vertexCount;e++)for(var t=0;t<a.normalDimensions;t++)o.bitangents.push(a.bitangents[a.bitangentIndex(e,t)])}else if(o.uvs){e.ensureTriangles();const t=e.fragmentTriangles[n];if(t&&t.triangles){o.bitangents=[],o.bitangents.length=o.normalDimensions*o.vertexCount;for(let e=0;e<o.vertexCount;e++){const n=t.vertexTriangleIndecies[e],r=t.triangles[n];r&&o.setBitangentVector(e,r.bitangent)}}}}return n},n.calcNormalsFromCross=function(){for(let n=0;n<e.meshFragments.length;n++){const o=e.meshFragments[n],a=o.renderData,i=o.vertexData;if(!a.normals)if(i.normals){a.normals=[];for(let t=0;t<i.vertexCount;t++)for(var r=0;r<i.normalDimensions;r++)a.normals.push(i.normals[i.normalIndex(t,r)])}else if(a.tangents&&a.bitangents){a.normals=[];for(let e=0;e<i.vertexCount;e++){const n=a.getTangentVector(e),o=a.getBitangentVector(e),i=t.Vector.cross(n,o);for(r=0;r<i.length;r++)a.normals.push(i[r])}}}return e.smoothShading&&e.calcSmoothShading(),n},n.calcNormalsFromGeometry=function(){for(let n=0;n<e.meshFragments.length;n++){const r=e.meshFragments[n],o=r.renderData,a=r.vertexData;if(!o.normals)if(a.normals){o.normals=[];for(let e=0;e<a.vertexCount;e++)for(var t=0;t<a.normalDimensions;t++)o.normals.push(a.normals[a.normalIndex(e,t)])}else{e.ensureTriangles();const t=e.fragmentTriangles[n];if(t&&t.triangles){o.normals=[],o.normals.length=o.normalDimensions*o.vertexCount;for(let e=0;e<o.vertexCount;e++){const n=t.vertexTriangleIndecies[e],r=t.triangles[n];r&&o.setNormalVector(e,r.normal)}}}}return e.smoothShading&&e.calcSmoothShading(),n},n.calcBitangentsFromCross=function(){for(let n=0;n<e.meshFragments.length;n++){const o=e.meshFragments[n],a=o.renderData,i=o.vertexData;if(!a.bitangents)if(i.bitangents){a.bitangents=[];for(let t=0;t<i.vertexCount;t++)for(var r=0;r<i.normalDimensions;r++)a.bitangents.push(i.bitangents[i.bitangentIndex(t,r)])}else if(a.tangents&&a.normals){a.bitangents=[];for(let e=0;e<i.vertexCount;e++){const n=a.getNormalVector(e),o=a.getTangentVector(e),i=t.Vector.cross(n,o);for(r=0;r<i.length;r++)a.bitangents.push(i[r])}}}return n},n}},2816:()=>{window.frag.Model=function(t,e){const n=window.frag;void 0===t&&(t=!e||!e.location||e.location.is3d);const r={name:null,parent:e,children:[],meshData:null,shader:null,material:null,enabled:!0},o={__private:r,location:n.Location(t),animations:[],dispose:function(){},addFlattenedChildren:function(t,e){for(let n=0;n<r.children.length;n++){let o=r.children[n];e(o)&&t.push(o),o.addFlattenedChildren(t,e)}},getPosition:function(){return n.ScenePosition(o.location)},name:function(t){return r.name=t,o},getName:function(){return r.name},shader:function(t){if(t.is3d!==o.location.is3d){const t=o.location.is3d?"3D":"2D";console.error("Model '"+r.name+"' has a "+t+" location and must use a "+t+" shader")}return r.shader=t,o},getShader:function(){return r.shader?r.shader:r.parent?r.parent.getShader():void 0},mesh:function(t){return r.meshData=t,o},getMesh:function(){return r.meshData},material:function(t){return r.material=t,o},enable:function(){r.enabled=!0},disable:function(){r.enabled=!1},getMaterial:function(){return r.material?r.material:r.parent?r.parent.getMaterial():void 0},addChild:function(t){return t?t.__private.parent=o:t=window.frag.Model(void 0,o),r.children.push(t),t},shadeSmooth:function(t){return void 0===t&&(t=-1),r.meshData&&r.meshData.shadeSmooth(),0===t||r.children.forEach((e=>{e.shadeSmooth(t-1)})),o},shadeFlat:function(t){return void 0===t&&(t=-1),r.meshData&&r.meshData.shadeFlat(),0===t||r.children.forEach((e=>{e.shadeFlat(t-1)})),o},textureSmooth:function(t){return void 0===t&&(t=-1),r.meshData&&r.meshData.textureSmooth(),0===t||r.children.forEach((e=>{e.textureSmooth(t-1)})),o},textureFlat:function(t){return void 0===t&&(t=-1),r.meshData&&r.meshData.textureFlat(),0===t||r.children.forEach((e=>{e.textureFlat(t-1)})),o},wireframe:function(t,e){return void 0===e&&(e=-1),r.meshData&&r.meshData.wireframe(t),0===e||r.children.forEach((n=>{n.wireframe(t,e-1)})),o},drawNormals:function(t,e,n){return void 0===n&&(n=-1),r.meshData&&r.meshData.drawNormals(t,e),0===n||r.children.forEach((r=>{r.drawNormals(t,e,n-1)})),o},addAnimation:function(t){const e=[];o.addFlattenedChildren(e,(function(t){return t.getName()}));const n=[],r=t.getChannelGraphs();for(let t=0;t<e.length;t++){const o=e[t],a=o.getName();for(let t=0;t<r.length;t++){const e=r[t];e.pattern.test(a)&&n.push({graph:e,model:o})}}return n.length>0&&o.animations.push({modelAnimation:t,childAnimations:n}),o},draw:function(t,e,a,i){if(!o.location)return o;const s=i&&r.name?i[r.name]:null,c=s?o.location.clone().add(s.location):o.location,l=c.getMatrix();c.is3d?(e=n.Matrix.m4Xm4(e,l),a=n.Matrix.m4Xm4(a,l)):(e=n.Matrix.m3Xm3(e,l),a=n.Matrix.m3Xm3(a,l));const u=t.shader||o.getShader();if(void 0!==u&&r.meshData&&r.enabled){if(u.bind(t.gl),t.isHitTest&&void 0!==u.uniforms.color){const e=t.sceneObjects.length-1,n=t.models.length;t.models.push(o);const r=e>>4,a=(15&e)<<4|(983040&n)>>16,i=(65280&n)>>8,s=255&n;t.gl.uniform4f(u.uniforms.color,r/255,a/255,i/255,s/255)}var f=o.getMaterial();f&&f.apply(t.gl,u),void 0!==u.uniforms.clipMatrix&&(c.is3d?n.Transform(a):n.Transform2D(a)).apply(t.gl,u.uniforms.clipMatrix),void 0!==u.uniforms.modelMatrix&&(c.is3d?n.Transform(e):n.Transform2D(e)).apply(t.gl,u.uniforms.modelMatrix),r.meshData.draw(t.gl,u),u.unbind(t.gl)}for(let n=0;n<r.children.length;n++)r.children[n].draw(t,e,a,i);return o}};return o}},5312:()=>{window.frag.Scene=function(){const t={sceneObjects:[],activeCamera:null,cameraUpdated:function(){}},e={__private:t,dispose:function(){t.activeCamera&&t.activeCamera.worldToClipTransform.observableMatrix.unsubscribe(t.cameraUpdated)},addObject:function(n){return t.sceneObjects.push(n),e},removeObject:function(e){for(let n=0;n<t.sceneObjects.length;n++)if(t.sceneObjects[n]===e)return t.sceneObjects.splice(n,1),!0;return!1},camera:function(n){return t.activeCamera&&t.activeCamera.worldToClipTransform.observableMatrix.unsubscribe(t.cameraUpdated),t.activeCamera=n,n&&n.worldToClipTransform.observableMatrix.subscribe(t.cameraUpdated),e},getCamera:function(){return t.activeCamera},setViewport:function(n){return t.activeCamera&&t.activeCamera.setViewport(n),e},adjustToViewport:function(n){return t.activeCamera&&t.activeCamera.adjustToViewport(n),e},draw:function(e){if(t.activeCamera){e.worldToClipTransform=t.activeCamera.worldToClipTransform;for(let n=0;n<t.sceneObjects.length;n++)t.sceneObjects[n].draw(e)}}};return e}},8390:()=>{window.frag.SceneObject=function(t){const e=window.frag,n={model:t,enabled:!0,location:null,animationLocation:null,animationMap:{}},r={__private:n,animations:{}};for(let e=0;e<t.animations.length;e++){const o=t.animations[e];for(let e=0;e<o.childAnimations.length;e++){const r=o.childAnimations[e].model.getName();if(!n.animationMap[r]){const e=window.frag.ObjectAnimationState();window.frag.debugAnimations&&(e.__private.modelName=t.getName(),e.__private.childModelName=r),n.animationMap[r]=e}}const a=window.frag.SceneObjectAnimation(o,n.animationMap);r.animations[o.modelAnimation.getName()]=a}return n.getLocation=function(){return n.location?n.location:n.model.location?(n.location=e.Location(n.model.location.is3d),n.location):null},n.getAnimationLocation=function(){return n.animationLocation?n.animationLocation:n.model.location?(n.animationLocation=e.Location(n.model.location.is3d),n.animationLocation):null},r.getPosition=function(){const t=n.getLocation();return t?e.ScenePosition(t):null},r.getAnimationPosition=function(){const t=n.getAnimationLocation();return t?e.ScenePosition(t):null},r.clearAnimationPosition=function(){return n.animationLocation=null,r},r.enable=function(){return n.enabled=!0,r},r.disable=function(){return n.enabled=!1,r},r.dispose=function(){r.disable();for(let t in r.animations)r.animations[t].dispose();return r},r.draw=function(t){if(!n.enabled)return r;let o=n.getLocation();if(!o)return r;n.animationLocation&&(o=o.clone().add(n.animationLocation));const a=t.worldToClipTransform.getMatrix(),i=o.getMatrix(),s=t.worldToClipTransform.is3d?e.Matrix.m4Xm4(a,i):e.Matrix.m3Xm3(a,i);return t.isHitTest&&t.sceneObjects.push(r),n.model.draw(t,i,s,n.animationMap),r},r}},7266:()=>{window.frag.ScenePosition=function(t){const e={location:null},n={__private:e,setLocation:function(t){return e.location=t||window.frag.Location(),n}};return n.setLocation(t),n.getMatrix=function(){return e.location.getMatrix()},n.getScaleX=function(){return e.location.scaleX},n.getScaleY=function(){return e.location.scaleY},n.getScaleZ=function(){return e.location.scaleZ},n.scale=function(t){return e.location.scaleX=t,e.location.scaleY=t,e.location.scaleZ=t,e.location.isModified=!0,n},n.scaleXYZ=function(t,r,o){return e.location.scaleX=t,e.location.scaleY=r,e.location.scaleZ=o,e.location.isModified=!0,n},n.scaleX=function(t){return e.location.scaleX=t,e.location.isModified=!0,n},n.scaleY=function(t){return e.location.scaleY=t,e.location.isModified=!0,n},n.scaleZ=function(t){return e.location.scaleZ=t,e.location.isModified=!0,n},n.scaleBy=function(t){n.scaleXYZ(e.location.scaleX*t[0],e.location.scaleY*t[1],e.location.scaleZ*t[2])},n.scaleByXYZ=function(t,r,o){n.scaleXYZ(e.location.scaleX*t,e.location.scaleY*r,e.location.scaleZ*o)},n.getRotateX=function(){return e.location.rotateX},n.getRotateY=function(){return e.location.rotateY},n.getRotateZ=function(){return e.location.rotateZ},n.getRotate=function(){return e.location.is3d?[e.location.rotateX,e.location.rotateY,e.location.rotateZ]:[e.location.rotateX,e.location.rotateY]},n.rotate=function(t){return e.location.rotateX=t[0],t.length>1&&(e.location.rotateY=t[1]),t.length>2&&(e.location.rotateZ=t[2]),e.location.isModified=!0,n},n.rotateXYZ=function(t,r,o){return e.location.rotateX=t,e.location.rotateY=r,e.location.rotateZ=o,e.location.isModified=!0,n},n.rotateX=function(t){return e.location.rotateX=t,e.location.isModified=!0,n},n.rotateY=function(t){return e.location.rotateY=t,e.location.isModified=!0,n},n.rotateZ=function(t){return e.location.rotateZ=t,e.location.isModified=!0,n},n.rotateBy=function(t){n.rotateXYZ(e.location.rotateX+t[0],e.location.rotateY+t[1],e.location.rotateZ+t[2])},n.rotateByXYZ=function(t,r,o){n.rotateXYZ(e.location.rotateX+t,e.location.rotateY+r,e.location.rotateZ+o)},n.getLocationX=function(){return e.location.translateX},n.getLocationY=function(){return e.location.translateY},n.getLocationZ=function(){return e.location.translateZ},n.getLocation=function(){return e.location.is3d?[e.location.translateX,e.location.translateY,e.location.translateZ]:[e.location.translateX,e.location.translateY]},n.location=function(t){return e.location.translateX=t[0],t.length>1&&(e.location.translateY=t[1]),t.length>2&&(e.location.translateZ=t[2]),e.location.isModified=!0,n},n.locationXYZ=function(t,r,o){return e.location.translateX=t,e.location.translateY=r,e.location.translateZ=o,e.location.isModified=!0,n},n.locationX=function(t){return e.location.translateX=t,e.location.isModified=!0,n},n.locationY=function(t){return e.location.translateY=t,e.location.isModified=!0,n},n.locationZ=function(t){return e.location.translateZ=t,e.location.isModified=!0,n},n.moveBy=function(t){n.locationXYZ(e.location.translateX+t[0],e.location.translateY+t[1],e.location.translateZ+t[2])},n.moveByXYZ=function(t,r,o){n.locationXYZ(e.location.translateX+t,e.location.translateY+r,e.location.translateZ+o)},n}},9288:()=>{window.frag.VertexData=function(){const t=window.frag,e=t.gl,n={},r={__private:n,primitiveType:e.TRIANGLES,vertexCount:0,verticies:void 0,vertexDimensions:3,colors:void 0,colorDimensions:3,uvs:void 0,uvDimensions:2,normals:void 0,normalDimensions:3,tangents:void 0,bitangents:void 0,clone:function(){const e=t.VertexData();return e.primitiveType=r.primitiveType,e.vertexCount=r.vertexCount,e.vertexDimensions=r.vertexDimensions,e.colorDimensions=r.colorDimensions,e.uvDimensions=r.uvDimensions,e.normalDimensions=r.normalDimensions,e.verticies=r.verticies,r.colors&&(e.colors=Array.from(r.colors)),r.uvs&&(e.uvs=Array.from(r.uvs)),r.normals&&(e.normals=Array.from(r.normals)),r.tangents&&(e.tangents=Array.from(r.tangents)),r.bitangents&&(e.bitangents=Array.from(r.bitangents)),e},vertexIndex:function(t,e){return t*r.vertexDimensions+(e||0)},colorIndex:function(t,e){return t*r.colorDimensions+(e||0)},uvIndex:function(t,e){return t*r.uvDimensions+(e||0)},normalIndex:function(t,e){return t*r.normalDimensions+(e||0)},tangentIndex:function(t,e){return t*r.normalDimensions+(e||0)},bitangentIndex:function(t,e){return t*r.normalDimensions+(e||0)}};return n.getVector=function(e,n,r){return 2===r?t.Vector.extract2D(e,n):t.Vector.extract3D(e,n)},n.setVector=function(t,e,n){for(i=0;i<n.length;i++)t[e+i]=n[i]},r.getVertexVector=function(t){return n.getVector(r.verticies,r.vertexIndex(t),r.vertexDimensions)},r.setVertexVector=function(t,e){return n.setVector(r.verticies,r.vertexIndex(t),e)},r.getColor=function(t){return n.getVector(r.colors,r.colorIndex(t),r.colorDimensions)},r.setColor=function(t,e){return n.setVector(r.colors,r.colorIndex(t),e)},r.getUvVector=function(t){return n.getVector(r.uvs,r.uvIndex(t),r.uvDimensions)},r.setUvVector=function(t,e){return n.setVector(r.uvs,r.uvIndex(t),e)},r.getNormalVector=function(t){return n.getVector(r.normals,r.normalIndex(t),r.normalDimensions)},r.setNormalVector=function(t,e){return n.setVector(r.normals,r.normalIndex(t),e)},r.getTangentVector=function(t){return n.getVector(r.tangents,r.tangentIndex(t),r.normalDimensions)},r.setTangentVector=function(t,e){return n.setVector(r.tangents,r.tangentIndex(t),e)},r.getBitangentVector=function(t){return n.getVector(r.bitangents,r.bitangentIndex(t),r.normalDimensions)},r.setBitangentVector=function(t,e){return n.setVector(r.bitangents,r.bitangentIndex(t),e)},r.setTriangles2D=function(t,n,o,a,i,s){return r.primitiveType=e.TRIANGLES,r.vertexDimensions=2,r.verticies=t,r.vertexCount=t.length/r.vertexDimensions,r.colorDimensions=3,r.colors=n,r.uvDimensions=2,r.uvs=o,r.normalDimensions=3,r.normals=a,r.tangents=i,r.bitangents=s,r.extractTriangles=function(t){for(let e=0;e<r.vertexCount;e+=3)t(e,e+1,e+2)},r},r.setTriangles=function(t,n,o,a,i,s){return r.primitiveType=e.TRIANGLES,r.vertexDimensions=3,r.verticies=t,r.vertexCount=t.length/r.vertexDimensions,r.colorDimensions=3,r.colors=n,r.uvDimensions=2,r.uvs=o,r.normalDimensions=3,r.normals=a,r.tangents=i,r.bitangents=s,r.extractTriangles=function(t){for(let e=0;e<r.vertexCount;e+=3)t(e,e+1,e+2)},r},r.setTriangleStrip=function(t,n,o,a,i,s){return r.primitiveType=e.TRIANGLE_STRIP,r.vertexDimensions=3,r.verticies=t,r.vertexCount=t.length/r.vertexDimensions,r.colorDimensions=3,r.colors=n,r.uvDimensions=2,r.uvs=o,r.normalDimensions=3,r.normals=a,r.tangents=i,r.bitangents=s,r.extractTriangles=function(t){const e=r.vertexCount-2;for(let n=0;n<e;n++)0==(1&n)?t(n,n+1,n+2):t(n+2,n+1,n)},r},r.setTriangleFan=function(t,n,o,a,i,s){return r.primitiveType=e.TRIANGLE_FAN,r.vertexDimensions=3,r.verticies=t,r.vertexCount=t.length/r.vertexDimensions,r.colorDimensions=3,r.colors=n,r.uvDimensions=2,r.uvs=o,r.normalDimensions=3,r.normals=a,r.tangents=i,r.bitangents=s,r.extractTriangles=function(t){const e=r.vertexCount-2;for(let n=0;n<e;n++)t(0,n+1,n+2)},r},r.setLines2D=function(t,n,o,a){return r.primitiveType=e.LINES,r.vertexDimensions=2,r.verticies=t,r.vertexCount=t.length/r.vertexDimensions,r.colorDimensions=3,r.colors=n,r.uvDimensions=2,r.uvs=o,r.normalDimensions=3,r.normals=a,r.tangents=null,r.bitangents=null,r.extractTriangles=function(){},r},r.setLines=function(t,n,o,a){return r.primitiveType=e.LINES,r.vertexDimensions=3,r.verticies=t,r.vertexCount=t.length/r.vertexDimensions,r.colorDimensions=3,r.colors=n,r.uvDimensions=2,r.uvs=o,r.normalDimensions=3,r.normals=a,r.tangents=null,r.bitangents=null,r.extractTriangles=function(){},r},r.setLineStrip=function(t,n,o,a){return r.primitiveType=e.LINE_STRIP,r.vertexDimensions=3,r.verticies=t,r.vertexCount=t.length/r.vertexDimensions,r.colorDimensions=3,r.colors=n,r.uvDimensions=2,r.uvs=o,r.normalDimensions=3,r.normals=a,r.tangents=null,r.bitangents=null,r.extractTriangles=function(){},r},r}},3798:()=>{window.frag.createShader=function(t,e,n){const r=window.frag.gl;console.log("\n// "+t+" "+(e===r.VERTEX_SHADER?"vertex":"fragment")+" shader\n"+n);var o=r.createShader(e);if(r.shaderSource(o,n),r.compileShader(o),r.getShaderParameter(o,r.COMPILE_STATUS))return o;console.error("Failed to compile shader "+t),console.log(r.getShaderInfoLog(o)),r.deleteShader(o)},window.frag.createProgram=function(t,e,n){const r=window.frag,o=r.gl;var a=o.createProgram();if(o.attachShader(a,e),o.attachShader(a,n),o.linkProgram(a),o.getProgramParameter(a,o.LINK_STATUS))return a;console.error("Failed to link shaders into program "+t),console.log(r.gl.getProgramInfoLog(a)),o.deleteProgram(a)},window.frag.CustomShader=function(t){const e={name:"Custom",vSource:null,fSource:null,bindList:[],unbindList:[]},n={__private:e,attributes:{},uniforms:{},is3d:void 0===t||t,name:function(t){return e.name=t,n},source:function(t,r){console.log("\n// "+e.name+" vertext shader\n"+t),console.log("\n// "+e.name+" fragment shader\n"+r),e.vSource=t,e.fSource=r;const o=frag.createShader(e.name,frag.gl.VERTEX_SHADER,t),a=frag.createShader(e.name,frag.gl.FRAGMENT_SHADER,r);return n.program=frag.createProgram(e.name,o,a),n},onBind:function(t){return e.bindList.push(t),n},onUnbind:function(t){return e.unbindList.push(t),n},attribute:function(t){if(!n.program)return console.error("You must set the "+e.name+" shader source before defining attributes"),n;const r=frag.gl.getAttribLocation(n.program,"a_"+t);return void 0===r?(console.error("Shader program "+e.name+" does not have attribute a_"+t),n):(n.attributes[t]=r,n)},uniform:function(t,r,o){if(!n.program)return console.error("You must set the "+e.name+" shader source before defining uniforms"),n;const a=frag.gl.getUniformLocation(n.program,"u_"+t);return a?(n.uniforms[t]=a,r&&(e[t]=o,n[t]=function(r){return e[t]=r,n},e.bindList.push((function(n){void 0!==e[t]&&n["uniform"+r](a,e[t])}))),n):(console.error("Shader program "+e.name+" does not have uniform u_"+t),n)},bind:function(t){return t.useProgram(n.program),e.bindList.forEach((e=>e(t))),n},unbind:function(t){return e.unbindList.forEach((e=>e(t))),n}};return n}},7218:()=>{window.frag.startFunctions.push((function(t){t.fontShader=t.CustomShader().name("Font").source("attribute vec4 a_position;\nattribute vec2 a_texcoord;\nattribute vec3 a_normal;\nuniform mat4 u_modelMatrix;\nuniform mat4 u_clipMatrix;\nuniform vec3 u_lightDirection;\nvarying vec2 v_texcoord;\nvarying vec3 v_lightDirection;\nvarying vec3 v_normal;\nvoid main() {\n  vec4 position = a_position;\n  position = u_clipMatrix * position;\n  gl_Position = position;\n  v_texcoord = a_texcoord;\n  v_normal = (u_modelMatrix * vec4(a_normal, 0)).xyz;\n  v_lightDirection = u_lightDirection;\n}","precision mediump float;\nuniform sampler2D u_diffuse;\nuniform float u_ambientLight;\nvarying vec2 v_texcoord;\nvarying vec3 v_lightDirection;\nvarying vec3 v_normal;\nvoid main() {\n  vec3 normal = normalize(v_normal);\n  vec3 lightDirection = v_lightDirection;\n  float light = max(dot(normal, lightDirection), 0.0);\n  light += u_ambientLight;\n  gl_FragColor = vec4(0, 0, 0, 1.0);\n  gl_FragColor += texture2D(u_diffuse, vec2(v_texcoord.x, 1.0 - v_texcoord.y));\n  gl_FragColor.rgb *= light;\n}\n").uniform("clipMatrix").uniform("diffuse")}))},2198:()=>{window.frag.Shader=function(){const t="None",e={name:"Custom",verticies:"XYZ",x:0,y:0,z:0,colors:t,matrix:"mat4",textureCoords:t,diffuseTexture:t,emmissiveTexture:t,displacementTexture:t,normalMap:t,roughnessTexture:t,shininessTexture:t,metalinessTexture:t,normals:t,tangents:t,bitangents:t,directionalLight:t,ambientLight:t},n={__private:e,name:function(t){return e.name=t,n},verticiesXY:function(t){return e.verticies="XY",e.z=t,n},verticiesXZ:function(t){return e.verticies="XZ",e.y=t,n},verticiesYZ:function(t){return e.verticies="YZ",e.x=t,n},verticiesXYZ:function(){return e.verticies="XYZ",n},verticiesNone:function(){return e.verticies=t,n},matrix2D:function(){return e.matrix="mat3",n},matrix3D:function(){return e.matrix="mat4",n},matrixNone:function(){return e.matrix=t,n},normals:function(){return e.normals="vec3",n},colorsRGB:function(){return e.colors="vec3",n},colorsRGBA:function(){return e.colors="vec4",n},colorsNone:function(){return e.colors=t,n},diffuseTexture:function(){return e.diffuseTexture="RGB",e.colors=t,e.textureCoords===t&&(e.textureCoords="vec2"),n},emmissiveTexture:function(){return e.emmissiveTexture="RGB",e.textureCoords===t&&(e.textureCoords="vec2"),n},normalMapStandard:function(){return e.normalMap="Standard",e.textureCoords===t&&(e.textureCoords="vec2"),e.normals===t&&(e.normals="vec3"),e.tangents===t&&(e.tangents="vec3"),n},normalMapOpenGL:function(){return e.normalMap="OpenGL",e.textureCoords===t&&(e.textureCoords="vec2"),e.normals===t&&(e.normals="vec3"),e.tangents===t&&(e.tangents="vec3"),n},displacementTextureRaised:function(){return e.displacementTexture="Raised",e.textureCoords===t&&(e.textureCoords="vec2"),e.normals===t&&(e.normals="vec3"),n},displacementTextureSunken:function(){return e.displacementTexture="Sunken",e.textureCoords===t&&(e.textureCoords="vec2"),e.normals===t&&(e.normals="vec3"),n},displacementTextureSigned:function(){return e.displacementTexture="Signed",e.textureCoords===t&&(e.textureCoords="vec2"),e.normals===t&&(e.normals="vec3"),n},tangents:function(){return e.tangents="vec3",e.normals===t&&(e.normals="vec3"),n},bitangents:function(){return e.bitangents="vec3",e.normals===t&&(e.normals="vec3"),n},directionalLightColor:function(){return n.matrix3D(),e.directionalLight="Color",e.ambientLight===t&&(e.ambientLight="Balanced"),e.normals===t&&(e.normals="vec3"),n},directionalLightWhite:function(){return n.matrix3D(),e.directionalLight="White",e.ambientLight===t&&(e.ambientLight=t),e.normals===t&&(e.normals="vec3"),n},directionalLightGrey:function(){return n.matrix3D(),e.directionalLight="Grey",e.ambientLight===t&&(e.ambientLight="Balanced"),e.normals===t&&(e.normals="vec3"),n},directionalLightNone:function(){return e.directionalLight=t,n},ambientLightBalanced:function(){return e.ambientLight="Balanced",n},ambientLightNone:function(){return e.ambientLight=t,n},ambientLightFixed:function(){return e.ambientLight="Fixed",n}};return e.addAttributeDeclarations=function(n){"XYZ"===e.verticies?n.vSource+="attribute vec4 a_position;\n":e.verticies!==t&&(n.vSource+="attribute vec2 a_position;\n"),e.colors!==t&&(n.vSource+="attribute "+e.colors+" a_color;\n"),e.textureCoords!==t&&(n.vSource+="attribute "+e.textureCoords+" a_texcoord;\n"),e.normals!==t&&(n.vSource+="attribute "+e.normals+" a_normal;\n"),e.tangents!==t&&(n.vSource+="attribute "+e.tangents+" a_tangent;\n"),e.bitangents!==t&&(n.vSource+="attribute "+e.bitangents+" a_bitangent;\n")},e.addUniformDeclarations=function(n){e.matrix!==t&&(e.directionalLight!==t&&(n.vSource+="uniform "+e.matrix+" u_modelMatrix;\n"),n.vSource+="uniform "+e.matrix+" u_clipMatrix;\n"),e.directionalLight!==t&&(n.vSource+="uniform vec3 u_lightDirection;\n"),"Color"===e.directionalLight&&(n.vSource+="uniform vec3 u_lightColor;\n"),e.displacementTexture!==t&&(n.vSource+="uniform float u_displacementScale;\n"),e.displacementTexture===t&&e.roughnessTexture===t&&e.shininessTexture==t||(n.vSource+="uniform sampler2D u_surface;\n"),e.normalMap!==t&&(n.fSource+="uniform sampler2D u_normalMap;\n"),e.textureCoords!==t&&(e.diffuseTexture!==t&&(n.fSource+="uniform sampler2D u_diffuse;\n"),e.emmissiveTexture!==t&&(n.fSource+="uniform sampler2D u_emmissive;\n")),e.ambientLight!==t&&(n.fSource+="uniform float u_ambientLight;\n")},e.addVaryingDeclarations=function(n){const r=function(t,e){const r="varying "+t+" "+e+";\n";n.vSource+=r,n.fSource+=r};e.textureCoords!==t&&r(e.textureCoords,"v_texcoord"),e.colors!==t&&r(e.colors,"v_color"),e.directionalLight!==t&&(r("vec3","v_lightDirection"),"Color"===e.directionalLight&&r("vec3","v_lightColor"),e.normalMap===t&&r(e.normals,"v_normal"))},e.addLogic=function(n){"XYZ"===e.verticies?n.vSource+="  vec4 position = a_position;\n":e.verticies!==t&&(n.vSource+="  vec2 position = a_position;\n"),e.displacementTexture===t&&e.roughnessTexture===t&&e.shininessTexture==t||(n.vSource+="  vec4 surface = texture2D(u_surface, vec2(a_texcoord.x, 1.0 - a_texcoord.y));\n"),e.displacementTexture!==t&&"XYZ"===e.verticies&&"vec3"===e.normals&&("Sunken"===e.displacementTexture?n.vSource+="  float displacement = -surface.r;\n":"Signed"===e.displacementTexture?n.vSource+="  float displacement = surface.r * 2.0 - 1.0;\n":"Raised"===e.displacementTexture&&(n.vSource+="  float displacement = surface.r;\n"),n.vSource+="  position = vec4(position.xyz + (a_normal * displacement * u_displacementScale), position.w);\n"),"XYZ"===e.verticies?n.vSource+="  position = u_clipMatrix * position;\n":e.verticies!==t&&(n.vSource+="  position = (u_clipMatrix * vec3(position, 1)).xy;\n"),"XYZ"===e.verticies?n.vSource+="  gl_Position = position;\n":"XY"===e.verticies?n.vSource+="  gl_Position = vec4(position, "+e.z+", 1);\n":"XZ"===e.verticies?n.vSource+="  gl_Position = vec4(position.x, "+e.y+", position.y, 1);\n":"YZ"===e.verticies&&(n.vSource+="  gl_Position = vec4("+e.x+", position, 1);\n"),e.textureCoords!==t&&(n.vSource+="  v_texcoord = a_texcoord;\n"),e.directionalLight!==t?(e.normalMap!==t?(n.vSource+="  vec3 T = normalize(vec3(u_modelMatrix * vec4(a_tangent, 0.0)));\n",e.bitangents!==t?n.vSource+="  vec3 B = normalize(vec3(u_modelMatrix * vec4(a_bitangent, 0.0)));\n":n.vSource+="  vec3 B = normalize(vec3(u_modelMatrix * vec4(cross(a_normal, a_tangent), 0.0)));\n",n.vSource+="  vec3 N = normalize(vec3(u_modelMatrix * vec4(a_normal, 0.0)));\n",n.vSource+="  mat3 TBN = transpose(mat3(T, B, N));\n",n.vSource+="  v_lightDirection = TBN * u_lightDirection;\n",n.fSource+="  vec3 normal = texture2D(u_normalMap, vec2(v_texcoord.x, 1.0 - v_texcoord.y)).rgb * 2.0 - 1.0;\n"):(n.vSource+="  v_normal = (u_modelMatrix * vec4(a_normal, 0)).xyz;\n",n.vSource+="  v_lightDirection = u_lightDirection;\n",n.fSource+="  vec3 normal = normalize(v_normal);\n"),n.fSource+="  vec3 lightDirection = v_lightDirection;\n",n.fSource+="  float light = max(dot(normal, lightDirection), 0.0);\n",e.ambientLight!==t&&(n.fSource+="  light += u_ambientLight;\n")):e.ambientLight!==t&&(n.fSource+="  float light = u_ambientLight;\n"),"Color"===e.directionalLight&&(n.vSource+="  v_lightColor = u_lightColor;\n"),e.colors===t?n.fSource+="  gl_FragColor = vec4(0, 0, 0, 1.0);\n":"vec4"===e.colors?(n.vSource+="  v_color = a_color;\n",n.fSource+="  gl_FragColor = v_color;\n"):(n.vSource+="  v_color = a_color;\n",n.fSource+="  gl_FragColor = vec4(v_color, 1.0);\n"),"vec2"===e.textureCoords&&"RGB"===e.diffuseTexture&&(n.fSource+="  gl_FragColor += texture2D(u_diffuse, vec2(v_texcoord.x, 1.0 - v_texcoord.y));\n"),e.ambientLight===t&&e.directionalLight===t||(n.fSource+="  gl_FragColor.rgb *= light;\n"),"vec2"===e.textureCoords&&"RGB"===e.emmissiveTexture&&(n.fSource+="  gl_FragColor.rgb += texture2D(u_emmissive, vec2(v_texcoord.x, 1.0 - v_texcoord.y)).rgb;\n")},n.compile=function(){const n={name:e.name,vSource:"",fSource:"precision mediump float;\n",attributes:{},uniforms:{},is3d:"mat4"===e.matrix};e.addAttributeDeclarations(n),e.addUniformDeclarations(n),e.addVaryingDeclarations(n),e.directionalLight!==t&&(n.vSource+="highp mat3 transpose(in highp mat3 inMatrix) {\n",n.vSource+="    highp vec3 i0 = inMatrix[0];\n",n.vSource+="    highp vec3 i1 = inMatrix[1];\n",n.vSource+="    highp vec3 i2 = inMatrix[2];\n",n.vSource+="    highp mat3 outMatrix = mat3(\n",n.vSource+="        vec3(i0.x, i1.x, i2.x),\n",n.vSource+="        vec3(i0.y, i1.y, i2.y),\n",n.vSource+="        vec3(i0.z, i1.z, i2.z)\n",n.vSource+="    );\n",n.vSource+="    return outMatrix;\n",n.vSource+="}\n"),n.vSource+="void main() {\n",n.fSource+="void main() {\n",e.addLogic(n),n.vSource+="}\n",n.fSource+="}\n";const r=frag.createShader(n.name,frag.gl.VERTEX_SHADER,n.vSource),o=frag.createShader(n.name,frag.gl.FRAGMENT_SHADER,n.fSource);if(n.program=frag.createProgram(n.name,r,o),!n.program)return null;const a=[],i=[];if(e.verticies!==t&&(n.attributes.position=frag.gl.getAttribLocation(n.program,"a_position")),e.colors!==t&&(n.attributes.color=frag.gl.getAttribLocation(n.program,"a_color")),e.textureCoords!==t&&(n.attributes.texture=frag.gl.getAttribLocation(n.program,"a_texcoord")),e.normals!==t&&(n.attributes.normal=frag.gl.getAttribLocation(n.program,"a_normal")),e.tangents!==t&&(n.attributes.tangent=frag.gl.getAttribLocation(n.program,"a_tangent")),e.bitangents!==t&&(n.attributes.bitangent=frag.gl.getAttribLocation(n.program,"a_bitangent")),e.matrix!==t&&(e.directionalLight!==t&&(n.uniforms.modelMatrix=frag.gl.getUniformLocation(n.program,"u_modelMatrix")),n.uniforms.clipMatrix=frag.gl.getUniformLocation(n.program,"u_clipMatrix")),e.diffuseTexture!==t&&(n.uniforms.diffuse=frag.gl.getUniformLocation(n.program,"u_diffuse")),e.emmissiveTexture!==t&&(n.uniforms.emmissive=frag.gl.getUniformLocation(n.program,"u_emmissive")),e.displacementTexture===t&&e.roughnessTexture===t&&e.shininessTexture==t||(n.uniforms.surface=frag.gl.getUniformLocation(n.program,"u_surface")),e.displacementTexture!==t&&(n.uniforms.displacementScale=frag.gl.getUniformLocation(n.program,"u_displacementScale"),a.push((function(t){t.uniform1f(n.uniforms.displacementScale,n._displacementScale)})),n._displacementScale=.2,n.displacementScale=function(t){return n._displacementScale=t,n}),e.normalMap!==t&&(n.uniforms.normalMap=frag.gl.getUniformLocation(n.program,"u_normalMap")),e.ambientLight!==t&&(n.uniforms.ambientLight=frag.gl.getUniformLocation(n.program,"u_ambientLight"),a.push((function(t){t.uniform1f(n.uniforms.ambientLight,n._ambientLight)})),n._ambientLight=.5),e.directionalLight!==t){n.uniforms.lightDirection=frag.gl.getUniformLocation(n.program,"u_lightDirection"),a.push((function(t){t.uniform3fv(n.uniforms.lightDirection,n._lightDirection)})),"Color"===e.directionalLight&&(n.uniforms.lightColor=frag.gl.getUniformLocation(n.program,"u_lightColor"),a.push((function(t){t.uniform3fv(n.uniforms.lightColor,n._lightColor)})),n.lightColor=function(t){return n._lightColor=t,n});const t="Balanced"===e.ambientLight;n.lightDirection=function(e){const r=window.frag.Vector.length(e);return r>1?(n._lightDirection=[-e[0]/r,-e[1]/r,-e[2]/r],t&&(n._ambientLight=0)):(n._lightDirection=[-e[0],-e[1],-e[2]],t&&(n._ambientLight=1-r)),n},"White"===e.directionalLight?n.lightDirection([.8,-.2,.8]):"Grey"===e.directionalLight&&n.lightDirection([.5,-.1,.5])}return n.bind=function(t){t.useProgram(n.program),a.forEach((e=>e(t)))},n.unbind=function(t){i.forEach((e=>e(t)))},n},n}},3743:()=>{window.frag.startFunctions.push((function(t){t.uiShader=t.Shader().name("UI").verticiesXY(-1).matrix2D().diffuseTexture().compile()}))},9914:()=>{window.frag.Cube=function(t,e){void 0===(e=e||{}).drawFront&&(e.drawFront=!0),void 0===e.drawBack&&(e.drawBack=!0),void 0===e.drawTop&&(e.drawTop=!0),void 0===e.drawBottom&&(e.drawBottom=!0),void 0===e.drawLeft&&(e.drawLeft=!0),void 0===e.drawRight&&(e.drawRight=!0);let n=1/4,r=.5,o=1/3,a=2/3;const i=[[-1,-1,-1],[1,-1,-1],[1,1,-1],[-1,1,-1],[1,-1,1],[-1,-1,1],[-1,1,1],[1,1,1]],s=[],c=[],l=e.color?[]:void 0,u=function(t){s.push(t[0]),s.push(t[1]),s.push(t[2]),e.color&&e.color.forEach((t=>{l.push(t)}))},f=function(t,e){c.push(t),c.push(e)},m=function(t,e,n,r){u(t),u(e),u(n),u(r),u(n),u(e)},d=function(t,e,n,r){f(n,e),f(n,r),f(t,e),f(t,r),f(t,e),f(n,r)},g=function(e,n,r,o,a,s,c){for(var l=0;l<t;l++){const u=l/t,f=(l+1)/t,g=(c-a)*u+a,h=(c-a)*f+a;for(hFacet=0;hFacet<t;hFacet++){const a=hFacet/t,c=(hFacet+1)/t,l=window.frag.Vector,v=l.sub(i[r],i[n]),p=l.sub(i[e],i[n]),x=l.add(l.add(i[n],l.mult(p,a)),l.mult(v,u)),T=l.add(l.add(i[n],l.mult(p,c)),l.mult(v,u)),b=l.add(l.add(i[n],l.mult(p,a)),l.mult(v,f)),w=l.add(l.add(i[n],l.mult(p,c)),l.mult(v,f));m(T,w,x,b),d((s-o)*a+o,g,(s-o)*c+o,h)}}};return e.duplicateTexture?(e.drawFront&&g(1,0,3,1,1,0,0),e.drawBottom&&g(4,5,0,1,1,0,0),e.drawLeft&&g(0,5,6,1,1,0,0),e.drawRight&&g(4,1,2,1,1,0,0),e.drawBack&&g(5,4,7,1,1,0,0),e.drawTop&&g(6,7,2,1,1,0,0)):(e.drawFront&&g(1,0,3,n,a,0,o),e.drawBottom&&g(4,5,0,r,a,n,o),e.drawLeft&&g(0,5,6,r,a,n,1),e.drawRight&&g(4,1,2,n,o,r,0),e.drawBack&&g(5,4,7,r,o,.75,a),e.drawTop&&g(6,7,2,.75,o,1,a)),window.frag.MeshData().addTriangles(s,l,c)}},6499:()=>{window.frag.Cylinder=function(t,e){t=t||32;const n=[0,0,-1],r=[.5,.5],o=[0,0,-1],a=(e=e||{}).color?Array.from(e.color):void 0,i=[0,0,1],s=[.5,.5],c=[0,0,1],l=e.color?Array.from(e.color):void 0,u=[],f=e.color?[]:void 0,m=[],d=[],g=2*Math.PI/t;for(var h=0;h<=t;h++){const t=-h*g,i=Math.sin(t),s=Math.cos(t);n.push(i),n.push(s),n.push(-1),e.color&&e.color.forEach((t=>a.push(t))),r.push(.5*(i+1)),r.push(.5*(s+1)),o.push(i),o.push(s),o.push(-1),u.push(i),u.push(s),u.push(-1),u.push(i),u.push(s),u.push(1),e.color&&(e.color.forEach((t=>f.push(t))),e.color.forEach((t=>f.push(t)))),m.push(.5*(i+1)),m.push(.5*(s+1)),m.push(.5*(i+1)),m.push(.5*(s+1)),d.push(i),d.push(s),d.push(0),d.push(i),d.push(s),d.push(0)}for(h=0;h<=t;h++){const t=h*g,n=Math.sin(t),r=Math.cos(t);i.push(n),i.push(r),i.push(1),e.color&&e.color.forEach((t=>l.push(t))),s.push(.5*(n+1)),s.push(.5*(r+1)),c.push(n),c.push(r),c.push(1)}return u.push(0),u.push(1),u.push(1),e.color&&e.color.forEach((t=>f.push(t))),m.push(.5),m.push(1),d.push(0),d.push(1),d.push(0),window.frag.MeshData().addTriangleFan(n,a,r,o).addTriangleFan(i,l,s,c).addTriangleStrip(u,f,m,d)}},9022:()=>{window.frag.Disc=function(t,e){t=t||32,e=e||{};const n=[0,0,0],r=[.5,.5],o=[0,0,-1],a=2*Math.PI/t;for(var i=0;i<=t;i++){const t=-i*a,e=Math.sin(t),s=Math.cos(t);n.push(e),n.push(s),n.push(0),o.push(0),o.push(0),o.push(-1),r.push(.5*(e+1)),r.push(.5*(s+1))}return window.frag.MeshData().addTriangleFan(n,r,o)}},1950:()=>{window.frag.Plane=function(t,e){if(e=e||{},1===(t=t||1)){const t=e.color||[0,0,0],n=new Float32Array([1,-1,0,1,1,0,-1,-1,0,-1,1,0,t[0],t[1],t[2],t[0],t[1],t[2],t[0],t[1],t[2],t[0],t[1],t[2],1,0,1,1,0,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0]);return window.frag.MeshData().fromBuffer(n.buffer,3,4,window.frag.gl.TRIANGLE_STRIP,0*Float32Array.BYTES_PER_ELEMENT,12*Float32Array.BYTES_PER_ELEMENT,24*Float32Array.BYTES_PER_ELEMENT,32*Float32Array.BYTES_PER_ELEMENT,44*Float32Array.BYTES_PER_ELEMENT,56*Float32Array.BYTES_PER_ELEMENT)}const n=[],r=[],o=[],a=e.color?[]:void 0,i=function(t,i){n.push(t),n.push(i),n.push(0),e.color&&e.color.forEach((t=>a.push(t))),r.push(.5*(t+1)),r.push(.5*(i+1)),o.push(0),o.push(0),o.push(-1)};for(var s=0;s<t;s++){const e=2*(t-s-1)/t-1,n=2*(t-s)/t-1;if(0==(1&s)){i(1,e);for(var c=0;c<t;c++){const r=2*(t-c-1)/t-1;i(2*(t-c)/t-1,n),i(r,e)}i(-1,n)}else{for(i(-1,n),c=0;c<t;c++){const r=2*(c+1)/t-1;i(2*c/t-1,e),i(r,n)}i(1,e)}}return window.frag.MeshData().addTriangleStrip(n,a,r,o)}}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r(6601),r(8197),r(7996),r(7904),r(9607),r(1346),r(9670),r(1821),r(6437),r(3798),r(2198),r(3743),r(7218),r(8394),r(2636),r(4655),r(9288),r(1175),r(1003),r(2816),r(7266),r(8390),r(5312),r(3270),r(3014),r(3906),r(6627),r(9023),r(5363),r(3890),r(9889),r(4600),r(9622),r(666),r(2201),r(9914),r(6499),r(9022),r(1950),r(6237),r(4583),r(956),r(9810),r(7802),r(3235),r(6784),r(8562),r(280),r(8853),r(5217)})();
//# sourceMappingURL=frag.min.js.map